const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/core-BXHNsp4W.js","assets/index-CUmGNwr3.js","assets/index-Dn6Kqrs6.css","assets/events-C1MKdq7K.js","assets/index-nibyPLVP.js"])))=>i.map(i=>d[i]);
var Ay=Object.defineProperty;var Py=(t,e,r)=>e in t?Ay(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Y=(t,e,r)=>Py(t,typeof e!="symbol"?e+"":e,r);import{cY as By,db as Mt,cT as Cy,dc as Ty}from"./index-CUmGNwr3.js";import{e as It,F as lc}from"./events-C1MKdq7K.js";import{c as Ry,a as Ny,k as Uy,d as ky,s as jy,g as cl}from"./index-nibyPLVP.js";/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Bf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Cf(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function wn(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function _s(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function mn(t){if(!Array.isArray(t))throw new Error("array expected")}function bn(t,e){if(!Cf(!0,e))throw new Error(`${t}: array of strings expected`)}function Tf(t,e){if(!Cf(!1,e))throw new Error(`${t}: array of numbers expected`)}function Rf(...t){const e=n=>n,r=(n,o)=>a=>n(o(a)),i=t.map(n=>n.encode).reduceRight(r,e),s=t.map(n=>n.decode).reduce(r,e);return{encode:i,decode:s}}function Nf(t){const e=typeof t=="string"?t.split(""):t,r=e.length;bn("alphabet",e);const i=new Map(e.map((s,n)=>[s,n]));return{encode:s=>(mn(s),s.map(n=>{if(!Number.isSafeInteger(n)||n<0||n>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${n}". Allowed: ${t}`);return e[n]})),decode:s=>(mn(s),s.map(n=>{wn("alphabet.decode",n);const o=i.get(n);if(o===void 0)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return o}))}}function Uf(t=""){return wn("join",t),{encode:e=>(bn("join.decode",e),e.join(t)),decode:e=>(wn("join.decode",e),e.split(t))}}function Fy(t,e="="){return _s(t),wn("padding",e),{encode(r){for(bn("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){bn("padding.decode",r);let i=r.length;if(i*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&r[i-1]===e;i--)if((i-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,i)}}}function ll(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(mn(t),!t.length)return[];let i=0;const s=[],n=Array.from(t,a=>{if(_s(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),o=n.length;for(;;){let a=0,c=!0;for(let l=i;l<o;l++){const u=n[l],h=e*a,f=h+u;if(!Number.isSafeInteger(f)||h/e!==a||f-u!==h)throw new Error("convertRadix: carry overflow");const d=f/r;a=f%r;const g=Math.floor(d);if(n[l]=g,!Number.isSafeInteger(g)||g*r+a!==f)throw new Error("convertRadix: carry overflow");if(c)g?c=!1:i=l;else continue}if(s.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)s.push(0);return s.reverse()}const kf=(t,e)=>e===0?t:kf(e,t%e),vn=(t,e)=>t+(e-kf(t,e)),lo=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function ul(t,e,r,i){if(mn(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(vn(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${vn(e,r)}`);let s=0,n=0;const o=lo[e],a=lo[r]-1,c=[];for(const l of t){if(_s(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(s=s<<e|l,n+e>32)throw new Error(`convertRadix2: carry overflow pos=${n} from=${e}`);for(n+=e;n>=r;n-=r)c.push((s>>n-r&a)>>>0);const u=lo[n];if(u===void 0)throw new Error("invalid carry");s&=u-1}if(s=s<<r-n&a,!i&&n>=e)throw new Error("Excess padding");if(!i&&s>0)throw new Error(`Non-zero padding: ${s}`);return i&&n>0&&c.push(s>>>0),c}function Ly(t){_s(t);const e=2**8;return{encode:r=>{if(!Bf(r))throw new Error("radix.encode input should be Uint8Array");return ll(Array.from(r),e,t)},decode:r=>(Tf("radix.decode",r),Uint8Array.from(ll(r,t,e)))}}function My(t,e=!1){if(_s(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(vn(8,t)>32||vn(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!Bf(r))throw new Error("radix2.encode input should be Uint8Array");return ul(Array.from(r),8,t,!e)},decode:r=>(Tf("radix2.decode",r),Uint8Array.from(ul(r,t,8,e)))}}const qy=Rf(My(5),Nf("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Fy(5),Uf("")),zy=t=>Rf(Ly(58),Nf(t),Uf("")),Ss=zy("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");var hl=function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},Vy=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),Hy=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Ky=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),Wy=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Gy=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Yy=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Zy=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,fl=3,Jy=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Yy]],dl=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Xy(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Gy:typeof navigator<"u"?e0(navigator.userAgent):r0()}function Qy(t){return t!==""&&Jy.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var n=s.exec(t);return!!n&&[i,n]},!1)}function e0(t){var e=Qy(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new Wy;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<fl&&(s=hl(hl([],s,!0),i0(fl-s.length),!0)):s=[];var n=s.join("."),o=t0(t),a=Zy.exec(t);return a&&a[1]?new Ky(r,n,o,a[1]):new Vy(r,n,o)}function t0(t){for(var e=0,r=dl.length;e<r;e++){var i=dl[e],s=i[0],n=i[1],o=n.exec(t);if(o)return s}return null}function r0(){var t=typeof process<"u"&&process.version;return t?new Hy(process.version.slice(1)):null}function i0(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var M={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ha=function(t,e){return ha=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s])},ha(t,e)};function s0(t,e){ha(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var fa=function(){return fa=Object.assign||function(e){for(var r,i=1,s=arguments.length;i<s;i++){r=arguments[i];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fa.apply(this,arguments)};function n0(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(r[i[s]]=t[i[s]]);return r}function o0(t,e,r,i){var s=arguments.length,n=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(n=(s<3?o(n):s>3?o(e,r,n):o(e,r))||n);return s>3&&n&&Object.defineProperty(e,r,n),n}function a0(t,e){return function(r,i){e(r,i,t)}}function c0(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function l0(t,e,r,i){function s(n){return n instanceof r?n:new r(function(o){o(n)})}return new(r||(r=Promise))(function(n,o){function a(u){try{l(i.next(u))}catch(h){o(h)}}function c(u){try{l(i.throw(u))}catch(h){o(h)}}function l(u){u.done?n(u.value):s(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function u0(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},i,s,n,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(n=l[0]&2?s.return:l[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,l[1])).done)return n;switch(s=0,n&&(l=[l[0]&2,n.value]),l[0]){case 0:case 1:n=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,s=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(n=r.trys,!(n=n.length>0&&n[n.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!n||l[1]>n[0]&&l[1]<n[3])){r.label=l[1];break}if(l[0]===6&&r.label<n[1]){r.label=n[1],n=l;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(l);break}n[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(u){l=[6,u],s=0}finally{i=n=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function h0(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function f0(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function da(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function jf(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),s,n=[],o;try{for(;(e===void 0||e-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return n}function d0(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(jf(arguments[e]));return t}function p0(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),s=0,e=0;e<r;e++)for(var n=arguments[e],o=0,a=n.length;o<a;o++,s++)i[s]=n[o];return i}function gs(t){return this instanceof gs?(this.v=t,this):new gs(t)}function g0(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),s,n=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){i[f]&&(s[f]=function(d){return new Promise(function(g,w){n.push([f,d,g,w])>1||a(f,d)})})}function a(f,d){try{c(i[f](d))}catch(g){h(n[0][3],g)}}function c(f){f.value instanceof gs?Promise.resolve(f.value.v).then(l,u):h(n[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,d){f(d),n.shift(),n.length&&a(n[0][0],n[0][1])}}function y0(t){var e,r;return e={},i("next"),i("throw",function(s){throw s}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(s,n){e[s]=t[s]?function(o){return(r=!r)?{value:gs(t[s](o)),done:s==="return"}:n?n(o):o}:n}}function w0(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof da=="function"?da(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(n){r[n]=t[n]&&function(o){return new Promise(function(a,c){o=t[n](o),s(a,c,o.done,o.value)})}}function s(n,o,a,c){Promise.resolve(c).then(function(l){n({value:l,done:a})},o)}}function m0(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function b0(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function v0(t){return t&&t.__esModule?t:{default:t}}function E0(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function x0(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}const I0=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return fa},__asyncDelegator:y0,__asyncGenerator:g0,__asyncValues:w0,__await:gs,__awaiter:l0,__classPrivateFieldGet:E0,__classPrivateFieldSet:x0,__createBinding:h0,__decorate:o0,__exportStar:f0,__extends:s0,__generator:u0,__importDefault:v0,__importStar:b0,__makeTemplateObject:m0,__metadata:c0,__param:a0,__read:jf,__rest:n0,__spread:d0,__spreadArrays:p0,__values:da},Symbol.toStringTag,{value:"Module"})),Os=By(I0);var uo={},qi={},pl;function _0(){if(pl)return qi;pl=1,Object.defineProperty(qi,"__esModule",{value:!0}),qi.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return qi.delay=t,qi}var qr={},ho={},zr={},gl;function S0(){return gl||(gl=1,Object.defineProperty(zr,"__esModule",{value:!0}),zr.ONE_THOUSAND=zr.ONE_HUNDRED=void 0,zr.ONE_HUNDRED=100,zr.ONE_THOUSAND=1e3),zr}var fo={},yl;function O0(){return yl||(yl=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(fo)),fo}var wl;function Ff(){return wl||(wl=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Os;e.__exportStar(S0(),t),e.__exportStar(O0(),t)}(ho)),ho}var ml;function D0(){if(ml)return qr;ml=1,Object.defineProperty(qr,"__esModule",{value:!0}),qr.fromMiliseconds=qr.toMiliseconds=void 0;const t=Ff();function e(i){return i*t.ONE_THOUSAND}qr.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return qr.fromMiliseconds=r,qr}var bl;function $0(){return bl||(bl=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Os;e.__exportStar(_0(),t),e.__exportStar(D0(),t)}(uo)),uo}var gi={},vl;function A0(){if(vl)return gi;vl=1,Object.defineProperty(gi,"__esModule",{value:!0}),gi.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return gi.Watch=t,gi.default=t,gi}var po={},zi={},El;function P0(){if(El)return zi;El=1,Object.defineProperty(zi,"__esModule",{value:!0}),zi.IWatch=void 0;class t{}return zi.IWatch=t,zi}var xl;function B0(){return xl||(xl=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Os.__exportStar(P0(),t)}(po)),po}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Os;e.__exportStar($0(),t),e.__exportStar(A0(),t),e.__exportStar(B0(),t),e.__exportStar(Ff(),t)})(M);var le={};Object.defineProperty(le,"__esModule",{value:!0});le.getLocalStorage=le.getLocalStorageOrThrow=le.getCrypto=le.getCryptoOrThrow=Lf=le.getLocation=le.getLocationOrThrow=uc=le.getNavigator=le.getNavigatorOrThrow=si=le.getDocument=le.getDocumentOrThrow=le.getFromWindowOrThrow=le.getFromWindow=void 0;function ui(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}le.getFromWindow=ui;function ji(t){const e=ui(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}le.getFromWindowOrThrow=ji;function C0(){return ji("document")}le.getDocumentOrThrow=C0;function T0(){return ui("document")}var si=le.getDocument=T0;function R0(){return ji("navigator")}le.getNavigatorOrThrow=R0;function N0(){return ui("navigator")}var uc=le.getNavigator=N0;function U0(){return ji("location")}le.getLocationOrThrow=U0;function k0(){return ui("location")}var Lf=le.getLocation=k0;function j0(){return ji("crypto")}le.getCryptoOrThrow=j0;function F0(){return ui("crypto")}le.getCrypto=F0;function L0(){return ji("localStorage")}le.getLocalStorageOrThrow=L0;function M0(){return ui("localStorage")}le.getLocalStorage=M0;var hc={};Object.defineProperty(hc,"__esModule",{value:!0});var Mf=hc.getWindowMetadata=void 0;const Il=le;function q0(){let t,e;try{t=Il.getDocumentOrThrow(),e=Il.getLocationOrThrow()}catch{return null}function r(){const h=t.getElementsByTagName("link"),f=[];for(let d=0;d<h.length;d++){const g=h[d],w=g.getAttribute("rel");if(w&&w.toLowerCase().indexOf("icon")>-1){const m=g.getAttribute("href");if(m)if(m.toLowerCase().indexOf("https:")===-1&&m.toLowerCase().indexOf("http:")===-1&&m.indexOf("//")!==0){let O=e.protocol+"//"+e.host;if(m.indexOf("/")===0)O+=m;else{const C=e.pathname.split("/");C.pop();const E=C.join("/");O+=E+"/"+m}f.push(O)}else if(m.indexOf("//")===0){const O=e.protocol+m;f.push(O)}else f.push(m)}}return f}function i(...h){const f=t.getElementsByTagName("meta");for(let d=0;d<f.length;d++){const g=f[d],w=["itemprop","property","name"].map(m=>g.getAttribute(m)).filter(m=>m?h.includes(m):!1);if(w.length&&w){const m=g.getAttribute("content");if(m)return m}}return""}function s(){let h=i("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function n(){return i("description","og:description","twitter:description","keywords")}const o=s(),a=n(),c=e.origin,l=r();return{description:a,url:c,icons:l,name:o}}Mf=hc.getWindowMetadata=q0;const z0="0.1.1";function V0(){return z0}class fe extends Error{constructor(e,r={}){const i=(()=>{var c;if(r.cause instanceof fe){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),s=r.cause instanceof fe&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${s??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...i||s?["",i?`Details: ${i}`:void 0,s?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${V0()}`}),this.cause=r.cause,this.details=i,this.docs=o,this.docsPath=s,this.shortMessage=e}walk(e){return qf(this,e)}}function qf(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?qf(t.cause,e):e?null:t}const yi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function H0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ys(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ni(t,...e){if(!H0(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function K0(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ys(t.outputLen),ys(t.blockLen)}function Ri(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function zf(t,e){ni(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function W0(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ni(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function go(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Tt(t,e){return t<<32-e|t>>>e}const G0=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Y0(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Z0(t){for(let e=0;e<t.length;e++)t[e]=Y0(t[e]);return t}const _l=G0?t=>t:Z0;function J0(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Fn(t){return typeof t=="string"&&(t=J0(t)),ni(t),t}function X0(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];ni(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}class fc{}function Vf(t){const e=i=>t().update(Fn(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Q0(t=32){if(yi&&typeof yi.getRandomValues=="function")return yi.getRandomValues(new Uint8Array(t));if(yi&&typeof yi.randomBytes=="function")return Uint8Array.from(yi.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function ew(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function tw(t,e,r){return t&e^~t&r}function rw(t,e,r){return t&e^t&r^e&r}class iw extends fc{constructor(e,r,i,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(e),this.view=go(this.buffer)}update(e){Ri(this),e=Fn(e),ni(e);const{view:r,buffer:i,blockLen:s}=this,n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=go(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ri(this),zf(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,Ni(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;ew(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=go(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=n,e.length=s,e.pos=a,s%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}}const pr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ks=BigInt(2**32-1),Sl=BigInt(32);function sw(t,e=!1){return e?{h:Number(t&ks),l:Number(t>>Sl&ks)}:{h:Number(t>>Sl&ks)|0,l:Number(t&ks)|0}}function nw(t,e=!1){const r=t.length;let i=new Uint32Array(r),s=new Uint32Array(r);for(let n=0;n<r;n++){const{h:o,l:a}=sw(t[n],e);[i[n],s[n]]=[o,a]}return[i,s]}const ow=(t,e,r)=>t<<r|e>>>32-r,aw=(t,e,r)=>e<<r|t>>>32-r,cw=(t,e,r)=>e<<r-32|t>>>64-r,lw=(t,e,r)=>t<<r-32|e>>>64-r,uw=BigInt(0),Vi=BigInt(1),hw=BigInt(2),fw=BigInt(7),dw=BigInt(256),pw=BigInt(113),Hf=[],Kf=[],Wf=[];for(let t=0,e=Vi,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Hf.push(2*(5*i+r)),Kf.push((t+1)*(t+2)/2%64);let s=uw;for(let n=0;n<7;n++)e=(e<<Vi^(e>>fw)*pw)%dw,e&hw&&(s^=Vi<<(Vi<<BigInt(n))-Vi);Wf.push(s)}const Gf=nw(Wf,!0),gw=Gf[0],yw=Gf[1],Ol=(t,e,r)=>r>32?cw(t,e,r):ow(t,e,r),Dl=(t,e,r)=>r>32?lw(t,e,r):aw(t,e,r);function ww(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=Ol(l,u,1)^r[a],f=Dl(l,u,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=f}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=Kf[o],c=Ol(s,n,a),l=Dl(s,n,a),u=Hf[o];s=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=gw[i],t[1]^=yw[i]}Ni(r)}class dc extends fc{constructor(e,r,i,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,ys(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=W0(this.state)}clone(){return this._cloneInto()}keccak(){_l(this.state32),ww(this.state32,this.rounds),_l(this.state32),this.posOut=0,this.pos=0}update(e){Ri(this),e=Fn(e),ni(e);const{blockLen:r,state:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,r&128&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Ri(this,!1),ni(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ys(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(zf(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ni(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new dc(r,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const mw=(t,e,r)=>Vf(()=>new dc(e,t,r)),bw=mw(1,136,256/8),vw=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),gr=new Uint32Array(64);class Ew extends iw{constructor(e=32){super(64,e,8,!1),this.A=pr[0]|0,this.B=pr[1]|0,this.C=pr[2]|0,this.D=pr[3]|0,this.E=pr[4]|0,this.F=pr[5]|0,this.G=pr[6]|0,this.H=pr[7]|0}get(){const{A:e,B:r,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,r,i,s,n,o,a,c]}set(e,r,i,s,n,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)gr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=gr[h-15],d=gr[h-2],g=Tt(f,7)^Tt(f,18)^f>>>3,w=Tt(d,17)^Tt(d,19)^d>>>10;gr[h]=w+gr[h-7]+g+gr[h-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=Tt(a,6)^Tt(a,11)^Tt(a,25),d=u+f+tw(a,c,l)+vw[h]+gr[h]|0,w=(Tt(i,2)^Tt(i,13)^Tt(i,22))+rw(i,s,n)|0;u=l,l=c,c=a,a=o+d|0,o=n,n=s,s=i,i=d+w|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,s,n,o,a,c,l,u)}roundClean(){Ni(gr)}destroy(){this.set(0,0,0,0,0,0,0,0),Ni(this.buffer)}}const xw=Vf(()=>new Ew);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const pc=BigInt(0),pa=BigInt(1);function Ds(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function gc(t){if(!Ds(t))throw new Error("Uint8Array expected")}function ws(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function js(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Yf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?pc:BigInt("0x"+t)}const Zf=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Iw=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ms(t){if(gc(t),Zf)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Iw[t[r]];return e}const Yt={_0:48,_9:57,A:65,F:70,a:97,f:102};function $l(t){if(t>=Yt._0&&t<=Yt._9)return t-Yt._0;if(t>=Yt.A&&t<=Yt.F)return t-(Yt.A-10);if(t>=Yt.a&&t<=Yt.f)return t-(Yt.a-10)}function En(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Zf)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=$l(t.charCodeAt(n)),a=$l(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function ii(t){return Yf(ms(t))}function Jf(t){return gc(t),Yf(ms(Uint8Array.from(t).reverse()))}function $s(t,e){return En(t.toString(16).padStart(e*2,"0"))}function Xf(t,e){return $s(t,e).reverse()}function wt(t,e,r){let i;if(typeof e=="string")try{i=En(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(Ds(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function xn(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];gc(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const yo=t=>typeof t=="bigint"&&pc<=t;function yc(t,e,r){return yo(t)&&yo(e)&&yo(r)&&e<=t&&t<r}function $i(t,e,r,i){if(!yc(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function _w(t){let e;for(e=0;t>pc;t>>=pa,e+=1);return e}const Ln=t=>(pa<<BigInt(t))-pa,wo=t=>new Uint8Array(t),Al=t=>Uint8Array.from(t);function Sw(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=wo(t),s=wo(t),n=0;const o=()=>{i.fill(1),s.fill(0),n=0},a=(...h)=>r(s,i,...h),c=(h=wo(0))=>{s=a(Al([0]),h),i=a(),h.length!==0&&(s=a(Al([1]),h),i=a())},l=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){i=a();const d=i.slice();f.push(d),h+=i.length}return xn(...f)};return(h,f)=>{o(),c(h);let d;for(;!(d=f(l()));)c();return o(),d}}const Ow={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ds(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Mn(t,e,r={}){const i=(s,n,o)=>{const a=Ow[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function Pl(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}function Dw(t,e){if(Rl(t)>e)throw new Gw({givenSize:Rl(t),maxSize:e})}const Zt={zero:48,nine:57,A:65,F:70,a:97,f:102};function Bl(t){if(t>=Zt.zero&&t<=Zt.nine)return t-Zt.zero;if(t>=Zt.A&&t<=Zt.F)return t-(Zt.A-10);if(t>=Zt.a&&t<=Zt.f)return t-(Zt.a-10)}function $w(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new Yw({size:t.length,targetSize:i,type:"Bytes"});const s=new Uint8Array(i);for(let n=0;n<i;n++){const o=r==="right";s[o?n:i-n-1]=t[o?n:t.length-n-1]}return s}function Qf(t,e){if(jr(t)>e)throw new jw({givenSize:jr(t),maxSize:e})}function Aw(t,e){if(typeof e=="number"&&e>0&&e>jr(t)-1)throw new rd({offset:e,position:"start",size:jr(t)})}function Pw(t,e,r){if(typeof e=="number"&&typeof r=="number"&&jr(t)!==r-e)throw new rd({offset:r,position:"end",size:jr(t)})}function ed(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;const s=t.replace("0x","");if(s.length>i*2)throw new Fw({size:Math.ceil(s.length/2),targetSize:i,type:"Hex"});return`0x${s[r==="right"?"padEnd":"padStart"](i*2,"0")}`}const Bw="#__bigint";function wc(t,e,r){return JSON.stringify(t,(i,s)=>typeof s=="bigint"?s.toString()+Bw:s,r)}const Cw=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Tw(t,e={}){const{strict:r=!1}=e;if(!t)throw new Cl(t);if(typeof t!="string")throw new Cl(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new Tl(t);if(!t.startsWith("0x"))throw new Tl(t)}function Rw(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function mc(t){return t instanceof Uint8Array?In(t):Array.isArray(t)?In(new Uint8Array(t)):t}function In(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=Cw[t[s]];const i=`0x${r}`;return typeof e.size=="number"?(Qf(i,e.size),td(i,e.size)):i}function mo(t,e={}){const{signed:r,size:i}=e,s=BigInt(t);let n;i?r?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&r?-n-1n:0;if(n&&s>n||s<o){const l=typeof t=="bigint"?"n":"";throw new kw({max:n?`${n}${l}`:void 0,min:`${o}${l}`,signed:r,size:i,value:`${t}${l}`})}const c=`0x${(r&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?Nw(c,i):c}function Nw(t,e){return ed(t,{dir:"left",size:e})}function td(t,e){return ed(t,{dir:"right",size:e})}function sr(t,e,r,i={}){const{strict:s}=i;Aw(t,e);const n=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return s&&Pw(n,e,r),n}function jr(t){return Math.ceil((t.length-2)/2)}function Uw(t,e={}){const{strict:r=!1}=e;try{return Tw(t,{strict:r}),!0}catch{return!1}}class kw extends fe{constructor({max:e,min:r,signed:i,size:s,value:n}){super(`Number \`${n}\` is not in safe${s?` ${s*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class Cl extends fe{constructor(e){super(`Value \`${typeof e=="object"?wc(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class Tl extends fe{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let jw=class extends fe{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class rd extends fe{constructor({offset:e,position:r,size:i}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${i}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let Fw=class extends fe{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const Lw=new TextEncoder;function Mw(t){if(!(t instanceof Uint8Array)){if(!t)throw new Fs(t);if(typeof t!="object")throw new Fs(t);if(!("BYTES_PER_ELEMENT"in t))throw new Fs(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Fs(t)}}function qw(t){return t instanceof Uint8Array?t:typeof t=="string"?Vw(t):zw(t)}function zw(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Vw(t,e={}){const{size:r}=e;let i=t;r&&(Qf(t,r),i=td(t,r));let s=i.slice(2);s.length%2&&(s=`0${s}`);const n=s.length/2,o=new Uint8Array(n);for(let a=0,c=0;a<n;a++){const l=Bl(s.charCodeAt(c++)),u=Bl(s.charCodeAt(c++));if(l===void 0||u===void 0)throw new fe(`Invalid byte sequence ("${s[c-2]}${s[c-1]}" in "${s}").`);o[a]=l*16+u}return o}function Hw(t,e={}){const{size:r}=e,i=Lw.encode(t);return typeof r=="number"?(Dw(i,r),Kw(i,r)):i}function Kw(t,e){return $w(t,{dir:"right",size:e})}function Rl(t){return t.length}function Ww(t){try{return Mw(t),!0}catch{return!1}}class Fs extends fe{constructor(e){super(`Value \`${typeof e=="object"?wc(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class Gw extends fe{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class Yw extends fe{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function id(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,i=bw(qw(t));return r==="Bytes"?i:In(i)}class Zw extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const Jw={checksum:new Zw(8192)},bo=Jw.checksum;function sd(t,e={}){const{compressed:r}=e,{prefix:i,x:s,y:n}=t;if(r===!1||typeof s=="bigint"&&typeof n=="bigint"){if(i!==4)throw new Nl({prefix:i,cause:new im});return}if(r===!0||typeof s=="bigint"&&typeof n>"u"){if(i!==3&&i!==2)throw new Nl({prefix:i,cause:new rm});return}throw new tm({publicKey:t})}function Xw(t){const e=(()=>{if(Uw(t))return nd(t);if(Ww(t))return Qw(t);const{prefix:r,x:i,y:s}=t;return typeof i=="bigint"&&typeof s=="bigint"?{prefix:r??4,x:i,y:s}:{prefix:r,x:i}})();return sd(e),e}function Qw(t){return nd(In(t))}function nd(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new sm({publicKey:t});if(t.length===130){const i=BigInt(sr(t,0,32)),s=BigInt(sr(t,32,64));return{prefix:4,x:i,y:s}}if(t.length===132){const i=Number(sr(t,0,1)),s=BigInt(sr(t,1,33)),n=BigInt(sr(t,33,65));return{prefix:i,x:s,y:n}}const e=Number(sr(t,0,1)),r=BigInt(sr(t,1,33));return{prefix:e,x:r}}function em(t,e={}){sd(t);const{prefix:r,x:i,y:s}=t,{includePrefix:n=!0}=e;return Rw(n?mo(r,{size:1}):"0x",mo(i,{size:32}),typeof s=="bigint"?mo(s,{size:32}):"0x")}class tm extends fe{constructor({publicKey:e}){super(`Value \`${wc(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class Nl extends fe{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class rm extends fe{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class im extends fe{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let sm=class extends fe{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${jr(mc(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const nm=/^0x[a-fA-F0-9]{40}$/;function od(t,e={}){const{strict:r=!0}=e;if(!nm.test(t))throw new Ul({address:t,cause:new cm});if(r){if(t.toLowerCase()===t)return;if(ad(t)!==t)throw new Ul({address:t,cause:new lm})}}function ad(t){if(bo.has(t))return bo.get(t);od(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=id(Hw(e),{as:"Bytes"}),i=e.split("");for(let n=0;n<40;n+=2)r[n>>1]>>4>=8&&i[n]&&(i[n]=i[n].toUpperCase()),(r[n>>1]&15)>=8&&i[n+1]&&(i[n+1]=i[n+1].toUpperCase());const s=`0x${i.join("")}`;return bo.set(t,s),s}function om(t,e={}){const{checksum:r=!1}=e;return od(t),r?ad(t):t}function am(t,e={}){const r=id(`0x${em(t).slice(4)}`).substring(26);return om(`0x${r}`,e)}class Ul extends fe{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class cm extends fe{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class lm extends fe{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}class cd extends fc{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,K0(e);const i=Fn(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),Ni(n)}update(e){return Ri(this),this.iHash.update(e),this}digestInto(e){Ri(this),ni(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ld=(t,e,r)=>new cd(t,e).update(r).digest();ld.create=(t,e)=>new cd(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const tt=BigInt(0),He=BigInt(1),Xr=BigInt(2),um=BigInt(3),ud=BigInt(4),hd=BigInt(5),fd=BigInt(8);function Xe(t,e){const r=t%e;return r>=tt?r:e+r}function dt(t,e,r){let i=t;for(;e-- >tt;)i*=i,i%=r;return i}function ga(t,e){if(t===tt)throw new Error("invert: expected non-zero number");if(e<=tt)throw new Error("invert: expected positive modulus, got "+e);let r=Xe(t,e),i=e,s=tt,n=He;for(;r!==tt;){const a=i/r,c=i%r,l=s-n*a;i=r,r=c,s=n,n=l}if(i!==He)throw new Error("invert: does not exist");return Xe(s,e)}function dd(t,e){const r=(t.ORDER+He)/ud,i=t.pow(e,r);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function hm(t,e){const r=(t.ORDER-hd)/fd,i=t.mul(e,Xr),s=t.pow(i,r),n=t.mul(e,s),o=t.mul(t.mul(n,Xr),s),a=t.mul(n,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function fm(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-He,r=0;for(;e%Xr===tt;)e/=Xr,r++;let i=Xr;const s=bc(t);for(;kl(s,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return dd;let n=s.pow(i,e);const o=(e+He)/Xr;return function(c,l){if(c.is0(l))return l;if(kl(c,l)!==1)throw new Error("Cannot find square root");let u=r,h=c.mul(c.ONE,n),f=c.pow(l,e),d=c.pow(l,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let g=1,w=c.sqr(f);for(;!c.eql(w,c.ONE);)if(g++,w=c.sqr(w),g===u)throw new Error("Cannot find square root");const m=He<<BigInt(u-g-1),O=c.pow(h,m);u=g,h=c.sqr(O),f=c.mul(f,h),d=c.mul(d,O)}return d}}function dm(t){return t%ud===um?dd:t%fd===hd?hm:fm(t)}const pm=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function gm(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=pm.reduce((i,s)=>(i[s]="function",i),e);return Mn(t,r)}function ym(t,e,r){if(r<tt)throw new Error("invalid exponent, negatives unsupported");if(r===tt)return t.ONE;if(r===He)return e;let i=t.ONE,s=e;for(;r>tt;)r&He&&(i=t.mul(i,s)),s=t.sqr(s),r>>=He;return i}function pd(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),n=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),n),i}function kl(t,e){const r=(t.ORDER-He)/Xr,i=t.pow(e,r),s=t.eql(i,t.ONE),n=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function gd(t,e){e!==void 0&&ys(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function bc(t,e,r=!1,i={}){if(t<=tt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=gd(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:Ln(s),ZERO:tt,ONE:He,create:c=>Xe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return tt<=c&&c<t},is0:c=>c===tt,isOdd:c=>(c&He)===He,neg:c=>Xe(-c,t),eql:(c,l)=>c===l,sqr:c=>Xe(c*c,t),add:(c,l)=>Xe(c+l,t),sub:(c,l)=>Xe(c-l,t),mul:(c,l)=>Xe(c*l,t),pow:(c,l)=>ym(a,c,l),div:(c,l)=>Xe(c*ga(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>ga(c,t),sqrt:i.sqrt||(c=>(o||(o=dm(t)),o(a,c))),toBytes:c=>r?Xf(c,n):$s(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?Jf(c):ii(c)},invertBatch:c=>pd(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function yd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function wd(t){const e=yd(t);return e+Math.ceil(e/2)}function wm(t,e,r=!1){const i=t.length,s=yd(e),n=wd(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=r?Jf(t):ii(t),a=Xe(o,e-He)+He;return r?Xf(a,s):$s(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const jl=BigInt(0),ya=BigInt(1);function vo(t,e){const r=e.negate();return t?r:e}function md(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Eo(t,e){md(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),s=2**t,n=Ln(t),o=BigInt(t);return{windows:r,windowSize:i,mask:n,maxNumber:s,shiftBy:o}}function Fl(t,e,r){const{windowSize:i,mask:s,maxNumber:n,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>i&&(a-=n,c+=ya);const l=e*i,u=l+Math.abs(a)-1,h=a===0,f=a<0,d=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:d,offsetF:l}}function mm(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function bm(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const xo=new WeakMap,bd=new WeakMap;function Io(t){return bd.get(t)||1}function vm(t,e){return{constTimeNegate:vo,hasPrecomputes(r){return Io(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>jl;)i&ya&&(s=s.add(n)),n=n.double(),i>>=ya;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=Eo(i,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){let n=t.ZERO,o=t.BASE;const a=Eo(r,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:f,isNegF:d,offsetF:g}=Fl(s,c,a);s=l,h?o=o.add(vo(d,i[g])):n=n.add(vo(f,i[u]))}return{p:n,f:o}},wNAFUnsafe(r,i,s,n=t.ZERO){const o=Eo(r,e);for(let a=0;a<o.windows&&s!==jl;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=Fl(s,a,o);if(s=c,!u){const f=i[l];n=n.add(h?f.negate():f)}}return n},getPrecomputes(r,i,s){let n=xo.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&xo.set(i,s(n))),n},wNAFCached(r,i,s){const n=Io(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=Io(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){md(i,e),bd.set(r,i),xo.delete(r)}}}function Em(t,e,r,i){mm(r,t),bm(i,e);const s=r.length,n=i.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=_w(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Ln(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let d=h;d>=0;d-=c){u.fill(o);for(let w=0;w<n;w++){const m=i[w],O=Number(m>>BigInt(d)&l);u[O]=u[O].add(r[w])}let g=o;for(let w=u.length-1,m=o;w>0;w--)m=m.add(u[w]),g=g.add(m);if(f=f.add(g),d!==0)for(let w=0;w<c;w++)f=f.double()}return f}function vd(t){return gm(t.Fp),Mn(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...gd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ll(t){t.lowS!==void 0&&ws("lowS",t.lowS),t.prehash!==void 0&&ws("prehash",t.prehash)}function xm(t){const e=vd(t);Mn(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:i,a:s}=e;if(r){if(!i.eql(s,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class Im extends Error{constructor(e=""){super(e)}}const nr={Err:Im,_tlv:{encode:(t,e)=>{const{Err:r}=nr;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,s=js(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const n=i>127?js(s.length/2|128):"";return js(t)+n+s+e},decode(t,e){const{Err:r}=nr;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=nr;if(t<ar)throw new e("integer: negative integers are not allowed");let r=js(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=nr;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return ii(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=nr,s=wt("signature",t),{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=nr,i=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),n=i+s;return e.encode(48,n)}};function _o(t,e){return ms($s(t,e))}const ar=BigInt(0),Oe=BigInt(1);BigInt(2);const So=BigInt(3),_m=BigInt(4);function Sm(t){const e=xm(t),{Fp:r}=e,i=bc(e.n,e.nBitLength),s=e.toBytes||((E,I,A)=>{const B=I.toAffine();return xn(Uint8Array.from([4]),r.toBytes(B.x),r.toBytes(B.y))}),n=e.fromBytes||(E=>{const I=E.subarray(1),A=r.fromBytes(I.subarray(0,r.BYTES)),B=r.fromBytes(I.subarray(r.BYTES,2*r.BYTES));return{x:A,y:B}});function o(E){const{a:I,b:A}=e,B=r.sqr(E),T=r.mul(B,E);return r.add(r.add(T,r.mul(E,I)),A)}function a(E,I){const A=r.sqr(I),B=o(E);return r.eql(A,B)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,So),_m),l=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,l)))throw new Error("bad curve params: a or b");function u(E){return yc(E,Oe,e.n)}function h(E){const{allowedPrivateKeyLengths:I,nByteLength:A,wrapPrivateKey:B,n:T}=e;if(I&&typeof E!="bigint"){if(Ds(E)&&(E=ms(E)),typeof E!="string"||!I.includes(E.length))throw new Error("invalid private key");E=E.padStart(A*2,"0")}let R;try{R=typeof E=="bigint"?E:ii(wt("private key",E,A))}catch{throw new Error("invalid private key, expected hex or "+A+" bytes, got "+typeof E)}return B&&(R=Xe(R,T)),$i("private key",R,Oe,T),R}function f(E){if(!(E instanceof w))throw new Error("ProjectivePoint expected")}const d=Pl((E,I)=>{const{px:A,py:B,pz:T}=E;if(r.eql(T,r.ONE))return{x:A,y:B};const R=E.is0();I==null&&(I=R?r.ONE:r.inv(T));const $=r.mul(A,I),k=r.mul(B,I),j=r.mul(T,I);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(j,r.ONE))throw new Error("invZ was invalid");return{x:$,y:k}}),g=Pl(E=>{if(E.is0()){if(e.allowInfinityPoint&&!r.is0(E.py))return;throw new Error("bad point: ZERO")}const{x:I,y:A}=E.toAffine();if(!r.isValid(I)||!r.isValid(A))throw new Error("bad point: x or y not FE");if(!a(I,A))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class w{constructor(I,A,B){if(I==null||!r.isValid(I))throw new Error("x required");if(A==null||!r.isValid(A)||r.is0(A))throw new Error("y required");if(B==null||!r.isValid(B))throw new Error("z required");this.px=I,this.py=A,this.pz=B,Object.freeze(this)}static fromAffine(I){const{x:A,y:B}=I||{};if(!I||!r.isValid(A)||!r.isValid(B))throw new Error("invalid affine point");if(I instanceof w)throw new Error("projective point not allowed");const T=R=>r.eql(R,r.ZERO);return T(A)&&T(B)?w.ZERO:new w(A,B,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(I){const A=pd(r,I.map(B=>B.pz));return I.map((B,T)=>B.toAffine(A[T])).map(w.fromAffine)}static fromHex(I){const A=w.fromAffine(n(wt("pointHex",I)));return A.assertValidity(),A}static fromPrivateKey(I){return w.BASE.multiply(h(I))}static msm(I,A){return Em(w,i,I,A)}_setWindowSize(I){C.setWindowSize(this,I)}assertValidity(){g(this)}hasEvenY(){const{y:I}=this.toAffine();if(r.isOdd)return!r.isOdd(I);throw new Error("Field doesn't support isOdd")}equals(I){f(I);const{px:A,py:B,pz:T}=this,{px:R,py:$,pz:k}=I,j=r.eql(r.mul(A,k),r.mul(R,T)),P=r.eql(r.mul(B,k),r.mul($,T));return j&&P}negate(){return new w(this.px,r.neg(this.py),this.pz)}double(){const{a:I,b:A}=e,B=r.mul(A,So),{px:T,py:R,pz:$}=this;let k=r.ZERO,j=r.ZERO,P=r.ZERO,_=r.mul(T,T),D=r.mul(R,R),p=r.mul($,$),y=r.mul(T,R);return y=r.add(y,y),P=r.mul(T,$),P=r.add(P,P),k=r.mul(I,P),j=r.mul(B,p),j=r.add(k,j),k=r.sub(D,j),j=r.add(D,j),j=r.mul(k,j),k=r.mul(y,k),P=r.mul(B,P),p=r.mul(I,p),y=r.sub(_,p),y=r.mul(I,y),y=r.add(y,P),P=r.add(_,_),_=r.add(P,_),_=r.add(_,p),_=r.mul(_,y),j=r.add(j,_),p=r.mul(R,$),p=r.add(p,p),_=r.mul(p,y),k=r.sub(k,_),P=r.mul(p,D),P=r.add(P,P),P=r.add(P,P),new w(k,j,P)}add(I){f(I);const{px:A,py:B,pz:T}=this,{px:R,py:$,pz:k}=I;let j=r.ZERO,P=r.ZERO,_=r.ZERO;const D=e.a,p=r.mul(e.b,So);let y=r.mul(A,R),b=r.mul(B,$),S=r.mul(T,k),v=r.add(A,B),x=r.add(R,$);v=r.mul(v,x),x=r.add(y,b),v=r.sub(v,x),x=r.add(A,T);let N=r.add(R,k);return x=r.mul(x,N),N=r.add(y,S),x=r.sub(x,N),N=r.add(B,T),j=r.add($,k),N=r.mul(N,j),j=r.add(b,S),N=r.sub(N,j),_=r.mul(D,x),j=r.mul(p,S),_=r.add(j,_),j=r.sub(b,_),_=r.add(b,_),P=r.mul(j,_),b=r.add(y,y),b=r.add(b,y),S=r.mul(D,S),x=r.mul(p,x),b=r.add(b,S),S=r.sub(y,S),S=r.mul(D,S),x=r.add(x,S),y=r.mul(b,x),P=r.add(P,y),y=r.mul(N,x),j=r.mul(v,j),j=r.sub(j,y),y=r.mul(v,b),_=r.mul(N,_),_=r.add(_,y),new w(j,P,_)}subtract(I){return this.add(I.negate())}is0(){return this.equals(w.ZERO)}wNAF(I){return C.wNAFCached(this,I,w.normalizeZ)}multiplyUnsafe(I){const{endo:A,n:B}=e;$i("scalar",I,ar,B);const T=w.ZERO;if(I===ar)return T;if(this.is0()||I===Oe)return this;if(!A||C.hasPrecomputes(this))return C.wNAFCachedUnsafe(this,I,w.normalizeZ);let{k1neg:R,k1:$,k2neg:k,k2:j}=A.splitScalar(I),P=T,_=T,D=this;for(;$>ar||j>ar;)$&Oe&&(P=P.add(D)),j&Oe&&(_=_.add(D)),D=D.double(),$>>=Oe,j>>=Oe;return R&&(P=P.negate()),k&&(_=_.negate()),_=new w(r.mul(_.px,A.beta),_.py,_.pz),P.add(_)}multiply(I){const{endo:A,n:B}=e;$i("scalar",I,Oe,B);let T,R;if(A){const{k1neg:$,k1:k,k2neg:j,k2:P}=A.splitScalar(I);let{p:_,f:D}=this.wNAF(k),{p,f:y}=this.wNAF(P);_=C.constTimeNegate($,_),p=C.constTimeNegate(j,p),p=new w(r.mul(p.px,A.beta),p.py,p.pz),T=_.add(p),R=D.add(y)}else{const{p:$,f:k}=this.wNAF(I);T=$,R=k}return w.normalizeZ([T,R])[0]}multiplyAndAddUnsafe(I,A,B){const T=w.BASE,R=(k,j)=>j===ar||j===Oe||!k.equals(T)?k.multiplyUnsafe(j):k.multiply(j),$=R(this,A).add(R(I,B));return $.is0()?void 0:$}toAffine(I){return d(this,I)}isTorsionFree(){const{h:I,isTorsionFree:A}=e;if(I===Oe)return!0;if(A)return A(w,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:I,clearCofactor:A}=e;return I===Oe?this:A?A(w,this):this.multiplyUnsafe(e.h)}toRawBytes(I=!0){return ws("isCompressed",I),this.assertValidity(),s(w,this,I)}toHex(I=!0){return ws("isCompressed",I),ms(this.toRawBytes(I))}}w.BASE=new w(e.Gx,e.Gy,r.ONE),w.ZERO=new w(r.ZERO,r.ONE,r.ZERO);const{endo:m,nBitLength:O}=e,C=vm(w,m?Math.ceil(O/2):O);return{CURVE:e,ProjectivePoint:w,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function Om(t){const e=vd(t);return Mn(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Dm(t){const e=Om(t),{Fp:r,n:i,nByteLength:s,nBitLength:n}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(p){return Xe(p,i)}function l(p){return ga(p,i)}const{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:d}=Sm({...e,toBytes(p,y,b){const S=y.toAffine(),v=r.toBytes(S.x),x=xn;return ws("isCompressed",b),b?x(Uint8Array.from([y.hasEvenY()?2:3]),v):x(Uint8Array.from([4]),v,r.toBytes(S.y))},fromBytes(p){const y=p.length,b=p[0],S=p.subarray(1);if(y===o&&(b===2||b===3)){const v=ii(S);if(!yc(v,Oe,r.ORDER))throw new Error("Point is not on curve");const x=f(v);let N;try{N=r.sqrt(x)}catch(L){const q=L instanceof Error?": "+L.message:"";throw new Error("Point is not on curve"+q)}const U=(N&Oe)===Oe;return(b&1)===1!==U&&(N=r.neg(N)),{x:v,y:N}}else if(y===a&&b===4){const v=r.fromBytes(S.subarray(0,r.BYTES)),x=r.fromBytes(S.subarray(r.BYTES,2*r.BYTES));return{x:v,y:x}}else{const v=o,x=a;throw new Error("invalid Point, expected length of "+v+", or uncompressed "+x+", got "+y)}}});function g(p){const y=i>>Oe;return p>y}function w(p){return g(p)?c(-p):p}const m=(p,y,b)=>ii(p.slice(y,b));class O{constructor(y,b,S){$i("r",y,Oe,i),$i("s",b,Oe,i),this.r=y,this.s=b,S!=null&&(this.recovery=S),Object.freeze(this)}static fromCompact(y){const b=s;return y=wt("compactSignature",y,b*2),new O(m(y,0,b),m(y,b,2*b))}static fromDER(y){const{r:b,s:S}=nr.toSig(wt("DER",y));return new O(b,S)}assertValidity(){}addRecoveryBit(y){return new O(this.r,this.s,y)}recoverPublicKey(y){const{r:b,s:S,recovery:v}=this,x=T(wt("msgHash",y));if(v==null||![0,1,2,3].includes(v))throw new Error("recovery id invalid");const N=v===2||v===3?b+e.n:b;if(N>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const U=v&1?"03":"02",V=u.fromHex(U+_o(N,r.BYTES)),L=l(N),q=c(-x*L),K=c(S*L),G=u.BASE.multiplyAndAddUnsafe(V,q,K);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new O(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return En(this.toDERHex())}toDERHex(){return nr.hexFromSig(this)}toCompactRawBytes(){return En(this.toCompactHex())}toCompactHex(){const y=s;return _o(this.r,y)+_o(this.s,y)}}const C={isValidPrivateKey(p){try{return h(p),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const p=wd(e.n);return wm(e.randomBytes(p),e.n)},precompute(p=8,y=u.BASE){return y._setWindowSize(p),y.multiply(BigInt(3)),y}};function E(p,y=!0){return u.fromPrivateKey(p).toRawBytes(y)}function I(p){if(typeof p=="bigint")return!1;if(p instanceof u)return!0;const b=wt("key",p).length,S=r.BYTES,v=S+1,x=2*S+1;if(!(e.allowedPrivateKeyLengths||s===v))return b===v||b===x}function A(p,y,b=!0){if(I(p)===!0)throw new Error("first arg must be private key");if(I(y)===!1)throw new Error("second arg must be public key");return u.fromHex(y).multiply(h(p)).toRawBytes(b)}const B=e.bits2int||function(p){if(p.length>8192)throw new Error("input is too large");const y=ii(p),b=p.length*8-n;return b>0?y>>BigInt(b):y},T=e.bits2int_modN||function(p){return c(B(p))},R=Ln(n);function $(p){return $i("num < 2^"+n,p,ar,R),$s(p,s)}function k(p,y,b=j){if(["recovered","canonical"].some(W=>W in b))throw new Error("sign() legacy options not supported");const{hash:S,randomBytes:v}=e;let{lowS:x,prehash:N,extraEntropy:U}=b;x==null&&(x=!0),p=wt("msgHash",p),Ll(b),N&&(p=wt("prehashed msgHash",S(p)));const V=T(p),L=h(y),q=[$(L),$(V)];if(U!=null&&U!==!1){const W=U===!0?v(r.BYTES):U;q.push(wt("extraEntropy",W))}const K=xn(...q),G=V;function X(W){const Q=B(W);if(!d(Q))return;const de=l(Q),be=u.BASE.multiply(Q).toAffine(),xe=c(be.x);if(xe===ar)return;const Ve=c(de*c(G+xe*L));if(Ve===ar)return;let Gt=(be.x===xe?0:2)|Number(be.y&Oe),dr=Ve;return x&&g(Ve)&&(dr=w(Ve),Gt^=1),new O(xe,dr,Gt)}return{seed:K,k2sig:X}}const j={lowS:e.lowS,prehash:!1},P={lowS:e.lowS,prehash:!1};function _(p,y,b=j){const{seed:S,k2sig:v}=k(p,y,b),x=e;return Sw(x.hash.outputLen,x.nByteLength,x.hmac)(S,v)}u.BASE._setWindowSize(8);function D(p,y,b,S=P){var Gt;const v=p;y=wt("msgHash",y),b=wt("publicKey",b);const{lowS:x,prehash:N,format:U}=S;if(Ll(S),"strict"in S)throw new Error("options.strict was renamed to lowS");if(U!==void 0&&U!=="compact"&&U!=="der")throw new Error("format must be compact or der");const V=typeof v=="string"||Ds(v),L=!V&&!U&&typeof v=="object"&&v!==null&&typeof v.r=="bigint"&&typeof v.s=="bigint";if(!V&&!L)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let q,K;try{if(L&&(q=new O(v.r,v.s)),V){try{U!=="compact"&&(q=O.fromDER(v))}catch(dr){if(!(dr instanceof nr.Err))throw dr}!q&&U!=="der"&&(q=O.fromCompact(v))}K=u.fromHex(b)}catch{return!1}if(!q||x&&q.hasHighS())return!1;N&&(y=e.hash(y));const{r:G,s:X}=q,W=T(y),Q=l(X),de=c(W*Q),be=c(G*Q),xe=(Gt=u.BASE.multiplyAndAddUnsafe(K,de,be))==null?void 0:Gt.toAffine();return xe?c(xe.x)===G:!1}return{CURVE:e,getPublicKey:E,getSharedSecret:A,sign:_,verify:D,ProjectivePoint:u,Signature:O,utils:C}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function $m(t){return{hash:t,hmac:(e,...r)=>ld(t,e,X0(...r)),randomBytes:Q0}}function Am(t,e){const r=i=>Dm({...t,...$m(i)});return{...r(e),create:r}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ed=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ml=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Pm=BigInt(0),Bm=BigInt(1),wa=BigInt(2),ql=(t,e)=>(t+e/wa)/e;function Cm(t){const e=Ed,r=BigInt(3),i=BigInt(6),s=BigInt(11),n=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=dt(u,r,e)*u%e,f=dt(h,r,e)*u%e,d=dt(f,wa,e)*l%e,g=dt(d,s,e)*d%e,w=dt(g,n,e)*g%e,m=dt(w,a,e)*w%e,O=dt(m,c,e)*m%e,C=dt(O,a,e)*w%e,E=dt(C,r,e)*u%e,I=dt(E,o,e)*g%e,A=dt(I,i,e)*l%e,B=dt(A,wa,e);if(!ma.eql(ma.sqr(B),t))throw new Error("Cannot find square root");return B}const ma=bc(Ed,void 0,void 0,{sqrt:Cm}),Tm=Am({a:Pm,b:BigInt(7),Fp:ma,n:Ml,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Ml,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Bm*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),n=r,o=BigInt("0x100000000000000000000000000000000"),a=ql(n*t,e),c=ql(-i*t,e);let l=Xe(t-a*r-c*s,e),u=Xe(-a*i-c*n,e);const h=l>o,f=u>o;if(h&&(l=e-l),f&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}}},xw);function Rm(t){if(t.length!==130&&t.length!==132)throw new Um({signature:t});const e=BigInt(sr(t,0,32)),r=BigInt(sr(t,32,64)),i=(()=>{const s=+`0x${t.slice(130)}`;if(!Number.isNaN(s))try{return Nm(s)}catch{throw new km({value:s})}})();return typeof i>"u"?{r:e,s:r}:{r:e,s:r,yParity:i}}function Nm(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new jm({value:t})}class Um extends fe{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${jr(mc(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class km extends fe{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class jm extends fe{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function Fm(t){return am(Lm(t))}function Lm(t){const{payload:e,signature:r}=t,{r:i,s,yParity:n}=r,a=new Tm.Signature(BigInt(i),BigInt(s)).addRecoveryBit(n).recoverPublicKey(mc(e).substring(2));return Xw(a)}function Mm(t){const e=t.length;let r=0,i=0;for(;i<e;){let s=t.charCodeAt(i++);if(s&4294967168)if(!(s&4294965248))r+=2;else{if(s>=55296&&s<=56319&&i<e){const n=t.charCodeAt(i);(n&64512)===56320&&(++i,s=((s&1023)<<10)+(n&1023)+65536)}s&4294901760?r+=4:r+=3}else{r++;continue}}return r}function qm(t,e,r){const i=t.length;let s=r,n=0;for(;n<i;){let o=t.charCodeAt(n++);if(o&4294967168)if(!(o&4294965248))e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&n<i){const a=t.charCodeAt(n);(a&64512)===56320&&(++n,o=((o&1023)<<10)+(a&1023)+65536)}o&4294901760?(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128):(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128)}else{e[s++]=o;continue}e[s++]=o&63|128}}const zm=new TextEncoder,Vm=50;function Hm(t,e,r){zm.encodeInto(t,e.subarray(r))}function Km(t,e,r){t.length>Vm?Hm(t,e,r):qm(t,e,r)}const Wm=4096;function xd(t,e,r){let i=e;const s=i+r,n=[];let o="";for(;i<s;){const a=t[i++];if(!(a&128))n.push(a);else if((a&224)===192){const c=t[i++]&63;n.push((a&31)<<6|c)}else if((a&240)===224){const c=t[i++]&63,l=t[i++]&63;n.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[i++]&63,l=t[i++]&63,u=t[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|h&1023),n.push(h)}else n.push(a);n.length>=Wm&&(o+=String.fromCharCode(...n),n.length=0)}return n.length>0&&(o+=String.fromCharCode(...n)),o}const Gm=new TextDecoder,Ym=200;function Zm(t,e,r){const i=t.subarray(e,e+r);return Gm.decode(i)}function Jm(t,e,r){return r>Ym?Zm(t,e,r):xd(t,e,r)}class Ls{constructor(e,r){Y(this,"type");Y(this,"data");this.type=e,this.data=r}}class lt extends Error{constructor(e){super(e);const r=Object.create(lt.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:lt.name})}}const Hi=4294967295;function Xm(t,e,r){const i=r/4294967296,s=r;t.setUint32(e,i),t.setUint32(e+4,s)}function Id(t,e,r){const i=Math.floor(r/4294967296),s=r;t.setUint32(e,i),t.setUint32(e+4,s)}function _d(t,e){const r=t.getInt32(e),i=t.getUint32(e+4);return r*4294967296+i}function Qm(t,e){const r=t.getUint32(e),i=t.getUint32(e+4);return r*4294967296+i}const eb=-1,tb=4294967296-1,rb=17179869184-1;function ib({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=rb)if(e===0&&t<=tb){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,i=t&4294967295,s=new Uint8Array(8),n=new DataView(s.buffer);return n.setUint32(0,e<<2|r&3),n.setUint32(4,i),s}else{const r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,e),Id(i,4,t),r}}function sb(t){const e=t.getTime(),r=Math.floor(e/1e3),i=(e-r*1e3)*1e6,s=Math.floor(i/1e9);return{sec:r+s,nsec:i-s*1e9}}function nb(t){if(t instanceof Date){const e=sb(t);return ib(e)}else return null}function ob(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),i=e.getUint32(4),s=(r&3)*4294967296+i,n=r>>>2;return{sec:s,nsec:n}}case 12:{const r=_d(e,4),i=e.getUint32(0);return{sec:r,nsec:i}}default:throw new lt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function ab(t){const e=ob(t);return new Date(e.sec*1e3+e.nsec/1e6)}const cb={type:eb,encode:nb,decode:ab},jn=class jn{constructor(){Y(this,"__brand");Y(this,"builtInEncoders",[]);Y(this,"builtInDecoders",[]);Y(this,"encoders",[]);Y(this,"decoders",[]);this.register(cb)}register({type:e,encode:r,decode:i}){if(e>=0)this.encoders[e]=r,this.decoders[e]=i;else{const s=-1-e;this.builtInEncoders[s]=r,this.builtInDecoders[s]=i}}tryToEncode(e,r){for(let i=0;i<this.builtInEncoders.length;i++){const s=this.builtInEncoders[i];if(s!=null){const n=s(e,r);if(n!=null){const o=-1-i;return new Ls(o,n)}}}for(let i=0;i<this.encoders.length;i++){const s=this.encoders[i];if(s!=null){const n=s(e,r);if(n!=null){const o=i;return new Ls(o,n)}}}return e instanceof Ls?e:null}decode(e,r,i){const s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,i):new Ls(r,e)}};Y(jn,"defaultCodec",new jn);let _n=jn;function lb(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function ba(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):lb(t)?new Uint8Array(t):Uint8Array.from(t)}const ub=100,hb=2048;let fb=class Sd{constructor(e){Y(this,"extensionCodec");Y(this,"context");Y(this,"useBigInt64");Y(this,"maxDepth");Y(this,"initialBufferSize");Y(this,"sortKeys");Y(this,"forceFloat32");Y(this,"ignoreUndefined");Y(this,"forceIntegerToFloat");Y(this,"pos");Y(this,"view");Y(this,"bytes");Y(this,"entered",!1);this.extensionCodec=(e==null?void 0:e.extensionCodec)??_n.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??ub,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??hb,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Sd({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),i=new Uint8Array(r),s=new DataView(r);i.set(this.bytes),this.view=s,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=Mm(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),Km(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,r){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const i=ba(e);this.writeU8a(i)}encodeArray(e,r){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const s of e)this.doEncode(s,r+1)}countWithoutUndefined(e,r){let i=0;for(const s of r)e[s]!==void 0&&i++;return i}encodeMap(e,r){const i=Object.keys(e);this.sortKeys&&i.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const n of i){const o=e[n];this.ignoreUndefined&&o===void 0||(this.encodeString(n),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),s=i.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(i);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),Xm(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Id(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function db(t,e){return new fb(e).encodeSharedRef(t)}function Oo(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const pb=16,gb=16;class yb{constructor(e=pb,r=gb){Y(this,"hit",0);Y(this,"miss",0);Y(this,"caches");Y(this,"maxKeyLength");Y(this,"maxLengthPerKey");this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,i){const s=this.caches[i-1];e:for(const n of s){const o=n.bytes;for(let a=0;a<i;a++)if(o[a]!==e[r+a])continue e;return n.str}return null}store(e,r){const i=this.caches[e.length-1],s={bytes:e,str:r};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=s:i.push(s)}decode(e,r,i){const s=this.find(e,r,i);if(s!=null)return this.hit++,s;this.miss++;const n=xd(e,r,i),o=Uint8Array.prototype.slice.call(e,r,r+i);return this.store(o,n),n}}const va="array",ls="map_key",Od="map_value",wb=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new lt("The type of key must be string or number but "+typeof t)};class mb{constructor(){Y(this,"stack",[]);Y(this,"stackHeadPosition",-1)}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=va,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=ls,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===va){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===ls||e.type===Od){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Ki=-1,vc=new DataView(new ArrayBuffer(0)),bb=new Uint8Array(vc.buffer);try{vc.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const zl=new RangeError("Insufficient data"),vb=new yb;let Eb=class Dd{constructor(e){Y(this,"extensionCodec");Y(this,"context");Y(this,"useBigInt64");Y(this,"rawStrings");Y(this,"maxStrLength");Y(this,"maxBinLength");Y(this,"maxArrayLength");Y(this,"maxMapLength");Y(this,"maxExtLength");Y(this,"keyDecoder");Y(this,"mapKeyConverter");Y(this,"totalPos",0);Y(this,"pos",0);Y(this,"view",vc);Y(this,"bytes",bb);Y(this,"headByte",Ki);Y(this,"stack",new mb);Y(this,"entered",!1);this.extensionCodec=(e==null?void 0:e.extensionCodec)??_n.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??Hi,this.maxBinLength=(e==null?void 0:e.maxBinLength)??Hi,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??Hi,this.maxMapLength=(e==null?void 0:e.maxMapLength)??Hi,this.maxExtLength=(e==null?void 0:e.maxExtLength)??Hi,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:vb,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??wb}clone(){return new Dd({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Ki,this.stack.reset()}setBuffer(e){const r=ba(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Ki&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),i=ba(e),s=new Uint8Array(r.length+i.length);s.set(r),s.set(i,r.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:i}=this;return new RangeError(`Extra ${r.byteLength-i} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,i;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:s,pos:n,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Oo(s)} at ${o} (${n} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let i=r,s=-1;for await(const n of e){if(r&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(n),i&&(s=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else{const s=e-160;r=this.decodeString(s,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const s=this.lookU8();r=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();r=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();r=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===196){const s=this.lookU8();r=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();r=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();r=this.decodeBinary(s,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();r=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();r=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();r=this.decodeExtension(s,4)}else throw new lt(`Unrecognized type byte: ${Oo(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const s=i.top();if(s.type===va)if(s.array[s.position]=r,s.position++,s.position===s.size)r=s.array,i.release(s);else continue e;else if(s.type===ls){if(r==="__proto__")throw new lt("The key __proto__ is not allowed");s.key=this.mapKeyConverter(r),s.type=Od;continue e}else if(s.map[s.key]=r,s.readCount++,s.readCount===s.size)r=s.map,i.release(s);else{s.key=null,s.type=ls;continue e}}return r}}readHeadByte(){return this.headByte===Ki&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Ki}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new lt(`Unrecognized array type byte: ${Oo(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new lt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new lt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){var n;if(e>this.maxStrLength)throw new lt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw zl;const i=this.pos+r;let s;return this.stateIsMapKey()&&((n=this.keyDecoder)!=null&&n.canBeCached(e))?s=this.keyDecoder.decode(this.bytes,i,e):s=Jm(this.bytes,i,e),this.pos+=r+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===ls:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new lt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw zl;const i=this.pos+r,s=this.bytes.subarray(i,i+e);return this.pos+=r+e,s}decodeExtension(e,r){if(e>this.maxExtLength)throw new lt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+r),s=this.decodeBinary(e,r+1);return this.extensionCodec.decode(s,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=Qm(this.view,this.pos);return this.pos+=8,e}readI64(){const e=_d(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function xb(t,e){return new Eb(e).decode(t)}const Ib=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),_b=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function oi(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return _b(t)}catch{return t}}function ai(t){return typeof t=="string"?t:Ib(t)||""}function Sb(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function $d(t,...e){if(!Sb(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Vl(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ob(t,e){$d(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const wi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Do=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Db(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Ad(t){return typeof t=="string"&&(t=Db(t)),$d(t),t}let $b=class{clone(){return this._cloneInto()}};function Ab(t){const e=i=>t().update(Ad(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Pd(t=32){if(wi&&typeof wi.getRandomValues=="function")return wi.getRandomValues(new Uint8Array(t));if(wi&&typeof wi.randomBytes=="function")return wi.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function Pb(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}let Bb=class extends $b{constructor(e,r,i,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Do(this.buffer)}update(e){Vl(this);const{view:r,buffer:i,blockLen:s}=this;e=Ad(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Do(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Vl(this),Ob(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;Pb(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=Do(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%r&&e.buffer.set(i),e}};const Ms=BigInt(2**32-1),Ea=BigInt(32);function Bd(t,e=!1){return e?{h:Number(t&Ms),l:Number(t>>Ea&Ms)}:{h:Number(t>>Ea&Ms)|0,l:Number(t&Ms)|0}}function Cb(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:o}=Bd(t[s],e);[r[s],i[s]]=[n,o]}return[r,i]}const Tb=(t,e)=>BigInt(t>>>0)<<Ea|BigInt(e>>>0),Rb=(t,e,r)=>t>>>r,Nb=(t,e,r)=>t<<32-r|e>>>r,Ub=(t,e,r)=>t>>>r|e<<32-r,kb=(t,e,r)=>t<<32-r|e>>>r,jb=(t,e,r)=>t<<64-r|e>>>r-32,Fb=(t,e,r)=>t>>>r-32|e<<64-r,Lb=(t,e)=>e,Mb=(t,e)=>t,qb=(t,e,r)=>t<<r|e>>>32-r,zb=(t,e,r)=>e<<r|t>>>32-r,Vb=(t,e,r)=>e<<r-32|t>>>64-r,Hb=(t,e,r)=>t<<r-32|e>>>64-r;function Kb(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const Wb=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Gb=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,Yb=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),Zb=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,Jb=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),Xb=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,J={fromBig:Bd,split:Cb,toBig:Tb,shrSH:Rb,shrSL:Nb,rotrSH:Ub,rotrSL:kb,rotrBH:jb,rotrBL:Fb,rotr32H:Lb,rotr32L:Mb,rotlSH:qb,rotlSL:zb,rotlBH:Vb,rotlBL:Hb,add:Kb,add3L:Wb,add3H:Gb,add4L:Yb,add4H:Zb,add5H:Xb,add5L:Jb},[Qb,e1]=J.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),yr=new Uint32Array(80),wr=new Uint32Array(80);let t1=class extends Bb{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:d,Gl:g,Hh:w,Hl:m}=this;return[e,r,i,s,n,o,a,c,l,u,h,f,d,g,w,m]}set(e,r,i,s,n,o,a,c,l,u,h,f,d,g,w,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=g|0,this.Hh=w|0,this.Hl=m|0}process(e,r){for(let E=0;E<16;E++,r+=4)yr[E]=e.getUint32(r),wr[E]=e.getUint32(r+=4);for(let E=16;E<80;E++){const I=yr[E-15]|0,A=wr[E-15]|0,B=J.rotrSH(I,A,1)^J.rotrSH(I,A,8)^J.shrSH(I,A,7),T=J.rotrSL(I,A,1)^J.rotrSL(I,A,8)^J.shrSL(I,A,7),R=yr[E-2]|0,$=wr[E-2]|0,k=J.rotrSH(R,$,19)^J.rotrBH(R,$,61)^J.shrSH(R,$,6),j=J.rotrSL(R,$,19)^J.rotrBL(R,$,61)^J.shrSL(R,$,6),P=J.add4L(T,j,wr[E-7],wr[E-16]),_=J.add4H(P,B,k,yr[E-7],yr[E-16]);yr[E]=_|0,wr[E]=P|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:d,Fl:g,Gh:w,Gl:m,Hh:O,Hl:C}=this;for(let E=0;E<80;E++){const I=J.rotrSH(h,f,14)^J.rotrSH(h,f,18)^J.rotrBH(h,f,41),A=J.rotrSL(h,f,14)^J.rotrSL(h,f,18)^J.rotrBL(h,f,41),B=h&d^~h&w,T=f&g^~f&m,R=J.add5L(C,A,T,e1[E],wr[E]),$=J.add5H(R,O,I,B,Qb[E],yr[E]),k=R|0,j=J.rotrSH(i,s,28)^J.rotrBH(i,s,34)^J.rotrBH(i,s,39),P=J.rotrSL(i,s,28)^J.rotrBL(i,s,34)^J.rotrBL(i,s,39),_=i&n^i&a^n&a,D=s&o^s&c^o&c;O=w|0,C=m|0,w=d|0,m=g|0,d=h|0,g=f|0,{h,l:f}=J.add(l|0,u|0,$|0,k|0),l=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const p=J.add3L(k,P,D);i=J.add3H(p,$,j,_),s=p|0}({h:i,l:s}=J.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=J.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=J.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=J.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=J.add(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:g}=J.add(this.Fh|0,this.Fl|0,d|0,g|0),{h:w,l:m}=J.add(this.Gh|0,this.Gl|0,w|0,m|0),{h:O,l:C}=J.add(this.Hh|0,this.Hl|0,O|0,C|0),this.set(i,s,n,o,a,c,l,u,h,f,d,g,w,m,O,C)}roundClean(){yr.fill(0),wr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const r1=Ab(()=>new t1);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ec=BigInt(0),Cd=BigInt(1),i1=BigInt(2);function xc(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ic(t){if(!xc(t))throw new Error("Uint8Array expected")}function $o(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const s1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function _c(t){Ic(t);let e="";for(let r=0;r<t.length;r++)e+=s1[t[r]];return e}function Td(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ec:BigInt("0x"+t)}const Jt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Hl(t){if(t>=Jt._0&&t<=Jt._9)return t-Jt._0;if(t>=Jt.A&&t<=Jt.F)return t-(Jt.A-10);if(t>=Jt.a&&t<=Jt.f)return t-(Jt.a-10)}function Rd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=Hl(t.charCodeAt(n)),a=Hl(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function n1(t){return Td(_c(t))}function ln(t){return Ic(t),Td(_c(Uint8Array.from(t).reverse()))}function Nd(t,e){return Rd(t.toString(16).padStart(e*2,"0"))}function xa(t,e){return Nd(t,e).reverse()}function Xt(t,e,r){let i;if(typeof e=="string")try{i=Rd(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(xc(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function Kl(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];Ic(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const Ao=t=>typeof t=="bigint"&&Ec<=t;function o1(t,e,r){return Ao(t)&&Ao(e)&&Ao(r)&&e<=t&&t<r}function Wi(t,e,r,i){if(!o1(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function a1(t){let e;for(e=0;t>Ec;t>>=Cd,e+=1);return e}const c1=t=>(i1<<BigInt(t-1))-Cd,l1={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||xc(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Sc(t,e,r={}){const i=(s,n,o)=>{const a=l1[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function Wl(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const $e=BigInt(0),ge=BigInt(1),Zr=BigInt(2),u1=BigInt(3),Ia=BigInt(4),Gl=BigInt(5),Yl=BigInt(8);function Ee(t,e){const r=t%e;return r>=$e?r:e+r}function h1(t,e,r){if(e<$e)throw new Error("invalid exponent, negatives unsupported");if(r<=$e)throw new Error("invalid modulus");if(r===ge)return $e;let i=ge;for(;e>$e;)e&ge&&(i=i*t%r),t=t*t%r,e>>=ge;return i}function Rt(t,e,r){let i=t;for(;e-- >$e;)i*=i,i%=r;return i}function Zl(t,e){if(t===$e)throw new Error("invert: expected non-zero number");if(e<=$e)throw new Error("invert: expected positive modulus, got "+e);let r=Ee(t,e),i=e,s=$e,n=ge;for(;r!==$e;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==ge)throw new Error("invert: does not exist");return Ee(s,e)}function f1(t){const e=(t-ge)/Zr;let r,i,s;for(r=t-ge,i=0;r%Zr===$e;r/=Zr,i++);for(s=Zr;s<t&&h1(s,e,t)!==t-ge;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+ge)/Ia;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const n=(r+ge)/Zr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,s),r),u=o.pow(a,n),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let g=o.sqr(h);f<c&&!o.eql(g,o.ONE);f++)g=o.sqr(g);const d=o.pow(l,ge<<BigInt(c-f-1));l=o.sqr(d),u=o.mul(u,d),h=o.mul(h,l),c=f}return u}}function d1(t){if(t%Ia===u1){const e=(t+ge)/Ia;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%Yl===Gl){const e=(t-Gl)/Yl;return function(r,i){const s=r.mul(i,Zr),n=r.pow(s,e),o=r.mul(i,n),a=r.mul(r.mul(o,Zr),n),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return f1(t)}const p1=(t,e)=>(Ee(t,e)&ge)===ge,g1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function y1(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=g1.reduce((i,s)=>(i[s]="function",i),e);return Sc(t,r)}function w1(t,e,r){if(r<$e)throw new Error("invalid exponent, negatives unsupported");if(r===$e)return t.ONE;if(r===ge)return e;let i=t.ONE,s=e;for(;r>$e;)r&ge&&(i=t.mul(i,s)),s=t.sqr(s),r>>=ge;return i}function m1(t,e){const r=new Array(e.length),i=e.reduce((n,o,a)=>t.is0(o)?n:(r[a]=n,t.mul(n,o)),t.ONE),s=t.inv(i);return e.reduceRight((n,o,a)=>t.is0(o)?n:(r[a]=t.mul(n,r[a]),t.mul(n,o)),s),r}function Ud(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function kd(t,e,r=!1,i={}){if(t<=$e)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=Ud(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:c1(s),ZERO:$e,ONE:ge,create:c=>Ee(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return $e<=c&&c<t},is0:c=>c===$e,isOdd:c=>(c&ge)===ge,neg:c=>Ee(-c,t),eql:(c,l)=>c===l,sqr:c=>Ee(c*c,t),add:(c,l)=>Ee(c+l,t),sub:(c,l)=>Ee(c-l,t),mul:(c,l)=>Ee(c*l,t),pow:(c,l)=>w1(a,c,l),div:(c,l)=>Ee(c*Zl(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Zl(c,t),sqrt:i.sqrt||(c=>(o||(o=d1(t)),o(a,c))),invertBatch:c=>m1(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>r?xa(c,n):Nd(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?ln(c):n1(c)}});return Object.freeze(a)}const Jl=BigInt(0),qs=BigInt(1);function Po(t,e){const r=e.negate();return t?r:e}function jd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Bo(t,e){jd(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function b1(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function v1(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Co=new WeakMap,Fd=new WeakMap;function To(t){return Fd.get(t)||1}function E1(t,e){return{constTimeNegate:Po,hasPrecomputes(r){return To(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>Jl;)i&qs&&(s=s.add(n)),n=n.double(),i>>=qs;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=Bo(i,e),o=[];let a=r,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<n;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){const{windows:n,windowSize:o}=Bo(r,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**r-1),u=2**r,h=BigInt(r);for(let f=0;f<n;f++){const d=f*o;let g=Number(s&l);s>>=h,g>o&&(g-=u,s+=qs);const w=d,m=d+Math.abs(g)-1,O=f%2!==0,C=g<0;g===0?c=c.add(Po(O,i[w])):a=a.add(Po(C,i[m]))}return{p:a,f:c}},wNAFUnsafe(r,i,s,n=t.ZERO){const{windows:o,windowSize:a}=Bo(r,e),c=BigInt(2**r-1),l=2**r,u=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(s===Jl)break;let d=Number(s&c);if(s>>=u,d>a&&(d-=l,s+=qs),d===0)continue;let g=i[f+Math.abs(d)-1];d<0&&(g=g.negate()),n=n.add(g)}return n},getPrecomputes(r,i,s){let n=Co.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&Co.set(i,s(n))),n},wNAFCached(r,i,s){const n=To(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=To(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){jd(i,e),Fd.set(r,i),Co.delete(r)}}}function x1(t,e,r,i){if(b1(r,t),v1(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,n=a1(BigInt(r.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let u=s;for(let h=l;h>=0;h-=o){c.fill(s);for(let d=0;d<i.length;d++){const g=i[d],w=Number(g>>BigInt(h)&BigInt(a));c[w]=c[w].add(r[d])}let f=s;for(let d=c.length-1,g=s;d>0;d--)g=g.add(c[d]),f=f.add(g);if(u=u.add(f),h!==0)for(let d=0;d<o;d++)u=u.double()}return u}function I1(t){return y1(t.Fp),Sc(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Ud(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const _t=BigInt(0),Ge=BigInt(1),zs=BigInt(2),_1=BigInt(8),S1={zip215:!0};function O1(t){const e=I1(t);return Sc(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function D1(t){const e=O1(t),{Fp:r,n:i,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,l=zs<<BigInt(a*8)-Ge,u=r.create,h=kd(e.n,e.nBitLength),f=e.uvRatio||((p,y)=>{try{return{isValid:!0,value:r.sqrt(p*r.inv(y))}}catch{return{isValid:!1,value:_t}}}),d=e.adjustScalarBytes||(p=>p),g=e.domain||((p,y,b)=>{if($o("phflag",b),y.length||b)throw new Error("Contexts/pre-hash are not supported");return p});function w(p,y){Wi("coordinate "+p,y,_t,l)}function m(p){if(!(p instanceof E))throw new Error("ExtendedPoint expected")}const O=Wl((p,y)=>{const{ex:b,ey:S,ez:v}=p,x=p.is0();y==null&&(y=x?_1:r.inv(v));const N=u(b*y),U=u(S*y),V=u(v*y);if(x)return{x:_t,y:Ge};if(V!==Ge)throw new Error("invZ was invalid");return{x:N,y:U}}),C=Wl(p=>{const{a:y,d:b}=e;if(p.is0())throw new Error("bad point: ZERO");const{ex:S,ey:v,ez:x,et:N}=p,U=u(S*S),V=u(v*v),L=u(x*x),q=u(L*L),K=u(U*y),G=u(L*u(K+V)),X=u(q+u(b*u(U*V)));if(G!==X)throw new Error("bad point: equation left != right (1)");const W=u(S*v),Q=u(x*N);if(W!==Q)throw new Error("bad point: equation left != right (2)");return!0});class E{constructor(y,b,S,v){this.ex=y,this.ey=b,this.ez=S,this.et=v,w("x",y),w("y",b),w("z",S),w("t",v),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(y){if(y instanceof E)throw new Error("extended point not allowed");const{x:b,y:S}=y||{};return w("x",b),w("y",S),new E(b,S,Ge,u(b*S))}static normalizeZ(y){const b=r.invertBatch(y.map(S=>S.ez));return y.map((S,v)=>S.toAffine(b[v])).map(E.fromAffine)}static msm(y,b){return x1(E,h,y,b)}_setWindowSize(y){B.setWindowSize(this,y)}assertValidity(){C(this)}equals(y){m(y);const{ex:b,ey:S,ez:v}=this,{ex:x,ey:N,ez:U}=y,V=u(b*U),L=u(x*v),q=u(S*U),K=u(N*v);return V===L&&q===K}is0(){return this.equals(E.ZERO)}negate(){return new E(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:y}=e,{ex:b,ey:S,ez:v}=this,x=u(b*b),N=u(S*S),U=u(zs*u(v*v)),V=u(y*x),L=b+S,q=u(u(L*L)-x-N),K=V+N,G=K-U,X=V-N,W=u(q*G),Q=u(K*X),de=u(q*X),be=u(G*K);return new E(W,Q,be,de)}add(y){m(y);const{a:b,d:S}=e,{ex:v,ey:x,ez:N,et:U}=this,{ex:V,ey:L,ez:q,et:K}=y;if(b===BigInt(-1)){const tl=u((x-v)*(L+V)),rl=u((x+v)*(L-V)),co=u(rl-tl);if(co===_t)return this.double();const il=u(N*zs*K),sl=u(U*zs*q),nl=sl+il,ol=rl+tl,al=sl-il,Sy=u(nl*co),Oy=u(ol*al),Dy=u(nl*al),$y=u(co*ol);return new E(Sy,Oy,$y,Dy)}const G=u(v*V),X=u(x*L),W=u(U*S*K),Q=u(N*q),de=u((v+x)*(V+L)-G-X),be=Q-W,xe=Q+W,Ve=u(X-b*G),Gt=u(de*be),dr=u(xe*Ve),Iy=u(de*Ve),_y=u(be*xe);return new E(Gt,dr,_y,Iy)}subtract(y){return this.add(y.negate())}wNAF(y){return B.wNAFCached(this,y,E.normalizeZ)}multiply(y){const b=y;Wi("scalar",b,Ge,i);const{p:S,f:v}=this.wNAF(b);return E.normalizeZ([S,v])[0]}multiplyUnsafe(y,b=E.ZERO){const S=y;return Wi("scalar",S,_t,i),S===_t?A:this.is0()||S===Ge?this:B.wNAFCachedUnsafe(this,S,E.normalizeZ,b)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return B.unsafeLadder(this,i).is0()}toAffine(y){return O(this,y)}clearCofactor(){const{h:y}=e;return y===Ge?this:this.multiplyUnsafe(y)}static fromHex(y,b=!1){const{d:S,a:v}=e,x=r.BYTES;y=Xt("pointHex",y,x),$o("zip215",b);const N=y.slice(),U=y[x-1];N[x-1]=U&-129;const V=ln(N),L=b?l:r.ORDER;Wi("pointHex.y",V,_t,L);const q=u(V*V),K=u(q-Ge),G=u(S*q-v);let{isValid:X,value:W}=f(K,G);if(!X)throw new Error("Point.fromHex: invalid y coordinate");const Q=(W&Ge)===Ge,de=(U&128)!==0;if(!b&&W===_t&&de)throw new Error("Point.fromHex: x=0 and x_0=1");return de!==Q&&(W=u(-W)),E.fromAffine({x:W,y:V})}static fromPrivateKey(y){return $(y).point}toRawBytes(){const{x:y,y:b}=this.toAffine(),S=xa(b,r.BYTES);return S[S.length-1]|=y&Ge?128:0,S}toHex(){return _c(this.toRawBytes())}}E.BASE=new E(e.Gx,e.Gy,Ge,u(e.Gx*e.Gy)),E.ZERO=new E(_t,Ge,Ge,_t);const{BASE:I,ZERO:A}=E,B=E1(E,a*8);function T(p){return Ee(p,i)}function R(p){return T(ln(p))}function $(p){const y=r.BYTES;p=Xt("private key",p,y);const b=Xt("hashed private key",n(p),2*y),S=d(b.slice(0,y)),v=b.slice(y,2*y),x=R(S),N=I.multiply(x),U=N.toRawBytes();return{head:S,prefix:v,scalar:x,point:N,pointBytes:U}}function k(p){return $(p).pointBytes}function j(p=new Uint8Array,...y){const b=Kl(...y);return R(n(g(b,Xt("context",p),!!s)))}function P(p,y,b={}){p=Xt("message",p),s&&(p=s(p));const{prefix:S,scalar:v,pointBytes:x}=$(y),N=j(b.context,S,p),U=I.multiply(N).toRawBytes(),V=j(b.context,U,x,p),L=T(N+V*v);Wi("signature.s",L,_t,i);const q=Kl(U,xa(L,r.BYTES));return Xt("result",q,r.BYTES*2)}const _=S1;function D(p,y,b,S=_){const{context:v,zip215:x}=S,N=r.BYTES;p=Xt("signature",p,2*N),y=Xt("message",y),b=Xt("publicKey",b,N),x!==void 0&&$o("zip215",x),s&&(y=s(y));const U=ln(p.slice(N,2*N));let V,L,q;try{V=E.fromHex(b,x),L=E.fromHex(p.slice(0,N),x),q=I.multiplyUnsafe(U)}catch{return!1}if(!x&&V.isSmallOrder())return!1;const K=j(v,L.toRawBytes(),V.toRawBytes(),y);return L.add(V.multiplyUnsafe(K)).subtract(q).clearCofactor().equals(E.ZERO)}return I._setWindowSize(8),{CURVE:e,getPublicKey:k,sign:P,verify:D,ExtendedPoint:E,utils:{getExtendedPublicKey:$,randomPrivateKey:()=>o(r.BYTES),precompute(p=8,y=E.BASE){return y._setWindowSize(p),y.multiply(BigInt(3)),y}}}}BigInt(0),BigInt(1);const Oc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Xl=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const $1=BigInt(1),Ql=BigInt(2);BigInt(3);const A1=BigInt(5),P1=BigInt(8);function B1(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=Oc,o=t*t%n*t%n,a=Rt(o,Ql,n)*o%n,c=Rt(a,$1,n)*t%n,l=Rt(c,A1,n)*c%n,u=Rt(l,e,n)*l%n,h=Rt(u,r,n)*u%n,f=Rt(h,i,n)*h%n,d=Rt(f,s,n)*f%n,g=Rt(d,s,n)*f%n,w=Rt(g,e,n)*l%n;return{pow_p_5_8:Rt(w,Ql,n)*t%n,b2:o}}function C1(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function T1(t,e){const r=Oc,i=Ee(e*e*e,r),s=Ee(i*i*e,r),n=B1(t*s).pow_p_5_8;let o=Ee(t*i*n,r);const a=Ee(e*o*o,r),c=o,l=Ee(o*Xl,r),u=a===t,h=a===Ee(-t,r),f=a===Ee(-t*Xl,r);return u&&(o=c),(h||f)&&(o=l),p1(o,r)&&(o=Ee(-o,r)),{isValid:u||h,value:o}}const R1=kd(Oc,void 0,!0),N1={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:R1,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:P1,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:r1,randomBytes:Pd,adjustScalarBytes:C1,uvRatio:T1},Ld=D1(N1),U1="EdDSA",k1="JWT",Sn=".",qn="base64url",Md="utf8",qd="utf8",j1=":",F1="did",L1="key",eu="base58btc",M1="z",q1="K36",z1=32;function Dc(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function zd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Dc(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Vd(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=zd(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return Dc(r)}function V1(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,m=0,O=0,C=g.length;O!==C&&g[O]===0;)O++,w++;for(var E=(C-O)*u+1>>>0,I=new Uint8Array(E);O!==C;){for(var A=g[O],B=0,T=E-1;(A!==0||B<m)&&T!==-1;T--,B++)A+=256*I[T]>>>0,I[T]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");m=B,O++}for(var R=E-m;R!==E&&I[R]===0;)R++;for(var $=c.repeat(w);R<E;++R)$+=t.charAt(I[R]);return $}function f(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var w=0;if(g[w]!==" "){for(var m=0,O=0;g[w]===c;)m++,w++;for(var C=(g.length-w)*l+1>>>0,E=new Uint8Array(C);g[w];){var I=r[g.charCodeAt(w)];if(I===255)return;for(var A=0,B=C-1;(I!==0||A<O)&&B!==-1;B--,A++)I+=a*E[B]>>>0,E[B]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");O=A,w++}if(g[w]!==" "){for(var T=C-O;T!==C&&E[T]===0;)T++;for(var R=new Uint8Array(m+(C-T)),$=m;T!==C;)R[$++]=E[T++];return R}}}function d(g){var w=f(g);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var H1=V1,K1=H1;const Hd=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},W1=t=>new TextEncoder().encode(t),G1=t=>new TextDecoder().decode(t);let Y1=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Z1=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Kd(this,e)}},J1=class{constructor(e){this.decoders=e}or(e){return Kd(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const Kd=(t,e)=>new J1({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let X1=class{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new Y1(e,r,i),this.decoder=new Z1(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const zn=({name:t,prefix:e,encode:r,decode:i})=>new X1(t,e,r,i),As=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=K1(r,e);return zn({prefix:t,name:e,encode:i,decode:n=>Hd(s(n))})},Q1=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},ev=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Re=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>zn({prefix:e,name:t,encode(s){return ev(s,i,r)},decode(s){return Q1(s,i,r,t)}}),tv=zn({prefix:"\0",name:"identity",encode:t=>G1(t),decode:t=>W1(t)});var rv=Object.freeze({__proto__:null,identity:tv});const iv=Re({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var sv=Object.freeze({__proto__:null,base2:iv});const nv=Re({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ov=Object.freeze({__proto__:null,base8:nv});const av=As({prefix:"9",name:"base10",alphabet:"0123456789"});var cv=Object.freeze({__proto__:null,base10:av});const lv=Re({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),uv=Re({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var hv=Object.freeze({__proto__:null,base16:lv,base16upper:uv});const fv=Re({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),dv=Re({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),pv=Re({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gv=Re({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),yv=Re({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),wv=Re({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),mv=Re({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),bv=Re({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),vv=Re({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ev=Object.freeze({__proto__:null,base32:fv,base32upper:dv,base32pad:pv,base32padupper:gv,base32hex:yv,base32hexupper:wv,base32hexpad:mv,base32hexpadupper:bv,base32z:vv});const xv=As({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Iv=As({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var _v=Object.freeze({__proto__:null,base36:xv,base36upper:Iv});const Sv=As({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Ov=As({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Dv=Object.freeze({__proto__:null,base58btc:Sv,base58flickr:Ov});const $v=Re({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Av=Re({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Pv=Re({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Bv=Re({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Cv=Object.freeze({__proto__:null,base64:$v,base64pad:Av,base64url:Pv,base64urlpad:Bv});const Wd=Array.from(""),Tv=Wd.reduce((t,e,r)=>(t[r]=e,t),[]),Rv=Wd.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Nv(t){return t.reduce((e,r)=>(e+=Tv[r],e),"")}function Uv(t){const e=[];for(const r of t){const i=Rv[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const kv=zn({prefix:"",name:"base256emoji",encode:Nv,decode:Uv});var jv=Object.freeze({__proto__:null,base256emoji:kv}),Fv=Gd,tu=128,Lv=-128,Mv=Math.pow(2,31);function Gd(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Mv;)e[r++]=t&255|tu,t/=128;for(;t&Lv;)e[r++]=t&255|tu,t>>>=7;return e[r]=t|0,Gd.bytes=r-i+1,e}var qv=_a,zv=128,ru=127;function _a(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw _a.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&ru)<<s:(o&ru)*Math.pow(2,s),s+=7}while(o>=zv);return _a.bytes=n-i,r}var Vv=Math.pow(2,7),Hv=Math.pow(2,14),Kv=Math.pow(2,21),Wv=Math.pow(2,28),Gv=Math.pow(2,35),Yv=Math.pow(2,42),Zv=Math.pow(2,49),Jv=Math.pow(2,56),Xv=Math.pow(2,63),Qv=function(t){return t<Vv?1:t<Hv?2:t<Kv?3:t<Wv?4:t<Gv?5:t<Yv?6:t<Zv?7:t<Jv?8:t<Xv?9:10},e2={encode:Fv,decode:qv,encodingLength:Qv},Yd=e2;const iu=(t,e,r=0)=>(Yd.encode(t,e,r),e),su=t=>Yd.encodingLength(t),Sa=(t,e)=>{const r=e.byteLength,i=su(t),s=i+su(r),n=new Uint8Array(s+r);return iu(t,n,0),iu(r,n,i),n.set(e,s),new t2(t,r,e,n)};let t2=class{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}};const Zd=({name:t,code:e,encode:r})=>new r2(t,e,r);let r2=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Sa(this.code,r):r.then(i=>Sa(this.code,i))}else throw Error("Unknown type, must be binary type")}};const Jd=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),i2=Zd({name:"sha2-256",code:18,encode:Jd("SHA-256")}),s2=Zd({name:"sha2-512",code:19,encode:Jd("SHA-512")});var n2=Object.freeze({__proto__:null,sha256:i2,sha512:s2});const Xd=0,o2="identity",Qd=Hd,a2=t=>Sa(Xd,Qd(t)),c2={code:Xd,name:o2,encode:Qd,digest:a2};var l2=Object.freeze({__proto__:null,identity:c2});new TextEncoder,new TextDecoder;const nu={...rv,...sv,...ov,...cv,...hv,...Ev,..._v,...Dv,...Cv,...jv};({...n2,...l2});function ep(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const ou=ep("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ro=ep("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=zd(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),tp={utf8:ou,"utf-8":ou,hex:nu.base16,latin1:Ro,ascii:Ro,binary:Ro,...nu};function Vn(t,e="utf8"){const r=tp[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Fi(t,e="utf8"){const r=tp[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Dc(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function au(t){return oi(Vn(Fi(t,qn),Md))}function On(t){return Vn(Fi(ai(t),Md),qn)}function rp(t){const e=Fi(q1,eu),r=M1+Vn(Vd([e,t]),eu);return[F1,L1,r].join(j1)}function u2(t){return Vn(t,qn)}function h2(t){return Fi(t,qn)}function f2(t){return Fi([On(t.header),On(t.payload)].join(Sn),qd)}function d2(t){return[On(t.header),On(t.payload),u2(t.signature)].join(Sn)}function Oa(t){const e=t.split(Sn),r=au(e[0]),i=au(e[1]),s=h2(e[2]),n=Fi(e.slice(0,2).join(Sn),qd);return{header:r,payload:i,signature:s,data:n}}function cu(t=Pd(z1)){const e=Ld.getPublicKey(t);return{secretKey:Vd([t,e]),publicKey:e}}async function p2(t,e,r,i,s=M.fromMiliseconds(Date.now())){const n={alg:U1,typ:k1},o=rp(i.publicKey),a=s+r,c={iss:o,sub:t,aud:e,iat:s,exp:a},l=f2({header:n,payload:c}),u=Ld.sign(l,i.secretKey.slice(0,32));return d2({header:n,payload:c,signature:u})}function $c(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function ip(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?$c(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function us(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=ip(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return $c(r)}function g2(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,m=0,O=0,C=g.length;O!==C&&g[O]===0;)O++,w++;for(var E=(C-O)*u+1>>>0,I=new Uint8Array(E);O!==C;){for(var A=g[O],B=0,T=E-1;(A!==0||B<m)&&T!==-1;T--,B++)A+=256*I[T]>>>0,I[T]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");m=B,O++}for(var R=E-m;R!==E&&I[R]===0;)R++;for(var $=c.repeat(w);R<E;++R)$+=t.charAt(I[R]);return $}function f(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var w=0;if(g[w]!==" "){for(var m=0,O=0;g[w]===c;)m++,w++;for(var C=(g.length-w)*l+1>>>0,E=new Uint8Array(C);g[w];){var I=r[g.charCodeAt(w)];if(I===255)return;for(var A=0,B=C-1;(I!==0||A<O)&&B!==-1;B--,A++)I+=a*E[B]>>>0,E[B]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");O=A,w++}if(g[w]!==" "){for(var T=C-O;T!==C&&E[T]===0;)T++;for(var R=new Uint8Array(m+(C-T)),$=m;T!==C;)R[$++]=E[T++];return R}}}function d(g){var w=f(g);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var y2=g2,w2=y2;const m2=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},b2=t=>new TextEncoder().encode(t),v2=t=>new TextDecoder().decode(t);class E2{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class x2{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sp(this,e)}}class I2{constructor(e){this.decoders=e}or(e){return sp(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const sp=(t,e)=>new I2({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class _2{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new E2(e,r,i),this.decoder=new x2(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Hn=({name:t,prefix:e,encode:r,decode:i})=>new _2(t,e,r,i),Ps=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=w2(r,e);return Hn({prefix:t,name:e,encode:i,decode:n=>m2(s(n))})},S2=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},O2=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Ne=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Hn({prefix:e,name:t,encode(s){return O2(s,i,r)},decode(s){return S2(s,i,r,t)}}),D2=Hn({prefix:"\0",name:"identity",encode:t=>v2(t),decode:t=>b2(t)}),$2=Object.freeze(Object.defineProperty({__proto__:null,identity:D2},Symbol.toStringTag,{value:"Module"})),A2=Ne({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),P2=Object.freeze(Object.defineProperty({__proto__:null,base2:A2},Symbol.toStringTag,{value:"Module"})),B2=Ne({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),C2=Object.freeze(Object.defineProperty({__proto__:null,base8:B2},Symbol.toStringTag,{value:"Module"})),T2=Ps({prefix:"9",name:"base10",alphabet:"0123456789"}),R2=Object.freeze(Object.defineProperty({__proto__:null,base10:T2},Symbol.toStringTag,{value:"Module"})),N2=Ne({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),U2=Ne({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),k2=Object.freeze(Object.defineProperty({__proto__:null,base16:N2,base16upper:U2},Symbol.toStringTag,{value:"Module"})),j2=Ne({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),F2=Ne({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),L2=Ne({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),M2=Ne({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),q2=Ne({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),z2=Ne({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),V2=Ne({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),H2=Ne({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),K2=Ne({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),W2=Object.freeze(Object.defineProperty({__proto__:null,base32:j2,base32hex:q2,base32hexpad:V2,base32hexpadupper:H2,base32hexupper:z2,base32pad:L2,base32padupper:M2,base32upper:F2,base32z:K2},Symbol.toStringTag,{value:"Module"})),G2=Ps({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Y2=Ps({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Z2=Object.freeze(Object.defineProperty({__proto__:null,base36:G2,base36upper:Y2},Symbol.toStringTag,{value:"Module"})),J2=Ps({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),X2=Ps({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Q2=Object.freeze(Object.defineProperty({__proto__:null,base58btc:J2,base58flickr:X2},Symbol.toStringTag,{value:"Module"})),eE=Ne({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),tE=Ne({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),rE=Ne({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),iE=Ne({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),sE=Object.freeze(Object.defineProperty({__proto__:null,base64:eE,base64pad:tE,base64url:rE,base64urlpad:iE},Symbol.toStringTag,{value:"Module"})),np=Array.from(""),nE=np.reduce((t,e,r)=>(t[r]=e,t),[]),oE=np.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function aE(t){return t.reduce((e,r)=>(e+=nE[r],e),"")}function cE(t){const e=[];for(const r of t){const i=oE[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const lE=Hn({prefix:"",name:"base256emoji",encode:aE,decode:cE}),uE=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:lE},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const lu={...$2,...P2,...C2,...R2,...k2,...W2,...Z2,...Q2,...sE,...uE};function op(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const uu=op("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),No=op("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=ip(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),ap={utf8:uu,"utf-8":uu,hex:lu.base16,latin1:No,ascii:No,binary:No,...lu};function vt(t,e="utf8"){const r=ap[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?$c(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function it(t,e="utf8"){const r=ap[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const hE={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},fE="Input must be an string, Buffer or Uint8Array";function dE(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(fE);return e}function pE(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function Vs(t){return(4294967296+t).toString(16).substring(1)}function gE(t,e,r){let i=`
`+t+" = ";for(let s=0;s<e.length;s+=2){if(r===32)i+=Vs(e[s]).toUpperCase(),i+=" ",i+=Vs(e[s+1]).toUpperCase();else if(r===64)i+=Vs(e[s+1]).toUpperCase(),i+=Vs(e[s]).toUpperCase();else throw new Error("Invalid size "+r);s%6===4?i+=`
`+new Array(t.length+4).join(" "):s<e.length-2&&(i+=" ")}console.log(i)}function yE(t,e,r){let i=new Date().getTime();const s=new Uint8Array(e);for(let o=0;o<e;o++)s[o]=o%256;const n=new Date().getTime();console.log("Generated random input in "+(n-i)+"ms"),i=n;for(let o=0;o<r;o++){const a=t(s),c=new Date().getTime(),l=c-i;i=c,console.log("Hashed in "+l+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(l/1e3)*100)/100+" MB PER SECOND")}}var cp={normalizeInput:dE,toHex:pE,debugPrint:gE,testSpeed:yE};const un=cp;function Hs(t,e,r){const i=t[e]+t[r];let s=t[e+1]+t[r+1];i>=4294967296&&s++,t[e]=i,t[e+1]=s}function hu(t,e,r,i){let s=t[e]+r;r<0&&(s+=4294967296);let n=t[e+1]+i;s>=4294967296&&n++,t[e]=s,t[e+1]=n}function lp(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function mr(t,e,r,i,s,n){const o=ns[s],a=ns[s+1],c=ns[n],l=ns[n+1];Hs(Z,t,e),hu(Z,t,o,a);let u=Z[i]^Z[t],h=Z[i+1]^Z[t+1];Z[i]=h,Z[i+1]=u,Hs(Z,r,i),u=Z[e]^Z[r],h=Z[e+1]^Z[r+1],Z[e]=u>>>24^h<<8,Z[e+1]=h>>>24^u<<8,Hs(Z,t,e),hu(Z,t,c,l),u=Z[i]^Z[t],h=Z[i+1]^Z[t+1],Z[i]=u>>>16^h<<16,Z[i+1]=h>>>16^u<<16,Hs(Z,r,i),u=Z[e]^Z[r],h=Z[e+1]^Z[r+1],Z[e]=h>>>31^u<<1,Z[e+1]=u>>>31^h<<1}const up=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),wE=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],ke=new Uint8Array(wE.map(function(t){return t*2})),Z=new Uint32Array(32),ns=new Uint32Array(32);function hp(t,e){let r=0;for(r=0;r<16;r++)Z[r]=t.h[r],Z[r+16]=up[r];for(Z[24]=Z[24]^t.t,Z[25]=Z[25]^t.t/4294967296,e&&(Z[28]=~Z[28],Z[29]=~Z[29]),r=0;r<32;r++)ns[r]=lp(t.b,4*r);for(r=0;r<12;r++)mr(0,8,16,24,ke[r*16+0],ke[r*16+1]),mr(2,10,18,26,ke[r*16+2],ke[r*16+3]),mr(4,12,20,28,ke[r*16+4],ke[r*16+5]),mr(6,14,22,30,ke[r*16+6],ke[r*16+7]),mr(0,10,20,30,ke[r*16+8],ke[r*16+9]),mr(2,12,22,24,ke[r*16+10],ke[r*16+11]),mr(4,14,16,26,ke[r*16+12],ke[r*16+13]),mr(6,8,18,28,ke[r*16+14],ke[r*16+15]);for(r=0;r<16;r++)t.h[r]=t.h[r]^Z[r]^Z[r+16]}const br=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function fp(t,e,r,i){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(r&&r.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(i&&i.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const s={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};br.fill(0),br[0]=t,e&&(br[1]=e.length),br[2]=1,br[3]=1,r&&br.set(r,32),i&&br.set(i,48);for(let n=0;n<16;n++)s.h[n]=up[n]^lp(br,n*4);return e&&(Ac(s,e),s.c=128),s}function Ac(t,e){for(let r=0;r<e.length;r++)t.c===128&&(t.t+=t.c,hp(t,!1),t.c=0),t.b[t.c++]=e[r]}function dp(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;hp(t,!0);const e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3);return e}function pp(t,e,r,i,s){r=r||64,t=un.normalizeInput(t),i&&(i=un.normalizeInput(i)),s&&(s=un.normalizeInput(s));const n=fp(r,e,i,s);return Ac(n,t),dp(n)}function mE(t,e,r,i,s){const n=pp(t,e,r,i,s);return un.toHex(n)}var bE={blake2b:pp,blake2bHex:mE,blake2bInit:fp,blake2bUpdate:Ac,blake2bFinal:dp};const gp=cp;function vE(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function vr(t,e,r,i,s,n){se[t]=se[t]+se[e]+s,se[i]=Ks(se[i]^se[t],16),se[r]=se[r]+se[i],se[e]=Ks(se[e]^se[r],12),se[t]=se[t]+se[e]+n,se[i]=Ks(se[i]^se[t],8),se[r]=se[r]+se[i],se[e]=Ks(se[e]^se[r],7)}function Ks(t,e){return t>>>e^t<<32-e}const yp=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),je=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),se=new Uint32Array(16),Ae=new Uint32Array(16);function wp(t,e){let r=0;for(r=0;r<8;r++)se[r]=t.h[r],se[r+8]=yp[r];for(se[12]^=t.t,se[13]^=t.t/4294967296,e&&(se[14]=~se[14]),r=0;r<16;r++)Ae[r]=vE(t.b,4*r);for(r=0;r<10;r++)vr(0,4,8,12,Ae[je[r*16+0]],Ae[je[r*16+1]]),vr(1,5,9,13,Ae[je[r*16+2]],Ae[je[r*16+3]]),vr(2,6,10,14,Ae[je[r*16+4]],Ae[je[r*16+5]]),vr(3,7,11,15,Ae[je[r*16+6]],Ae[je[r*16+7]]),vr(0,5,10,15,Ae[je[r*16+8]],Ae[je[r*16+9]]),vr(1,6,11,12,Ae[je[r*16+10]],Ae[je[r*16+11]]),vr(2,7,8,13,Ae[je[r*16+12]],Ae[je[r*16+13]]),vr(3,4,9,14,Ae[je[r*16+14]],Ae[je[r*16+15]]);for(r=0;r<8;r++)t.h[r]^=se[r]^se[r+8]}function mp(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");const r=e?e.length:0;if(e&&!(r>0&&r<=32))throw new Error("Incorrect key length, should be in [1, 32]");const i={h:new Uint32Array(yp),b:new Uint8Array(64),c:0,t:0,outlen:t};return i.h[0]^=16842752^r<<8^t,r>0&&(Pc(i,e),i.c=64),i}function Pc(t,e){for(let r=0;r<e.length;r++)t.c===64&&(t.t+=t.c,wp(t,!1),t.c=0),t.b[t.c++]=e[r]}function bp(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;wp(t,!0);const e=new Uint8Array(t.outlen);for(let r=0;r<t.outlen;r++)e[r]=t.h[r>>2]>>8*(r&3)&255;return e}function vp(t,e,r){r=r||32,t=gp.normalizeInput(t);const i=mp(r,e);return Pc(i,t),bp(i)}function EE(t,e,r){const i=vp(t,e,r);return gp.toHex(i)}var xE={blake2s:vp,blake2sHex:EE,blake2sInit:mp,blake2sUpdate:Pc,blake2sFinal:bp};const Gi=bE,Yi=xE;var IE={blake2b:Gi.blake2b,blake2bHex:Gi.blake2bHex,blake2bInit:Gi.blake2bInit,blake2bUpdate:Gi.blake2bUpdate,blake2bFinal:Gi.blake2bFinal,blake2s:Yi.blake2s,blake2sHex:Yi.blake2sHex,blake2sInit:Yi.blake2sInit,blake2sUpdate:Yi.blake2sUpdate,blake2sFinal:Yi.blake2sFinal},zt={exports:{}};function _E(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var SE=OE;function OE(t,e,r){var i=r&&r.stringify||_E,s=1;if(typeof t=="object"&&t!==null){var n=e.length+s;if(n===1)return t;var o=new Array(n);o[0]=i(t);for(var a=1;a<n;a++)o[a]=i(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var l="",u=1-s,h=-1,f=t&&t.length||0,d=0;d<f;){if(t.charCodeAt(d)===37&&d+1<f){switch(h=h>-1?h:0,t.charCodeAt(d+1)){case 100:case 102:if(u>=c||e[u]==null)break;h<d&&(l+=t.slice(h,d)),l+=Number(e[u]),h=d+2,d++;break;case 105:if(u>=c||e[u]==null)break;h<d&&(l+=t.slice(h,d)),l+=Math.floor(Number(e[u])),h=d+2,d++;break;case 79:case 111:case 106:if(u>=c||e[u]===void 0)break;h<d&&(l+=t.slice(h,d));var g=typeof e[u];if(g==="string"){l+="'"+e[u]+"'",h=d+2,d++;break}if(g==="function"){l+=e[u].name||"<anonymous>",h=d+2,d++;break}l+=i(e[u]),h=d+2,d++;break;case 115:if(u>=c)break;h<d&&(l+=t.slice(h,d)),l+=String(e[u]),h=d+2,d++;break;case 37:h<d&&(l+=t.slice(h,d)),l+="%",h=d+2,d++,u--;break}++u}++d}return h===-1?t:(h<f&&(l+=t.slice(h)),l)}const fu=SE;zt.exports=lr;const bs=ME().console||{},DE={mapHttpRequest:Ws,mapHttpResponse:Ws,wrapRequestSerializer:Uo,wrapResponseSerializer:Uo,wrapErrorSerializer:Uo,req:Ws,res:Ws,err:pu,errWithCause:pu};function Tr(t,e){return t==="silent"?1/0:e.levels.values[t]}const Bc=Symbol("pino.logFuncs"),Da=Symbol("pino.hierarchy"),$E={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function du(t,e){const r={logger:e,parent:t[Da]};e[Da]=r}function AE(t,e,r){const i={};e.forEach(s=>{i[s]=r[s]?r[s]:bs[s]||bs[$E[s]||"log"]||Ai}),t[Bc]=i}function PE(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function lr(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||bs;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},s=PE(t.browser.serialize,i);let n=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(n=!1);const o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(w){r[w]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");const c=t.level||"info",l=Object.create(r);l.log||(l.log=Ai),AE(l,a,r),du({},l),Object.defineProperty(l,"levelVal",{get:h}),Object.defineProperty(l,"level",{get:f,set:d});const u={transmit:e,serialize:s,asObject:t.browser.asObject,asObjectBindingsOnly:t.browser.asObjectBindingsOnly,formatters:t.browser.formatters,levels:a,timestamp:jE(t),messageKey:t.messageKey||"msg",onChild:t.onChild||Ai};l.levels=BE(t),l.level=c,l.isLevelEnabled=function(w){return this.levels.values[w]?this.levels.values[w]>=this.levels.values[this.level]:!1},l.setMaxListeners=l.getMaxListeners=l.emit=l.addListener=l.on=l.prependListener=l.once=l.prependOnceListener=l.removeListener=l.removeAllListeners=l.listeners=l.listenerCount=l.eventNames=l.write=l.flush=Ai,l.serializers=i,l._serialize=s,l._stdErrSerialize=n,l.child=function(...w){return g.call(this,u,...w)},e&&(l._logEvent=$a());function h(){return Tr(this.level,this)}function f(){return this._level}function d(w){if(w!=="silent"&&!this.levels.values[w])throw Error("unknown level "+w);this._level=w,Vr(this,u,l,"error"),Vr(this,u,l,"fatal"),Vr(this,u,l,"warn"),Vr(this,u,l,"info"),Vr(this,u,l,"debug"),Vr(this,u,l,"trace"),o.forEach(m=>{Vr(this,u,l,m)})}function g(w,m,O){if(!m)throw new Error("missing bindings for child Pino");O=O||{},s&&m.serializers&&(O.serializers=m.serializers);const C=O.serializers;if(s&&C){var E=Object.assign({},i,C),I=t.browser.serialize===!0?Object.keys(E):s;delete m.serializers,Cc([m],I,E,this._stdErrSerialize)}function A(T){this._childLevel=(T._childLevel|0)+1,this.bindings=m,E&&(this.serializers=E,this._serialize=I),e&&(this._logEvent=$a([].concat(T._logEvent.bindings,m)))}A.prototype=this;const B=new A(this);return du(this,B),B.child=function(...T){return g.call(this,w,...T)},B.level=O.level||this.level,w.onChild(B),B}return l}function BE(t){const e=t.customLevels||{},r=Object.assign({},lr.levels.values,e),i=Object.assign({},lr.levels.labels,CE(e));return{values:r,labels:i}}function CE(t){const e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}lr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},lr.stdSerializers=DE,lr.stdTimeFunctions=Object.assign({},{nullTime:Ep,epochTime:xp,unixTime:FE,isoTime:LE});function TE(t){const e=[];t.bindings&&e.push(t.bindings);let r=t[Da];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function Vr(t,e,r,i){if(Object.defineProperty(t,i,{value:Tr(t.level,r)>Tr(i,r)?Ai:r[Bc][i],writable:!0,enumerable:!0,configurable:!0}),t[i]===Ai){if(!e.transmit)return;const n=e.transmit.level||t.level,o=Tr(n,r);if(Tr(i,r)<o)return}t[i]=NE(t,e,r,i);const s=TE(t);s.length!==0&&(t[i]=RE(s,t[i]))}function RE(t,e){return function(){return e.apply(this,[...t,...arguments])}}function NE(t,e,r,i){return function(s){return function(){const n=e.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===bs?bs:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];var l=!1;if(e.serialize&&(Cc(o,this._serialize,this.serializers,this._stdErrSerialize),l=!0),e.asObject||e.formatters?s.call(a,...UE(this,i,o,n,e)):s.apply(a,o),e.transmit){const u=e.transmit.level||t._level,h=Tr(u,r),f=Tr(i,r);if(f<h)return;kE(this,{ts:n,methodLevel:i,methodValue:f,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:Tr(t._level,r)},o,l)}}}(t[Bc][i])}function UE(t,e,r,i,s){const{level:n,log:o=h=>h}=s.formatters||{},a=r.slice();let c=a[0];const l={};let u=(t._childLevel|0)+1;if(u<1&&(u=1),i&&(l.time=i),n){const h=n(e,t.levels.values[e]);Object.assign(l,h)}else l.level=t.levels.values[e];if(s.asObjectBindingsOnly){if(c!==null&&typeof c=="object")for(;u--&&typeof a[0]=="object";)Object.assign(l,a.shift());return[o(l),...a]}else{if(c!==null&&typeof c=="object"){for(;u--&&typeof a[0]=="object";)Object.assign(l,a.shift());c=a.length?fu(a.shift(),a):void 0}else typeof c=="string"&&(c=fu(a.shift(),a));return c!==void 0&&(l[s.messageKey]=c),[o(l)]}}function Cc(t,e,r,i){for(const s in t)if(i&&t[s]instanceof Error)t[s]=lr.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s])&&e)for(const n in t[s])e.indexOf(n)>-1&&n in r&&(t[s][n]=r[n](t[s][n]))}function kE(t,e,r,i=!1){const s=e.send,n=e.ts,o=e.methodLevel,a=e.methodValue,c=e.val,l=t._logEvent.bindings;i||Cc(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=n,t._logEvent.messages=r.filter(function(u){return l.indexOf(u)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,s(o,t._logEvent,c),t._logEvent=$a(l)}function $a(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function pu(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function jE(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Ep:xp}function Ws(){return{}}function Uo(t){return t}function Ai(){}function Ep(){return!1}function xp(){return Date.now()}function FE(){return Math.round(Date.now()/1e3)}function LE(){return new Date(Date.now()).toISOString()}function ME(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}zt.exports.default=lr;zt.exports.pino=lr;const qE={level:"info"},Kn="custom_context",Tc=1e3*1024;var zE=Object.defineProperty,VE=(t,e,r)=>e in t?zE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pr=(t,e,r)=>VE(t,typeof e!="symbol"?e+"":e,r);let HE=class{constructor(e){Pr(this,"nodeValue"),Pr(this,"sizeInBytes"),Pr(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},gu=class{constructor(e){Pr(this,"lengthInNodes"),Pr(this,"sizeInBytes"),Pr(this,"head"),Pr(this,"tail"),Pr(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new HE(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};const KE=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function yu(t){return typeof t=="string"?t:KE(t)||""}var WE=Object.defineProperty,GE=(t,e,r)=>e in t?WE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gs=(t,e,r)=>GE(t,typeof e!="symbol"?e+"":e,r);let Ip=class{constructor(e,r=Tc){Gs(this,"logs"),Gs(this,"level"),Gs(this,"levelValue"),Gs(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=zt.exports.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new gu(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===zt.exports.levels.values.error?console.error(e):r===zt.exports.levels.values.warn?console.warn(e):r===zt.exports.levels.values.debug?console.debug(e):r===zt.exports.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(yu({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new gu(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(yu({extraMetadata:e})),new Blob(r,{type:"application/json"})}};var YE=Object.defineProperty,ZE=(t,e,r)=>e in t?YE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,JE=(t,e,r)=>ZE(t,e+"",r);let XE=class{constructor(e,r=Tc){JE(this,"baseChunkLogger"),this.baseChunkLogger=new Ip(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}};var QE=Object.defineProperty,ex=(t,e,r)=>e in t?QE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tx=(t,e,r)=>ex(t,e+"",r);let rx=class{constructor(e,r=Tc){tx(this,"baseChunkLogger"),this.baseChunkLogger=new Ip(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var ix=Object.defineProperty,sx=Object.defineProperties,nx=Object.getOwnPropertyDescriptors,wu=Object.getOwnPropertySymbols,ox=Object.prototype.hasOwnProperty,ax=Object.prototype.propertyIsEnumerable,mu=(t,e,r)=>e in t?ix(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nr=(t,e)=>{for(var r in e||(e={}))ox.call(e,r)&&mu(t,r,e[r]);if(wu)for(var r of wu(e))ax.call(e,r)&&mu(t,r,e[r]);return t},Ur=(t,e)=>sx(t,nx(e));function cx(t){return Ur(Nr({},t),{level:(t==null?void 0:t.level)||qE.level})}function lx(t,e,r=Kn){return t[r]=e,t}function st(t,e=Kn){return t[e]||""}function ux(t,e,r=Kn){const i=st(t,r);return i.trim()?`${i}/${e}`:e}function ft(t,e,r=Kn){const i=ux(t,e,r),s=t.child({context:i});return lx(s,i,r)}function hx(t){var e,r;const i=new XE((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:zt.exports(Ur(Nr({},t.opts),{level:"trace",browser:Ur(Nr({},(r=t.opts)==null?void 0:r.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function fx(t){var e,r;const i=new rx((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:zt.exports(Ur(Nr({},t.opts),{level:"trace",browser:Ur(Nr({},(r=t.opts)==null?void 0:r.browser),{write:s=>i.write(s)})}),i),chunkLoggerController:i}}function _p(t){var e;if(typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string")return{logger:t.loggerOverride,chunkLoggerController:null};const r=Ur(Nr({},t.opts),{level:typeof t.loggerOverride=="string"?t.loggerOverride:(e=t.opts)==null?void 0:e.level});return typeof window<"u"?hx(Ur(Nr({},t),{opts:r})):fx(Ur(Nr({},t),{opts:r}))}var dx={};const px=":";function ur(t){const[e,r]=t.split(px);return{namespace:e,reference:r}}function bu(t,e=[]){const r=[];return Object.keys(t).forEach(i=>{if(e.length&&!e.includes(i))return;const s=t[i];r.push(...s.accounts)}),r}function Sp(t,e){return t.includes(":")?[t]:e.chains||[]}var gx=Object.defineProperty,yx=Object.defineProperties,wx=Object.getOwnPropertyDescriptors,vu=Object.getOwnPropertySymbols,mx=Object.prototype.hasOwnProperty,bx=Object.prototype.propertyIsEnumerable,Aa=(t,e,r)=>e in t?gx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Eu=(t,e)=>{for(var r in e||(e={}))mx.call(e,r)&&Aa(t,r,e[r]);if(vu)for(var r of vu(e))bx.call(e,r)&&Aa(t,r,e[r]);return t},vx=(t,e)=>yx(t,wx(e)),xu=(t,e,r)=>Aa(t,typeof e!="symbol"?e+"":e,r);const Ex="ReactNative",ht={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},xx="js";function Dn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Lr(){return!si()&&!!uc()&&navigator.product===Ex}function Ix(){return Lr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function _x(){return Lr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Li(){return!Dn()&&!!uc()&&!!si()}function Bs(){return Lr()?ht.reactNative:Dn()?ht.node:Li()?ht.browser:ht.unknown}function Iu(){var t;try{return Lr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function Sx(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([i],[s])=>i.localeCompare(s)).forEach(([i,s])=>{s!=null&&r.set(i,String(s))}),r.toString()}function Ox(t){var e,r;const i=Op();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),vx(Eu(Eu({},i),t),{url:(t==null?void 0:t.url)||i.url,name:(t==null?void 0:t.name)||i.name,description:(t==null?void 0:t.description)||i.description,icons:(r=t==null?void 0:t.icons)!=null&&r.length&&t.icons.length>0?t.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),t||i}}function Op(){return Mf()||{name:"",description:"",url:"",icons:[""]}}function Dx(){if(Bs()===ht.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=Xy();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function $x(){var t;const e=Bs();return e===ht.browser?[e,((t=Lf())==null?void 0:t.host)||"unknown"].join(":"):e}function Dp(t,e,r){const i=Dx(),s=$x();return[[t,e].join("-"),[xx,r].join("-"),i,s].join("/")}function Ax({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=r.split("?"),u=Dp(t,e,i),h={auth:s,ua:u,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=Sx(l[1]||"",h);return l[0]+"?"+f}function Qr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Pa(t){return Object.fromEntries(t.entries())}function Ba(t){return new Map(Object.entries(t))}function Gr(t=M.FIVE_MINUTES,e){const r=M.toMiliseconds(t||M.FIVE_MINUTES);let i,s,n,o;return{resolve:a=>{n&&i&&(clearTimeout(n),i(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},r),i=a,s=c})}}function Vt(t,e,r){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(r)),e);try{const o=await t;i(o)}catch(o){s(o)}clearTimeout(n)})}function $p(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Px(t){return $p("topic",t)}function Bx(t){return $p("id",t)}function Ap(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function we(t,e){return M.fromMiliseconds(Date.now()+M.toMiliseconds(t))}function qt(t){return Date.now()>=M.toMiliseconds(t)}function oe(t,e){return`${t}${e?`:${e}`:""}`}function Ht(t=[],e=[]){return[...new Set([...t,...e])]}async function Cx({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r,n=s==null?void 0:s.href;if(typeof n!="string")return;const o=Tx(n,t,e),a=Bs();if(a===ht.browser){if(!((i=si())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Rx(o)}else a===ht.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function Tx(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${jx(i,!0)}`}else s=`${s}/wc?${i}`;return s}function Rx(t){let e="_self";kx()?e="_top":(Ux()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function Nx(t,e){let r="";try{if(Li()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function _u(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function Su(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Rc(){return typeof process<"u"&&dx.IS_VITEST==="true"}function Ux(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function kx(){try{return window.self!==window.top}catch{return!1}}function jx(t,e=!1){const r=Buffer.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function Pp(t){return Buffer.from(t,"base64").toString("utf-8")}function Fx(t){return new Promise(e=>setTimeout(e,t))}let Lx=class{constructor({limit:e}){xu(this,"limit"),xu(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const Ys=BigInt(2**32-1),Ou=BigInt(32);function Bp(t,e=!1){return e?{h:Number(t&Ys),l:Number(t>>Ou&Ys)}:{h:Number(t>>Ou&Ys)|0,l:Number(t&Ys)|0}}function Cp(t,e=!1){const r=t.length;let i=new Uint32Array(r),s=new Uint32Array(r);for(let n=0;n<r;n++){const{h:o,l:a}=Bp(t[n],e);[i[n],s[n]]=[o,a]}return[i,s]}const Du=(t,e,r)=>t>>>r,$u=(t,e,r)=>t<<32-r|e>>>r,Dr=(t,e,r)=>t>>>r|e<<32-r,$r=(t,e,r)=>t<<32-r|e>>>r,os=(t,e,r)=>t<<64-r|e>>>r-32,as=(t,e,r)=>t>>>r-32|e<<64-r,Mx=(t,e)=>e,qx=(t,e)=>t,zx=(t,e,r)=>t<<r|e>>>32-r,Vx=(t,e,r)=>e<<r|t>>>32-r,Hx=(t,e,r)=>e<<r-32|t>>>64-r,Kx=(t,e,r)=>t<<r-32|e>>>64-r;function $t(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const Nc=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),Uc=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,Wx=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),Gx=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,Yx=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),Zx=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,mi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Wn(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function fr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ct(t,...e){if(!Wn(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Gn(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");fr(t.outputLen),fr(t.blockLen)}function Fr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function kc(t,e){Ct(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function vs(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function xt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function ko(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Nt(t,e){return t<<32-e|t>>>e}const Tp=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Rp(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const rr=Tp?t=>t:t=>Rp(t);function Jx(t){for(let e=0;e<t.length;e++)t[e]=Rp(t[e]);return t}const Ar=Tp?t=>t:Jx,Np=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Xx=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Pi(t){if(Ct(t),Np)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Xx[t[r]];return e}const Qt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Au(t){if(t>=Qt._0&&t<=Qt._9)return t-Qt._0;if(t>=Qt.A&&t<=Qt.F)return t-(Qt.A-10);if(t>=Qt.a&&t<=Qt.f)return t-(Qt.a-10)}function $n(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Np)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=Au(t.charCodeAt(n)),a=Au(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Up(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Bt(t){return typeof t=="string"&&(t=Up(t)),Ct(t),t}function Br(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];Ct(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}let Yn=class{};function Cs(t){const e=i=>t().update(Bt(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Qx(t){const e=(i,s)=>t(s).update(Bt(i)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}function hi(t=32){if(mi&&typeof mi.getRandomValues=="function")return mi.getRandomValues(new Uint8Array(t));if(mi&&typeof mi.randomBytes=="function")return Uint8Array.from(mi.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const e3=BigInt(0),Zi=BigInt(1),t3=BigInt(2),r3=BigInt(7),i3=BigInt(256),s3=BigInt(113),kp=[],jp=[],Fp=[];for(let t=0,e=Zi,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],kp.push(2*(5*i+r)),jp.push((t+1)*(t+2)/2%64);let s=e3;for(let n=0;n<7;n++)e=(e<<Zi^(e>>r3)*s3)%i3,e&t3&&(s^=Zi<<(Zi<<BigInt(n))-Zi);Fp.push(s)}const Lp=Cp(Fp,!0),n3=Lp[0],o3=Lp[1],Pu=(t,e,r)=>r>32?Hx(t,e,r):zx(t,e,r),Bu=(t,e,r)=>r>32?Kx(t,e,r):Vx(t,e,r);function a3(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=r[c],u=r[c+1],h=Pu(l,u,1)^r[a],f=Bu(l,u,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=f}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=jp[o],c=Pu(s,n,a),l=Bu(s,n,a),u=kp[o];s=t[u],n=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=n3[i],t[1]^=o3[i]}xt(r)}let c3=class Mp extends Yn{constructor(e,r,i,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,fr(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=vs(this.state)}clone(){return this._cloneInto()}keccak(){Ar(this.state32),a3(this.state32,this.rounds),Ar(this.state32),this.posOut=0,this.pos=0}update(e){Fr(this),e=Bt(e),Ct(e);const{blockLen:r,state:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,r&128&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Fr(this,!1),Ct(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return fr(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(kc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,xt(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new Mp(r,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const l3=(t,e,r)=>Cs(()=>new c3(e,t,r)),u3=l3(1,136,256/8);function h3(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function f3(t,e,r){return t&e^~t&r}function d3(t,e,r){return t&e^t&r^e&r}let qp=class extends Yn{constructor(e,r,i,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(e),this.view=ko(this.buffer)}update(e){Fr(this),e=Bt(e),Ct(e);const{view:r,buffer:i,blockLen:s}=this,n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=ko(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Fr(this),kc(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,xt(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;h3(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=ko(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=n,e.length=s,e.pos=a,s%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const Er=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Fe=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Le=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),p3=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xr=new Uint32Array(64);class g3 extends qp{constructor(e=32){super(64,e,8,!1),this.A=Er[0]|0,this.B=Er[1]|0,this.C=Er[2]|0,this.D=Er[3]|0,this.E=Er[4]|0,this.F=Er[5]|0,this.G=Er[6]|0,this.H=Er[7]|0}get(){const{A:e,B:r,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,r,i,s,n,o,a,c]}set(e,r,i,s,n,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)xr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=xr[h-15],d=xr[h-2],g=Nt(f,7)^Nt(f,18)^f>>>3,w=Nt(d,17)^Nt(d,19)^d>>>10;xr[h]=w+xr[h-7]+g+xr[h-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=Nt(a,6)^Nt(a,11)^Nt(a,25),d=u+f+f3(a,c,l)+p3[h]+xr[h]|0,g=(Nt(i,2)^Nt(i,13)^Nt(i,22))+d3(i,s,n)|0;u=l,l=c,c=a,a=o+d|0,o=n,n=s,s=i,i=d+g|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,s,n,o,a,c,l,u)}roundClean(){xt(xr)}destroy(){this.set(0,0,0,0,0,0,0,0),xt(this.buffer)}}const zp=Cp(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),y3=zp[0],w3=zp[1],Ir=new Uint32Array(80),_r=new Uint32Array(80);let jc=class extends qp{constructor(e=64){super(128,e,16,!1),this.Ah=Le[0]|0,this.Al=Le[1]|0,this.Bh=Le[2]|0,this.Bl=Le[3]|0,this.Ch=Le[4]|0,this.Cl=Le[5]|0,this.Dh=Le[6]|0,this.Dl=Le[7]|0,this.Eh=Le[8]|0,this.El=Le[9]|0,this.Fh=Le[10]|0,this.Fl=Le[11]|0,this.Gh=Le[12]|0,this.Gl=Le[13]|0,this.Hh=Le[14]|0,this.Hl=Le[15]|0}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:d,Gl:g,Hh:w,Hl:m}=this;return[e,r,i,s,n,o,a,c,l,u,h,f,d,g,w,m]}set(e,r,i,s,n,o,a,c,l,u,h,f,d,g,w,m){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=g|0,this.Hh=w|0,this.Hl=m|0}process(e,r){for(let E=0;E<16;E++,r+=4)Ir[E]=e.getUint32(r),_r[E]=e.getUint32(r+=4);for(let E=16;E<80;E++){const I=Ir[E-15]|0,A=_r[E-15]|0,B=Dr(I,A,1)^Dr(I,A,8)^Du(I,A,7),T=$r(I,A,1)^$r(I,A,8)^$u(I,A,7),R=Ir[E-2]|0,$=_r[E-2]|0,k=Dr(R,$,19)^os(R,$,61)^Du(R,$,6),j=$r(R,$,19)^as(R,$,61)^$u(R,$,6),P=Wx(T,j,_r[E-7],_r[E-16]),_=Gx(P,B,k,Ir[E-7],Ir[E-16]);Ir[E]=_|0,_r[E]=P|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:d,Fl:g,Gh:w,Gl:m,Hh:O,Hl:C}=this;for(let E=0;E<80;E++){const I=Dr(h,f,14)^Dr(h,f,18)^os(h,f,41),A=$r(h,f,14)^$r(h,f,18)^as(h,f,41),B=h&d^~h&w,T=f&g^~f&m,R=Yx(C,A,T,w3[E],_r[E]),$=Zx(R,O,I,B,y3[E],Ir[E]),k=R|0,j=Dr(i,s,28)^os(i,s,34)^os(i,s,39),P=$r(i,s,28)^as(i,s,34)^as(i,s,39),_=i&n^i&a^n&a,D=s&o^s&c^o&c;O=w|0,C=m|0,w=d|0,m=g|0,d=h|0,g=f|0,{h,l:f}=$t(l|0,u|0,$|0,k|0),l=a|0,u=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const p=Nc(k,P,D);i=Uc(p,$,j,_),s=p|0}({h:i,l:s}=$t(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=$t(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=$t(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=$t(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=$t(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:g}=$t(this.Fh|0,this.Fl|0,d|0,g|0),{h:w,l:m}=$t(this.Gh|0,this.Gl|0,w|0,m|0),{h:O,l:C}=$t(this.Hh|0,this.Hl|0,O|0,C|0),this.set(i,s,n,o,a,c,l,u,h,f,d,g,w,m,O,C)}roundClean(){xt(Ir,_r)}destroy(){xt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class m3 extends jc{constructor(){super(48),this.Ah=Fe[0]|0,this.Al=Fe[1]|0,this.Bh=Fe[2]|0,this.Bl=Fe[3]|0,this.Ch=Fe[4]|0,this.Cl=Fe[5]|0,this.Dh=Fe[6]|0,this.Dl=Fe[7]|0,this.Eh=Fe[8]|0,this.El=Fe[9]|0,this.Fh=Fe[10]|0,this.Fl=Fe[11]|0,this.Gh=Fe[12]|0,this.Gl=Fe[13]|0,this.Hh=Fe[14]|0,this.Hl=Fe[15]|0}}const Me=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class b3 extends jc{constructor(){super(32),this.Ah=Me[0]|0,this.Al=Me[1]|0,this.Bh=Me[2]|0,this.Bl=Me[3]|0,this.Ch=Me[4]|0,this.Cl=Me[5]|0,this.Dh=Me[6]|0,this.Dl=Me[7]|0,this.Eh=Me[8]|0,this.El=Me[9]|0,this.Fh=Me[10]|0,this.Fl=Me[11]|0,this.Gh=Me[12]|0,this.Gl=Me[13]|0,this.Hh=Me[14]|0,this.Hl=Me[15]|0}}const Zn=Cs(()=>new g3),v3=Cs(()=>new jc),E3=Cs(()=>new m3),x3=Cs(()=>new b3),I3=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),ve=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),H=new Uint32Array(32);function Sr(t,e,r,i,s,n){const o=s[n],a=s[n+1];let c=H[2*t],l=H[2*t+1],u=H[2*e],h=H[2*e+1],f=H[2*r],d=H[2*r+1],g=H[2*i],w=H[2*i+1],m=Nc(c,u,o);l=Uc(m,l,h,a),c=m|0,{Dh:w,Dl:g}={Dh:w^l,Dl:g^c},{Dh:w,Dl:g}={Dh:Mx(w,g),Dl:qx(w)},{h:d,l:f}=$t(d,f,w,g),{Bh:h,Bl:u}={Bh:h^d,Bl:u^f},{Bh:h,Bl:u}={Bh:Dr(h,u,24),Bl:$r(h,u,24)},H[2*t]=c,H[2*t+1]=l,H[2*e]=u,H[2*e+1]=h,H[2*r]=f,H[2*r+1]=d,H[2*i]=g,H[2*i+1]=w}function Or(t,e,r,i,s,n){const o=s[n],a=s[n+1];let c=H[2*t],l=H[2*t+1],u=H[2*e],h=H[2*e+1],f=H[2*r],d=H[2*r+1],g=H[2*i],w=H[2*i+1],m=Nc(c,u,o);l=Uc(m,l,h,a),c=m|0,{Dh:w,Dl:g}={Dh:w^l,Dl:g^c},{Dh:w,Dl:g}={Dh:Dr(w,g,16),Dl:$r(w,g,16)},{h:d,l:f}=$t(d,f,w,g),{Bh:h,Bl:u}={Bh:h^d,Bl:u^f},{Bh:h,Bl:u}={Bh:os(h,u,63),Bl:as(h,u,63)},H[2*t]=c,H[2*t+1]=l,H[2*e]=u,H[2*e+1]=h,H[2*r]=f,H[2*r+1]=d,H[2*i]=g,H[2*i+1]=w}function _3(t,e={},r,i,s){if(fr(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:n,salt:o,personalization:a}=e;if(n!==void 0&&(n.length<1||n.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class S3 extends Yn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,fr(e),fr(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=vs(this.buffer)}update(e){Fr(this),e=Bt(e),Ct(e);const{blockLen:r,buffer:i,buffer32:s}=this,n=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<n;){this.pos===r&&(Ar(s),this.compress(s,0,!1),Ar(s),this.pos=0);const l=Math.min(r-this.pos,n-c),u=o+c;if(l===r&&!(u%4)&&c+l<n){const h=new Uint32Array(a,u,Math.floor((n-c)/4));Ar(h);for(let f=0;c+r<n;f+=s.length,c+=r)this.length+=r,this.compress(h,f,!1);Ar(h);continue}i.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Fr(this),kc(e,this);const{pos:r,buffer32:i}=this;this.finished=!0,xt(this.buffer.subarray(r)),Ar(i),this.compress(i,0,!0),Ar(i);const s=vs(e);this.get().forEach((n,o)=>s[o]=rr(n))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){const{buffer:r,length:i,finished:s,destroyed:n,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=n,e.finished=s,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class O3 extends S3{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=ve[0]|0,this.v0h=ve[1]|0,this.v1l=ve[2]|0,this.v1h=ve[3]|0,this.v2l=ve[4]|0,this.v2h=ve[5]|0,this.v3l=ve[6]|0,this.v3h=ve[7]|0,this.v4l=ve[8]|0,this.v4h=ve[9]|0,this.v5l=ve[10]|0,this.v5h=ve[11]|0,this.v6l=ve[12]|0,this.v6h=ve[13]|0,this.v7l=ve[14]|0,this.v7h=ve[15]|0,_3(r,e,64,16,16);let{key:i,personalization:s,salt:n}=e,o=0;if(i!==void 0&&(i=Bt(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,n!==void 0){n=Bt(n);const a=vs(n);this.v4l^=rr(a[0]),this.v4h^=rr(a[1]),this.v5l^=rr(a[2]),this.v5h^=rr(a[3])}if(s!==void 0){s=Bt(s);const a=vs(s);this.v6l^=rr(a[0]),this.v6h^=rr(a[1]),this.v7l^=rr(a[2]),this.v7h^=rr(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:i,v1h:s,v2l:n,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:f,v6l:d,v6h:g,v7l:w,v7h:m}=this;return[e,r,i,s,n,o,a,c,l,u,h,f,d,g,w,m]}set(e,r,i,s,n,o,a,c,l,u,h,f,d,g,w,m){this.v0l=e|0,this.v0h=r|0,this.v1l=i|0,this.v1h=s|0,this.v2l=n|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=f|0,this.v6l=d|0,this.v6h=g|0,this.v7l=w|0,this.v7h=m|0}compress(e,r,i){this.get().forEach((c,l)=>H[l]=c),H.set(ve,16);let{h:s,l:n}=Bp(BigInt(this.length));H[24]=ve[8]^n,H[25]=ve[9]^s,i&&(H[28]=~H[28],H[29]=~H[29]);let o=0;const a=I3;for(let c=0;c<12;c++)Sr(0,4,8,12,e,r+2*a[o++]),Or(0,4,8,12,e,r+2*a[o++]),Sr(1,5,9,13,e,r+2*a[o++]),Or(1,5,9,13,e,r+2*a[o++]),Sr(2,6,10,14,e,r+2*a[o++]),Or(2,6,10,14,e,r+2*a[o++]),Sr(3,7,11,15,e,r+2*a[o++]),Or(3,7,11,15,e,r+2*a[o++]),Sr(0,5,10,15,e,r+2*a[o++]),Or(0,5,10,15,e,r+2*a[o++]),Sr(1,6,11,12,e,r+2*a[o++]),Or(1,6,11,12,e,r+2*a[o++]),Sr(2,7,8,13,e,r+2*a[o++]),Or(2,7,8,13,e,r+2*a[o++]),Sr(3,4,9,14,e,r+2*a[o++]),Or(3,4,9,14,e,r+2*a[o++]);this.v0l^=H[0]^H[16],this.v0h^=H[1]^H[17],this.v1l^=H[2]^H[18],this.v1h^=H[3]^H[19],this.v2l^=H[4]^H[20],this.v2h^=H[5]^H[21],this.v3l^=H[6]^H[22],this.v3h^=H[7]^H[23],this.v4l^=H[8]^H[24],this.v4h^=H[9]^H[25],this.v5l^=H[10]^H[26],this.v5h^=H[11]^H[27],this.v6l^=H[12]^H[28],this.v6h^=H[13]^H[29],this.v7l^=H[14]^H[30],this.v7h^=H[15]^H[31],xt(H)}destroy(){this.destroyed=!0,xt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const D3=Qx(t=>new O3(t)),$3="https://rpc.walletconnect.org/v1";function Vp(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+Buffer.from(u3(r)).toString("hex")}async function A3(t,e,r,i,s,n){switch(r.t){case"eip191":return await P3(t,e,r.s);case"eip1271":return await B3(t,e,r.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function P3(t,e,r){const i=Rm(r);return Fm({payload:Vp(e),signature:i}).toLowerCase()===t.toLowerCase()}async function B3(t,e,r,i,s,n){const o=ur(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=r.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:Vp(e)).substring(2),f=a+h+c+u+l,d=await fetch(`${n||$3}/?chainId=${i}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:C3(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:g}=await d.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function C3(){return Date.now()+Math.floor(Math.random()*1e3)}function T3(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const s=1+i*64;if(r.length<s)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const n=Buffer.from(t,"base64").slice(1,65);return Ss.encode(n)}function R3(t){const e=new Uint8Array(Buffer.from(t,"base64")),r=Array.from("TransactionData::").map(n=>n.charCodeAt(0)),i=new Uint8Array(r.length+e.length);i.set(r),i.set(e,r.length);const s=D3(i,{dkLen:32});return Ss.encode(s)}function Cu(t){const e=new Uint8Array(Zn(N3(t)));return Ss.encode(e)}function N3(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Tu(t){const e=Buffer.from(t,"base64"),r=xb(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const i=db(r),s=Buffer.from("TX"),n=Buffer.concat([s,Buffer.from(i)]),o=x3(n);return qy.encode(o).replace(/=+$/,"")}function jo(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),Buffer.from(e)}function U3(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),r=Buffer.from(t.signed.authInfoBytes,"base64"),i=Buffer.from(t.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(jo(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(jo(r.length)),s.push(r),s.push(Buffer.from([26])),s.push(jo(i.length)),s.push(i);const n=Buffer.concat(s),o=Zn(n);return Buffer.from(o).toString("hex").toUpperCase()}function k3(t){var e,r;const i=[];try{if(typeof t=="string")return i.push(t),i;if(typeof t!="object")return i;t!=null&&t.id&&i.push(t.id);const s=(r=(e=t==null?void 0:t.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;s&&i.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return i}var j3=Object.defineProperty,F3=Object.defineProperties,L3=Object.getOwnPropertyDescriptors,Ru=Object.getOwnPropertySymbols,M3=Object.prototype.hasOwnProperty,q3=Object.prototype.propertyIsEnumerable,Nu=(t,e,r)=>e in t?j3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,z3=(t,e)=>{for(var r in e||(e={}))M3.call(e,r)&&Nu(t,r,e[r]);if(Ru)for(var r of Ru(e))q3.call(e,r)&&Nu(t,r,e[r]);return t},V3=(t,e)=>F3(t,L3(e));const Hp="did:pkh:",H3={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},K3=t=>t?H3[t]||t:"",Jn=t=>t==null?void 0:t.split(":"),W3=t=>{const e=t&&Jn(t);if(e)return t.includes(Hp)?e[3]:e[1]},G3=t=>{const e=t&&Jn(t);if(e)return t.includes(Hp)?e[2]:e[0]},Ca=t=>{const e=t&&Jn(t);if(e)return e[2]+":"+e[3]},An=t=>{const e=t&&Jn(t);if(e)return e.pop()};async function Uu(t){const{cacao:e,projectId:r}=t,{s:i,p:s}=e,n=Kp(s,s.iss),o=An(s.iss);return await A3(o,n,i,Ca(s.iss),r)}const Kp=(t,e)=>{const r=G3(e);if(!r)throw new Error("Invalid issuer: "+e);const i=`${t.domain} wants you to sign in with your ${K3(r)} account:`,s=An(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let n=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${W3(e)}`,l=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,f=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,g=t.resources?`Resources:${t.resources.map(m=>`
- ${m}`).join("")}`:void 0,w=hn(t.resources);if(w){const m=Es(w);n=iI(n,m)}return[i,s,"",n,"",o,a,c,l,u,h,f,d,g].filter(m=>m!=null).join(`
`)};function Y3(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function Z3(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function ci(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function J3(t,e,r,i={}){return r==null||r.sort((s,n)=>s.localeCompare(n)),{att:{[t]:X3(e,r,i)}}}function X3(t,e,r={}){e=e==null?void 0:e.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...i)}function Wp(t){return ci(t),`urn:recap:${Y3(t).replace(/=/g,"")}`}function Es(t){const e=Z3(t.replace("urn:recap:",""));return ci(e),e}function Q3(t,e,r){const i=J3(t,e,r);return Wp(i)}function eI(t){return t&&t.includes("urn:recap:")}function tI(t,e){const r=Es(t),i=Es(e),s=rI(r,i);return Wp(s)}function rI(t,e){ci(t),ci(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return r.forEach(s=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;i.att[s]=V3(z3({},i.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((l=e.att[s])==null?void 0:l[a])})})}),i}function iI(t="",e){ci(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(s++,`(${s}) '${h}': '${l[h].join("', '")}' for '${a}'.`));i.push(u.join(", ").replace(".,","."))});const n=i.join(" "),o=`${r}${n}`;return`${t?t+" ":""}${o}`}function ku(t){var e;const r=Es(t);ci(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function ju(t){const e=Es(t);ci(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s==null?void 0:s[0])!=null&&n.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function hn(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return eI(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Gp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ta(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Fo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Qe(t,...e){if(!Gp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Fu(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function sI(t,e){Qe(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function kr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ui(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function nI(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const oI=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function aI(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Ra(t){if(typeof t=="string")t=aI(t);else if(Gp(t))t=Na(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function cI(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function lI(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const uI=(t,e)=>{function r(i,...s){if(Qe(i),!oI)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=s[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?Qe(l):Qe(l,t.nonceLength)}const n=t.tagLength;n&&s[1]!==void 0&&Qe(s[1]);const o=e(i,...s),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Qe(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Qe(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Qe(l),n&&l.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(r,t),r};function Lu(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!fI(e))throw new Error("invalid output, must be aligned");return e}function Mu(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n);t.setUint32(e+4,o,i),t.setUint32(e+0,a,i)}function hI(t,e,r){Ta(r);const i=new Uint8Array(16),s=nI(i);return Mu(s,0,BigInt(e),r),Mu(s,8,BigInt(t),r),i}function fI(t){return t.byteOffset%4===0}function Na(t){return Uint8Array.from(t)}const Yp=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),dI=Yp("expand 16-byte k"),pI=Yp("expand 32-byte k"),gI=kr(dI),yI=kr(pI);function ie(t,e){return t<<e|t>>>32-e}function Ua(t){return t.byteOffset%4===0}const Zs=64,wI=16,Zp=2**32-1,qu=new Uint32Array;function mI(t,e,r,i,s,n,o,a){const c=s.length,l=new Uint8Array(Zs),u=kr(l),h=Ua(s)&&Ua(n),f=h?kr(s):qu,d=h?kr(n):qu;for(let g=0;g<c;o++){if(t(e,r,i,u,o,a),o>=Zp)throw new Error("arx: counter overflow");const w=Math.min(Zs,c-g);if(h&&w===Zs){const m=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let O=0,C;O<wI;O++)C=m+O,d[C]=f[C]^u[O];g+=Zs;continue}for(let m=0,O;m<w;m++)O=g+m,n[O]=s[O]^l[m];g+=w}}function bI(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:s,counterRight:n,rounds:o}=cI({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Fo(s),Fo(o),Ta(n),Ta(r),(a,c,l,u,h=0)=>{Qe(a),Qe(c),Qe(l);const f=l.length;if(u===void 0&&(u=new Uint8Array(f)),Qe(u),Fo(h),h<0||h>=Zp)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const d=[];let g=a.length,w,m;if(g===32)d.push(w=Na(a)),m=yI;else if(g===16&&r)w=new Uint8Array(32),w.set(a),w.set(a,16),m=gI,d.push(w);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Ua(c)||d.push(c=Na(c));const O=kr(w);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(m,O,kr(c.subarray(0,16)),O),c=c.subarray(16)}const C=16-s;if(C!==c.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){const I=new Uint8Array(12);I.set(c,n?0:12-c.length),c=I,d.push(c)}const E=kr(c);return mI(t,m,O,E,l,u,h,o),Ui(...d),u}}const Pe=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class vI{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Ra(e),Qe(e,32);const r=Pe(e,0),i=Pe(e,2),s=Pe(e,4),n=Pe(e,6),o=Pe(e,8),a=Pe(e,10),c=Pe(e,12),l=Pe(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Pe(e,16+2*u)}process(e,r,i=!1){const s=i?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],f=o[5],d=o[6],g=o[7],w=o[8],m=o[9],O=Pe(e,r+0),C=Pe(e,r+2),E=Pe(e,r+4),I=Pe(e,r+6),A=Pe(e,r+8),B=Pe(e,r+10),T=Pe(e,r+12),R=Pe(e,r+14);let $=n[0]+(O&8191),k=n[1]+((O>>>13|C<<3)&8191),j=n[2]+((C>>>10|E<<6)&8191),P=n[3]+((E>>>7|I<<9)&8191),_=n[4]+((I>>>4|A<<12)&8191),D=n[5]+(A>>>1&8191),p=n[6]+((A>>>14|B<<2)&8191),y=n[7]+((B>>>11|T<<5)&8191),b=n[8]+((T>>>8|R<<8)&8191),S=n[9]+(R>>>5|s),v=0,x=v+$*a+k*(5*m)+j*(5*w)+P*(5*g)+_*(5*d);v=x>>>13,x&=8191,x+=D*(5*f)+p*(5*h)+y*(5*u)+b*(5*l)+S*(5*c),v+=x>>>13,x&=8191;let N=v+$*c+k*a+j*(5*m)+P*(5*w)+_*(5*g);v=N>>>13,N&=8191,N+=D*(5*d)+p*(5*f)+y*(5*h)+b*(5*u)+S*(5*l),v+=N>>>13,N&=8191;let U=v+$*l+k*c+j*a+P*(5*m)+_*(5*w);v=U>>>13,U&=8191,U+=D*(5*g)+p*(5*d)+y*(5*f)+b*(5*h)+S*(5*u),v+=U>>>13,U&=8191;let V=v+$*u+k*l+j*c+P*a+_*(5*m);v=V>>>13,V&=8191,V+=D*(5*w)+p*(5*g)+y*(5*d)+b*(5*f)+S*(5*h),v+=V>>>13,V&=8191;let L=v+$*h+k*u+j*l+P*c+_*a;v=L>>>13,L&=8191,L+=D*(5*m)+p*(5*w)+y*(5*g)+b*(5*d)+S*(5*f),v+=L>>>13,L&=8191;let q=v+$*f+k*h+j*u+P*l+_*c;v=q>>>13,q&=8191,q+=D*a+p*(5*m)+y*(5*w)+b*(5*g)+S*(5*d),v+=q>>>13,q&=8191;let K=v+$*d+k*f+j*h+P*u+_*l;v=K>>>13,K&=8191,K+=D*c+p*a+y*(5*m)+b*(5*w)+S*(5*g),v+=K>>>13,K&=8191;let G=v+$*g+k*d+j*f+P*h+_*u;v=G>>>13,G&=8191,G+=D*l+p*c+y*a+b*(5*m)+S*(5*w),v+=G>>>13,G&=8191;let X=v+$*w+k*g+j*d+P*f+_*h;v=X>>>13,X&=8191,X+=D*u+p*l+y*c+b*a+S*(5*m),v+=X>>>13,X&=8191;let W=v+$*m+k*w+j*g+P*d+_*f;v=W>>>13,W&=8191,W+=D*h+p*u+y*l+b*c+S*a,v+=W>>>13,W&=8191,v=(v<<2)+v|0,v=v+x|0,x=v&8191,v=v>>>13,N+=v,n[0]=x,n[1]=N,n[2]=U,n[3]=V,n[4]=L,n[5]=q,n[6]=K,n[7]=G,n[8]=X,n[9]=W}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+s,s=i[a]>>>13,i[a]&=8191;i[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)i[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Ui(i)}update(e){Fu(this),e=Ra(e),Qe(e);const{buffer:r,blockLen:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);if(o===i){for(;i<=s-n;n+=i)this.process(e,n);continue}r.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Ui(this.h,this.r,this.buffer,this.pad)}digestInto(e){Fu(this),sI(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=i[o]>>>0,e[n++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function EI(t){const e=(i,s)=>t(s).update(Ra(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const xI=EI(t=>new vI(t));function II(t,e,r,i,s,n=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],f=e[2],d=e[3],g=e[4],w=e[5],m=e[6],O=e[7],C=s,E=r[0],I=r[1],A=r[2],B=o,T=a,R=c,$=l,k=u,j=h,P=f,_=d,D=g,p=w,y=m,b=O,S=C,v=E,x=I,N=A;for(let V=0;V<n;V+=2)B=B+k|0,S=ie(S^B,16),D=D+S|0,k=ie(k^D,12),B=B+k|0,S=ie(S^B,8),D=D+S|0,k=ie(k^D,7),T=T+j|0,v=ie(v^T,16),p=p+v|0,j=ie(j^p,12),T=T+j|0,v=ie(v^T,8),p=p+v|0,j=ie(j^p,7),R=R+P|0,x=ie(x^R,16),y=y+x|0,P=ie(P^y,12),R=R+P|0,x=ie(x^R,8),y=y+x|0,P=ie(P^y,7),$=$+_|0,N=ie(N^$,16),b=b+N|0,_=ie(_^b,12),$=$+_|0,N=ie(N^$,8),b=b+N|0,_=ie(_^b,7),B=B+j|0,N=ie(N^B,16),y=y+N|0,j=ie(j^y,12),B=B+j|0,N=ie(N^B,8),y=y+N|0,j=ie(j^y,7),T=T+P|0,S=ie(S^T,16),b=b+S|0,P=ie(P^b,12),T=T+P|0,S=ie(S^T,8),b=b+S|0,P=ie(P^b,7),R=R+_|0,v=ie(v^R,16),D=D+v|0,_=ie(_^D,12),R=R+_|0,v=ie(v^R,8),D=D+v|0,_=ie(_^D,7),$=$+k|0,x=ie(x^$,16),p=p+x|0,k=ie(k^p,12),$=$+k|0,x=ie(x^$,8),p=p+x|0,k=ie(k^p,7);let U=0;i[U++]=o+B|0,i[U++]=a+T|0,i[U++]=c+R|0,i[U++]=l+$|0,i[U++]=u+k|0,i[U++]=h+j|0,i[U++]=f+P|0,i[U++]=d+_|0,i[U++]=g+D|0,i[U++]=w+p|0,i[U++]=m+y|0,i[U++]=O+b|0,i[U++]=C+S|0,i[U++]=E+v|0,i[U++]=I+x|0,i[U++]=A+N|0}const _I=bI(II,{counterRight:!1,counterLength:4,allowShortKeys:!1}),SI=new Uint8Array(16),zu=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(SI.subarray(r))},OI=new Uint8Array(32);function Vu(t,e,r,i,s){const n=t(e,r,OI),o=xI.create(n);s&&zu(o,s),zu(o,i);const a=hI(i.length,s?s.length:0,!0);o.update(a);const c=o.digest();return Ui(n,a),c}const DI=t=>(e,r,i)=>({encrypt(s,n){const o=s.length;n=Lu(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);t(e,r,a,a,1);const c=Vu(t,e,r,a,i);return n.set(c,o),Ui(c),n},decrypt(s,n){n=Lu(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=Vu(t,e,r,o,i);if(!lI(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),t(e,r,n,n,1),Ui(c),n}}),Jp=uI({blockSize:64,nonceLength:12,tagLength:16},DI(_I));let Xp=class extends Yn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Gn(e);const i=Bt(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),xt(n)}update(e){return Fr(this),this.iHash.update(e),this}digestInto(e){Fr(this),Ct(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Xn=(t,e,r)=>new Xp(t,e).update(r).digest();Xn.create=(t,e)=>new Xp(t,e);function $I(t,e,r){return Gn(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Xn(t,Bt(r),Bt(e))}const Lo=Uint8Array.from([0]),Hu=Uint8Array.of();function AI(t,e,r,i=32){Gn(t),fr(i);const s=t.outputLen;if(i>255*s)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(i/s);r===void 0&&(r=Hu);const o=new Uint8Array(n*s),a=Xn.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<n;u++)Lo[0]=u+1,c.update(u===0?Hu:l).update(r).update(Lo).digestInto(l),o.set(l,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),xt(l,Lo),o.slice(0,i)}const PI=(t,e,r,i,s)=>AI(t,$I(t,e,r),i,s),Qn=Zn,Fc=BigInt(0),ka=BigInt(1);function Pn(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function ei(t,e,r=""){const i=Wn(t),s=t==null?void 0:t.length,n=e!==void 0;if(!i||n&&s!==e){const o=r&&`"${r}" `,a=n?` of length ${e}`:"",c=i?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Js(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Qp(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Fc:BigInt("0x"+t)}function eo(t){return Qp(Pi(t))}function Bn(t){return Ct(t),Qp(Pi(Uint8Array.from(t).reverse()))}function Lc(t,e){return $n(t.toString(16).padStart(e*2,"0"))}function Mc(t,e){return Lc(t,e).reverse()}function ze(t,e,r){let i;if(typeof e=="string")try{i=$n(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(Wn(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}const Mo=t=>typeof t=="bigint"&&Fc<=t;function BI(t,e,r){return Mo(t)&&Mo(e)&&Mo(r)&&e<=t&&t<r}function ja(t,e,r,i){if(!BI(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function eg(t){let e;for(e=0;t>Fc;t>>=ka,e+=1);return e}const Ts=t=>(ka<<BigInt(t))-ka;function CI(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const i=f=>new Uint8Array(f),s=f=>Uint8Array.of(f);let n=i(t),o=i(t),a=0;const c=()=>{n.fill(1),o.fill(0),a=0},l=(...f)=>r(o,n,...f),u=(f=i(0))=>{o=l(s(0),f),n=l(),f.length!==0&&(o=l(s(1),f),n=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const d=[];for(;f<e;){n=l();const g=n.slice();d.push(g),f+=n.length}return Br(...d)};return(f,d)=>{c(),u(f);let g;for(;!(g=d(h()));)u();return c(),g}}function to(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(s,n,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==n||a===null)throw new Error(`param "${s}" is invalid: expected ${n}, got ${c}`)}Object.entries(e).forEach(([s,n])=>i(s,n,!1)),Object.entries(r).forEach(([s,n])=>i(s,n,!0))}function Ku(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const rt=BigInt(0),Ke=BigInt(1),ti=BigInt(2),tg=BigInt(3),rg=BigInt(4),ig=BigInt(5),TI=BigInt(7),sg=BigInt(8),RI=BigInt(9),ng=BigInt(16);function ut(t,e){const r=t%e;return r>=rt?r:e+r}function Dt(t,e,r){let i=t;for(;e-- >rt;)i*=i,i%=r;return i}function Wu(t,e){if(t===rt)throw new Error("invert: expected non-zero number");if(e<=rt)throw new Error("invert: expected positive modulus, got "+e);let r=ut(t,e),i=e,s=rt,n=Ke;for(;r!==rt;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==Ke)throw new Error("invert: does not exist");return ut(s,e)}function qc(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function og(t,e){const r=(t.ORDER+Ke)/rg,i=t.pow(e,r);return qc(t,i,e),i}function NI(t,e){const r=(t.ORDER-ig)/sg,i=t.mul(e,ti),s=t.pow(i,r),n=t.mul(e,s),o=t.mul(t.mul(n,ti),s),a=t.mul(n,t.sub(o,t.ONE));return qc(t,a,e),a}function UI(t){const e=Mr(t),r=ag(t),i=r(e,e.neg(e.ONE)),s=r(e,i),n=r(e,e.neg(i)),o=(t+TI)/ng;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,i);const h=a.mul(l,s),f=a.mul(l,n),d=a.eql(a.sqr(u),c),g=a.eql(a.sqr(h),c);l=a.cmov(l,u,d),u=a.cmov(f,h,g);const w=a.eql(a.sqr(u),c),m=a.cmov(l,u,w);return qc(a,m,c),m}}function ag(t){if(t<tg)throw new Error("sqrt is not defined for small field");let e=t-Ke,r=0;for(;e%ti===rt;)e/=ti,r++;let i=ti;const s=Mr(t);for(;Gu(s,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return og;let n=s.pow(i,e);const o=(e+Ke)/ti;return function(a,c){if(a.is0(c))return c;if(Gu(a,c)!==1)throw new Error("Cannot find square root");let l=r,u=a.mul(a.ONE,n),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,g=a.sqr(h);for(;!a.eql(g,a.ONE);)if(d++,g=a.sqr(g),d===l)throw new Error("Cannot find square root");const w=Ke<<BigInt(l-d-1),m=a.pow(u,w);l=d,u=a.sqr(m),h=a.mul(h,u),f=a.mul(f,m)}return f}}function kI(t){return t%rg===tg?og:t%sg===ig?NI:t%ng===RI?UI(t):ag(t)}const jI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function FI(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=jI.reduce((i,s)=>(i[s]="function",i),e);return to(t,r),t}function LI(t,e,r){if(r<rt)throw new Error("invalid exponent, negatives unsupported");if(r===rt)return t.ONE;if(r===Ke)return e;let i=t.ONE,s=e;for(;r>rt;)r&Ke&&(i=t.mul(i,s)),s=t.sqr(s),r>>=Ke;return i}function cg(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),n=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),n),i}function Gu(t,e){const r=(t.ORDER-Ke)/ti,i=t.pow(e,r),s=t.eql(i,t.ONE),n=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function lg(t,e){e!==void 0&&fr(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Mr(t,e,r=!1,i={}){if(t<=rt)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,n,o=!1,a;if(typeof e=="object"&&e!=null){if(i.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(s=f.BITS),f.sqrt&&(n=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(s=e),i.sqrt&&(n=i.sqrt);const{nBitLength:c,nByteLength:l}=lg(t,s);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:l,MASK:Ts(c),ZERO:rt,ONE:Ke,allowedLengths:a,create:f=>ut(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return rt<=f&&f<t},is0:f=>f===rt,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Ke)===Ke,neg:f=>ut(-f,t),eql:(f,d)=>f===d,sqr:f=>ut(f*f,t),add:(f,d)=>ut(f+d,t),sub:(f,d)=>ut(f-d,t),mul:(f,d)=>ut(f*d,t),pow:(f,d)=>LI(h,f,d),div:(f,d)=>ut(f*Wu(d,t),t),sqrN:f=>f*f,addN:(f,d)=>f+d,subN:(f,d)=>f-d,mulN:(f,d)=>f*d,inv:f=>Wu(f,t),sqrt:n||(f=>(u||(u=kI(t)),u(h,f))),toBytes:f=>r?Mc(f,l):Lc(f,l),fromBytes:(f,d=!0)=>{if(a){if(!a.includes(f.length)||f.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const w=new Uint8Array(l);w.set(f,r?0:w.length-f.length),f=w}if(f.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+f.length);let g=r?Bn(f):eo(f);if(o&&(g=ut(g,t)),!d&&!h.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:f=>cg(h,f),cmov:(f,d,g)=>g?d:f});return Object.freeze(h)}function ug(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function hg(t){const e=ug(t);return e+Math.ceil(e/2)}function MI(t,e,r=!1){const i=t.length,s=ug(e),n=hg(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=r?Bn(t):eo(t),a=ut(o,e-Ke)+Ke;return r?Mc(a,s):Lc(a,s)}const ki=BigInt(0),ri=BigInt(1);function Cn(t,e){const r=e.negate();return t?r:e}function qo(t,e){const r=cg(t.Fp,e.map(i=>i.Z));return e.map((i,s)=>t.fromAffine(i.toAffine(r[s])))}function fg(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function zo(t,e){fg(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),s=2**t,n=Ts(t),o=BigInt(t);return{windows:r,windowSize:i,mask:n,maxNumber:s,shiftBy:o}}function Yu(t,e,r){const{windowSize:i,mask:s,maxNumber:n,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>i&&(a-=n,c+=ri);const l=e*i,u=l+Math.abs(a)-1,h=a===0,f=a<0,d=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:d,offsetF:l}}function qI(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function zI(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const Vo=new WeakMap,dg=new WeakMap;function Ho(t){return dg.get(t)||1}function Zu(t){if(t!==ki)throw new Error("invalid wNAF")}class VI{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,i=this.ZERO){let s=e;for(;r>ki;)r&ri&&(i=i.add(s)),s=s.double(),r>>=ri;return i}precomputeWindow(e,r){const{windows:i,windowSize:s}=zo(r,this.bits),n=[];let o=e,a=o;for(let c=0;c<i;c++){a=o,n.push(a);for(let l=1;l<s;l++)a=a.add(o),n.push(a);o=a.double()}return n}wNAF(e,r,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let s=this.ZERO,n=this.BASE;const o=zo(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:f,offsetF:d}=Yu(i,a,o);i=c,u?n=n.add(Cn(f,r[d])):s=s.add(Cn(h,r[l]))}return Zu(i),{p:s,f:n}}wNAFUnsafe(e,r,i,s=this.ZERO){const n=zo(e,this.bits);for(let o=0;o<n.windows&&i!==ki;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=Yu(i,o,n);if(i=a,!l){const h=r[c];s=s.add(u?h.negate():h)}}return Zu(i),s}getPrecomputes(e,r,i){let s=Vo.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof i=="function"&&(s=i(s)),Vo.set(r,s))),s}cached(e,r,i){const s=Ho(e);return this.wNAF(s,this.getPrecomputes(s,e,i),r)}unsafe(e,r,i,s){const n=Ho(e);return n===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(n,this.getPrecomputes(n,e,i),r,s)}createCache(e,r){fg(r,this.bits),dg.set(e,r),Vo.delete(e)}hasCache(e){return Ho(e)!==1}}function HI(t,e,r,i){let s=e,n=t.ZERO,o=t.ZERO;for(;r>ki||i>ki;)r&ri&&(n=n.add(s)),i&ri&&(o=o.add(s)),s=s.double(),r>>=ri,i>>=ri;return{p1:n,p2:o}}function KI(t,e,r,i){qI(r,t),zI(i,e);const s=r.length,n=i.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=eg(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Ts(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let d=h;d>=0;d-=c){u.fill(o);for(let w=0;w<n;w++){const m=i[w],O=Number(m>>BigInt(d)&l);u[O]=u[O].add(r[w])}let g=o;for(let w=u.length-1,m=o;w>0;w--)m=m.add(u[w]),g=g.add(m);if(f=f.add(g),d!==0)for(let w=0;w<c;w++)f=f.double()}return f}function Ju(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return FI(e),e}else return Mr(t,{isLE:r})}function WI(t,e,r={},i){if(i===void 0&&(i=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>ki))throw new Error(`CURVE.${a} must be positive bigint`)}const s=Ju(e.p,r.Fp,i),n=Ju(e.n,r.Fn,i),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:n}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Up("HashToScalar-");const Ji=BigInt(0),bi=BigInt(1),Xs=BigInt(2);function GI(t){return to(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function YI(t){const e=GI(t),{P:r,type:i,adjustScalarBytes:s,powPminus2:n,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const c=o||hi,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),d=a?Xs**BigInt(254):Xs**BigInt(447),g=a?BigInt(8)*Xs**BigInt(251)-bi:BigInt(4)*Xs**BigInt(445)-bi,w=d+g+bi,m=P=>ut(P,r),O=C(h);function C(P){return Mc(m(P),u)}function E(P){const _=ze("u coordinate",P,u);return a&&(_[31]&=127),m(Bn(_))}function I(P){return Bn(s(ze("scalar",P,u)))}function A(P,_){const D=R(E(_),I(P));if(D===Ji)throw new Error("invalid private or public key received");return C(D)}function B(P){return A(P,O)}function T(P,_,D){const p=m(P*(_-D));return _=m(_-p),D=m(D+p),{x_2:_,x_3:D}}function R(P,_){ja("u",P,Ji,r),ja("scalar",_,d,w);const D=_,p=P;let y=bi,b=Ji,S=P,v=bi,x=Ji;for(let U=BigInt(l-1);U>=Ji;U--){const V=D>>U&bi;x^=V,{x_2:y,x_3:S}=T(x,y,S),{x_2:b,x_3:v}=T(x,b,v),x=V;const L=y+b,q=m(L*L),K=y-b,G=m(K*K),X=q-G,W=S+v,Q=S-v,de=m(Q*L),be=m(W*K),xe=de+be,Ve=de-be;S=m(xe*xe),v=m(p*m(Ve*Ve)),y=m(q*G),b=m(X*(q+m(f*X)))}({x_2:y,x_3:S}=T(x,y,S)),{x_2:b,x_3:v}=T(x,b,v);const N=n(b);return m(y*N)}const $={secretKey:u,publicKey:u,seed:u},k=(P=c(u))=>(Ct(P,$.seed),P);function j(P){const _=k(P);return{secretKey:_,publicKey:B(_)}}return{keygen:j,getSharedSecret:(P,_)=>A(P,_),getPublicKey:P=>B(P),scalarMult:A,scalarMultBase:B,utils:{randomSecretKey:k,randomPrivateKey:k},GuBytes:O.slice(),lengths:$}}const ZI=BigInt(1),Xu=BigInt(2),JI=BigInt(3),XI=BigInt(5);BigInt(8);const pg=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),QI={p:pg,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function e_(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=pg,o=t*t%n*t%n,a=Dt(o,Xu,n)*o%n,c=Dt(a,ZI,n)*t%n,l=Dt(c,XI,n)*c%n,u=Dt(l,e,n)*l%n,h=Dt(u,r,n)*u%n,f=Dt(h,i,n)*h%n,d=Dt(f,s,n)*f%n,g=Dt(d,s,n)*f%n,w=Dt(g,e,n)*l%n;return{pow_p_5_8:Dt(w,Xu,n)*t%n,b2:o}}function t_(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const r_=Mr(QI.p,{isLE:!0}),Fa=(()=>{const t=r_.ORDER;return YI({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:i}=e_(e);return ut(Dt(r,JI,t)*i,t)},adjustScalarBytes:t_})})(),Qu=(t,e)=>(t+(t>=0?e:-e)/gg)/e;function i_(t,e,r){const[[i,s],[n,o]]=e,a=Qu(o*t,r),c=Qu(-s*t,r);let l=t-a*i-c*n,u=-a*s-c*o;const h=l<cr,f=u<cr;h&&(l=-l),f&&(u=-u);const d=Ts(Math.ceil(eg(r)/2))+Bi;if(l<cr||l>=d||u<cr||u>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}function La(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Ko(t,e){const r={};for(let i of Object.keys(e))r[i]=t[i]===void 0?e[i]:t[i];return Pn(r.lowS,"lowS"),Pn(r.prehash,"prehash"),r.format!==void 0&&La(r.format),r}class s_ extends Error{constructor(e=""){super(e)}}const or={Err:s_,_tlv:{encode:(t,e)=>{const{Err:r}=or;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,s=Js(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const n=i>127?Js(s.length/2|128):"";return Js(t)+n+s+e},decode(t,e){const{Err:r}=or;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=or;if(t<cr)throw new e("integer: negative integers are not allowed");let r=Js(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=or;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return eo(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=or,s=ze("signature",t),{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=or,i=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),n=i+s;return e.encode(48,n)}},cr=BigInt(0),Bi=BigInt(1),gg=BigInt(2),Qs=BigInt(3),n_=BigInt(4);function _i(t,e){const{BYTES:r}=t;let i;if(typeof e=="bigint")i=e;else{let s=ze("private key",e);try{i=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}function o_(t,e={}){const r=WI("weierstrass",t,e),{Fp:i,Fn:s}=r;let n=r.CURVE;const{h:o,n:a}=n;to(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!i.is0(n.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=wg(i,s);function u(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(P,_,D){const{x:p,y}=_.toAffine(),b=i.toBytes(p);if(Pn(D,"isCompressed"),D){u();const S=!i.isOdd(y);return Br(yg(S),b)}else return Br(Uint8Array.of(4),b,i.toBytes(y))}function f(P){ei(P,void 0,"Point");const{publicKey:_,publicKeyUncompressed:D}=l,p=P.length,y=P[0],b=P.subarray(1);if(p===_&&(y===2||y===3)){const S=i.fromBytes(b);if(!i.isValid(S))throw new Error("bad point: is not on curve, wrong x");const v=w(S);let x;try{x=i.sqrt(v)}catch(U){const V=U instanceof Error?": "+U.message:"";throw new Error("bad point: is not on curve, sqrt error"+V)}u();const N=i.isOdd(x);return(y&1)===1!==N&&(x=i.neg(x)),{x:S,y:x}}else if(p===D&&y===4){const S=i.BYTES,v=i.fromBytes(b.subarray(0,S)),x=i.fromBytes(b.subarray(S,S*2));if(!m(v,x))throw new Error("bad point: is not on curve");return{x:v,y:x}}else throw new Error(`bad point: got length ${p}, expected compressed=${_} or uncompressed=${D}`)}const d=e.toBytes||h,g=e.fromBytes||f;function w(P){const _=i.sqr(P),D=i.mul(_,P);return i.add(i.add(D,i.mul(P,n.a)),n.b)}function m(P,_){const D=i.sqr(_),p=w(P);return i.eql(D,p)}if(!m(n.Gx,n.Gy))throw new Error("bad curve params: generator point");const O=i.mul(i.pow(n.a,Qs),n_),C=i.mul(i.sqr(n.b),BigInt(27));if(i.is0(i.add(O,C)))throw new Error("bad curve params: a or b");function E(P,_,D=!1){if(!i.isValid(_)||D&&i.is0(_))throw new Error(`bad point coordinate ${P}`);return _}function I(P){if(!(P instanceof $))throw new Error("ProjectivePoint expected")}function A(P){if(!c||!c.basises)throw new Error("no endo");return i_(P,c.basises,s.ORDER)}const B=Ku((P,_)=>{const{X:D,Y:p,Z:y}=P;if(i.eql(y,i.ONE))return{x:D,y:p};const b=P.is0();_==null&&(_=b?i.ONE:i.inv(y));const S=i.mul(D,_),v=i.mul(p,_),x=i.mul(y,_);if(b)return{x:i.ZERO,y:i.ZERO};if(!i.eql(x,i.ONE))throw new Error("invZ was invalid");return{x:S,y:v}}),T=Ku(P=>{if(P.is0()){if(e.allowInfinityPoint&&!i.is0(P.Y))return;throw new Error("bad point: ZERO")}const{x:_,y:D}=P.toAffine();if(!i.isValid(_)||!i.isValid(D))throw new Error("bad point: x or y not field elements");if(!m(_,D))throw new Error("bad point: equation left != right");if(!P.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(P,_,D,p,y){return D=new $(i.mul(D.X,P),D.Y,D.Z),_=Cn(p,_),D=Cn(y,D),_.add(D)}class ${constructor(_,D,p){this.X=E("x",_),this.Y=E("y",D,!0),this.Z=E("z",p),Object.freeze(this)}static CURVE(){return n}static fromAffine(_){const{x:D,y:p}=_||{};if(!_||!i.isValid(D)||!i.isValid(p))throw new Error("invalid affine point");if(_ instanceof $)throw new Error("projective point not allowed");return i.is0(D)&&i.is0(p)?$.ZERO:new $(D,p,i.ONE)}static fromBytes(_){const D=$.fromAffine(g(ei(_,void 0,"point")));return D.assertValidity(),D}static fromHex(_){return $.fromBytes(ze("pointHex",_))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(_=8,D=!0){return j.createCache(this,_),D||this.multiply(Qs),this}assertValidity(){T(this)}hasEvenY(){const{y:_}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(_)}equals(_){I(_);const{X:D,Y:p,Z:y}=this,{X:b,Y:S,Z:v}=_,x=i.eql(i.mul(D,v),i.mul(b,y)),N=i.eql(i.mul(p,v),i.mul(S,y));return x&&N}negate(){return new $(this.X,i.neg(this.Y),this.Z)}double(){const{a:_,b:D}=n,p=i.mul(D,Qs),{X:y,Y:b,Z:S}=this;let v=i.ZERO,x=i.ZERO,N=i.ZERO,U=i.mul(y,y),V=i.mul(b,b),L=i.mul(S,S),q=i.mul(y,b);return q=i.add(q,q),N=i.mul(y,S),N=i.add(N,N),v=i.mul(_,N),x=i.mul(p,L),x=i.add(v,x),v=i.sub(V,x),x=i.add(V,x),x=i.mul(v,x),v=i.mul(q,v),N=i.mul(p,N),L=i.mul(_,L),q=i.sub(U,L),q=i.mul(_,q),q=i.add(q,N),N=i.add(U,U),U=i.add(N,U),U=i.add(U,L),U=i.mul(U,q),x=i.add(x,U),L=i.mul(b,S),L=i.add(L,L),U=i.mul(L,q),v=i.sub(v,U),N=i.mul(L,V),N=i.add(N,N),N=i.add(N,N),new $(v,x,N)}add(_){I(_);const{X:D,Y:p,Z:y}=this,{X:b,Y:S,Z:v}=_;let x=i.ZERO,N=i.ZERO,U=i.ZERO;const V=n.a,L=i.mul(n.b,Qs);let q=i.mul(D,b),K=i.mul(p,S),G=i.mul(y,v),X=i.add(D,p),W=i.add(b,S);X=i.mul(X,W),W=i.add(q,K),X=i.sub(X,W),W=i.add(D,y);let Q=i.add(b,v);return W=i.mul(W,Q),Q=i.add(q,G),W=i.sub(W,Q),Q=i.add(p,y),x=i.add(S,v),Q=i.mul(Q,x),x=i.add(K,G),Q=i.sub(Q,x),U=i.mul(V,W),x=i.mul(L,G),U=i.add(x,U),x=i.sub(K,U),U=i.add(K,U),N=i.mul(x,U),K=i.add(q,q),K=i.add(K,q),G=i.mul(V,G),W=i.mul(L,W),K=i.add(K,G),G=i.sub(q,G),G=i.mul(V,G),W=i.add(W,G),q=i.mul(K,W),N=i.add(N,q),q=i.mul(Q,W),x=i.mul(X,x),x=i.sub(x,q),q=i.mul(X,K),U=i.mul(Q,U),U=i.add(U,q),new $(x,N,U)}subtract(_){return this.add(_.negate())}is0(){return this.equals($.ZERO)}multiply(_){const{endo:D}=e;if(!s.isValidNot0(_))throw new Error("invalid scalar: out of range");let p,y;const b=S=>j.cached(this,S,v=>qo($,v));if(D){const{k1neg:S,k1:v,k2neg:x,k2:N}=A(_),{p:U,f:V}=b(v),{p:L,f:q}=b(N);y=V.add(q),p=R(D.beta,U,L,S,x)}else{const{p:S,f:v}=b(_);p=S,y=v}return qo($,[p,y])[0]}multiplyUnsafe(_){const{endo:D}=e,p=this;if(!s.isValid(_))throw new Error("invalid scalar: out of range");if(_===cr||p.is0())return $.ZERO;if(_===Bi)return p;if(j.hasCache(this))return this.multiply(_);if(D){const{k1neg:y,k1:b,k2neg:S,k2:v}=A(_),{p1:x,p2:N}=HI($,p,b,v);return R(D.beta,x,N,y,S)}else return j.unsafe(p,_)}multiplyAndAddUnsafe(_,D,p){const y=this.multiplyUnsafe(D).add(_.multiplyUnsafe(p));return y.is0()?void 0:y}toAffine(_){return B(this,_)}isTorsionFree(){const{isTorsionFree:_}=e;return o===Bi?!0:_?_($,this):j.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:_}=e;return o===Bi?this:_?_($,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(_=!0){return Pn(_,"isCompressed"),this.assertValidity(),d($,this,_)}toHex(_=!0){return Pi(this.toBytes(_))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(_=!0){return this.toBytes(_)}_setWindowSize(_){this.precompute(_)}static normalizeZ(_){return qo($,_)}static msm(_,D){return KI($,s,_,D)}static fromPrivateKey(_){return $.BASE.multiply(_i(s,_))}}$.BASE=new $(n.Gx,n.Gy,i.ONE),$.ZERO=new $(i.ZERO,i.ONE,i.ZERO),$.Fp=i,$.Fn=s;const k=s.BITS,j=new VI($,e.endo?Math.ceil(k/2):k);return $.BASE.precompute(8),$}function yg(t){return Uint8Array.of(t?2:3)}function wg(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function a_(t,e={}){const{Fn:r}=t,i=e.randomBytes||hi,s=Object.assign(wg(t.Fp,r),{seed:hg(r.ORDER)});function n(f){try{return!!_i(r,f)}catch{return!1}}function o(f,d){const{publicKey:g,publicKeyUncompressed:w}=s;try{const m=f.length;return d===!0&&m!==g||d===!1&&m!==w?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=i(s.seed)){return MI(ei(f,s.seed,"seed"),r.ORDER)}function c(f,d=!0){return t.BASE.multiply(_i(r,f)).toBytes(d)}function l(f){const d=a(f);return{secretKey:d,publicKey:c(d)}}function u(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:d,publicKey:g,publicKeyUncompressed:w}=s;if(r.allowedLengths||d===g)return;const m=ze("key",f).length;return m===g||m===w}function h(f,d,g=!0){if(u(f)===!0)throw new Error("first arg must be private key");if(u(d)===!1)throw new Error("second arg must be public key");const w=_i(r,f);return t.fromHex(d).multiply(w).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:n,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:n,randomPrivateKey:a,normPrivateKeyToScalar:f=>_i(r,f),precompute(f=8,d=t.BASE){return d.precompute(f,!1)}},lengths:s})}function c_(t,e,r={}){Gn(e),to(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=r.randomBytes||hi,s=r.hmac||((D,...p)=>Xn(e,D,Br(...p))),{Fp:n,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:d}=a_(t,r),g={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},w="compact";function m(D){const p=a>>Bi;return D>p}function O(D,p){if(!o.isValidNot0(p))throw new Error(`invalid signature ${D}: out of range 1..Point.Fn.ORDER`);return p}function C(D,p){La(p);const y=d.signature,b=p==="compact"?y:p==="recovered"?y+1:void 0;return ei(D,b,`${p} signature`)}class E{constructor(p,y,b){this.r=O("r",p),this.s=O("s",y),b!=null&&(this.recovery=b),Object.freeze(this)}static fromBytes(p,y=w){C(p,y);let b;if(y==="der"){const{r:N,s:U}=or.toSig(ei(p));return new E(N,U)}y==="recovered"&&(b=p[0],y="compact",p=p.subarray(1));const S=o.BYTES,v=p.subarray(0,S),x=p.subarray(S,S*2);return new E(o.fromBytes(v),o.fromBytes(x),b)}static fromHex(p,y){return this.fromBytes($n(p),y)}addRecoveryBit(p){return new E(this.r,this.s,p)}recoverPublicKey(p){const y=n.ORDER,{r:b,s:S,recovery:v}=this;if(v==null||![0,1,2,3].includes(v))throw new Error("recovery id invalid");if(a*gg<y&&v>1)throw new Error("recovery id is ambiguous for h>1 curve");const x=v===2||v===3?b+a:b;if(!n.isValid(x))throw new Error("recovery id 2 or 3 invalid");const N=n.toBytes(x),U=t.fromBytes(Br(yg((v&1)===0),N)),V=o.inv(x),L=A(ze("msgHash",p)),q=o.create(-L*V),K=o.create(S*V),G=t.BASE.multiplyUnsafe(q).add(U.multiplyUnsafe(K));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return m(this.s)}toBytes(p=w){if(La(p),p==="der")return $n(or.hexFromSig(this));const y=o.toBytes(this.r),b=o.toBytes(this.s);if(p==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Br(Uint8Array.of(this.recovery),y,b)}return Br(y,b)}toHex(p){return Pi(this.toBytes(p))}assertValidity(){}static fromCompact(p){return E.fromBytes(ze("sig",p),"compact")}static fromDER(p){return E.fromBytes(ze("sig",p),"der")}normalizeS(){return this.hasHighS()?new E(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Pi(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Pi(this.toBytes("compact"))}}const I=r.bits2int||function(D){if(D.length>8192)throw new Error("input is too large");const p=eo(D),y=D.length*8-c;return y>0?p>>BigInt(y):p},A=r.bits2int_modN||function(D){return o.create(I(D))},B=Ts(c);function T(D){return ja("num < 2^"+c,D,cr,B),o.toBytes(D)}function R(D,p){return ei(D,void 0,"message"),p?ei(e(D),void 0,"prehashed message"):D}function $(D,p,y){if(["recovered","canonical"].some(K=>K in y))throw new Error("sign() legacy options not supported");const{lowS:b,prehash:S,extraEntropy:v}=Ko(y,g);D=R(D,S);const x=A(D),N=_i(o,p),U=[T(N),T(x)];if(v!=null&&v!==!1){const K=v===!0?i(d.secretKey):v;U.push(ze("extraEntropy",K))}const V=Br(...U),L=x;function q(K){const G=I(K);if(!o.isValidNot0(G))return;const X=o.inv(G),W=t.BASE.multiply(G).toAffine(),Q=o.create(W.x);if(Q===cr)return;const de=o.create(X*o.create(L+Q*N));if(de===cr)return;let be=(W.x===Q?0:2)|Number(W.y&Bi),xe=de;return b&&m(de)&&(xe=o.neg(de),be^=1),new E(Q,xe,be)}return{seed:V,k2sig:q}}function k(D,p,y={}){D=ze("message",D);const{seed:b,k2sig:S}=$(D,p,y);return CI(e.outputLen,o.BYTES,s)(b,S)}function j(D){let p;const y=typeof D=="string"||Wn(D),b=!y&&D!==null&&typeof D=="object"&&typeof D.r=="bigint"&&typeof D.s=="bigint";if(!y&&!b)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(b)p=new E(D.r,D.s);else if(y){try{p=E.fromBytes(ze("sig",D),"der")}catch(S){if(!(S instanceof or.Err))throw S}if(!p)try{p=E.fromBytes(ze("sig",D),"compact")}catch{return!1}}return p||!1}function P(D,p,y,b={}){const{lowS:S,prehash:v,format:x}=Ko(b,g);if(y=ze("publicKey",y),p=R(ze("message",p),v),"strict"in b)throw new Error("options.strict was renamed to lowS");const N=x===void 0?j(D):E.fromBytes(ze("sig",D),x);if(N===!1)return!1;try{const U=t.fromBytes(y);if(S&&N.hasHighS())return!1;const{r:V,s:L}=N,q=A(p),K=o.inv(L),G=o.create(q*K),X=o.create(V*K),W=t.BASE.multiplyUnsafe(G).add(U.multiplyUnsafe(X));return W.is0()?!1:o.create(W.x)===V}catch{return!1}}function _(D,p,y={}){const{prehash:b}=Ko(y,g);return p=R(p,b),E.fromBytes(D,"recovered").recoverPublicKey(p).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:d,Point:t,sign:k,verify:P,recoverPublicKey:_,Signature:E,hash:e})}function l_(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let i=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=Mr(e.n,{BITS:t.nBitLength,allowedLengths:i,modFromBytes:t.wrapPrivateKey}),n={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:n}}function u_(t){const{CURVE:e,curveOpts:r}=l_(t),i={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:i}}function h_(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,lg(r.Fn.ORDER,r.Fn.BITS))})}function f_(t){const{CURVE:e,curveOpts:r,hash:i,ecdsaOpts:s}=u_(t),n=o_(e,r),o=c_(n,i,s);return h_(t,o)}function Ma(t,e){const r=i=>f_({...t,hash:i});return{...r(e),create:r}}const mg={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},bg={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},vg={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},d_=Mr(mg.p),p_=Mr(bg.p),g_=Mr(vg.p),y_=Ma({...mg,Fp:d_,lowS:!1},Zn);Ma({...bg,Fp:p_,lowS:!1},E3),Ma({...vg,Fp:g_,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},v3);const w_=y_,Eg="base10",We="base16",et="base64pad",Cr="base64url",Rs="utf8",xg=0,hr=1,Ns=2,m_=0,eh=1,hs=12,zc=32;function b_(){const t=Fa.utils.randomPrivateKey(),e=Fa.getPublicKey(t);return{privateKey:it(t,We),publicKey:it(e,We)}}function qa(){const t=hi(zc);return it(t,We)}function v_(t,e){const r=Fa.getSharedSecret(vt(t,We),vt(e,We)),i=PI(Qn,r,void 0,void 0,zc);return it(i,We)}function fn(t){const e=Qn(vt(t,We));return it(e,We)}function mt(t){const e=Qn(vt(t,Rs));return it(e,We)}function Ig(t){return vt(`${t}`,Eg)}function li(t){return Number(it(t,Eg))}function _g(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Sg(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function E_(t){const e=Ig(typeof t.type<"u"?t.type:xg);if(li(e)===hr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?vt(t.senderPublicKey,We):void 0,i=typeof t.iv<"u"?vt(t.iv,We):hi(hs),s=vt(t.symKey,We),n=Jp(s,i).encrypt(vt(t.message,Rs)),o=Og({type:e,sealed:n,iv:i,senderPublicKey:r});return t.encoding===Cr?_g(o):o}function x_(t){const e=vt(t.symKey,We),{sealed:r,iv:i}=xs({encoded:t.encoded,encoding:t.encoding}),s=Jp(e,i).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return it(s,Rs)}function I_(t,e){const r=Ig(Ns),i=hi(hs),s=vt(t,Rs),n=Og({type:r,sealed:s,iv:i});return e===Cr?_g(n):n}function __(t,e){const{sealed:r}=xs({encoded:t,encoding:e});return it(r,Rs)}function Og(t){if(li(t.type)===Ns)return it(us([t.type,t.sealed]),et);if(li(t.type)===hr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return it(us([t.type,t.senderPublicKey,t.iv,t.sealed]),et)}return it(us([t.type,t.iv,t.sealed]),et)}function xs(t){const e=(t.encoding||et)===Cr?Sg(t.encoded):t.encoded,r=vt(e,et),i=r.slice(m_,eh),s=eh;if(li(i)===hr){const c=s+zc,l=c+hs,u=r.slice(s,c),h=r.slice(c,l),f=r.slice(l);return{type:i,sealed:f,iv:h,senderPublicKey:u}}if(li(i)===Ns){const c=r.slice(s),l=hi(hs);return{type:i,sealed:c,iv:l}}const n=s+hs,o=r.slice(s,n),a=r.slice(n);return{type:i,sealed:a,iv:o}}function S_(t,e){const r=xs({encoded:t,encoding:e==null?void 0:e.encoding});return Dg({type:li(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?it(r.senderPublicKey,We):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Dg(t){const e=(t==null?void 0:t.type)||xg;if(e===hr){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function th(t){return t.type===hr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function rh(t){return t.type===Ns}function O_(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return us([new Uint8Array([4]),e,r])}function D_(t,e){const[r,i,s]=t.split("."),n=Buffer.from(Sg(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${r}.${i}`,l=Qn(c),u=O_(e);if(!w_.verify(us([o,a]),l,u))throw new Error("Invalid signature");return Oa(t).payload}const $_="irn";function Tn(t){return(t==null?void 0:t.relay)||{protocol:$_}}function Si(t){const e=hE[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var A_=Object.defineProperty,P_=Object.defineProperties,B_=Object.getOwnPropertyDescriptors,ih=Object.getOwnPropertySymbols,C_=Object.prototype.hasOwnProperty,T_=Object.prototype.propertyIsEnumerable,sh=(t,e,r)=>e in t?A_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wo=(t,e)=>{for(var r in e||(e={}))C_.call(e,r)&&sh(t,r,e[r]);if(ih)for(var r of ih(e))T_.call(e,r)&&sh(t,r,e[r]);return t},R_=(t,e)=>P_(t,B_(e));function N_(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),o=t[s];r[n]=o}}),r}function nh(t){if(!t.includes("wc:")){const l=Pp(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),n=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(n),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:U_(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:N_(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function U_(t){return t.startsWith("//")?t.substring(2):t}function k_(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const n=s,o=r+e+n;t[n]&&(i[o]=t[n])}),i}function oh(t){const e=new URLSearchParams,r=Wo(Wo(R_(Wo({},k_(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([i],[s])=>i.localeCompare(s)).forEach(([i,s])=>{s!==void 0&&e.append(i,String(s))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function en(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var j_=Object.defineProperty,F_=Object.defineProperties,L_=Object.getOwnPropertyDescriptors,ah=Object.getOwnPropertySymbols,M_=Object.prototype.hasOwnProperty,q_=Object.prototype.propertyIsEnumerable,ch=(t,e,r)=>e in t?j_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,z_=(t,e)=>{for(var r in e||(e={}))M_.call(e,r)&&ch(t,r,e[r]);if(ah)for(var r of ah(e))q_.call(e,r)&&ch(t,r,e[r]);return t},V_=(t,e)=>F_(t,L_(e));function Mi(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function $g(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Mi(r.accounts))}),[...new Set(e)]}function H_(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.methods)}),[...new Set(e)]}function K_(t){const e=[];return Object.values(t).forEach(r=>{e.push(...r.events)}),[...new Set(e)]}function W_(t,e){const r=[];return Object.values(t).forEach(i=>{Mi(i.accounts).includes(e)&&r.push(...i.methods)}),r}function G_(t,e){const r=[];return Object.values(t).forEach(i=>{Mi(i.accounts).includes(e)&&r.push(...i.events)}),r}function ro(t){return t.includes(":")}function Oi(t){return ro(t)?t.split(":")[0]:t}function lh(t){var e,r,i;const s={};if(!Kt(t))return s;for(const[n,o]of Object.entries(t)){const a=ro(n)?[n]:o.chains,c=o.methods||[],l=o.events||[],u=Oi(n);s[u]=V_(z_({},s[u]),{chains:Ht(a,(e=s[u])==null?void 0:e.chains),methods:Ht(c,(r=s[u])==null?void 0:r.methods),events:Ht(l,(i=s[u])==null?void 0:i.events)})}return s}function Y_(t){const e={};return t==null||t.forEach(r=>{var i;const[s,n]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function uh(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=Y_(e);for(const[i,s]of Object.entries(r))s.methods?s.methods=Ht(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}function Z_(t,e){var r,i,s,n,o,a;const c=lh(t),l=lh(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const f of h)u[f]={chains:Ht((r=c[f])==null?void 0:r.chains,(i=l[f])==null?void 0:i.chains),methods:Ht((s=c[f])==null?void 0:s.methods,(n=l[f])==null?void 0:n.methods),events:Ht((o=c[f])==null?void 0:o.events,(a=l[f])==null?void 0:a.events)};return u}const J_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},X_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function z(t,e){const{message:r,code:i}=X_[t];return{message:e?`${r} ${e}`:r,code:i}}function he(t,e){const{message:r,code:i}=J_[t];return{message:e?`${r} ${e}`:r,code:i}}function Et(t,e){return!!Array.isArray(t)}function Kt(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function De(t){return typeof t>"u"}function me(t,e){return e&&De(t)?!0:typeof t=="string"&&!!t.trim().length}function Vc(t,e){return typeof t=="number"&&!isNaN(t)}function Q_(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let n=!0;return Qr(s,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=Mi(a),h=r[o];(!Qr(Sp(o,h),u)||!Qr(h.methods,c)||!Qr(h.events,l))&&(n=!1)}),n):!1}function Rn(t){return me(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function eS(t){if(me(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Rn(r)}}return!1}function tS(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(me(t,!1)){if(e(t))return!0;const r=Pp(t);return e(r)}}catch{}return!1}function rS(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function iS(t){return t==null?void 0:t.topic}function sS(t,e){let r=null;return me(t==null?void 0:t.publicKey,!1)||(r=z("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function hh(t){let e=!0;return Et(t)?t.length&&(e=t.every(r=>me(r,!1))):e=!1,e}function nS(t,e,r){let i=null;return Et(e)&&e.length?e.forEach(s=>{i||Rn(s)||(i=he("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):Rn(t)||(i=he("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function oS(t,e,r){let i=null;return Object.entries(t).forEach(([s,n])=>{if(i)return;const o=nS(s,Sp(s,n),`${e} ${r}`);o&&(i=o)}),i}function aS(t,e){let r=null;return Et(t)?t.forEach(i=>{r||eS(i)||(r=he("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=he("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function cS(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=aS(i==null?void 0:i.accounts,`${e} namespace`);s&&(r=s)}),r}function lS(t,e){let r=null;return hh(t==null?void 0:t.methods)?hh(t==null?void 0:t.events)||(r=he("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=he("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Ag(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=lS(i,`${e}, namespace`);s&&(r=s)}),r}function uS(t,e,r){let i=null;if(t&&Kt(t)){const s=Ag(t,e);s&&(i=s);const n=oS(t,e,r);n&&(i=n)}else i=z("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function Go(t,e){let r=null;if(t&&Kt(t)){const i=Ag(t,e);i&&(r=i);const s=cS(t,e);s&&(r=s)}else r=z("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Pg(t){return me(t.protocol,!0)}function hS(t,e){let r=!1;return t?t&&Et(t)&&t.length&&t.forEach(i=>{r=Pg(i)}):r=!0,r}function fS(t){return typeof t=="number"}function Je(t){return typeof t<"u"&&typeof t!==null}function dS(t){return!(!t||typeof t!="object"||!t.code||!Vc(t.code)||!t.message||!me(t.message,!1))}function pS(t){return!(De(t)||!me(t.method,!1))}function gS(t){return!(De(t)||De(t.result)&&De(t.error)||!Vc(t.id)||!me(t.jsonrpc,!1))}function yS(t){return!(De(t)||!me(t.name,!1))}function fh(t,e){return!(!Rn(e)||!$g(t).includes(e))}function wS(t,e,r){return me(r,!1)?W_(t,e).includes(r):!1}function mS(t,e,r){return me(r,!1)?G_(t,e).includes(r):!1}function dh(t,e,r){let i=null;const s=bS(t),n=vS(e),o=Object.keys(s),a=Object.keys(n),c=ph(Object.keys(t)),l=ph(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Qr(o,a)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||i)return;const f=Mi(e[h].accounts);f.includes(h)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{i||(Qr(s[h].methods,n[h].methods)?Qr(s[h].events,n[h].events)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),i}function bS(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function ph(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function vS(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=Mi(t[r].accounts);i==null||i.forEach(s=>{e[s]={accounts:t[r].accounts.filter(n=>n.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function ES(t,e){return Vc(t)&&t<=e.max&&t>=e.min}function gh(){const t=Bs();return new Promise(e=>{switch(t){case ht.browser:e(xS());break;case ht.reactNative:e(IS());break;case ht.node:e(_S());break;default:e(!0)}})}function xS(){return Li()&&(navigator==null?void 0:navigator.onLine)}async function IS(){if(Lr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function _S(){return!0}function SS(t){switch(Bs()){case ht.browser:OS(t);break;case ht.reactNative:DS(t);break}}function OS(t){!Lr()&&Li()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function DS(t){Lr()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function $S(){var t;return Li()&&si()?((t=si())==null?void 0:t.visibilityState)==="visible":!0}const Yo={};class Xi{static get(e){return Yo[e]}static set(e,r){Yo[e]=r}static delete(e){delete Yo[e]}}function AS(t){const e=Ss.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function PS({publicKey:t,signature:e,payload:r}){var i;const s=za(r.method),n=128|parseInt(((i=r.version)==null?void 0:i.toString())||"4"),o=TS(r.address),a=r.era==="00"?new Uint8Array([0]):za(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${CS(r.tip)}`),h=NS(u),f=new Uint8Array([0,...t,o,...e,...a,...l,...h,...s]),d=RS(f.length+1);return new Uint8Array([...d,n,...f])}function BS(t){const e=za(t),r=IE.blake2b(e,void 0,32);return"0x"+Buffer.from(r).toString("hex")}function za(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function CS(t){return t.startsWith("0x")?t.slice(2):t}function TS(t){const e=Ss.decode(t)[0];return e===42?0:e===60?2:1}function RS(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function NS(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function US(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),r=AS(t.transaction.address),i=PS({publicKey:r,signature:e,payload:t.transaction}),s=Buffer.from(i).toString("hex");return BS(s)}function Hc({logger:t,name:e}){const r=typeof t=="string"?_p({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}class fi{}let kS=class extends fi{constructor(e){super()}};const yh=M.FIVE_SECONDS,di={pulse:"heartbeat_pulse"};let jS=class Bg extends kS{constructor(e){super(e),this.events=new It.EventEmitter,this.interval=yh,this.interval=(e==null?void 0:e.interval)||yh}static async init(e){const r=new Bg(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),M.toMiliseconds(this.interval))}pulse(){this.events.emit(di.pulse)}};const FS=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,LS=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,MS=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function qS(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){zS(t);return}return e}function zS(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function tn(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!MS.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(FS.test(t)||LS.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,qS)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function VS(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Se(t,...e){try{return VS(t(...e))}catch(r){return Promise.reject(r)}}function HS(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function KS(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function dn(t){if(HS(t))return String(t);if(KS(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return dn(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Va="base64:";function WS(t){return typeof t=="string"?t:Va+ZS(t)}function GS(t){return typeof t!="string"||!t.startsWith(Va)?t:YS(t.slice(Va.length))}function YS(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function ZS(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ze(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function JS(...t){return Ze(t.join(":"))}function rn(t){return t=Ze(t),t?t+":":""}function XS(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function QS(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const e8="memory",t8=()=>{const t=new Map;return{name:e8,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function r8(t={}){const e={mounts:{"":t.driver||t8()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},i=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),s=(l,u)=>{if(e.watching){u=Ze(u);for(const h of e.watchListeners)h(l,u)}},n=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await wh(e.mounts[l],s,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const f=new Map,d=g=>{let w=f.get(g.base);return w||(w={driver:g.driver,base:g.base,items:[]},f.set(g.base,w)),w};for(const g of l){const w=typeof g=="string",m=Ze(w?g:g.key),O=w?void 0:g.value,C=w||!g.options?u:{...u,...g.options},E=r(m);d(E).items.push({key:m,value:O,relativeKey:E.relativeKey,options:C})}return Promise.all([...f.values()].map(g=>h(g))).then(g=>g.flat())},c={hasItem(l,u={}){l=Ze(l);const{relativeKey:h,driver:f}=r(l);return Se(f.hasItem,h,u)},getItem(l,u={}){l=Ze(l);const{relativeKey:h,driver:f}=r(l);return Se(f.getItem,h,u).then(d=>tn(d))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?Se(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),u).then(f=>f.map(d=>({key:JS(h.base,d.key),value:tn(d.value)}))):Promise.all(h.items.map(f=>Se(h.driver.getItem,f.relativeKey,f.options).then(d=>({key:f.key,value:tn(d)})))))},getItemRaw(l,u={}){l=Ze(l);const{relativeKey:h,driver:f}=r(l);return f.getItemRaw?Se(f.getItemRaw,h,u):Se(f.getItem,h,u).then(d=>GS(d))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=Ze(l);const{relativeKey:f,driver:d}=r(l);d.setItem&&(await Se(d.setItem,f,dn(u),h),d.watch||s("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return Se(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:dn(f.value),options:f.options})),u);h.driver.setItem&&await Promise.all(h.items.map(f=>Se(h.driver.setItem,f.relativeKey,dn(f.value),f.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=Ze(l);const{relativeKey:f,driver:d}=r(l);if(d.setItemRaw)await Se(d.setItemRaw,f,u,h);else if(d.setItem)await Se(d.setItem,f,WS(u),h);else return;d.watch||s("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Ze(l);const{relativeKey:h,driver:f}=r(l);f.removeItem&&(await Se(f.removeItem,h,u),(u.removeMeta||u.removeMata)&&await Se(f.removeItem,h+"$",u),f.watch||s("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Ze(l);const{relativeKey:h,driver:f}=r(l),d=Object.create(null);if(f.getMeta&&Object.assign(d,await Se(f.getMeta,h,u)),!u.nativeOnly){const g=await Se(f.getItem,h+"$",u).then(w=>tn(w));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(d,g))}return d},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){var m;l=rn(l);const h=i(l,!0);let f=[];const d=[];let g=!0;for(const O of h){(m=O.driver.flags)!=null&&m.maxDepth||(g=!1);const C=await Se(O.driver.getKeys,O.relativeBase,u);for(const E of C){const I=O.mountpoint+Ze(E);f.some(A=>I.startsWith(A))||d.push(I)}f=[O.mountpoint,...f.filter(E=>!E.startsWith(O.mountpoint))]}const w=u.maxDepth!==void 0&&!g;return d.filter(O=>(!w||XS(O,u.maxDepth))&&QS(O,l))},async clear(l,u={}){l=rn(l),await Promise.all(i(l,!1).map(async h=>{if(h.driver.clear)return Se(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(f.map(d=>h.driver.removeItem(d,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>mh(l)))},async watch(l){return await n(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=rn(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(wh(u,s,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){var h,f;l=rn(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((f=(h=e.unwatch)[l])==null||f.call(h),delete e.unwatch[l]),u&&await mh(e.mounts[l]),e.mountpoints=e.mountpoints.filter(d=>d!==l),delete e.mounts[l])},getMount(l=""){l=Ze(l)+":";const u=r(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Ze(l),i(l,u.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function wh(t,e,r){return t.watch?t.watch((i,s)=>e(i,r+s)):()=>{}}async function mh(t){typeof t.dispose=="function"&&await Se(t.dispose)}const i8="idb-keyval";var s8=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=s=>e+s;let i;return t.dbName&&t.storeName&&(i=Ry(t.dbName,t.storeName)),{name:i8,options:t,async hasItem(s){return!(typeof await cl(r(s),i)>"u")},async getItem(s){return await cl(r(s),i)??null},setItem(s,n){return jy(r(s),n,i)},removeItem(s){return ky(r(s),i)},getKeys(){return Uy(i)},clear(){return Ny(i)}}};const n8="WALLET_CONNECT_V2_INDEXED_DB",o8="keyvaluestorage";let a8=class{constructor(){this.indexedDb=r8({driver:s8({dbName:n8,storeName:o8})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,ai(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Zo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},pn={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Zo<"u"&&Zo.localStorage?pn.exports=Zo.localStorage:typeof window<"u"&&window.localStorage?pn.exports=window.localStorage:pn.exports=new e})();function c8(t){var e;return[t[0],oi((e=t[1])!=null?e:"")]}let l8=class{constructor(){this.localStorage=pn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(c8)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return oi(r)}async setItem(e,r){this.localStorage.setItem(e,ai(r))}async removeItem(e){this.localStorage.removeItem(e)}};const u8="wc_storage_version",bh=1,h8=async(t,e,r)=>{const i=u8,s=await e.getItem(i);if(s&&s>=bh){r(e);return}const n=await t.getKeys();if(!n.length){r(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(i,bh),r(e),f8(t,o)},f8=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let d8=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new l8;this.storage=e;try{const r=new a8;h8(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var p8=Object.defineProperty,g8=(t,e,r)=>e in t?p8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vh=(t,e,r)=>g8(t,typeof e!="symbol"?e+"":e,r);let y8=class extends fi{constructor(e){super(),this.opts=e,vh(this,"protocol","wc"),vh(this,"version",2)}};var w8=Object.defineProperty,m8=(t,e,r)=>e in t?w8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,b8=(t,e,r)=>m8(t,e+"",r);let v8=class extends fi{constructor(e,r){super(),this.core=e,this.logger=r,b8(this,"records",new Map)}},E8=class{constructor(e,r){this.logger=e,this.core=r}};class x8 extends fi{constructor(e,r){super(),this.relayer=e,this.logger=r}}let I8=class extends fi{constructor(e){super()}},_8=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}},S8=class extends fi{constructor(e,r){super(),this.relayer=e,this.logger=r}},O8=class extends fi{constructor(e,r){super(),this.core=e,this.logger=r}},D8=class{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}},$8=class{constructor(e,r){this.projectId=e,this.logger=r}},A8=class{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}};var P8=Object.defineProperty,B8=(t,e,r)=>e in t?P8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Eh=(t,e,r)=>B8(t,typeof e!="symbol"?e+"":e,r);let C8=class{constructor(e){this.opts=e,Eh(this,"protocol","wc"),Eh(this,"version",2)}},T8=class{constructor(e){this.client=e}};const R8="PARSE_ERROR",N8="INVALID_REQUEST",U8="METHOD_NOT_FOUND",k8="INVALID_PARAMS",Cg="INTERNAL_ERROR",Kc="SERVER_ERROR",j8=[-32700,-32600,-32601,-32602,-32603],fs={[R8]:{code:-32700,message:"Parse error"},[N8]:{code:-32600,message:"Invalid Request"},[U8]:{code:-32601,message:"Method not found"},[k8]:{code:-32602,message:"Invalid params"},[Cg]:{code:-32603,message:"Internal error"},[Kc]:{code:-32e3,message:"Server error"}},Tg=Kc;function F8(t){return j8.includes(t)}function xh(t){return Object.keys(fs).includes(t)?fs[t]:fs[Tg]}function L8(t){const e=Object.values(fs).find(r=>r.code===t);return e||fs[Tg]}function Rg(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Ng={},er={},Ih;function M8(){if(Ih)return er;Ih=1,Object.defineProperty(er,"__esModule",{value:!0}),er.isBrowserCryptoAvailable=er.getSubtleCrypto=er.getBrowerCrypto=void 0;function t(){return(Mt===null||Mt===void 0?void 0:Mt.crypto)||(Mt===null||Mt===void 0?void 0:Mt.msCrypto)||{}}er.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}er.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return er.isBrowserCryptoAvailable=r,er}var tr={},_h;function q8(){if(_h)return tr;_h=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.isBrowser=tr.isNode=tr.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}tr.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}tr.isNode=e;function r(){return!t()&&!e()}return tr.isBrowser=r,tr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Os;e.__exportStar(M8(),t),e.__exportStar(q8(),t)})(Ng);function Ft(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Rr(t=6){return BigInt(Ft(t))}function Pt(t,e,r){return{id:r||Ft(),jsonrpc:"2.0",method:t,params:e}}function Is(t,e){return{id:t,jsonrpc:"2.0",result:e}}function io(t,e,r){return{id:t,jsonrpc:"2.0",error:z8(e)}}function z8(t,e){return typeof t>"u"?xh(Cg):(typeof t=="string"&&(t=Object.assign(Object.assign({},xh(Kc)),{message:t})),F8(t.code)&&(t=L8(t.code)),t)}class V8{}class H8 extends V8{constructor(){super()}}class K8 extends H8{constructor(e){super()}}const W8="^https?:",G8="^wss?:";function Y8(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Ug(t,e){const r=Y8(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Sh(t){return Ug(t,W8)}function Oh(t){return Ug(t,G8)}function Z8(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function kg(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Wc(t){return kg(t)&&"method"in t}function so(t){return kg(t)&&(Lt(t)||bt(t))}function Lt(t){return"result"in t}function bt(t){return"error"in t}let Gc=class extends K8{constructor(e){super(e),this.events=new It.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Pt(e.method,e.params||[],e.id||Rr().toString()),r)}async requestStrict(e,r){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{bt(n)?s(n.error):i(n.result)});try{await this.connection.send(e,r)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),so(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const J8=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),X8=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Dh=t=>t.split("?")[0],$h=10,Q8=J8();let eO=class{constructor(e){if(this.url=e,this.events=new It.EventEmitter,this.registering=!1,!Oh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ai(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!Oh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=Ng.isReactNative()?void 0:{rejectUnauthorized:!Z8(e)},n=new Q8(e,[],s);X8()?n.onerror=o=>{const a=o;i(this.emitError(a.error))}:n.on("error",o=>{i(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),r(n)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?oi(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=io(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return Rg(e,Dh(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>$h&&this.events.setMaxListeners($h)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Dh(this.url)}`));return this.events.emit("register_error",r),r}};var tO={};const jg="wc",Fg=2,Ha="core",Wt=`${jg}@2:${Ha}:`,rO={logger:"error"},iO={database:":memory:"},sO="crypto",Ah="client_ed25519_seed",nO=M.ONE_DAY,oO="keychain",aO="0.3",cO="messages",lO="0.3",uO=M.SIX_HOURS,hO="publisher",Lg="irn",fO="error",Mg="wss://relay.walletconnect.org",dO="relayer",pe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},pO="_subscription",pt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},gO=.1,Ka="2.23.5",ue={link_mode:"link_mode",relay:"relay"},gn={inbound:"inbound",outbound:"outbound"},yO="0.3",wO="WALLETCONNECT_CLIENT_ID",Ph="WALLETCONNECT_LINK_MODE_APPS",ct={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},mO="subscription",bO="0.3",vO="pairing",EO="0.3",Qi={wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}},Jr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},St={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},xO="history",IO="0.3",_O="expirer",yt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},SO="0.3",OO="verify-api",DO="https://verify.walletconnect.com",qg="https://verify.walletconnect.org",ds=qg,$O=`${ds}/v3`,AO=[DO,qg],PO="echo",BO="https://echo.walletconnect.com",jt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},ir={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Ot={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Hr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Kr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},es={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},CO=.1,TO="event-client",RO=86400,NO="https://pulse.walletconnect.org/batch";function UO(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var w=0,m=0,O=0,C=g.length;O!==C&&g[O]===0;)O++,w++;for(var E=(C-O)*u+1>>>0,I=new Uint8Array(E);O!==C;){for(var A=g[O],B=0,T=E-1;(A!==0||B<m)&&T!==-1;T--,B++)A+=256*I[T]>>>0,I[T]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");m=B,O++}for(var R=E-m;R!==E&&I[R]===0;)R++;for(var $=c.repeat(w);R<E;++R)$+=t.charAt(I[R]);return $}function f(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var w=0;if(g[w]!==" "){for(var m=0,O=0;g[w]===c;)m++,w++;for(var C=(g.length-w)*l+1>>>0,E=new Uint8Array(C);g[w];){var I=r[g.charCodeAt(w)];if(I===255)return;for(var A=0,B=C-1;(I!==0||A<O)&&B!==-1;B--,A++)I+=a*E[B]>>>0,E[B]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");O=A,w++}if(g[w]!==" "){for(var T=C-O;T!==C&&E[T]===0;)T++;for(var R=new Uint8Array(m+(C-T)),$=m;T!==C;)R[$++]=E[T++];return R}}}function d(g){var w=f(g);if(w)return w;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var kO=UO,jO=kO;const zg=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},FO=t=>new TextEncoder().encode(t),LO=t=>new TextDecoder().decode(t);class MO{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class qO{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Vg(this,e)}}class zO{constructor(e){this.decoders=e}or(e){return Vg(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Vg=(t,e)=>new zO({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class VO{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new MO(e,r,i),this.decoder=new qO(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const no=({name:t,prefix:e,encode:r,decode:i})=>new VO(t,e,r,i),Us=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=jO(r,e);return no({prefix:t,name:e,encode:i,decode:n=>zg(s(n))})},HO=(t,e,r,i)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,l=0;for(let u=0;u<n;++u){const h=s[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},KO=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Ue=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>no({prefix:e,name:t,encode(s){return KO(s,i,r)},decode(s){return HO(s,i,r,t)}}),WO=no({prefix:"\0",name:"identity",encode:t=>LO(t),decode:t=>FO(t)});var GO=Object.freeze({__proto__:null,identity:WO});const YO=Ue({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ZO=Object.freeze({__proto__:null,base2:YO});const JO=Ue({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var XO=Object.freeze({__proto__:null,base8:JO});const QO=Us({prefix:"9",name:"base10",alphabet:"0123456789"});var eD=Object.freeze({__proto__:null,base10:QO});const tD=Ue({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),rD=Ue({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var iD=Object.freeze({__proto__:null,base16:tD,base16upper:rD});const sD=Ue({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),nD=Ue({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),oD=Ue({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),aD=Ue({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),cD=Ue({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),lD=Ue({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),uD=Ue({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hD=Ue({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),fD=Ue({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var dD=Object.freeze({__proto__:null,base32:sD,base32upper:nD,base32pad:oD,base32padupper:aD,base32hex:cD,base32hexupper:lD,base32hexpad:uD,base32hexpadupper:hD,base32z:fD});const pD=Us({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),gD=Us({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var yD=Object.freeze({__proto__:null,base36:pD,base36upper:gD});const wD=Us({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mD=Us({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var bD=Object.freeze({__proto__:null,base58btc:wD,base58flickr:mD});const vD=Ue({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ED=Ue({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),xD=Ue({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ID=Ue({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var _D=Object.freeze({__proto__:null,base64:vD,base64pad:ED,base64url:xD,base64urlpad:ID});const Hg=Array.from(""),SD=Hg.reduce((t,e,r)=>(t[r]=e,t),[]),OD=Hg.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function DD(t){return t.reduce((e,r)=>(e+=SD[r],e),"")}function $D(t){const e=[];for(const r of t){const i=OD[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const AD=no({prefix:"",name:"base256emoji",encode:DD,decode:$D});var PD=Object.freeze({__proto__:null,base256emoji:AD}),BD=Kg,Bh=128,CD=-128,TD=Math.pow(2,31);function Kg(t,e,r){e=e||[],r=r||0;for(var i=r;t>=TD;)e[r++]=t&255|Bh,t/=128;for(;t&CD;)e[r++]=t&255|Bh,t>>>=7;return e[r]=t|0,Kg.bytes=r-i+1,e}var RD=Wa,ND=128,Ch=127;function Wa(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw Wa.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&Ch)<<s:(o&Ch)*Math.pow(2,s),s+=7}while(o>=ND);return Wa.bytes=n-i,r}var UD=Math.pow(2,7),kD=Math.pow(2,14),jD=Math.pow(2,21),FD=Math.pow(2,28),LD=Math.pow(2,35),MD=Math.pow(2,42),qD=Math.pow(2,49),zD=Math.pow(2,56),VD=Math.pow(2,63),HD=function(t){return t<UD?1:t<kD?2:t<jD?3:t<FD?4:t<LD?5:t<MD?6:t<qD?7:t<zD?8:t<VD?9:10},KD={encode:BD,decode:RD,encodingLength:HD},Wg=KD;const Th=(t,e,r=0)=>(Wg.encode(t,e,r),e),Rh=t=>Wg.encodingLength(t),Ga=(t,e)=>{const r=e.byteLength,i=Rh(t),s=i+Rh(r),n=new Uint8Array(s+r);return Th(t,n,0),Th(r,n,i),n.set(e,s),new WD(t,r,e,n)};class WD{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const Gg=({name:t,code:e,encode:r})=>new GD(t,e,r);class GD{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ga(this.code,r):r.then(i=>Ga(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Yg=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),YD=Gg({name:"sha2-256",code:18,encode:Yg("SHA-256")}),ZD=Gg({name:"sha2-512",code:19,encode:Yg("SHA-512")});var JD=Object.freeze({__proto__:null,sha256:YD,sha512:ZD});const Zg=0,XD="identity",Jg=zg,QD=t=>Ga(Zg,Jg(t)),e$={code:Zg,name:XD,encode:Jg,digest:QD};var t$=Object.freeze({__proto__:null,identity:e$});new TextEncoder,new TextDecoder;const Nh={...GO,...ZO,...XO,...eD,...iD,...dD,...yD,...bD,..._D,...PD};({...JD,...t$});function Xg(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function r$(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Xg(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Qg(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Uh=Qg("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Jo=Qg("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=r$(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),i$={utf8:Uh,"utf-8":Uh,hex:Nh.base16,latin1:Jo,ascii:Jo,binary:Jo,...Nh};function s$(t,e="utf8"){const r=i$[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Xg(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var n$=Object.defineProperty,o$=(t,e,r)=>e in t?n$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ut=(t,e,r)=>o$(t,typeof e!="symbol"?e+"":e,r);class a${constructor(e,r){this.core=e,this.logger=r,Ut(this,"keychain",new Map),Ut(this,"name",oO),Ut(this,"version",aO),Ut(this,"initialized",!1),Ut(this,"storagePrefix",Wt),Ut(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),Ut(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),Ut(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),Ut(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),Ut(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=ft(r,this.name)}get context(){return st(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Pa(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ba(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var c$=Object.defineProperty,l$=(t,e,r)=>e in t?c$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ie=(t,e,r)=>l$(t,typeof e!="symbol"?e+"":e,r);class u${constructor(e,r,i){this.core=e,this.logger=r,Ie(this,"name",sO),Ie(this,"keychain"),Ie(this,"randomSessionIdentifier",qa()),Ie(this,"initialized",!1),Ie(this,"clientId"),Ie(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Ie(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),Ie(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const s=await this.getClientSeed(),n=cu(s),o=rp(n.publicKey);return this.clientId=o,o}),Ie(this,"generateKeyPair",()=>{this.isInitialized();const s=b_();return this.setPrivateKey(s.publicKey,s.privateKey)}),Ie(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=cu(n),a=this.randomSessionIdentifier;return await p2(a,s,nO,o)}),Ie(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=v_(a,n);return this.setSymKey(c,o)}),Ie(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||fn(s);return await this.keychain.set(o,s),o}),Ie(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),Ie(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),Ie(this,"encode",async(s,n,o)=>{this.isInitialized();const a=Dg(o),c=ai(n);if(rh(a))return I_(c,o==null?void 0:o.encoding);if(th(a)){const f=a.senderPublicKey,d=a.receiverPublicKey;s=await this.generateSharedKey(f,d)}const l=this.getSymKey(s),{type:u,senderPublicKey:h}=a;return E_({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),Ie(this,"decode",async(s,n,o)=>{this.isInitialized();const a=S_(n,o);if(rh(a)){const c=__(n,o==null?void 0:o.encoding);return oi(c)}if(th(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;s=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(s),l=x_({symKey:c,encoded:n,encoding:o==null?void 0:o.encoding});return oi(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Ie(this,"getPayloadType",(s,n=et)=>{const o=xs({encoded:s,encoding:n});return li(o.type)}),Ie(this,"getPayloadSenderPublicKey",(s,n=et)=>{const o=xs({encoded:s,encoding:n});return o.senderPublicKey?it(o.senderPublicKey,We):void 0}),this.core=e,this.logger=ft(r,this.name),this.keychain=i||new a$(this.core,this.logger)}get context(){return st(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Ah)}catch{e=qa(),await this.keychain.set(Ah,e)}return s$(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var h$=Object.defineProperty,f$=Object.defineProperties,d$=Object.getOwnPropertyDescriptors,kh=Object.getOwnPropertySymbols,p$=Object.prototype.hasOwnProperty,g$=Object.prototype.propertyIsEnumerable,Ya=(t,e,r)=>e in t?h$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y$=(t,e)=>{for(var r in e||(e={}))p$.call(e,r)&&Ya(t,r,e[r]);if(kh)for(var r of kh(e))g$.call(e,r)&&Ya(t,r,e[r]);return t},w$=(t,e)=>f$(t,d$(e)),nt=(t,e,r)=>Ya(t,typeof e!="symbol"?e+"":e,r);class m$ extends E8{constructor(e,r){super(e,r),this.logger=e,this.core=r,nt(this,"messages",new Map),nt(this,"messagesWithoutClientAck",new Map),nt(this,"name",cO),nt(this,"version",lO),nt(this,"initialized",!1),nt(this,"storagePrefix",Wt),nt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),nt(this,"set",async(i,s,n)=>{this.isInitialized();const o=mt(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===gn.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,w$(y$({},c),{[o]:s}))}return await this.persist(),o}),nt(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),nt(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),nt(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),o=mt(s);return typeof n[o]<"u"}),nt(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;const o=mt(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),nt(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=ft(e,this.name),this.core=r}get context(){return st(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Pa(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Pa(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ba(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Ba(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var b$=Object.defineProperty,v$=Object.defineProperties,E$=Object.getOwnPropertyDescriptors,jh=Object.getOwnPropertySymbols,x$=Object.prototype.hasOwnProperty,I$=Object.prototype.propertyIsEnumerable,Za=(t,e,r)=>e in t?b$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vi=(t,e)=>{for(var r in e||(e={}))x$.call(e,r)&&Za(t,r,e[r]);if(jh)for(var r of jh(e))I$.call(e,r)&&Za(t,r,e[r]);return t},Fh=(t,e)=>v$(t,E$(e)),gt=(t,e,r)=>Za(t,typeof e!="symbol"?e+"":e,r);class _$ extends x8{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,gt(this,"events",new It.EventEmitter),gt(this,"name",hO),gt(this,"queue",new Map),gt(this,"publishTimeout",M.toMiliseconds(M.ONE_MINUTE)),gt(this,"initialPublishTimeout",M.toMiliseconds(M.ONE_SECOND*15)),gt(this,"needsTransportRestart",!1),gt(this,"publish",async(i,s,n)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const h=(n==null?void 0:n.ttl)||uO,f=(n==null?void 0:n.prompt)||!1,d=(n==null?void 0:n.tag)||0,g=(n==null?void 0:n.id)||Rr().toString(),w=Si(Tn().protocol),m={id:g,method:(n==null?void 0:n.publishMethod)||w.publish,params:vi({topic:i,message:s,ttl:h,prompt:f,tag:d,attestation:n==null?void 0:n.attestation},n==null?void 0:n.tvf)},O=`Failed to publish payload, please try again. id:${g} tag:${d}`;try{De((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),De((c=m.params)==null?void 0:c.tag)&&((l=m.params)==null||delete l.tag);const C=new Promise(async E=>{const I=({id:B})=>{var T;((T=m.id)==null?void 0:T.toString())===B.toString()&&(this.removeRequestFromQueue(B),this.relayer.events.removeListener(pe.publish,I),E())};this.relayer.events.on(pe.publish,I);const A=Vt(new Promise((B,T)=>{this.rpcPublish(m,n).then(B).catch(R=>{this.logger.warn(R,R==null?void 0:R.message),T(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${g} tag:${d}`);try{await A,this.events.removeListener(pe.publish,I)}catch(B){this.queue.set(g,{request:m,opts:n,attempt:1}),this.logger.warn(B,B==null?void 0:B.message)}});this.logger.trace({type:"method",method:"publish",params:{id:g,topic:i,message:s,opts:n}}),await Vt(C,this.publishTimeout,O)}catch(C){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(C),(u=n==null?void 0:n.internal)!=null&&u.throwOnFailedPublish)throw C}finally{this.queue.delete(g)}}),gt(this,"publishCustom",async i=>{var s,n,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:l,opts:u={}}=i,{attestation:h,tvf:f,publishMethod:d,prompt:g,tag:w,ttl:m=M.FIVE_MINUTES}=u,O=u.id||Rr().toString(),C=Si(Tn().protocol),E=d||C.publish,I={id:O,method:E,params:vi(Fh(vi({},l),{ttl:m,prompt:g,tag:w,attestation:h}),f)},A=`Failed to publish custom payload, please try again. id:${O} tag:${w}`;try{De((s=I.params)==null?void 0:s.prompt)&&((n=I.params)==null||delete n.prompt),De((o=I.params)==null?void 0:o.tag)&&((a=I.params)==null||delete a.tag);const B=new Promise(async T=>{const R=({id:k})=>{var j;((j=I.id)==null?void 0:j.toString())===k.toString()&&(this.removeRequestFromQueue(k),this.relayer.events.removeListener(pe.publish,R),T())};this.relayer.events.on(pe.publish,R);const $=Vt(new Promise((k,j)=>{this.rpcPublish(I,u).then(k).catch(P=>{this.logger.warn(P,P==null?void 0:P.message),j(P)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${E} id:${O} tag:${w}`);try{await $,this.events.removeListener(pe.publish,R)}catch(k){this.queue.set(O,{request:I,opts:u,attempt:1}),this.logger.warn(k,k==null?void 0:k.message)}});this.logger.trace({type:"method",method:"publish",params:{id:O,payload:l,opts:u}}),await Vt(B,this.publishTimeout,A)}catch(B){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(B),(c=u==null?void 0:u.internal)!=null&&c.throwOnFailedPublish)throw B}finally{this.queue.delete(O)}}),gt(this,"on",(i,s)=>{this.events.on(i,s)}),gt(this,"once",(i,s)=>{this.events.once(i,s)}),gt(this,"off",(i,s)=>{this.events.off(i,s)}),gt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=ft(r,this.name),this.registerEventListeners()}get context(){return st(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(pe.publish,vi(vi({},e),r)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var i;const s=e.attempt+1;this.queue.set(r,Fh(vi({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(di.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(pe.connection_stalled);return}this.checkQueue()}),this.relayer.on(pe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var S$=Object.defineProperty,O$=(t,e,r)=>e in t?S$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ei=(t,e,r)=>O$(t,typeof e!="symbol"?e+"":e,r);class D${constructor(){Ei(this,"map",new Map),Ei(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),Ei(this,"get",e=>this.map.get(e)||[]),Ei(this,"exists",(e,r)=>this.get(e).includes(r)),Ei(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(n=>n!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),Ei(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var $$=Object.defineProperty,A$=Object.defineProperties,P$=Object.getOwnPropertyDescriptors,Lh=Object.getOwnPropertySymbols,B$=Object.prototype.hasOwnProperty,C$=Object.prototype.propertyIsEnumerable,Ja=(t,e,r)=>e in t?$$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ts=(t,e)=>{for(var r in e||(e={}))B$.call(e,r)&&Ja(t,r,e[r]);if(Lh)for(var r of Lh(e))C$.call(e,r)&&Ja(t,r,e[r]);return t},Xo=(t,e)=>A$(t,P$(e)),ae=(t,e,r)=>Ja(t,typeof e!="symbol"?e+"":e,r);class T$ extends S8{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ae(this,"subscriptions",new Map),ae(this,"topicMap",new D$),ae(this,"events",new It.EventEmitter),ae(this,"name",mO),ae(this,"version",bO),ae(this,"pending",new Map),ae(this,"cached",[]),ae(this,"initialized",!1),ae(this,"storagePrefix",Wt),ae(this,"subscribeTimeout",M.toMiliseconds(M.ONE_MINUTE)),ae(this,"initialSubscribeTimeout",M.toMiliseconds(M.ONE_SECOND*15)),ae(this,"clientId"),ae(this,"batchSubscribeTopicsLimit",500),ae(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ae(this,"subscribe",async(i,s)=>{var n;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const o=Tn(s),a={topic:i,relay:o,transportType:s==null?void 0:s.transportType};(n=s==null?void 0:s.internal)!=null&&n.skipSubscribe||this.pending.set(i,a);const c=await this.rpcSubscribe(i,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),ae(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),ae(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),ae(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),ae(this,"on",(i,s)=>{this.events.on(i,s)}),ae(this,"once",(i,s)=>{this.events.once(i,s)}),ae(this,"off",(i,s)=>{this.events.off(i,s)}),ae(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),ae(this,"start",async()=>{await this.onConnect()}),ae(this,"stop",async()=>{await this.onDisconnect()}),ae(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ae(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),ae(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(di.pulse,async()=>{await this.checkPending()}),this.events.on(ct.created,async i=>{const s=ct.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(ct.deleted,async i=>{const s=ct.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=ft(r,this.name),this.clientId=""}get context(){return st(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=Tn(i);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);const n=he("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,i){var s,n;const o=await this.getSubscriptionId(e);if((s=i==null?void 0:i.internal)!=null&&s.skipSubscribe)return o;(!i||(i==null?void 0:i.transportType)===ue.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:Si(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(n=i==null?void 0:i.internal)==null?void 0:n.throwOnFailedPublish;try{if((i==null?void 0:i.transportType)===ue.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},M.toMiliseconds(M.ONE_SECOND)),o;const l=new Promise(async h=>{const f=d=>{d.topic===e&&(this.events.removeListener(ct.created,f),h(d.id))};this.events.on(ct.created,f);try{const d=await Vt(new Promise((g,w)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m==null?void 0:m.message),w(m)}).then(g)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(ct.created,f),h(d)}catch{}}),u=await Vt(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(pe.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return!0;const r=e[0].relay,i={method:Si(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await Vt(new Promise((s,n)=>{this.relayer.request(i).then(s).catch(o=>{this.logger.warn(o),n(o)})}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again"),!0}catch{return this.relayer.events.emit(pe.connection_stalled),!1}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:Si(r.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Vt(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(pe.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:Si(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,Xo(ts({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,ts({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,ts({},r)),this.topicMap.set(r.topic,e),this.events.emit(ct.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(ct.deleted,Xo(ts({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(ct.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(ct.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var i;return r.topic===((i=this.subscriptions.get(r.id))==null?void 0:i.topic)})){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(e.length){if(!await this.rpcBatchSubscribe(e)){this.logger.warn(`Batch subscribe failed for ${e.length} topics, adding to pending for retry`),e.forEach(r=>{this.pending.set(r.topic,r)});return}this.onBatchSubscribe(await Promise.all(e.map(async r=>Xo(ts({},r),{id:await this.getSubscriptionId(r.topic)}))))}}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await Fx(M.toMiliseconds(M.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return mt(e+await this.getClientId())}}var R$=Object.defineProperty,Mh=Object.getOwnPropertySymbols,N$=Object.prototype.hasOwnProperty,U$=Object.prototype.propertyIsEnumerable,Xa=(t,e,r)=>e in t?R$(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qh=(t,e)=>{for(var r in e||(e={}))N$.call(e,r)&&Xa(t,r,e[r]);if(Mh)for(var r of Mh(e))U$.call(e,r)&&Xa(t,r,e[r]);return t},ee=(t,e,r)=>Xa(t,typeof e!="symbol"?e+"":e,r);class k$ extends I8{constructor(e){var r;super(e),ee(this,"protocol","wc"),ee(this,"version",2),ee(this,"core"),ee(this,"logger"),ee(this,"events",new It.EventEmitter),ee(this,"provider"),ee(this,"messages"),ee(this,"subscriber"),ee(this,"publisher"),ee(this,"name",dO),ee(this,"transportExplicitlyClosed",!1),ee(this,"initialized",!1),ee(this,"connectionAttemptInProgress",!1),ee(this,"relayUrl"),ee(this,"projectId"),ee(this,"packageName"),ee(this,"bundleId"),ee(this,"hasExperiencedNetworkDisruption",!1),ee(this,"pingTimeout"),ee(this,"heartBeatTimeout",M.toMiliseconds(M.THIRTY_SECONDS+M.FIVE_SECONDS)),ee(this,"reconnectTimeout"),ee(this,"connectPromise"),ee(this,"reconnectInProgress",!1),ee(this,"requestsInFlight",[]),ee(this,"connectTimeout",M.toMiliseconds(M.ONE_SECOND*15)),ee(this,"stalledRestartInProgress",!1),ee(this,"stalledRestartTimeout"),ee(this,"stalledRestartBackoff",0),ee(this,"stalledRestartBaseInterval",M.toMiliseconds(M.ONE_SECOND*2)),ee(this,"stalledRestartMaxInterval",M.toMiliseconds(M.THIRTY_SECONDS)),ee(this,"request",async i=>{var s,n;this.logger.debug("Publishing Request Payload");const o=i.id||Rr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:i.method,topic:(s=i.params)==null?void 0:s.topic},"relayer.request - publishing...");const a=`${o}:${((n=i.params)==null?void 0:n.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(i);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),ee(this,"resetPingTimeout",()=>{Dn()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,s,n,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null?void 0:n.terminate)==null||o.call(n)}catch(a){this.logger.warn(a,a==null?void 0:a.message)}},this.heartBeatTimeout))}),ee(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),ee(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(pe.connect)}),ee(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),ee(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(pe.error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportExplicitlyClosed=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,this.reconnectInProgress=!1,this.transportClose().catch(s=>this.logger.warn(s))}),ee(this,"registerProviderListeners",()=>{this.provider.on(pt.payload,this.onPayloadHandler),this.provider.on(pt.connect,this.onConnectHandler),this.provider.on(pt.disconnect,this.onDisconnectHandler),this.provider.on(pt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=Hc({logger:(r=e.logger)!=null?r:fO,name:this.name}),this.messages=new m$(this.logger,e.core),this.subscriber=new T$(this,this.logger),this.publisher=new _$(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Mg,Ix()?this.packageName=Iu():_x()&&(this.bundleId=Iu()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return st(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ue.relay},gn.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var i,s,n;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=r==null?void 0:r.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(ct.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(ct.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,qh({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,u()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Vt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,clearTimeout(this.stalledRestartTimeout),this.stalledRestartInProgress=!1,this.stalledRestartBackoff=0,await this.resetTransport()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.resetTransport(),await this.transportOpen())}async resetTransport(){this.reconnectInProgress=!0,clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0,await this.transportDisconnect(),await this.subscriber.stop(),this.reconnectInProgress=!1}async confirmOnlineStateOrThrow(){if(!await gh())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const s=we(M.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(pe.message,e),await this.recordMessageEvent(e,gn.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(pt.disconnect,n),await Vt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(pt.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(pt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(pt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,M.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,s,n;if(Dn())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Gc(new eO(Ax({sdkVersion:Ka,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:s}=e;await this.messages.set(i,s,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const s=this.messages.has(r,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Wc(e)){if(!e.method.endsWith(pO))return;const r=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=r.data,a={topic:i,message:s,publishedAt:n,transportType:ue.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(qh({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else so(e)&&this.events.emit(pe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,gn.inbound),this.events.emit(pe.message,e))}async acknowledgePayload(e){const r=Is(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(pt.payload,this.onPayloadHandler),this.provider.off(pt.connect,this.onConnectHandler),this.provider.off(pt.disconnect,this.onDisconnectHandler),this.provider.off(pt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await gh();SS(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(di.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&$S())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r==null?void 0:r.message)}}),this.events.on(pe.connection_stalled,()=>{if(this.transportExplicitlyClosed||this.stalledRestartInProgress)return;this.stalledRestartInProgress=!0;const r=this.stalledRestartBackoff===0?0:Math.min(Math.pow(2,this.stalledRestartBackoff-1)*this.stalledRestartBaseInterval,this.stalledRestartMaxInterval);this.stalledRestartBackoff++,this.logger.warn(`Connection stalled, restarting transport${r?` in ${r}ms`:""}...`),this.stalledRestartTimeout=setTimeout(async()=>{try{if(this.transportExplicitlyClosed)return;await this.restartTransport()}catch(i){this.logger.error(i,i==null?void 0:i.message)}finally{this.stalledRestartInProgress=!1}},r)})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(pe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},M.toMiliseconds(gO)))))}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function j$(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function zh(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Vh(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const F$="[object RegExp]",L$="[object String]",M$="[object Number]",q$="[object Boolean]",Hh="[object Arguments]",z$="[object Symbol]",V$="[object Date]",H$="[object Map]",K$="[object Set]",W$="[object Array]",G$="[object Function]",Y$="[object ArrayBuffer]",Qo="[object Object]",Z$="[object Error]",J$="[object DataView]",X$="[object Uint8Array]",Q$="[object Uint8ClampedArray]",eA="[object Uint16Array]",tA="[object Uint32Array]",rA="[object BigUint64Array]",iA="[object Int8Array]",sA="[object Int16Array]",nA="[object Int32Array]",oA="[object BigInt64Array]",aA="[object Float32Array]",cA="[object Float64Array]";function Kh(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function lA(t,e,r){return cs(t,e,void 0,void 0,void 0,void 0,r)}function cs(t,e,r,i,s,n,o){const a=o(t,e,r,i,s,n);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return ps(t,e,n,o)}return ps(t,e,n,o)}function ps(t,e,r,i){if(Object.is(t,e))return!0;let s=Vh(t),n=Vh(e);if(s===Hh&&(s=Qo),n===Hh&&(n=Qo),s!==n)return!1;switch(s){case L$:return t.toString()===e.toString();case M$:{const c=t.valueOf(),l=e.valueOf();return j$(c,l)}case q$:case V$:case z$:return Object.is(t.valueOf(),e.valueOf());case F$:return t.source===e.source&&t.flags===e.flags;case G$:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(s){case H$:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!cs(l,e.get(c),c,t,e,r,i))return!1;return!0}case K$:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],f=l.findIndex(d=>cs(h,d,void 0,t,e,r,i));if(f===-1)return!1;l.splice(f,1)}return!0}case W$:case X$:case Q$:case eA:case tA:case rA:case iA:case sA:case nA:case oA:case aA:case cA:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!cs(t[c],e[c],c,t,e,r,i))return!1;return!0}case Y$:return t.byteLength!==e.byteLength?!1:ps(new Uint8Array(t),new Uint8Array(e),r,i);case J$:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:ps(new Uint8Array(t),new Uint8Array(e),r,i);case Z$:return t.name===e.name&&t.message===e.message;case Qo:{if(!(ps(t.constructor,e.constructor,r,i)||Kh(t)&&Kh(e)))return!1;const c=[...Object.keys(t),...zh(t)],l=[...Object.keys(e),...zh(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],f=t[h];if(!Object.hasOwn(e,h))return!1;const d=e[h];if(!cs(f,d,h,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function uA(){}function hA(t,e){return lA(t,e,uA)}var fA=Object.defineProperty,Wh=Object.getOwnPropertySymbols,dA=Object.prototype.hasOwnProperty,pA=Object.prototype.propertyIsEnumerable,Qa=(t,e,r)=>e in t?fA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gh=(t,e)=>{for(var r in e||(e={}))dA.call(e,r)&&Qa(t,r,e[r]);if(Wh)for(var r of Wh(e))pA.call(e,r)&&Qa(t,r,e[r]);return t},Ye=(t,e,r)=>Qa(t,typeof e!="symbol"?e+"":e,r);class pi extends _8{constructor(e,r,i,s=Wt,n=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,Ye(this,"map",new Map),Ye(this,"version",yO),Ye(this,"cached",[]),Ye(this,"initialized",!1),Ye(this,"getKey"),Ye(this,"storagePrefix",Wt),Ye(this,"recentlyDeleted",[]),Ye(this,"recentlyDeletedLimit",200),Ye(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!De(o)?this.map.set(this.getKey(o),o):rS(o)?this.map.set(o.id,o):iS(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ye(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ye(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ye(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>hA(a[c],o[c]))):this.values)),Ye(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Gh(Gh({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ye(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=ft(r,this.name),this.storagePrefix=s,this.getKey=n}get context(){return st(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:s}=z("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var gA=Object.defineProperty,yA=(t,e,r)=>e in t?gA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,te=(t,e,r)=>yA(t,typeof e!="symbol"?e+"":e,r);class wA{constructor(e,r){this.core=e,this.logger=r,te(this,"name",vO),te(this,"version",EO),te(this,"events",new lc),te(this,"pairings"),te(this,"initialized",!1),te(this,"storagePrefix",Wt),te(this,"ignoredPayloadTypes",[hr]),te(this,"registeredMethods",[]),te(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),te(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),te(this,"create",async i=>{this.isInitialized();const s=qa(),n=await this.core.crypto.setSymKey(s),o=we(M.FIVE_MINUTES),a={protocol:Lg},c={topic:n,expiry:o,relay:a,active:!1,methods:i==null?void 0:i.methods},l=oh({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i==null?void 0:i.methods});return this.events.emit(Jr.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i==null?void 0:i.transportType,internal:i==null?void 0:i.internal}),{topic:n,uri:l}}),te(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[jt.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:l}=nh(i.uri);s.props.properties.topic=n,s.addTrace(jt.pairing_uri_validation_success),s.addTrace(jt.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(n)){if(u=this.pairings.get(n),s.addTrace(jt.existing_pairing),u.active)throw s.setError(ir.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(jt.pairing_not_expired)}const h=c||we(M.FIVE_MINUTES),f={topic:n,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(n,h),await this.pairings.set(n,f),s.addTrace(jt.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(Jr.create,f),s.addTrace(jt.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(jt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(ir.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(d){throw s.setError(ir.subscribe_pairing_topic_failure),d}return s.addTrace(jt.subscribe_pairing_topic_success),f}),te(this,"activate",async({topic:i})=>{this.isInitialized();const s=we(M.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),te(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Gr();this.events.once(oe("pairing_ping",n),({error:l})=>{l?c(l):a()}),await o()}}),te(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),te(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),te(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),te(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",he("USER_DISCONNECTED")),await this.deletePairing(s))}),te(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return oh({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),te(this,"sendRequest",async(i,s,n)=>{const o=Pt(s,n),a=await this.core.crypto.encode(i,o),c=Qi[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),te(this,"sendResult",async(i,s,n)=>{const o=Is(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=Qi[c].res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),te(this,"sendError",async(i,s,n)=>{const o=io(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,l=Qi[c]?Qi[c].res:Qi.unregistered_method.res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),te(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,he("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),te(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>qt(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),te(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),te(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}}),te(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(Jr.ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),te(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{Lt(s)?this.events.emit(oe("pairing_ping",n),{}):bt(s)&&this.events.emit(oe("pairing_ping",n),{error:s.error})},500)}),te(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Jr.delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),te(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=he("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),te(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(he("WC_METHOD_UNSUPPORTED",i))}),te(this,"isValidPair",(i,s)=>{var n;if(!Je(i)){const{message:a}=z("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(ir.malformed_pairing_uri),new Error(a)}if(!tS(i.uri)){const{message:a}=z("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(ir.malformed_pairing_uri),new Error(a)}const o=nh(i==null?void 0:i.uri);if(!((n=o==null?void 0:o.relay)!=null&&n.protocol)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(ir.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(ir.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&M.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){s.setError(ir.pairing_expired);const{message:a}=z("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),te(this,"isValidPing",async i=>{if(!Je(i)){const{message:n}=z("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),te(this,"isValidDisconnect",async i=>{if(!Je(i)){const{message:n}=z("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),te(this,"isValidPairingTopic",async i=>{if(!me(i,!1)){const{message:s}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(qt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=z("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=ft(r,this.name),this.pairings=new pi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return st(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(pe.message,async e=>{const{topic:r,message:i,transportType:s}=e;if(this.pairings.keys.includes(r)&&s!==ue.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(r,i);Wc(n)?(this.core.history.set(r,n),await this.onRelayEventRequest({topic:r,payload:n})):so(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id)),await this.core.relayer.messages.ack(r,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(yt.expired,async e=>{const{topic:r}=Ap(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Jr.expire,{topic:r}))})}}var mA=Object.defineProperty,bA=(t,e,r)=>e in t?mA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Be=(t,e,r)=>bA(t,typeof e!="symbol"?e+"":e,r);class vA extends v8{constructor(e,r){super(e,r),this.core=e,this.logger=r,Be(this,"records",new Map),Be(this,"events",new It.EventEmitter),Be(this,"name",xO),Be(this,"version",IO),Be(this,"cached",[]),Be(this,"initialized",!1),Be(this,"storagePrefix",Wt),Be(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Be(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:we(M.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(St.created,o)}),Be(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=bt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(St.updated,s))}),Be(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),Be(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(St.deleted,n)}}),this.persist()}),Be(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),Be(this,"on",(i,s)=>{this.events.on(i,s)}),Be(this,"once",(i,s)=>{this.events.once(i,s)}),Be(this,"off",(i,s)=>{this.events.off(i,s)}),Be(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=ft(r,this.name)}get context(){return st(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:Pt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(St.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(St.created,e=>{const r=St.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(St.updated,e=>{const r=St.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(St.deleted,e=>{const r=St.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(di.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{M.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(St.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var EA=Object.defineProperty,xA=(t,e,r)=>e in t?EA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qe=(t,e,r)=>xA(t,typeof e!="symbol"?e+"":e,r);class IA extends O8{constructor(e,r){super(e,r),this.core=e,this.logger=r,qe(this,"expirations",new Map),qe(this,"events",new It.EventEmitter),qe(this,"name",_O),qe(this,"version",SO),qe(this,"cached",[]),qe(this,"initialized",!1),qe(this,"storagePrefix",Wt),qe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),qe(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),qe(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(yt.created,{target:n,expiration:o})}),qe(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),qe(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(yt.deleted,{target:s,expiration:n})}}),qe(this,"on",(i,s)=>{this.events.on(i,s)}),qe(this,"once",(i,s)=>{this.events.once(i,s)}),qe(this,"off",(i,s)=>{this.events.off(i,s)}),qe(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=ft(r,this.name)}get context(){return st(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Px(e);if(typeof e=="number")return Bx(e);const{message:r}=z("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(yt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;M.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(yt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(di.pulse,()=>this.checkExpirations()),this.events.on(yt.created,e=>{const r=yt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(yt.expired,e=>{const r=yt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(yt.deleted,e=>{const r=yt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var _A=Object.defineProperty,SA=(t,e,r)=>e in t?_A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ye=(t,e,r)=>SA(t,typeof e!="symbol"?e+"":e,r);class OA extends D8{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,ye(this,"name",OO),ye(this,"abortController"),ye(this,"isDevEnv"),ye(this,"verifyUrlV3",$O),ye(this,"storagePrefix",Wt),ye(this,"version",Fg),ye(this,"publicKey"),ye(this,"fetchPromise"),ye(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&M.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ye(this,"register",async s=>{if(!Li()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const l=si(),u=this.startAbortTimer(M.ONE_SECOND*5),h=await new Promise((f,d)=>{const g=()=>{window.removeEventListener("message",m),l.body.removeChild(w),d("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const w=l.createElement("iframe");w.src=c,w.style.display="none",w.addEventListener("error",g,{signal:this.abortController.signal});const m=O=>{if(O.data&&typeof O.data=="string")try{const C=JSON.parse(O.data);if(C.type==="verify_attestation"){if(Oa(C.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(w),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",m),f(C.attestation===null?"":C.attestation)}}catch(C){this.logger.warn(C)}};l.body.appendChild(w),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(l){this.logger.warn(l)}return""}),ye(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(Oa(n).payload.id!==a)return;const l=await this.isValidJwtAttestation(n);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(o,c)}),ye(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(M.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),ye(this,"getVerifyUrl",s=>{let n=s||ds;return AO.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${ds}`),n=ds),n}),ye(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(M.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),ye(this,"persistPublicKey",async s=>{this.logger.debug(s,"persisting public key to local storage"),await this.store.setItem(this.storeKey,s),this.publicKey=s}),ye(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ye(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ye(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ye(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),ye(this,"validateAttestation",(s,n)=>{const o=D_(s,n.publicKey),a={hasExpired:M.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=ft(r,this.name),this.abortController=new AbortController,this.isDevEnv=Rc(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return st(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),M.toMiliseconds(e))}}var DA=Object.defineProperty,$A=(t,e,r)=>e in t?DA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yh=(t,e,r)=>$A(t,typeof e!="symbol"?e+"":e,r);class AA extends $8{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Yh(this,"context",PO),Yh(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`${BO}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=ft(r,this.context)}}var PA=Object.defineProperty,Zh=Object.getOwnPropertySymbols,BA=Object.prototype.hasOwnProperty,CA=Object.prototype.propertyIsEnumerable,ec=(t,e,r)=>e in t?PA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rs=(t,e)=>{for(var r in e||(e={}))BA.call(e,r)&&ec(t,r,e[r]);if(Zh)for(var r of Zh(e))CA.call(e,r)&&ec(t,r,e[r]);return t},_e=(t,e,r)=>ec(t,typeof e!="symbol"?e+"":e,r);class TA extends A8{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,_e(this,"context",TO),_e(this,"storagePrefix",Wt),_e(this,"storageVersion",CO),_e(this,"events",new Map),_e(this,"shouldPersist",!1),_e(this,"init",async()=>{if(!Rc())try{const s={eventId:Su(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Dp(this.core.relayer.protocol,this.core.relayer.version,Ka)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),_e(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,l=Su(),u=this.core.projectId||"",h=Date.now(),f=rs({eventId:l,timestamp:h,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,f),this.shouldPersist=!0),f}),_e(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return rs(rs({},a),this.setMethods(a.eventId))}),_e(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),_e(this,"setEventListeners",()=>{this.core.heartbeat.on(di.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{M.fromMiliseconds(Date.now())-M.fromMiliseconds(s.timestamp)>RO&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),_e(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),_e(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),_e(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),_e(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),_e(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,rs(rs({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),_e(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),_e(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${NO}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Ka}${n}`,{method:"POST",body:JSON.stringify(s)})}),_e(this,"getAppDomain",()=>Op().url),this.logger=ft(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var RA=Object.defineProperty,Jh=Object.getOwnPropertySymbols,NA=Object.prototype.hasOwnProperty,UA=Object.prototype.propertyIsEnumerable,tc=(t,e,r)=>e in t?RA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xh=(t,e)=>{for(var r in e||(e={}))NA.call(e,r)&&tc(t,r,e[r]);if(Jh)for(var r of Jh(e))UA.call(e,r)&&tc(t,r,e[r]);return t},ce=(t,e,r)=>tc(t,typeof e!="symbol"?e+"":e,r);let kA=class ey extends y8{constructor(e){var r;super(e),ce(this,"protocol",jg),ce(this,"version",Fg),ce(this,"name",Ha),ce(this,"relayUrl"),ce(this,"projectId"),ce(this,"customStoragePrefix"),ce(this,"events",new It.EventEmitter),ce(this,"logger"),ce(this,"heartbeat"),ce(this,"relayer"),ce(this,"crypto"),ce(this,"storage"),ce(this,"history"),ce(this,"expirer"),ce(this,"pairing"),ce(this,"verify"),ce(this,"echoClient"),ce(this,"linkModeSupportedApps"),ce(this,"eventClient"),ce(this,"initialized",!1),ce(this,"logChunkController"),ce(this,"on",(a,c)=>this.events.on(a,c)),ce(this,"once",(a,c)=>this.events.once(a,c)),ce(this,"off",(a,c)=>this.events.off(a,c)),ce(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ce(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:ue.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const i=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Mg,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=cx({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:rO.logger,name:Ha}),{logger:n,chunkLoggerController:o}=_p({opts:s,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=ft(n,this.name),this.heartbeat=new jS,this.crypto=new u$(this,this.logger,e==null?void 0:e.keychain),this.history=new vA(this,this.logger),this.expirer=new IA(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new d8(Xh(Xh({},iO),e==null?void 0:e.storageOptions)),this.relayer=new k$({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new wA(this,this.logger),this.verify=new OA(this,this.logger,this.storage),this.echoClient=new AA(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new TA(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new ey(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(wO,i),r}get context(){return st(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Ph,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Ph)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,i=`${r}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&tO.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const jA=kA,ty="wc",ry=2,iy="client",Yc=`${ty}@${ry}:${iy}:`,ea={name:iy,logger:"error"},Qh="WALLETCONNECT_DEEPLINK_CHOICE",FA="proposal",ef="Proposal expired",LA="session",xi=M.SEVEN_DAYS,MA="engine",Ce={wc_sessionPropose:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1104},res:{ttl:M.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1106},res:{ttl:M.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1112},res:{ttl:M.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1114},res:{ttl:M.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:M.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:M.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1119}}},ta={min:M.FIVE_MINUTES,max:M.SEVEN_DAYS},kt={idle:"IDLE",active:"ACTIVE"},qA={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},zA="request",VA=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],HA="wc",KA="auth",WA="authKeys",GA="pairingTopics",YA="requests",oo=`${HA}@${1.5}:${KA}:`,yn=`${oo}:PUB_KEY`;var ZA=Object.defineProperty,JA=Object.defineProperties,XA=Object.getOwnPropertyDescriptors,tf=Object.getOwnPropertySymbols,QA=Object.prototype.hasOwnProperty,e6=Object.prototype.propertyIsEnumerable,rc=(t,e,r)=>e in t?ZA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ne=(t,e)=>{for(var r in e||(e={}))QA.call(e,r)&&rc(t,r,e[r]);if(tf)for(var r of tf(e))e6.call(e,r)&&rc(t,r,e[r]);return t},Te=(t,e)=>JA(t,XA(e)),F=(t,e,r)=>rc(t,typeof e!="symbol"?e+"":e,r);class t6 extends T8{constructor(e){super(e),F(this,"name",MA),F(this,"events",new lc),F(this,"initialized",!1),F(this,"requestQueue",{state:kt.idle,queue:[]}),F(this,"sessionRequestQueue",{state:kt.idle,queue:[]}),F(this,"emittedSessionRequests",new Lx({limit:500})),F(this,"requestQueueDelay",M.ONE_SECOND),F(this,"expectedPairingMethodMap",new Map),F(this,"recentlyDeletedMap",new Map),F(this,"recentlyDeletedLimit",200),F(this,"relayMessageCache",[]),F(this,"pendingSessions",new Map),F(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ce)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay)))}),F(this,"connect",async r=>{var i;this.isInitialized(),await this.confirmOnlineStateOrThrow();const s=Te(ne({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s),s.optionalNamespaces=Z_(s.requiredNamespaces,s.optionalNamespaces),s.requiredNamespaces={};const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:l,relays:u,authentication:h,walletPay:f}=s,d=((i=h==null?void 0:h[0])==null?void 0:i.ttl)||Ce.wc_sessionPropose.req.ttl||M.FIVE_MINUTES;this.validateRequestExpiry(d);let g=n,w,m=!1;try{if(g){const $=this.client.core.pairing.pairings.get(g);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),m=$.active}}catch($){throw this.client.logger.error(`connect() -> pairing.get(${g}) failed`),$}if(!g||!m){const{topic:$,uri:k}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});g=$,w=k}if(!g){const{message:$}=z("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error($)}const O=await this.client.core.crypto.generateKeyPair(),C=we(d),E=ne(Te(ne(ne({requiredNamespaces:o,optionalNamespaces:a,relays:u??[{protocol:Lg}],proposer:{publicKey:O,metadata:this.client.metadata},expiryTimestamp:C,pairingTopic:g},c&&{sessionProperties:c}),l&&{scopedProperties:l}),{id:Ft()}),(h||f)&&{requests:{authentication:h==null?void 0:h.map($=>{const{domain:k,chains:j,nonce:P,uri:_,exp:D,nbf:p,type:y,statement:b,requestId:S,resources:v,signatureTypes:x}=$;return{domain:k,chains:j,nonce:P,type:y??"caip122",aud:_,version:"1",iat:new Date().toISOString(),exp:D,nbf:p,statement:b,requestId:S,resources:v,signatureTypes:x}}),walletPay:f}}),I=oe("session_connect",E.id),{reject:A,resolve:B,done:T}=Gr(d,ef),R=({id:$})=>{$===E.id&&(this.client.events.off("proposal_expire",R),this.pendingSessions.delete(E.id),this.events.emit(I,{error:{message:ef,code:0}}))};return this.client.events.on("proposal_expire",R),this.events.once(I,({error:$,session:k})=>{this.client.events.off("proposal_expire",R),$?A($):k&&B(k)}),await this.setProposal(E.id,E),await this.sendProposeSession({proposal:E,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:E.id}}}).catch($=>{throw this.deleteProposal(E.id),$}),{uri:w,approval:T}}),F(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),F(this,"approve",async r=>{var i,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r==null?void 0:r.id)==null?void 0:i.toString(),trace:[Ot.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(k){throw o.setError(Hr.no_internet_connection),k}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(k){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),o.setError(Hr.proposal_not_found),k}try{await this.isValidApprove(r)}catch(k){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Hr.session_approve_namespace_validation_failure),k}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:d}=r,g=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:w,proposer:m,requiredNamespaces:O,optionalNamespaces:C}=g;let E=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:w});E||(E=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:Ot.session_approve_started,properties:{topic:w,trace:[Ot.session_approve_started,Ot.session_namespaces_validation_success]}}));const I=await this.client.core.crypto.generateKeyPair(),A=m.publicKey,B=await this.client.core.crypto.generateSharedKey(I,A),T=Te(ne(ne(ne({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:I,metadata:this.client.metadata},expiry:we(xi)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{proposalRequestsResponses:d}),R=ue.relay;E.addTrace(Ot.subscribing_session_topic);try{await this.client.core.relayer.subscribe(B,{transportType:R,internal:{skipSubscribe:!0}})}catch(k){throw E.setError(Hr.subscribe_session_topic_failure),k}E.addTrace(Ot.subscribe_session_topic_success);const $=Te(ne({},T),{topic:B,requiredNamespaces:O,optionalNamespaces:C,pairingTopic:w,acknowledged:!1,self:T.controller,peer:{publicKey:m.publicKey,metadata:m.metadata},controller:I,transportType:ue.relay,authentication:d==null?void 0:d.authentication,walletPayResult:d==null?void 0:d.walletPay});await this.client.session.set(B,$),E.addTrace(Ot.store_session);try{await this.sendApproveSession({sessionTopic:B,proposal:g,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:I},sessionSettleRequest:T,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:ne({correlationId:a},this.getTVFApproveParams($))}}),E.addTrace(Ot.session_approve_publish_success)}catch(k){throw this.client.logger.error(k),this.client.session.delete(B,he("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(B),k}return this.client.core.eventClient.deleteEvent({eventId:E.eventId}),await this.client.core.pairing.updateMetadata({topic:w,metadata:m.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:w}),await this.setExpiry(B,we(xi)),{topic:B,acknowledged:()=>Promise.resolve(this.client.session.get(B))}}),F(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:s}=r;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}n&&await this.sendError({id:i,topic:n,error:s,rpcOpts:Ce.wc_sessionPropose.reject}),await this.deleteProposal(i)}),F(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:i,namespaces:s}=r,{done:n,resolve:o,reject:a}=Gr(M.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=Ft(),l=Rr().toString(),u=this.client.session.get(i).namespaces;return this.events.once(oe("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:u}),a(h)}),{acknowledged:n}}),F(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,s=Ft(),{done:n,resolve:o,reject:a}=Gr(M.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(oe("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,we(xi)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),F(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:i,request:s,topic:n,expiry:o=Ce.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(n);(a==null?void 0:a.transportType)===ue.relay&&await this.confirmOnlineStateOrThrow();const c=Ft(),l=Rr().toString(),{done:u,resolve:h,reject:f}=Gr(o,"Request expired. Please try again.");this.events.once(oe("session_request",c),({error:m,result:O})=>{m?f(m):h(O)});const d="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:d,params:{request:Te(ne({},s),{expiryTimestamp:we(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch(m=>f(m)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),await u();const w={request:Te(ne({},s),{expiryTimestamp:we(o)}),chainId:i};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:n,method:d,params:w,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,w)}).catch(O=>f(O)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),m()}),new Promise(async m=>{var O;if(!((O=a.sessionConfig)!=null&&O.disableDeepLink)){const C=await Nx(this.client.core.storage,Qh);await Cx({id:c,topic:n,wcDeepLink:C})}m()}),u()]).then(m=>m[2])}),F(this,"respond",async r=>{var i,s;this.isInitialized();const n=this.client.core.eventClient.createEvent({properties:{topic:(r==null?void 0:r.topic)||((s=(i=r==null?void 0:r.response)==null?void 0:i.id)==null?void 0:s.toString()),trace:[Ot.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw n.addTrace(h==null?void 0:h.message),n.setError(Hr.session_request_response_validation_failure),h}n.addTrace(Ot.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,l=this.client.session.get(o);l.transportType===ue.relay&&await this.confirmOnlineStateOrThrow();const u=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{n.addTrace(Ot.session_request_response_publish_started),Lt(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:u}):bt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:u}),this.cleanupAfterResponse(r)}catch(h){throw n.addTrace(h==null?void 0:h.message),n.setError(Hr.session_request_response_publish_failure),h}}),F(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=Ft(),n=Rr().toString(),{done:o,resolve:a,reject:c}=Gr(M.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(oe("session_ping",s),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),F(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:s,chainId:n}=r,o=Rr().toString(),a=Ft();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),F(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:he("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),F(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>Q_(i,r)))),F(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),F(this,"authenticate",async(r,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?ue.link_mode:ue.relay;o===ue.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:f,exp:d,nbf:g,methods:w=[],expiry:m}=r,O=[...r.resources||[]],{topic:C,uri:E}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:C,uri:E}});const I=await this.client.core.crypto.generateKeyPair(),A=fn(I);if(await Promise.all([this.client.auth.authKeys.set(yn,{responseTopic:A,publicKey:I}),this.client.auth.pairingTopics.set(A,{topic:A,pairingTopic:C})]),await this.client.core.relayer.subscribe(A,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${C}`),w.length>0){const{namespace:v}=ur(a[0]);let x=Q3(v,"request",w);hn(O)&&(x=tI(x,O.pop())),O.push(x)}const B=m&&m>Ce.wc_sessionAuthenticate.req.ttl?m:Ce.wc_sessionAuthenticate.req.ttl,T={authPayload:{type:f??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:d,nbf:g,resources:O},requester:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:we(B)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...w])],events:["chainChanged","accountsChanged"]}},$={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:C,proposer:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:we(Ce.wc_sessionPropose.req.ttl),id:Ft()},{done:k,resolve:j,reject:P}=Gr(B,"Request expired"),_=Ft(),D=oe("session_connect",$.id),p=oe("session_request",_),y=async({error:v,session:x})=>{this.events.off(p,b),v?P(v):x&&j({session:x})},b=async v=>{var x,N,U;if(await this.deletePendingAuthRequest(_,{message:"fulfilled",code:0}),v.error){const W=he("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return v.error.code===W.code?void 0:(this.events.off(D,y),P(v.error.message))}await this.deleteProposal($.id),this.events.off(D,y);const{cacaos:V,responder:L}=v.result,q=[],K=[];for(const W of V){await Uu({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),P(he("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Q}=W,de=hn(Q.resources),be=[Ca(Q.iss)],xe=An(Q.iss);if(de){const Ve=ku(de),Gt=ju(de);q.push(...Ve),be.push(...Gt)}for(const Ve of be)K.push(`${Ve}:${xe}`)}const G=await this.client.core.crypto.generateSharedKey(I,L.publicKey);let X;q.length>0&&(X={topic:G,acknowledged:!0,self:{publicKey:I,metadata:this.client.metadata},peer:L,controller:L.publicKey,expiry:we(xi),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:C,namespaces:uh([...new Set(q)],[...new Set(K)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,X),C&&await this.client.core.pairing.updateMetadata({topic:C,metadata:L.metadata}),X=this.client.session.get(G)),(x=this.client.metadata.redirect)!=null&&x.linkMode&&(N=L.metadata.redirect)!=null&&N.linkMode&&(U=L.metadata.redirect)!=null&&U.universal&&i&&(this.client.core.addLinkModeSupportedApp(L.metadata.redirect.universal),this.client.session.update(G,{transportType:ue.link_mode})),j({auths:V,session:X})};this.events.once(D,y),this.events.once(p,b);let S;try{if(n){const v=Pt("wc_sessionAuthenticate",T,_);this.client.core.history.set(C,v);const x=await this.client.core.crypto.encode("",v,{type:Ns,encoding:Cr});S=en(i,C,x)}else await Promise.all([this.sendRequest({topic:C,method:"wc_sessionAuthenticate",params:T,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:_}),this.sendRequest({topic:C,method:"wc_sessionPropose",params:$,expiry:Ce.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:$.id})])}catch(v){throw this.events.off(D,y),this.events.off(p,b),v}return await this.setProposal($.id,$),await this.setAuthRequest(_,{request:Te(ne({},T),{verifyContext:{}}),pairingTopic:C,transportType:o}),{uri:S??E,response:k}}),F(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:s}=r,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Kr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw n.setError(es.no_internet_connection),m}const o=this.getPendingAuthRequest(i);if(!o)throw n.setError(es.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||ue.relay;a===ue.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=fn(c),h={type:hr,receiverPublicKey:c,senderPublicKey:l},f=[],d=[];for(const m of s){if(!await Uu({cacao:m,projectId:this.client.core.projectId})){n.setError(es.invalid_cacao);const A=he("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:u,error:A,encodeOpts:h}),new Error(A.message)}n.addTrace(Kr.cacaos_verified);const{p:O}=m,C=hn(O.resources),E=[Ca(O.iss)],I=An(O.iss);if(C){const A=ku(C),B=ju(C);f.push(...A),E.push(...B)}for(const A of E)d.push(`${A}:${I}`)}const g=await this.client.core.crypto.generateSharedKey(l,c);n.addTrace(Kr.create_authenticated_session_topic);let w;if((f==null?void 0:f.length)>0){w={topic:g,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:we(xi),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:uh([...new Set(f)],[...new Set(d)]),transportType:a},n.addTrace(Kr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(m){throw n.setError(es.subscribe_authenticated_session_topic_failure),m}n.addTrace(Kr.subscribe_authenticated_session_topic_success),await this.client.session.set(g,w),n.addTrace(Kr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Kr.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:i,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw n.setError(es.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:w}}),F(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:s}=r,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===ue.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=fn(o),l={type:hr,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:s,encodeOpts:l,rpcOpts:Ce.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),F(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:s}=r;return Kp(i,s)}),F(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),F(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),F(this,"deleteSession",async r=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,he("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Qh).catch(l=>this.client.logger.warn(l)),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=kt.idle),await Promise.all(this.getPendingSessionRequests().filter(l=>l.topic===s).map(l=>this.deletePendingSessionRequest(l.id,he("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),F(this,"deleteProposal",async(r,i)=>{if(i)try{const s=this.client.proposal.get(r),n=this.client.core.eventClient.getEvent({topic:s.pairingTopic});n==null||n.setError(Hr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,he("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),F(this,"deletePendingSessionRequest",async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==r),s&&(this.sessionRequestQueue.state=kt.idle,this.client.events.emit("session_request_expire",{id:r}))}),F(this,"deletePendingAuthRequest",async(r,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])}),F(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),F(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,we(Ce.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),F(this,"setAuthRequest",async(r,i)=>{const{request:s,pairingTopic:n,transportType:o=ue.relay}=i;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),F(this,"setPendingSessionRequest",async r=>{const{id:i,topic:s,params:n,verifyContext:o}=r,a=n.request.expiryTimestamp||we(Ce.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:o})}),F(this,"sendRequest",async r=>{const{topic:i,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:f={}}=r,d=Pt(s,n,c);let g;const w=!!u;try{const C=w?Cr:et;g=await this.client.core.crypto.encode(i,d,{encoding:C})}catch(C){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),C}let m;if(VA.includes(s)){const C=mt(JSON.stringify(d)),E=mt(g);m=await this.client.core.verify.register({id:E,decryptedId:C})}const O=ne(ne({},Ce[s].req),f);if(O.attestation=m,o&&(O.ttl=o),a&&(O.id=a),this.client.core.history.set(i,d),w){const C=en(u,i,g);await global.Linking.openURL(C,this.client.name)}else O.tvf=Te(ne({},h),{correlationId:d.id}),l?(O.internal=Te(ne({},O.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,g,O)):this.client.core.relayer.publish(i,g,O).catch(C=>this.client.logger.error(C));return d.id}),F(this,"sendProposeSession",async r=>{const{proposal:i,publishOpts:s}=r,n=Pt("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,n);const o=await this.client.core.crypto.encode(i.pairingTopic,n,{encoding:et}),a=mt(JSON.stringify(n)),c=mt(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:o},opts:Te(ne({},s),{publishMethod:"wc_proposeSession",attestation:l})})}),F(this,"sendApproveSession",async r=>{const{sessionTopic:i,pairingProposalResponse:s,proposal:n,sessionSettleRequest:o,publishOpts:a}=r,c=Is(n.id,s),l=await this.client.core.crypto.encode(n.pairingTopic,c,{encoding:et}),u=Pt("wc_sessionSettle",o,a==null?void 0:a.id),h=await this.client.core.crypto.encode(i,u,{encoding:et});this.client.core.history.set(i,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:n.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:Te(ne({},a),{publishMethod:"wc_approveSession"})})}),F(this,"sendResult",async r=>{const{id:i,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,l=Is(i,n);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const g=h?Cr:et;u=await this.client.core.crypto.encode(s,l,Te(ne({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),g}let f,d;try{f=await this.client.core.history.get(s,i);const g=f.request;try{d=this.getTVFParams(i,g.params,n)}catch(w){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${w==null?void 0:w.message}`)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),g}if(h){const g=en(c,s,u);await global.Linking.openURL(g,this.client.name)}else{const g=f.request.method,w=Ce[g].res;w.tvf=Te(ne({},d),{correlationId:i}),o?(w.internal=Te(ne({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,w)):this.client.core.relayer.publish(s,u,w).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),F(this,"sendError",async r=>{const{id:i,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=r,l=io(i,n);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?Cr:et;u=await this.client.core.crypto.encode(s,l,Te(ne({},o||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),d}let f;try{f=await this.client.core.history.get(s,i)}catch(d){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),d}if(h){const d=en(c,s,u);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,g=a||Ce[d].res;this.client.core.relayer.publish(s,u,g)}await this.client.core.history.resolve(l)}),F(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;qt(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{qt(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),F(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),F(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),F(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===kt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=kt.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=kt.idle}),F(this,"processRequest",async r=>{const{topic:i,payload:s,attestation:n,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),F(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s,transportType:n}=r,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),F(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:s}=z("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),F(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:s}=r,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),F(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:s,attestation:n,encryptedId:o}=r,{params:a,id:c}=s;try{const l=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(ir.proposal_listener_not_found)),this.isValidConnect(ne({},s.params));const u=a.expiryTimestamp||we(Ce.wc_sessionPropose.req.ttl),h=ne({id:c,pairingTopic:i,expiryTimestamp:u,attestation:n,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:n,hash:mt(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});l==null||l.addTrace(jt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(l){await this.sendError({id:c,topic:i,error:l,rpcOpts:Ce.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),F(this,"onSessionProposeResponse",async(r,i,s)=>{const{id:n}=i;if(Lt(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(n,{sessionTopic:u,pairingTopic:r,proposalId:n,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(bt(i)){await this.deleteProposal(n);const o=oe("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),F(this,"onSessionSettleRequest",async(r,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:d}=i.params,g=[...this.pendingSessions.values()].find(O=>O.sessionTopic===r);if(!g)return this.client.logger.error(`Pending session not found for topic ${r}`);const w=this.client.proposal.get(g.proposalId),m=Te(ne(ne(ne({topic:r,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:g.pairingTopic,requiredNamespaces:w.requiredNamespaces,optionalNamespaces:w.optionalNamespaces,controller:a.publicKey,self:{publicKey:g.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:ue.relay,authentication:d==null?void 0:d.authentication,walletPayResult:d==null?void 0:d.walletPay});await this.client.session.set(m.topic,m),await this.setExpiry(m.topic,m.expiry),await this.client.core.pairing.updateMetadata({topic:g.pairingTopic,metadata:m.peer.metadata}),this.pendingSessions.delete(g.proposalId),this.deleteProposal(g.proposalId,!1),this.cleanupDuplicatePairings(m),await this.sendResult({id:i.id,topic:r,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:m}),this.events.emit(oe("session_connect",g.proposalId),{session:m})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionSettleResponse",async(r,i)=>{const{id:s}=i;Lt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(oe("session_approve",s),{})):bt(i)&&(await this.client.session.delete(r,he("USER_DISCONNECTED")),this.events.emit(oe("session_approve",s),{error:i.error}))}),F(this,"onSessionUpdateRequest",async(r,i)=>{const{params:s,id:n}=i;try{const o=`${r}_session_update`,a=Xi.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:r,error:he("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ne({topic:r},s));try{Xi.set(o,n),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:r,result:!0})}catch(c){throw Xi.delete(o),c}this.client.events.emit("session_update",{id:n,topic:r,params:s})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),F(this,"onSessionUpdateResponse",(r,i)=>{const{id:s}=i,n=oe("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Lt(i)?this.events.emit(oe("session_update",s),{}):bt(i)&&this.events.emit(oe("session_update",s),{error:i.error})}),F(this,"onSessionExtendRequest",async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,we(xi)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),F(this,"onSessionExtendResponse",(r,i)=>{const{id:s}=i,n=oe("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Lt(i)?this.events.emit(oe("session_extend",s),{}):bt(i)&&this.events.emit(oe("session_extend",s),{error:i.error})}),F(this,"onSessionPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),F(this,"onSessionPingResponse",(r,i)=>{const{id:s}=i,n=oe("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);Lt(i)?this.events.emit(oe("session_ping",s),{}):bt(i)&&this.events.emit(oe("session_ping",s),{error:i.error})},500)}),F(this,"onSessionDeleteRequest",async(r,i)=>{const{id:s}=i;try{await this.isValidDisconnect({topic:r,reason:i.params}),this.cleanupPendingSentRequestsForTopic({topic:r,error:he("USER_DISCONNECTED")}),await this.deleteSession({topic:r,id:s})}catch(n){this.client.logger.error(n)}}),F(this,"onSessionRequest",async r=>{var i,s,n;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=r,{id:h,params:f}=a;try{await this.isValidRequest(ne({topic:o},f));const d=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:mt(JSON.stringify(Pt("wc_sessionRequest",f,h))),encryptedId:l,metadata:d.peer.metadata,transportType:u}),w={id:h,topic:o,params:f,verifyContext:g};await this.setPendingSessionRequest(w),u===ue.link_mode&&(i=d.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=d.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(w):(this.addSessionRequestToSessionRequestQueue(w),this.processSessionRequestQueue())}catch(d){await this.sendError({id:h,topic:o,error:d}),this.client.logger.error(d)}}),F(this,"onSessionRequestResponse",(r,i)=>{const{id:s}=i,n=oe("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Lt(i)?this.events.emit(oe("session_request",s),{result:i.result}):bt(i)&&this.events.emit(oe("session_request",s),{error:i.error})}),F(this,"onSessionEventRequest",async(r,i)=>{const{id:s,params:n}=i;try{const o=`${r}_session_event_${n.event.name}`,a=Xi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(ne({topic:r},n)),this.client.events.emit("session_event",{id:s,topic:r,params:n}),Xi.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),F(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),Lt(i)?this.events.emit(oe("session_request",s),{result:i.result}):bt(i)&&this.events.emit(oe("session_request",s),{error:i.error})}),F(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:l,authPayload:u,expiryTimestamp:h}=n.params,f=await this.getVerifyContext({attestationId:o,hash:mt(JSON.stringify(n)),encryptedId:a,metadata:l.metadata,transportType:c}),d={requester:l,pairingTopic:s,id:n.id,authPayload:u,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(n.id,{request:d,pairingTopic:s,transportType:c}),c===ue.link_mode&&(i=l.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:f})}catch(l){this.client.logger.error(l);const u=n.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(n.params.requester.metadata,c),d={type:hr,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:n.id,topic:s,error:l,encodeOpts:d,rpcOpts:Ce.wc_sessionAuthenticate.autoReject,appLink:f})}}),F(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),F(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=kt.idle,this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay))}),F(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===r&&n.request.method==="wc_sessionRequest").forEach(n=>{this.events.emit(oe("session_request",n.request.id),{error:i})})}),F(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===kt.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),F(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=kt.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),F(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:Pt("wc_sessionPropose",Te(ne({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),F(this,"isValidConnect",async r=>{if(!Je(r)){const{message:l}=z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=r;if(De(i)||await this.isValidPairingTopic(i),!hS(c)){const{message:l}=z("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(s&&!De(s)&&Kt(s)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(n&&!De(n)&&Kt(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),o&&!De(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!De(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),F(this,"validateNamespaces",(r,i)=>{const s=uS(r,"connect()",i);if(s)throw new Error(s.message)}),F(this,"isValidApprove",async r=>{if(!Je(r))throw new Error(z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),l=Go(s,"approve()");if(l)throw new Error(l.message);const u=dh(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!me(n,!0)){const{message:h}=z("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(h)}if(o&&!De(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!De(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),F(this,"isValidReject",async r=>{if(!Je(r)){const{message:n}=z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(n)}const{id:i,reason:s}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!dS(s)){const{message:n}=z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),F(this,"isValidSessionSettleRequest",r=>{if(!Je(r)){const{message:l}=z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:s,namespaces:n,expiry:o}=r;if(!Pg(i)){const{message:l}=z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=sS(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Go(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(qt(o)){const{message:l}=z("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),F(this,"isValidUpdate",async r=>{if(!Je(r)){const{message:c}=z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:s}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),o=Go(s,"update()");if(o)throw new Error(o.message);const a=dh(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),F(this,"isValidExtend",async r=>{if(!Je(r)){const{message:s}=z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),F(this,"isValidRequest",async r=>{if(!Je(r)){const{message:c}=z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:s,chainId:n,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!fh(a,n)){const{message:c}=z("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!pS(s)){const{message:c}=z("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!wS(a,n,s.method)){const{message:c}=z("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),F(this,"isValidRespond",async r=>{var i;if(!Je(r)){const{message:a}=z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:s,response:n}=r;try{await this.isValidSessionTopic(s)}catch(a){throw(i=r==null?void 0:r.response)!=null&&i.id&&this.cleanupAfterResponse(r),a}if(!gS(n)){const{message:a}=z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(a)}const o=this.client.pendingRequest.get(n.id);if(o.topic!==s){const{message:a}=z("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${n.id}, expected topic: ${o.topic}, received topic: ${s}`);throw new Error(a)}}),F(this,"isValidPing",async r=>{if(!Je(r)){const{message:s}=z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),F(this,"isValidEmit",async r=>{if(!Je(r)){const{message:a}=z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:s,chainId:n}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!fh(o,n)){const{message:a}=z("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!yS(s)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!mS(o,n,s.name)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),F(this,"isValidDisconnect",async r=>{if(!Je(r)){const{message:s}=z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),F(this,"isValidAuthenticate",r=>{const{chains:i,uri:s,domain:n,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!me(s,!1))throw new Error("uri is required parameter");if(!me(n,!1))throw new Error("domain is required parameter");if(!me(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>ur(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=ur(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),F(this,"getVerifyContext",async r=>{const{attestationId:i,hash:s,encryptedId:n,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||ds,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ue.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),F(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((s,n)=>{if(s==null){const{message:o}=z("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[n]}`);throw new Error(o)}})}),F(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),F(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),F(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:s}=z("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(s)}}),F(this,"isLinkModeEnabled",(r,i)=>{var s,n,o,a,c,l,u,h,f;return!r||i!==ue.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=r==null?void 0:r.redirect)==null?void 0:u.universal)!==void 0&&((h=r==null?void 0:r.redirect)==null?void 0:h.universal)!==""&&((f=r==null?void 0:r.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),F(this,"getAppLinkIfEnabled",(r,i)=>{var s;return this.isLinkModeEnabled(r,i)?(s=r==null?void 0:r.redirect)==null?void 0:s.universal:void 0}),F(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=_u(r,"topic")||"",s=decodeURIComponent(_u(r,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:ue.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),F(this,"registerLinkModeListeners",async()=>{var r;if(Rc()||Lr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),F(this,"getTVFApproveParams",r=>{try{const i=$g(r.namespaces),s=H_(r.namespaces),n=K_(r.namespaces),o=r.sessionProperties,a=r.scopedProperties;return{approvedChains:i,approvedMethods:s,approvedEvents:n,sessionProperties:o,scopedProperties:a}}catch(i){return this.client.logger.warn(i,"Error getting TVF approve params"),{}}}),F(this,"getTVFParams",(r,i,s)=>{var n,o,a;if(!((n=i.request)!=null&&n.method))return{};const c={correlationId:r,rpcMethods:[i.request.method],chainId:i.chainId};try{const l=this.extractTxHashesFromResult(i.request,s);c.txHashes=l,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),F(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const s=(r==null?void 0:r.data)||((i=r==null?void 0:r[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),F(this,"extractTxHashesFromResult",(r,i)=>{var s;try{if(!i)return[];const n=r.method,o=qA[n];if(n==="sui_signTransaction")return[R3(i.transactionBytes)];if(n==="near_signTransaction")return[Cu(i)];if(n==="near_signTransactions")return i.map(c=>Cu(c));if(n==="xrpl_signTransactionFor"||n==="xrpl_signTransaction")return[(s=i.tx_json)==null?void 0:s.hash];if(n==="polkadot_signTransaction")return[US({transaction:r.params.transactionPayload,signature:i.signature})];if(n==="algo_signTxn")return Et(i)?i.map(c=>Tu(c)):[Tu(i)];if(n==="cosmos_signDirect")return[U3(i)];if(n==="wallet_sendCalls")return k3(i);if(typeof i=="string")return[i];const a=i[o.key];if(Et(a))return n==="solana_signAllTransactions"?a.map(c=>T3(c)):a;if(typeof a=="string")return[a]}catch(n){this.client.logger.warn(n,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,s]of Object.entries(r))for(const n of s)try{await this.onProviderMessageEvent({topic:i,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${n}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(pe.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(yn)?this.client.auth.authKeys.get(yn):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:n===ue.link_mode?Cr:et});Wc(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:n,encryptedId:mt(i)})):so(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:n}),this.client.core.history.delete(r,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:n})),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${i}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(yt.expired,async e=>{const{topic:r,id:i}=Ap(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,z("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Jr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Jr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!me(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(qt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=z("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!me(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(qt(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=z("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(me(e,!1)){const{message:r}=z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!fS(e)){const{message:r}=z("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(qt(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=z("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}validateRequestExpiry(e){if(e&&!ES(e,ta)){const{message:r}=z("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${ta.min} and ${ta.max}`);throw new Error(r)}}}class r6 extends pi{constructor(e,r){super(e,r,FA,Yc),this.core=e,this.logger=r}}let i6=class extends pi{constructor(e,r){super(e,r,LA,Yc),this.core=e,this.logger=r}};class s6 extends pi{constructor(e,r){super(e,r,zA,Yc,i=>i.id),this.core=e,this.logger=r}}class n6 extends pi{constructor(e,r){super(e,r,WA,oo,()=>yn),this.core=e,this.logger=r}}class o6 extends pi{constructor(e,r){super(e,r,GA,oo),this.core=e,this.logger=r}}class a6 extends pi{constructor(e,r){super(e,r,YA,oo,i=>i.id),this.core=e,this.logger=r}}var c6=Object.defineProperty,l6=(t,e,r)=>e in t?c6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ra=(t,e,r)=>l6(t,typeof e!="symbol"?e+"":e,r);class u6{constructor(e,r){this.core=e,this.logger=r,ra(this,"authKeys"),ra(this,"pairingTopics"),ra(this,"requests"),this.authKeys=new n6(this.core,this.logger),this.pairingTopics=new o6(this.core,this.logger),this.requests=new a6(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var h6=Object.defineProperty,f6=(t,e,r)=>e in t?h6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,re=(t,e,r)=>f6(t,typeof e!="symbol"?e+"":e,r);class Zc extends C8{constructor(e){super(e),re(this,"protocol",ty),re(this,"version",ry),re(this,"name",ea.name),re(this,"metadata"),re(this,"core"),re(this,"logger"),re(this,"events",new It.EventEmitter),re(this,"engine"),re(this,"session"),re(this,"proposal"),re(this,"pendingRequest"),re(this,"auth"),re(this,"signConfig"),re(this,"on",(i,s)=>this.events.on(i,s)),re(this,"once",(i,s)=>this.events.once(i,s)),re(this,"off",(i,s)=>this.events.off(i,s)),re(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),re(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),re(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),re(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),re(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),re(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||ea.name,this.metadata=Ox(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const r=Hc({logger:(e==null?void 0:e.logger)||ea.logger,name:this.name});this.logger=r,this.core=(e==null?void 0:e.core)||new jA(e),this.session=new i6(this.core,this.logger),this.proposal=new r6(this.core,this.logger),this.pendingRequest=new s6(this.core,this.logger),this.engine=new t6(this),this.auth=new u6(this.core,this.logger)}static async init(e){const r=new Zc(e);return await r.initialize(),r}get context(){return st(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const d6=Zc;var ic={exports:{}};(function(t,e){var r=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof Mt<"u"&&Mt,i=function(){function n(){this.fetch=!1,this.DOMException=r.DOMException}return n.prototype=r,new n}();(function(n){(function(o){var a=typeof n<"u"&&n||typeof self<"u"&&self||typeof Mt<"u"&&Mt||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(p){return p&&DataView.prototype.isPrototypeOf(p)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(p){return p&&u.indexOf(Object.prototype.toString.call(p))>-1};function f(p){if(typeof p!="string"&&(p=String(p)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(p)||p==="")throw new TypeError('Invalid character in header field name: "'+p+'"');return p.toLowerCase()}function d(p){return typeof p!="string"&&(p=String(p)),p}function g(p){var y={next:function(){var b=p.shift();return{done:b===void 0,value:b}}};return c.iterable&&(y[Symbol.iterator]=function(){return y}),y}function w(p){this.map={},p instanceof w?p.forEach(function(y,b){this.append(b,y)},this):Array.isArray(p)?p.forEach(function(y){if(y.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+y.length);this.append(y[0],y[1])},this):p&&Object.getOwnPropertyNames(p).forEach(function(y){this.append(y,p[y])},this)}w.prototype.append=function(p,y){p=f(p),y=d(y);var b=this.map[p];this.map[p]=b?b+", "+y:y},w.prototype.delete=function(p){delete this.map[f(p)]},w.prototype.get=function(p){return p=f(p),this.has(p)?this.map[p]:null},w.prototype.has=function(p){return this.map.hasOwnProperty(f(p))},w.prototype.set=function(p,y){this.map[f(p)]=d(y)},w.prototype.forEach=function(p,y){for(var b in this.map)this.map.hasOwnProperty(b)&&p.call(y,this.map[b],b,this)},w.prototype.keys=function(){var p=[];return this.forEach(function(y,b){p.push(b)}),g(p)},w.prototype.values=function(){var p=[];return this.forEach(function(y){p.push(y)}),g(p)},w.prototype.entries=function(){var p=[];return this.forEach(function(y,b){p.push([b,y])}),g(p)},c.iterable&&(w.prototype[Symbol.iterator]=w.prototype.entries);function m(p){if(!p._noBody){if(p.bodyUsed)return Promise.reject(new TypeError("Already read"));p.bodyUsed=!0}}function O(p){return new Promise(function(y,b){p.onload=function(){y(p.result)},p.onerror=function(){b(p.error)}})}function C(p){var y=new FileReader,b=O(y);return y.readAsArrayBuffer(p),b}function E(p){var y=new FileReader,b=O(y),S=/charset=([A-Za-z0-9_-]+)/.exec(p.type),v=S?S[1]:"utf-8";return y.readAsText(p,v),b}function I(p){for(var y=new Uint8Array(p),b=new Array(y.length),S=0;S<y.length;S++)b[S]=String.fromCharCode(y[S]);return b.join("")}function A(p){if(p.slice)return p.slice(0);var y=new Uint8Array(p.byteLength);return y.set(new Uint8Array(p)),y.buffer}function B(){return this.bodyUsed=!1,this._initBody=function(p){this.bodyUsed=this.bodyUsed,this._bodyInit=p,p?typeof p=="string"?this._bodyText=p:c.blob&&Blob.prototype.isPrototypeOf(p)?this._bodyBlob=p:c.formData&&FormData.prototype.isPrototypeOf(p)?this._bodyFormData=p:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(p)?this._bodyText=p.toString():c.arrayBuffer&&c.blob&&l(p)?(this._bodyArrayBuffer=A(p.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(p)||h(p))?this._bodyArrayBuffer=A(p):this._bodyText=p=Object.prototype.toString.call(p):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof p=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(p)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var p=m(this);if(p)return p;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var p=m(this);return p||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(C);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var p=m(this);if(p)return p;if(this._bodyBlob)return E(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(I(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}var T=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function R(p){var y=p.toUpperCase();return T.indexOf(y)>-1?y:p}function $(p,y){if(!(this instanceof $))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');y=y||{};var b=y.body;if(p instanceof $){if(p.bodyUsed)throw new TypeError("Already read");this.url=p.url,this.credentials=p.credentials,y.headers||(this.headers=new w(p.headers)),this.method=p.method,this.mode=p.mode,this.signal=p.signal,!b&&p._bodyInit!=null&&(b=p._bodyInit,p.bodyUsed=!0)}else this.url=String(p);if(this.credentials=y.credentials||this.credentials||"same-origin",(y.headers||!this.headers)&&(this.headers=new w(y.headers)),this.method=R(y.method||this.method||"GET"),this.mode=y.mode||this.mode||null,this.signal=y.signal||this.signal||function(){if("AbortController"in a){var x=new AbortController;return x.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&b)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(b),(this.method==="GET"||this.method==="HEAD")&&(y.cache==="no-store"||y.cache==="no-cache")){var S=/([?&])_=[^&]*/;if(S.test(this.url))this.url=this.url.replace(S,"$1_="+new Date().getTime());else{var v=/\?/;this.url+=(v.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}$.prototype.clone=function(){return new $(this,{body:this._bodyInit})};function k(p){var y=new FormData;return p.trim().split("&").forEach(function(b){if(b){var S=b.split("="),v=S.shift().replace(/\+/g," "),x=S.join("=").replace(/\+/g," ");y.append(decodeURIComponent(v),decodeURIComponent(x))}}),y}function j(p){var y=new w,b=p.replace(/\r?\n[\t ]+/g," ");return b.split("\r").map(function(S){return S.indexOf(`
`)===0?S.substr(1,S.length):S}).forEach(function(S){var v=S.split(":"),x=v.shift().trim();if(x){var N=v.join(":").trim();try{y.append(x,N)}catch(U){console.warn("Response "+U.message)}}}),y}B.call($.prototype);function P(p,y){if(!(this instanceof P))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(y||(y={}),this.type="default",this.status=y.status===void 0?200:y.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=y.statusText===void 0?"":""+y.statusText,this.headers=new w(y.headers),this.url=y.url||"",this._initBody(p)}B.call(P.prototype),P.prototype.clone=function(){return new P(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new w(this.headers),url:this.url})},P.error=function(){var p=new P(null,{status:200,statusText:""});return p.ok=!1,p.status=0,p.type="error",p};var _=[301,302,303,307,308];P.redirect=function(p,y){if(_.indexOf(y)===-1)throw new RangeError("Invalid status code");return new P(null,{status:y,headers:{location:p}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(y,b){this.message=y,this.name=b;var S=Error(y);this.stack=S.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function D(p,y){return new Promise(function(b,S){var v=new $(p,y);if(v.signal&&v.signal.aborted)return S(new o.DOMException("Aborted","AbortError"));var x=new XMLHttpRequest;function N(){x.abort()}x.onload=function(){var L={statusText:x.statusText,headers:j(x.getAllResponseHeaders()||"")};v.url.indexOf("file://")===0&&(x.status<200||x.status>599)?L.status=200:L.status=x.status,L.url="responseURL"in x?x.responseURL:L.headers.get("X-Request-URL");var q="response"in x?x.response:x.responseText;setTimeout(function(){b(new P(q,L))},0)},x.onerror=function(){setTimeout(function(){S(new TypeError("Network request failed"))},0)},x.ontimeout=function(){setTimeout(function(){S(new TypeError("Network request timed out"))},0)},x.onabort=function(){setTimeout(function(){S(new o.DOMException("Aborted","AbortError"))},0)};function U(L){try{return L===""&&a.location.href?a.location.href:L}catch{return L}}if(x.open(v.method,U(v.url),!0),v.credentials==="include"?x.withCredentials=!0:v.credentials==="omit"&&(x.withCredentials=!1),"responseType"in x&&(c.blob?x.responseType="blob":c.arrayBuffer&&(x.responseType="arraybuffer")),y&&typeof y.headers=="object"&&!(y.headers instanceof w||a.Headers&&y.headers instanceof a.Headers)){var V=[];Object.getOwnPropertyNames(y.headers).forEach(function(L){V.push(f(L)),x.setRequestHeader(L,d(y.headers[L]))}),v.headers.forEach(function(L,q){V.indexOf(q)===-1&&x.setRequestHeader(q,L)})}else v.headers.forEach(function(L,q){x.setRequestHeader(q,L)});v.signal&&(v.signal.addEventListener("abort",N),x.onreadystatechange=function(){x.readyState===4&&v.signal.removeEventListener("abort",N)}),x.send(typeof v._bodyInit>"u"?null:v._bodyInit)})}return D.polyfill=!0,a.fetch||(a.fetch=D,a.Headers=w,a.Request=$,a.Response=P),o.Headers=w,o.Request=$,o.Response=P,o.fetch=D,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(i),i.fetch.ponyfill=!0,delete i.fetch.polyfill;var s=r.fetch?r:i;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,t.exports=e})(ic,ic.exports);var p6=ic.exports;const rf=Cy(p6);var g6=Object.defineProperty,y6=Object.defineProperties,w6=Object.getOwnPropertyDescriptors,sf=Object.getOwnPropertySymbols,m6=Object.prototype.hasOwnProperty,b6=Object.prototype.propertyIsEnumerable,nf=(t,e,r)=>e in t?g6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,of=(t,e)=>{for(var r in e||(e={}))m6.call(e,r)&&nf(t,r,e[r]);if(sf)for(var r of sf(e))b6.call(e,r)&&nf(t,r,e[r]);return t},af=(t,e)=>y6(t,w6(e));const v6={Accept:"application/json","Content-Type":"application/json"},E6="POST",cf={headers:v6,method:E6},lf=10;let sy=class{constructor(e,r=!1){if(this.url=e,this.disableProviderPing=r,this.events=new It.EventEmitter,this.isAvailable=!1,this.registering=!1,!Sh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const r=ai(e),i=await(await rf(this.url,af(of({},cf),{body:r}))).json();this.onPayload({data:i})}catch(r){this.onError(e.id,r)}}async register(e=this.url){if(!Sh(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));i()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const r=ai({id:1,jsonrpc:"2.0",method:"test",params:[]});await rf(e,af(of({},cf),{body:r}))}this.onOpen()}catch(r){const i=this.parseError(r);throw this.events.emit("register_error",i),this.onClose(),i}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?oi(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=io(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return Rg(e,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>lf&&this.events.setMaxListeners(lf)}};function x6(t){return Number.isSafeInteger(t)&&t>=0}function I6(t){return t!=null&&typeof t!="function"&&x6(t.length)}function _6(t){return t==="__proto__"}function Jc(t){return t==null||typeof t!="object"&&typeof t!="function"}function ny(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Xc(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const S6="[object RegExp]",oy="[object String]",ay="[object Number]",cy="[object Boolean]",ly="[object Arguments]",O6="[object Symbol]",D6="[object Date]",$6="[object Map]",A6="[object Set]",P6="[object Array]",B6="[object ArrayBuffer]",uy="[object Object]",C6="[object DataView]",T6="[object Uint8Array]",R6="[object Uint8ClampedArray]",N6="[object Uint16Array]",U6="[object Uint32Array]",k6="[object Int8Array]",j6="[object Int16Array]",F6="[object Int32Array]",L6="[object Float32Array]",M6="[object Float64Array]";function Qc(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function q6(t,e){return Di(t,void 0,t,new Map,e)}function Di(t,e,r,i=new Map,s=void 0){const n=s==null?void 0:s(t,e,r,i);if(n!==void 0)return n;if(Jc(t))return t;if(i.has(t))return i.get(t);if(Array.isArray(t)){const o=new Array(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=Di(t[a],a,r,i,s);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;i.set(t,o);for(const[a,c]of t)o.set(a,Di(c,a,r,i,s));return o}if(t instanceof Set){const o=new Set;i.set(t,o);for(const a of t)o.add(Di(a,void 0,r,i,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(Qc(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);i.set(t,o);for(let a=0;a<t.length;a++)o[a]=Di(t[a],a,r,i,s);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return i.set(t,o),At(o,t,r,i,s),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return i.set(t,o),At(o,t,r,i,s),o}if(typeof Blob<"u"&&t instanceof Blob){const o=new Blob([t],{type:t.type});return i.set(t,o),At(o,t,r,i,s),o}if(t instanceof Error){const o=new t.constructor;return i.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,At(o,t,r,i,s),o}if(t instanceof Boolean){const o=new Boolean(t.valueOf());return i.set(t,o),At(o,t,r,i,s),o}if(t instanceof Number){const o=new Number(t.valueOf());return i.set(t,o),At(o,t,r,i,s),o}if(t instanceof String){const o=new String(t.valueOf());return i.set(t,o),At(o,t,r,i,s),o}if(typeof t=="object"&&z6(t)){const o=Object.create(Object.getPrototypeOf(t));return i.set(t,o),At(o,t,r,i,s),o}return t}function At(t,e,r=t,i,s){const n=[...Object.keys(e),...ny(e)];for(let o=0;o<n.length;o++){const a=n[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=Di(e[a],a,r,i,s))}}function z6(t){switch(Xc(t)){case ly:case P6:case B6:case C6:case cy:case D6:case L6:case M6:case k6:case j6:case F6:case $6:case ay:case uy:case S6:case A6:case oy:case O6:case T6:case R6:case N6:case U6:return!0;default:return!1}}function V6(t,e){return q6(t,(r,i,s,n)=>{if(typeof t=="object"){if(Xc(t)===uy&&typeof t.constructor!="function"){const o={};return n.set(t,o),At(o,t,s,n),o}switch(Object.prototype.toString.call(t)){case ay:case oy:case cy:{const o=new t.constructor(t==null?void 0:t.valueOf());return At(o,t),o}case ly:{const o={};return At(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}}})}function uf(t){return V6(t)}function hf(t){return t!==null&&typeof t=="object"&&Xc(t)==="[object Arguments]"}function sc(t){return typeof t=="object"&&t!==null}function H6(t){return sc(t)&&I6(t)}function K6(){}function ia(t){return Qc(t)}function sa(t){var r;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const i=t[Symbol.toStringTag];return i==null||!((r=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&r.writable)?!1:t.toString()===`[object ${i}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function W6(t){if(Jc(t))return t;if(Array.isArray(t)||Qc(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t);if(e==null)return Object.assign(Object.create(e),t);const r=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new r(t);if(t instanceof RegExp){const i=new r(t);return i.lastIndex=t.lastIndex,i}if(t instanceof DataView)return new r(t.buffer.slice(0));if(t instanceof Error){let i;return t instanceof AggregateError?i=new r(t.errors,t.message,{cause:t.cause}):i=new r(t.message,{cause:t.cause}),i.stack=t.stack,Object.assign(i,t),i}if(typeof File<"u"&&t instanceof File)return new r([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const i=Object.create(e);return Object.assign(i,t)}return t}function G6(t,...e){const r=e.slice(0,-1),i=e[e.length-1];let s=t;for(let n=0;n<r.length;n++){const o=r[n];s=nc(s,o,i,new Map)}return s}function nc(t,e,r,i){if(Jc(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(i.has(e))return W6(i.get(e));if(i.set(e,t),Array.isArray(e)){e=e.slice();for(let n=0;n<e.length;n++)e[n]=e[n]??void 0}const s=[...Object.keys(e),...ny(e)];for(let n=0;n<s.length;n++){const o=s[n];if(_6(o))continue;let a=e[o],c=t[o];if(hf(a)&&(a={...a}),hf(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=uf(a)),Array.isArray(a))if(Array.isArray(c)){const u=[],h=Reflect.ownKeys(c);for(let f=0;f<h.length;f++){const d=h[f];u[d]=c[d]}c=u}else if(H6(c)){const u=[];for(let h=0;h<c.length;h++)u[h]=c[h];c=u}else c=[];const l=r(c,a,o,t,e,i);l!==void 0?t[o]=l:Array.isArray(a)||sc(c)&&sc(a)&&(sa(c)||sa(a)||ia(c)||ia(a))?t[o]=nc(c,a,r,i):c==null&&sa(a)?t[o]=nc({},a,r,i):c==null&&ia(a)?t[o]=uf(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function Y6(t,...e){return G6(t,...e,K6)}const ff="error",Z6="wss://relay.walletconnect.org",J6="wc",hy="universal_provider",sn=`${J6}@2:${hy}:`,fy="https://rpc.walletconnect.org/v1/",dy="generic",X6=`${fy}bundler`,Ci="call_status",Q6=86400,el={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var e4=Object.defineProperty,t4=Object.defineProperties,r4=Object.getOwnPropertyDescriptors,df=Object.getOwnPropertySymbols,i4=Object.prototype.hasOwnProperty,s4=Object.prototype.propertyIsEnumerable,pf=(t,e,r)=>e in t?e4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,nn=(t,e)=>{for(var r in e||(e={}))i4.call(e,r)&&pf(t,r,e[r]);if(df)for(var r of df(e))s4.call(e,r)&&pf(t,r,e[r]);return t},n4=(t,e)=>t4(t,r4(e));function py(t,e,r){var i;const s=ur(t);return((i=e.rpcMap)==null?void 0:i[s.reference])||`${fy}?chainId=${s.namespace}:${s.reference}&projectId=${r}`}function o4(t){return t.includes(":")?t.split(":")[1]:t}function gy(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function a4(t,e){const r=Object.keys(e.namespaces).filter(s=>s.includes(t));if(!r.length)return[];const i=[];return r.forEach(s=>{const n=e.namespaces[s].accounts;i.push(...n)}),i}function gf(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>{var i,s;return((i=r==null?void 0:r.chains)==null?void 0:i.length)&&((s=r==null?void 0:r.chains)==null?void 0:s.length)>0}))}function on(t={},e={}){const r=gf(yf(t)),i=gf(yf(e));return Y6(r,i)}function yf(t){var e,r,i,s,n;const o={};if(!Kt(t))return o;for(const[a,c]of Object.entries(t)){const l=ro(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],f=c.rpcMap||{},d=Oi(a);o[d]=n4(nn(nn({},o[d]),c),{chains:Ht(l,(e=o[d])==null?void 0:e.chains),methods:Ht(u,(r=o[d])==null?void 0:r.methods),events:Ht(h,(i=o[d])==null?void 0:i.events)}),(Kt(f)||Kt(((s=o[d])==null?void 0:s.rpcMap)||{}))&&(o[d].rpcMap=nn(nn({},f),(n=o[d])==null?void 0:n.rpcMap))}return o}function wf(t){return t.includes(":")?t.split(":")[2]:t}function mf(t){const e={};for(const[r,i]of Object.entries(t)){const s=i.methods||[],n=i.events||[],o=i.accounts||[],a=ro(r)?[r]:i.chains?i.chains:gy(i.accounts);e[r]={chains:a,methods:s,events:n,accounts:o}}return e}function na(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function c4(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const yy={},Ti=t=>yy[t],oa=(t,e)=>{yy[t]=e};var l4=Object.defineProperty,bf=Object.getOwnPropertySymbols,u4=Object.prototype.hasOwnProperty,h4=Object.prototype.propertyIsEnumerable,vf=(t,e,r)=>e in t?l4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ef=(t,e)=>{for(var r in e||(e={}))u4.call(e,r)&&vf(t,r,e[r]);if(bf)for(var r of bf(e))h4.call(e,r)&&vf(t,r,e[r]);return t};const xf="eip155",f4=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],d4=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,aa=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,If=t=>Object.keys(t).filter(e=>f4.includes(e)).reduce((e,r)=>(e[r]=p4(t[r]),e),{}),p4=t=>typeof t=="string"&&c4(t)?JSON.parse(t):t,g4=(t,e,r)=>{const{sessionProperties:i={},scopedProperties:s={}}=t,n={};if(!Kt(s)&&!Kt(i))return;const o=If(i);for(const a of r){const c=d4(a);if(!c)continue;n[aa(c)]=o;const l=s==null?void 0:s[`${xf}:${c}`];if(l){const u=l==null?void 0:l[`${xf}:${c}:${e}`];n[aa(c)]=Ef(Ef({},n[aa(c)]),If(u||l))}}for(const[a,c]of Object.entries(n))Object.keys(c).length===0&&delete n[a];return Object.keys(n).length>0?n:void 0};var y4=Object.defineProperty,w4=(t,e,r)=>e in t?y4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,m4=(t,e,r)=>w4(t,e+"",r);let ca,b4=class wy{constructor(e){m4(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,r){return await this.storage.setItem(e,r)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return ca||(ca=new wy(e)),ca}};var v4=Object.defineProperty,E4=Object.defineProperties,x4=Object.getOwnPropertyDescriptors,_f=Object.getOwnPropertySymbols,I4=Object.prototype.hasOwnProperty,_4=Object.prototype.propertyIsEnumerable,Sf=(t,e,r)=>e in t?v4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,S4=(t,e)=>{for(var r in e||(e={}))I4.call(e,r)&&Sf(t,r,e[r]);if(_f)for(var r of _f(e))_4.call(e,r)&&Sf(t,r,e[r]);return t},O4=(t,e)=>E4(t,x4(e));async function D4(t,e){const r=ur(t.result.capabilities.caip345.caip2),i=t.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(i.map(h=>$4(r.reference,h,e))),n=s.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);s.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));const o=!n.length||n.some(h=>!h),a=n.every(h=>(h==null?void 0:h.status)==="0x1"),c=n.every(h=>(h==null?void 0:h.status)==="0x0"),l=n.some(h=>(h==null?void 0:h.status)==="0x0");let u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:n,status:u}}async function $4(t,e,r){return await r(parseInt(t)).request(Pt("eth_getTransactionReceipt",[e]))}async function A4({sendCalls:t,storage:e}){const r=await e.getItem(Ci);await e.setItem(Ci,O4(S4({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:we(Q6)}}))}async function P4({resultId:t,storage:e}){const r=await e.getItem(Ci);if(r){delete r[t],await e.setItem(Ci,r);for(const i in r)qt(r[i].expiry)&&delete r[i];await e.setItem(Ci,r)}}async function B4({resultId:t,storage:e}){const r=await e.getItem(Ci),i=r==null?void 0:r[t];if(i&&!qt(i.expiry))return i;await P4({resultId:t,storage:e})}var C4=Object.defineProperty,T4=Object.defineProperties,R4=Object.getOwnPropertyDescriptors,Of=Object.getOwnPropertySymbols,N4=Object.prototype.hasOwnProperty,U4=Object.prototype.propertyIsEnumerable,oc=(t,e,r)=>e in t?C4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,la=(t,e)=>{for(var r in e||(e={}))N4.call(e,r)&&oc(t,r,e[r]);if(Of)for(var r of Of(e))U4.call(e,r)&&oc(t,r,e[r]);return t},ua=(t,e)=>T4(t,R4(e)),Wr=(t,e,r)=>oc(t,typeof e!="symbol"?e+"":e,r);class k4{constructor(e){Wr(this,"name","eip155"),Wr(this,"client"),Wr(this,"chainId"),Wr(this,"namespace"),Wr(this,"httpProviders"),Wr(this,"events"),Wr(this,"storage"),this.namespace=e.namespace,this.events=Ti("events"),this.client=Ti("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=b4.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(parseInt(e),r);const i=this.chainId;this.chainId=parseInt(e),this.events.emit(el.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,r){const i=r||py(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Gc(new sy(i,Ti("disableProviderPing")))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{var i;const s=parseInt(o4(r));e[s]=this.createHttpProvider(s,(i=this.namespace.rpcMap)==null?void 0:i[r])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(e){const r=e||this.chainId;return this.httpProviders[r]||(this.httpProviders=ua(la({},this.httpProviders),{[r]:this.createHttpProvider(r)}),this.httpProviders[r])}async handleSwitchChain(e){var r,i;let s=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const n=parseInt(s,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(i=this.namespace.chains)==null?void 0:i[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var r,i,s,n,o;const a=(i=(r=e.request)==null?void 0:r.params)==null?void 0:i[0],c=((n=(s=e.request)==null?void 0:s.params)==null?void 0:n[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),u=((o=l==null?void 0:l.sessionProperties)==null?void 0:o.capabilities)||{},h=c.length>0?c.join(","):`0x${this.chainId.toString(16)}`,f=`${a}${h}`,d=u==null?void 0:u[f];if(d)return d;let g;try{g=g4(l,a,c)}catch(m){console.warn("Failed to extract capabilities from session",m)}if(g)return g;const w=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:ua(la({},l.sessionProperties||{}),{capabilities:ua(la({},u||{}),{[f]:w})})})}catch(m){console.warn("Failed to update session with capabilities",m)}return w}async getCallStatus(e){var r,i,s;const n=this.client.session.get(e.topic),o=(r=n.sessionProperties)==null?void 0:r.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}const a=(i=n.sessionProperties)==null?void 0:i.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await B4({resultId:(s=e.request.params)==null?void 0:s[0],storage:this.storage});if(c)try{return await D4(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,r){var i;const s=new URL(e),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Pt("eth_getUserOperationReceipt",[(i=r.request.params)==null?void 0:i[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,r){return`${X6}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${r}`}async sendCalls(e){var r,i,s;const n=await this.client.request(e),o=(r=e.request.params)==null?void 0:r[0],a=n==null?void 0:n.id,c=(n==null?void 0:n.capabilities)||{},l=(i=c==null?void 0:c.caip345)==null?void 0:i.caip2,u=(s=c==null?void 0:c.caip345)==null?void 0:s.transactionHashes;return!a||!l||!(u!=null&&u.length)||await A4({sendCalls:{request:o,result:n},storage:this.storage}),n}}var j4=Object.defineProperty,F4=(t,e,r)=>e in t?j4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ii=(t,e,r)=>F4(t,typeof e!="symbol"?e+"":e,r);class L4{constructor(e){Ii(this,"name",dy),Ii(this,"client"),Ii(this,"httpProviders"),Ii(this,"events"),Ii(this,"namespace"),Ii(this,"chainId"),this.namespace=e.namespace,this.events=Ti("events"),this.client=Ti("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,r){this.httpProviders[e]||this.setHttpProvider(e,r);const i=this.chainId;this.chainId=e,this.events.emit(el.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${i}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return ur(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){var e,r;const i={};return(r=(e=this.namespace)==null?void 0:e.accounts)==null||r.forEach(s=>{var n,o;const a=ur(s),c=(o=(n=this.namespace)==null?void 0:n.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];i[a.reference]=this.createHttpProvider(s,c)}),i}getHttpProvider(e){const r=ur(e).reference,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return i}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||py(e,this.namespace,this.client.core.projectId);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);return new Gc(new sy(i,Ti("disableProviderPing")))}}var M4=Object.defineProperty,q4=Object.defineProperties,z4=Object.getOwnPropertyDescriptors,Df=Object.getOwnPropertySymbols,V4=Object.prototype.hasOwnProperty,H4=Object.prototype.propertyIsEnumerable,ac=(t,e,r)=>e in t?M4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,is=(t,e)=>{for(var r in e||(e={}))V4.call(e,r)&&ac(t,r,e[r]);if(Df)for(var r of Df(e))H4.call(e,r)&&ac(t,r,e[r]);return t},an=(t,e)=>q4(t,z4(e)),ot=(t,e,r)=>ac(t,typeof e!="symbol"?e+"":e,r);let K4=class my{constructor(e){ot(this,"client"),ot(this,"namespaces"),ot(this,"optionalNamespaces"),ot(this,"sessionProperties"),ot(this,"scopedProperties"),ot(this,"events",new lc),ot(this,"rpcProviders",{}),ot(this,"session"),ot(this,"providerOpts"),ot(this,"logger"),ot(this,"uri"),ot(this,"disableProviderPing",!1),ot(this,"connectParams");var r,i;this.providerOpts=e,this.logger=Hc({logger:(r=e.logger)!=null?r:ff,name:(i=this.providerOpts.name)!=null?i:hy}),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const r=new my(e);return await r.initialize(),r}async request(e,r,i){const[s,n]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:is({},e),chainId:`${s}:${n}`,topic:this.session.topic,expiry:i})}sendAsync(e,r,i,s){const n=new Date().getTime();this.request(e,i,s).then(o=>r(null,Is(n,o))).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:he("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.connectParams=e,this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,r){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:i,response:s}=await this.client.authenticate(e,r);i&&(this.uri=i,this.events.emit("display_uri",i));const n=await s();if(this.session=n.session,this.session){const o=mf(this.session.namespaces);this.namespaces=on(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){var r,i;const{uri:s,approval:n}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:(r=this.connectParams)==null?void 0:r.authentication,walletPay:(i=this.connectParams)==null?void 0:i.walletPay});s&&(this.uri=s,this.events.emit("display_uri",s));const o=await n();this.session=o;const a=mf(o.namespaces);return this.namespaces=on(this.namespaces,a),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,r){try{if(!this.session)return;const[i,s]=this.validateChain(e),n=this.getProvider(i);n?n.setDefaultChain(s,r):this.session&&this.logger.warn(`Provider for namespace '${i}' not found in setDefaultChain`)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(!Et(r))return;for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}catch(r){this.logger.warn(r,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,r;if(this.client=this.providerOpts.client||await d6.init({core:this.providerOpts.core,logger:this.providerOpts.logger||ff,relayUrl:this.providerOpts.relayUrl||Z6,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(i){throw this.logger.error(i,"Failed to get session"),new Error(`The provided session: ${(r=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:r.topic} doesn't exist in the Sign client`)}else{const i=this.client.session.getAll();this.session=i[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(r=>Oi(r)))];oa("client",this.client),oa("events",this.events),oa("disableProviderPing",this.disableProviderPing),e.forEach(r=>{if(!this.session)return;const i=a4(r,this.session);if((i==null?void 0:i.length)===0)return;const s=gy(i),n=on(this.namespaces,this.optionalNamespaces),o=an(is({},n[r]),{accounts:i,chains:s});switch(r){case"eip155":this.rpcProviders[r]=new k4({namespace:o});break;default:this.rpcProviders[r]=new L4({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var r;const{topic:i}=e;i===((r=this.session)==null?void 0:r.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var r;const{params:i,topic:s}=e;if(s!==((r=this.session)==null?void 0:r.topic))return;const{event:n}=i;if(n.name==="accountsChanged"){const o=n.data;o&&Et(o)&&this.events.emit("accountsChanged",o.map(wf))}else if(n.name==="chainChanged"){const o=i.chainId,a=i.event.data,c=Oi(o),l=na(o)!==na(a)?`${c}:${na(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i,s;if(e!==((i=this.session)==null?void 0:i.topic))return;const{namespaces:n}=r,o=(s=this.client)==null?void 0:s.session.get(e);this.session=an(is({},o),{namespaces:n}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{var r;e.topic===((r=this.session)==null?void 0:r.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",an(is({},he("USER_DISCONNECTED")),{data:e.topic})))}),this.on(el.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(an(is({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[dy]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){const{namespaces:r={},optionalNamespaces:i={},sessionProperties:s,scopedProperties:n}=e;this.optionalNamespaces=on(r,i),this.sessionProperties=s,this.scopedProperties=n}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,i];if(r&&!Object.keys(this.namespaces||{}).map(o=>Oi(o)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&i)return[r,i];const s=Oi(Object.keys(this.namespaces)[0]),n=this.rpcProviders[s].getDefaultChain();return[s,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:r,internal:i=!1}){if(!this.namespaces)return;const[s,n]=this.validateChain(e);if(n){if(this.updateNamespaceChain(s,n),i)this.events.emit("chainChanged",n),this.emitAccountsChangedOnChainChange({namespace:s,currentCaipChainId:e,previousCaipChainId:r});else{const o=this.getProvider(s);o?o.setDefaultChain(n):this.session&&this.logger.warn(`Provider for namespace '${s}' not found during chain change`)}await this.persist("namespaces",this.namespaces)}}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:r,previousCaipChainId:i}){var s,n;try{if(i===r)return;const o=(n=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:n.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${r}:`)).map(wf);if(!Et(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,r){if(!this.namespaces)return;const i=this.namespaces[e]?e:`${e}:${r}`,s={chains:[],methods:[],events:[],defaultChain:r};this.namespaces[i]?this.namespaces[i]&&(this.namespaces[i].defaultChain=r):this.namespaces[i]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,r){var i;const s=((i=this.session)==null?void 0:i.topic)||"";await this.client.core.storage.setItem(`${sn}/${e}${s}`,r)}async getFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";return await this.client.core.storage.getItem(`${sn}/${e}${i}`)}async deleteFromStore(e){var r;const i=((r=this.session)==null?void 0:r.topic)||"";await this.client.core.storage.removeItem(`${sn}/${e}${i}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const r=await this.client.core.storage.getKeys();for(const i of r)i.startsWith(sn)&&await this.client.core.storage.removeItem(i)}catch(r){this.logger.warn(r,"Failed to cleanup storage")}}};const W4=K4,G4="wc",Y4="ethereum_provider",Z4=`${G4}@2:${Y4}:`,J4="https://rpc.walletconnect.org/v1/",Nn=["eth_sendTransaction","personal_sign"],by=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],Un=["chainChanged","accountsChanged"],vy=["chainChanged","accountsChanged","message","disconnect","connect"],X4=async()=>{const{createAppKit:t}=await Ty(()=>import("./core-BXHNsp4W.js").then(e=>e.a7),__vite__mapDeps([0,1,2,3,4]));return t};var Q4=Object.defineProperty,eP=Object.defineProperties,tP=Object.getOwnPropertyDescriptors,$f=Object.getOwnPropertySymbols,rP=Object.prototype.hasOwnProperty,iP=Object.prototype.propertyIsEnumerable,cc=(t,e,r)=>e in t?Q4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yr=(t,e)=>{for(var r in e||(e={}))rP.call(e,r)&&cc(t,r,e[r]);if($f)for(var r of $f(e))iP.call(e,r)&&cc(t,r,e[r]);return t},ss=(t,e)=>eP(t,tP(e)),at=(t,e,r)=>cc(t,typeof e!="symbol"?e+"":e,r);function kn(t){return Number(t[0].split(":")[1])}function cn(t){return`0x${t.toString(16)}`}function sP(t){const{chains:e,optionalChains:r,methods:i,optionalMethods:s,events:n,optionalEvents:o,rpcMap:a}=t;if(!Et(e))throw new Error("Invalid chains");const c={chains:e,methods:i||Nn,events:n||Un,rpcMap:Yr({},e.length?{[kn(e)]:a[kn(e)]}:{})},l=n==null?void 0:n.filter(d=>!Un.includes(d)),u=i==null?void 0:i.filter(d=>!Nn.includes(d));if(!r&&!o&&!s&&!(l!=null&&l.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};const h=(l==null?void 0:l.length)&&(u==null?void 0:u.length)||!r,f={chains:[...new Set(h?c.chains.concat(r||[]):r)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:by))],events:[...new Set(c.events.concat(o!=null&&o.length?o:vy))],rpcMap:a};return{required:e.length?c:void 0,optional:r.length?f:void 0}}class ao{constructor(){at(this,"events",new It.EventEmitter),at(this,"namespace","eip155"),at(this,"accounts",[]),at(this,"signer"),at(this,"chainId",1),at(this,"modal"),at(this,"rpc"),at(this,"STORAGE_KEY",Z4),at(this,"on",(e,r)=>(this.events.on(e,r),this)),at(this,"once",(e,r)=>(this.events.once(e,r),this)),at(this,"removeListener",(e,r)=>(this.events.removeListener(e,r),this)),at(this,"off",(e,r)=>(this.events.off(e,r),this)),at(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const r=new ao;return await r.initialize(e),r}async request(e,r){return await this.signer.request(e,this.formatChainId(this.chainId),r)}sendAsync(e,r,i){this.signer.sendAsync(e,r,this.formatChainId(this.chainId),i)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var r;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:i,optional:s}=sP(this.rpc);try{const n=await new Promise(async(a,c)=>{var l,u;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(u=this.modal)==null||u.subscribeState(f=>{!f.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const h=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(ss(Yr({namespaces:Yr({},i&&{[this.namespace]:i})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e==null?void 0:e.pairingTopic,scopedProperties:h})).then(f=>{a(f)}).catch(f=>{var d;(d=this.modal)==null||d.showErrorMessage("Unable to connect"),c(new Error(f.message))})});if(!n)return;const o=bu(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:cn(this.chainId)})}catch(n){throw this.signer.logger.error(n),n}finally{(r=this.modal)==null||r.close()}}async authenticate(e,r){var i;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const s=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(ss(Yr({},e),{chains:this.rpc.chains}),r).then(u=>{o(u)}).catch(u=>{var h;(h=this.modal)==null||h.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),n=s.session;if(n){const o=bu(n.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:cn(this.chainId)})}return s}catch(s){throw this.signer.logger.error(s),s}finally{(i=this.modal)==null||i.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?(this.accounts=this.parseAccounts(i.data),this.events.emit("accountsChanged",this.accounts)):i.name==="chainChanged"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const r=parseInt(e);this.chainId=r,this.events.emit("chainChanged",cn(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",ss(Yr({},he("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const r=e.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",cn(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const r=this.parseChainId(e);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(e){const[r,i,s]=e.split(":");return{chainId:`${r}:${i}`,address:s}}setAccounts(e){this.accounts=e.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var r,i;const s=(r=e==null?void 0:e.chains)!=null?r:[],n=(i=e==null?void 0:e.optionalChains)!=null?i:[],o=s.concat(n);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=s.length?(e==null?void 0:e.methods)||Nn:[],c=s.length?(e==null?void 0:e.events)||Un:[],l=(e==null?void 0:e.optionalMethods)||[],u=(e==null?void 0:e.optionalEvents)||[],h=(e==null?void 0:e.rpcMap)||this.buildRpcMap(o,e.projectId),f=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(d=>this.formatChainId(d)),optionalChains:n.map(d=>this.formatChainId(d)),methods:a,events:c,optionalMethods:l,optionalEvents:u,rpcMap:h,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:f,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,r){const i={};return e.forEach(s=>{i[s]=this.getRpcUrl(s,r)}),i}async initialize(e){var r;if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?kn(this.rpc.chains):kn(this.rpc.optionalChains),this.signer=await W4.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const s=await X4(),{convertWCMToAppKitOptions:n}=await Promise.resolve().then(function(){return gP}),o=n(ss(Yr({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!o.networks.length)throw new Error("No networks found for WalletConnect");i=s(ss(Yr({},o),{universalProvider:this.signer,manualWCControl:!0,enableMobileFullScreen:((r=this.rpc.qrModalOptions)==null?void 0:r.enableMobileFullScreen)===!0}))}catch(s){throw console.warn(s),new Error("To use QR modal, please install @reown/appkit package")}if(i)try{this.modal=i}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:r,optionalChains:i,rpcMap:s}=e;r&&Et(r)&&(this.rpc.chains=r.map(n=>this.formatChainId(n)),r.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)})),i&&Et(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i==null?void 0:i.map(n=>this.formatChainId(n)),i.forEach(n=>{this.rpc.rpcMap[n]=(s==null?void 0:s[n])||this.getRpcUrl(n)}))}getRpcUrl(e,r){var i;return((i=this.rpc.rpcMap)==null?void 0:i[e])||`${J4}?chainId=eip155:${e}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(r=>this.signer.logger.warn(r))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(r=>this.parseAccount(r))}}const nP=ao;var oP=Object.defineProperty,aP=Object.defineProperties,cP=Object.getOwnPropertyDescriptors,Af=Object.getOwnPropertySymbols,lP=Object.prototype.hasOwnProperty,uP=Object.prototype.propertyIsEnumerable,Pf=(t,e,r)=>e in t?oP(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ey=(t,e)=>{for(var r in e||(e={}))lP.call(e,r)&&Pf(t,r,e[r]);if(Af)for(var r of Af(e))uP.call(e,r)&&Pf(t,r,e[r]);return t},hP=(t,e)=>aP(t,cP(e));function fP(t){if(t)return{"--w3m-font-family":t["--wcm-font-family"],"--w3m-accent":t["--wcm-accent-color"],"--w3m-color-mix":t["--wcm-background-color"],"--w3m-z-index":t["--wcm-z-index"]?Number(t["--wcm-z-index"]):void 0,"--w3m-qr-color":t["--wcm-accent-color"],"--w3m-font-size-master":t["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":t["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const dP=t=>{const[e,r]=t.split(":");return xy({id:r,caipNetworkId:t,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function pP(t){var e,r,i,s,n,o,a;const c=(e=t.chains)==null?void 0:e.map(dP).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const l=c.find(h=>{var f;return h.id===((f=t.defaultChain)==null?void 0:f.id)}),u={projectId:t.projectId,networks:c,themeMode:t.themeMode,themeVariables:fP(t.themeVariables),chainImages:t.chainImages,connectorImages:t.walletImages,defaultNetwork:l,metadata:hP(Ey({},t.metadata),{name:((r=t.metadata)==null?void 0:r.name)||"WalletConnect",description:((i=t.metadata)==null?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:((s=t.metadata)==null?void 0:s.url)||"https://walletconnect.org",icons:((n=t.metadata)==null?void 0:n.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:t.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(t.explorerRecommendedWalletIds)?t.explorerRecommendedWalletIds:[],excludeWalletIds:t.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(t.explorerExcludedWalletIds)?t.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=t.mobileWallets)!=null&&o.length||(a=t.desktopWallets)!=null&&a.length){const h=[...(t.mobileWallets||[]).map(g=>({id:g.id,name:g.name,links:g.links})),...(t.desktopWallets||[]).map(g=>({id:g.id,name:g.name,links:{native:g.links.native,universal:g.links.universal}}))],f=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],d=h.filter(g=>!f.includes(g.id));d.length&&(u.customWallets=d)}return u}function xy(t){return Ey({formatters:void 0,fees:void 0,serializers:void 0},t)}var gP=Object.freeze({__proto__:null,convertWCMToAppKitOptions:pP,defineChain:xy});const c5=Object.freeze(Object.defineProperty({__proto__:null,EthereumProvider:nP,OPTIONAL_EVENTS:vy,OPTIONAL_METHODS:by,REQUIRED_EVENTS:Un,REQUIRED_METHODS:Nn,default:ao},Symbol.toStringTag,{value:"Module"}));export{io as A,Lt as B,hE as C,bt as D,Ft as E,sy as F,cx as G,c5 as H,fi as I,cu as P,rp as Q,ft as R,_p as U,ai as a,si as b,M as c,tn as d,uc as e,vt as f,Mf as g,Xy as h,Lf as i,us as j,Oa as k,qy as l,IE as m,jS as n,st as o,Pt as p,Gc as q,di as r,oi as s,it as t,eO as u,Wc as v,so as w,Is as x,p2 as y,Rr as z};
