const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BO-BmR-4.js","assets/parseSignature-CUQ2tX3m.js","assets/index-DAFyR3CE.js","assets/index-Dn6Kqrs6.css","assets/ccip-Br_vUYfF.js","assets/events-l3XzqiNp.js","assets/index-0EX6IENZ.js","assets/index-nibyPLVP.js","assets/features-1a8VRkrL.js","assets/basic-B89gVQ4F.js","assets/index-B3NwjDEU.js","assets/w3m-modal-DFS-P5Ca.js"])))=>i.map(i=>d[i]);
import{bk as Ag,aQ as Ig,b1 as Ng,dd as Sg,R as _g,de as Tg,bQ as Nh,dc as mo,bD as Ui,h as $i,cJ as $l}from"./index-DAFyR3CE.js";import{e as Yn,F as Yc}from"./events-l3XzqiNp.js";import{d as Di,s as wo,a as Jc,I as Pr,U as Xc,g as xg,f as Xt,t as _t,c as V,b as Ir,C as Og,e as Sh,h as Pg,i as kg,j as ei,k as Za,l as Rg,m as Ug,G as _h,R as Lt,n as $g,o as Mt,p as ys,r as kr,q as Zc,u as Dg,v as Qc,w as el,x as li,P as Dl,Q as Bg,y as Lg,z as Rn,A as Th,B as Ps,D as ws,E as Gs,F as xh}from"./index-0EX6IENZ.js";import{c as Mg,a as Fg,k as jg,d as qg,s as Wg,g as Bl}from"./index-nibyPLVP.js";function Ll(t,e={}){const{key:s="fallback",name:n="Fallback",rank:r=!1,shouldThrow:i=Hg,retryCount:o,retryDelay:a}=e;return({chain:c,pollingInterval:l=4e3,timeout:d,...u})=>{let h=t,f=()=>{};const g=Ag({key:s,name:n,async request({method:p,params:w}){let b;const I=async(v=0)=>{const E=h[v]({...u,chain:c,retryCount:0,timeout:d});try{const _=await E.request({method:p,params:w});return f({method:p,params:w,response:_,transport:E,status:"success"}),_}catch(_){if(f({error:_,method:p,params:w,transport:E,status:"error"}),i(_)||v===h.length-1||(b??(b=h.slice(v+1).some(R=>{const{include:D,exclude:M}=R({chain:c}).config.methods||{};return D?D.includes(p):M?!M.includes(p):!0})),!b))throw _;return I(v+1)}};return I()},retryCount:o,retryDelay:a,type:"fallback"},{onResponse:p=>f=p,transports:h.map(p=>p({chain:c,retryCount:0}))});if(r){const p=typeof r=="object"?r:{};zg({chain:c,interval:p.interval??l,onTransports:w=>h=w,ping:p.ping,sampleCount:p.sampleCount,timeout:p.timeout,transports:h,weights:p.weights})}return g}}function Hg(t){return!!("code"in t&&typeof t.code=="number"&&(t.code===Ig.code||t.code===Ng.code||t.code===Sg.code||_g.nodeMessage.test(t.message)||t.code===5e3))}function zg({chain:t,interval:e=4e3,onTransports:s,ping:n,sampleCount:r=10,timeout:i=1e3,transports:o,weights:a={}}){const{stability:c=.7,latency:l=.3}=a,d=[],u=async()=>{const h=await Promise.all(o.map(async p=>{const w=p({chain:t,retryCount:0,timeout:i}),b=Date.now();let I,v;try{await(n?n({transport:w}):w.request({method:"net_listening"})),v=1}catch{v=0}finally{I=Date.now()}return{latency:I-b,success:v}}));d.push(h),d.length>r&&d.shift();const f=Math.max(...d.map(p=>Math.max(...p.map(({latency:w})=>w)))),g=o.map((p,w)=>{const b=d.map(R=>R[w].latency),v=1-b.reduce((R,D)=>R+D,0)/b.length/f,E=d.map(R=>R[w].success),_=E.reduce((R,D)=>R+D,0)/E.length;return _===0?[0,w]:[l*v+c*_,w]}).sort((p,w)=>w[0]-p[0]);s(g.map(([,p])=>o[p])),await Tg(e),u()};u()}const Oh={isLowerCaseMatch(t,e){return(t==null?void 0:t.toLowerCase())===(e==null?void 0:e.toLowerCase())}};var Ml={};const k={WC_NAME_SUFFIX:".reown.id",WC_NAME_SUFFIX_LEGACY:".wcn.id",BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org",PULSE_API_URL:"https://pulse.walletconnect.org",W3M_API_URL:"https://api.web3modal.org",CONNECTOR_ID:{WALLET_CONNECT:"walletConnect",INJECTED:"injected",WALLET_STANDARD:"announced",COINBASE:"coinbaseWallet",COINBASE_SDK:"coinbaseWalletSDK",BASE_ACCOUNT:"baseAccount",SAFE:"safe",LEDGER:"ledger",OKX:"okx",EIP6963:"eip6963",AUTH:"AUTH"},CONNECTOR_NAMES:{AUTH:"Auth"},AUTH_CONNECTOR_SUPPORTED_CHAINS:["eip155","solana"],LIMITS:{PENDING_TRANSACTIONS:99},CHAIN:{EVM:"eip155",SOLANA:"solana",POLKADOT:"polkadot",BITCOIN:"bip122",TON:"ton"},CHAIN_NAME_MAP:{eip155:"EVM Networks",solana:"Solana",polkadot:"Polkadot",bip122:"Bitcoin",cosmos:"Cosmos",sui:"Sui",stacks:"Stacks",ton:"TON"},ADAPTER_TYPES:{BITCOIN:"bitcoin",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5",TON:"ton"},USDT_CONTRACT_ADDRESSES:["0xdac17f958d2ee523a2206206994597c13d831ec7","0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x9702230a8ea53601f5cd2dc00fdbc13d4df4a8c7","0x919C1c267BC06a7039e03fcc2eF738525769109c","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e","0x55d398326f99059fF775485246999027B3197955","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9"],SOLANA_SPL_TOKEN_ADDRESSES:{SOL:"So11111111111111111111111111111111111111112"},NATIVE_IMAGE_IDS_BY_NAMESPACE:{eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"3e8119e5-2a6f-4818-c50c-1937011d5900",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00"},TOKEN_SYMBOLS_BY_ADDRESS:{"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48":"USDC","0x833589fcd6edb6e08f4c7c32d4f71b54bda02913":"USDC","0x0b2c639c533813f4aa9d7837caf62653d097ff85":"USDC","0xaf88d065e77c8cc2239327c5edb3a432268e5831":"USDC","0x3c499c542cef5e3811e1192ce70d8cc03d5c3359":"USDC","0x2791bca1f2de4661ed88a30c99a7a9449aa84174":"USDC",EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v:"USDC","0xdac17f958d2ee523a2206206994597c13d831ec7":"USDT","0x94b008aa00579c1307b0ef2c499ad98a8ce58e58":"USDT","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9":"USDT","0xc2132d05d31c914a87c6611c10748aeb04b58e8f":"USDT",Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB:"USDT"},HTTP_STATUS_CODES:{SERVER_ERROR:500,TOO_MANY_REQUESTS:429,SERVICE_UNAVAILABLE:503,FORBIDDEN:403},UNSUPPORTED_NETWORK_NAME:"Unknown Network",SECURE_SITE_SDK_ORIGIN:(typeof process<"u"&&typeof Ml<"u"?Ml.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",REMOTE_FEATURES_ALERTS:{MULTI_WALLET_NOT_ENABLED:{DEFAULT:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com."},CONNECTIONS_HOOK:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com to use the useAppKitConnections hook."},CONNECTION_HOOK:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com to use the useAppKitConnection hook."}},HEADLESS_NOT_ENABLED:{DEFAULT:{displayMessage:"",debugMessage:"Headless support is not enabled. Please enable it with the features.headless option in the AppKit configuration and make sure your current plan supports it."}}},IS_DEVELOPMENT:typeof process<"u"&&!1,DEFAULT_ALLOWED_ANCESTORS:["http://localhost:*","https://localhost:*","http://127.0.0.1:*","https://127.0.0.1:*","https://*.pages.dev","https://*.vercel.app","https://*.ngrok-free.app","https://secure-mobile.walletconnect.com","https://secure-mobile.walletconnect.org"],METMASK_CONNECTOR_NAME:"MetaMask",TRUST_CONNECTOR_NAME:"Trust Wallet",SOLFLARE_CONNECTOR_NAME:"Solflare",PHANTOM_CONNECTOR_NAME:"Phantom",COIN98_CONNECTOR_NAME:"Coin98",MAGIC_EDEN_CONNECTOR_NAME:"Magic Eden",BACKPACK_CONNECTOR_NAME:"Backpack",BITGET_CONNECTOR_NAME:"Bitget Wallet",FRONTIER_CONNECTOR_NAME:"Frontier",XVERSE_CONNECTOR_NAME:"Xverse Wallet",LEATHER_CONNECTOR_NAME:"Leather",OKX_CONNECTOR_NAME:"OKX Wallet",BINANCE_CONNECTOR_NAME:"Binance Wallet",EIP155:"eip155",ADD_CHAIN_METHOD:"wallet_addEthereumChain",EIP6963_ANNOUNCE_EVENT:"eip6963:announceProvider",EIP6963_REQUEST_EVENT:"eip6963:requestProvider",CONNECTOR_RDNS_MAP:{coinbaseWallet:"com.coinbase.wallet",coinbaseWalletSDK:"com.coinbase.wallet"},CONNECTOR_TYPE_EXTERNAL:"EXTERNAL",CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED",CONNECTOR_TYPE_AUTH:"AUTH",CONNECTOR_TYPE_MULTI_CHAIN:"MULTI_CHAIN",CONNECTOR_TYPE_W3M_AUTH:"AUTH"},Ph={caipNetworkIdToNumber(t){return t?Number(t.split(":")[1]):void 0},parseEvmChainId(t){return typeof t=="string"?this.caipNetworkIdToNumber(t):t},getNetworksByNamespace(t,e){return(t==null?void 0:t.filter(s=>s.chainNamespace===e))||[]},getFirstNetworkByNamespace(t,e){return this.getNetworksByNamespace(t,e)[0]},getNetworkNameByCaipNetworkId(t,e){var r;if(!e)return;const s=t.find(i=>i.caipNetworkId===e);if(s)return s.name;const[n]=e.split(":");return((r=k.CHAIN_NAME_MAP)==null?void 0:r[n])||void 0}},kh=["eip155","solana","polkadot","bip122","cosmos","sui","stacks"];var Kg=20,Vg=1,Wn=1e6,Fl=1e6,Gg=-7,Yg=21,Jg=!1,Ci="[big.js] ",Jn=Ci+"Invalid ",Mo=Jn+"decimal places",Xg=Jn+"rounding mode",Rh=Ci+"Division by zero",Se={},As=void 0,Zg=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function Uh(){function t(e){var s=this;if(!(s instanceof t))return e===As?Uh():new t(e);if(e instanceof t)s.s=e.s,s.e=e.e,s.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(Jn+"value");e=e===0&&1/e<0?"-0":String(e)}Qg(s,e)}s.constructor=t}return t.prototype=Se,t.DP=Kg,t.RM=Vg,t.NE=Gg,t.PE=Yg,t.strict=Jg,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function Qg(t,e){var s,n,r;if(!Zg.test(e))throw Error(Jn+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(s=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(s<0&&(s=n),s+=+e.slice(n+1),e=e.substring(0,n)):s<0&&(s=e.length),r=e.length,n=0;n<r&&e.charAt(n)=="0";)++n;if(n==r)t.c=[t.e=0];else{for(;r>0&&e.charAt(--r)=="0";);for(t.e=s-n-1,t.c=[],s=0;n<=r;)t.c[s++]=+e.charAt(n++)}return t}function Xn(t,e,s,n){var r=t.c;if(s===As&&(s=t.constructor.RM),s!==0&&s!==1&&s!==2&&s!==3)throw Error(Xg);if(e<1)n=s===3&&(n||!!r[0])||e===0&&(s===1&&r[0]>=5||s===2&&(r[0]>5||r[0]===5&&(n||r[1]!==As))),r.length=1,n?(t.e=t.e-e+1,r[0]=1):r[0]=t.e=0;else if(e<r.length){if(n=s===1&&r[e]>=5||s===2&&(r[e]>5||r[e]===5&&(n||r[e+1]!==As||r[e-1]&1))||s===3&&(n||!!r[0]),r.length=e,n){for(;++r[--e]>9;)if(r[e]=0,e===0){++t.e,r.unshift(1);break}}for(e=r.length;!r[--e];)r.pop()}return t}function Zn(t,e,s){var n=t.e,r=t.c.join(""),i=r.length;if(e)r=r.charAt(0)+(i>1?"."+r.slice(1):"")+(n<0?"e":"e+")+n;else if(n<0){for(;++n;)r="0"+r;r="0."+r}else if(n>0)if(++n>i)for(n-=i;n--;)r+="0";else n<i&&(r=r.slice(0,n)+"."+r.slice(n));else i>1&&(r=r.charAt(0)+"."+r.slice(1));return t.s<0&&s?"-"+r:r}Se.abs=function(){var t=new this.constructor(this);return t.s=1,t};Se.cmp=function(t){var e,s=this,n=s.c,r=(t=new s.constructor(t)).c,i=s.s,o=t.s,a=s.e,c=t.e;if(!n[0]||!r[0])return n[0]?i:r[0]?-o:0;if(i!=o)return i;if(e=i<0,a!=c)return a>c^e?1:-1;for(o=(a=n.length)<(c=r.length)?a:c,i=-1;++i<o;)if(n[i]!=r[i])return n[i]>r[i]^e?1:-1;return a==c?0:a>c^e?1:-1};Se.div=function(t){var e=this,s=e.constructor,n=e.c,r=(t=new s(t)).c,i=e.s==t.s?1:-1,o=s.DP;if(o!==~~o||o<0||o>Wn)throw Error(Mo);if(!r[0])throw Error(Rh);if(!n[0])return t.s=i,t.c=[t.e=0],t;var a,c,l,d,u,h=r.slice(),f=a=r.length,g=n.length,p=n.slice(0,a),w=p.length,b=t,I=b.c=[],v=0,E=o+(b.e=e.e-t.e)+1;for(b.s=i,i=E<0?0:E,h.unshift(0);w++<a;)p.push(0);do{for(l=0;l<10;l++){if(a!=(w=p.length))d=a>w?1:-1;else for(u=-1,d=0;++u<a;)if(r[u]!=p[u]){d=r[u]>p[u]?1:-1;break}if(d<0){for(c=w==a?r:h;w;){if(p[--w]<c[w]){for(u=w;u&&!p[--u];)p[u]=9;--p[u],p[w]+=10}p[w]-=c[w]}for(;!p[0];)p.shift()}else break}I[v++]=d?l:++l,p[0]&&d?p[w]=n[f]||0:p=[n[f]]}while((f++<g||p[0]!==As)&&i--);return!I[0]&&v!=1&&(I.shift(),b.e--,E--),v>E&&Xn(b,E,s.RM,p[0]!==As),b};Se.eq=function(t){return this.cmp(t)===0};Se.gt=function(t){return this.cmp(t)>0};Se.gte=function(t){return this.cmp(t)>-1};Se.lt=function(t){return this.cmp(t)<0};Se.lte=function(t){return this.cmp(t)<1};Se.minus=Se.sub=function(t){var e,s,n,r,i=this,o=i.constructor,a=i.s,c=(t=new o(t)).s;if(a!=c)return t.s=-c,i.plus(t);var l=i.c.slice(),d=i.e,u=t.c,h=t.e;if(!l[0]||!u[0])return u[0]?t.s=-c:l[0]?t=new o(i):t.s=1,t;if(a=d-h){for((r=a<0)?(a=-a,n=l):(h=d,n=u),n.reverse(),c=a;c--;)n.push(0);n.reverse()}else for(s=((r=l.length<u.length)?l:u).length,a=c=0;c<s;c++)if(l[c]!=u[c]){r=l[c]<u[c];break}if(r&&(n=l,l=u,u=n,t.s=-t.s),(c=(s=u.length)-(e=l.length))>0)for(;c--;)l[e++]=0;for(c=e;s>a;){if(l[--s]<u[s]){for(e=s;e&&!l[--e];)l[e]=9;--l[e],l[s]+=10}l[s]-=u[s]}for(;l[--c]===0;)l.pop();for(;l[0]===0;)l.shift(),--h;return l[0]||(t.s=1,l=[h=0]),t.c=l,t.e=h,t};Se.mod=function(t){var e,s=this,n=s.constructor,r=s.s,i=(t=new n(t)).s;if(!t.c[0])throw Error(Rh);return s.s=t.s=1,e=t.cmp(s)==1,s.s=r,t.s=i,e?new n(s):(r=n.DP,i=n.RM,n.DP=n.RM=0,s=s.div(t),n.DP=r,n.RM=i,this.minus(s.times(t)))};Se.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};Se.plus=Se.add=function(t){var e,s,n,r=this,i=r.constructor;if(t=new i(t),r.s!=t.s)return t.s=-t.s,r.minus(t);var o=r.e,a=r.c,c=t.e,l=t.c;if(!a[0]||!l[0])return l[0]||(a[0]?t=new i(r):t.s=r.s),t;if(a=a.slice(),e=o-c){for(e>0?(c=o,n=l):(e=-e,n=a),n.reverse();e--;)n.push(0);n.reverse()}for(a.length-l.length<0&&(n=l,l=a,a=n),e=l.length,s=0;e;a[e]%=10)s=(a[--e]=a[e]+l[e]+s)/10|0;for(s&&(a.unshift(s),++c),e=a.length;a[--e]===0;)a.pop();return t.c=a,t.e=c,t};Se.pow=function(t){var e=this,s=new e.constructor("1"),n=s,r=t<0;if(t!==~~t||t<-Fl||t>Fl)throw Error(Jn+"exponent");for(r&&(t=-t);t&1&&(n=n.times(e)),t>>=1,!!t;)e=e.times(e);return r?s.div(n):n};Se.prec=function(t,e){if(t!==~~t||t<1||t>Wn)throw Error(Jn+"precision");return Xn(new this.constructor(this),t,e)};Se.round=function(t,e){if(t===As)t=0;else if(t!==~~t||t<-Wn||t>Wn)throw Error(Mo);return Xn(new this.constructor(this),t+this.e+1,e)};Se.sqrt=function(){var t,e,s,n=this,r=n.constructor,i=n.s,o=n.e,a=new r("0.5");if(!n.c[0])return new r(n);if(i<0)throw Error(Ci+"No square root");i=Math.sqrt(+Zn(n,!0,!0)),i===0||i===1/0?(e=n.c.join(""),e.length+o&1||(e+="0"),i=Math.sqrt(e),o=((o+1)/2|0)-(o<0||o&1),t=new r((i==1/0?"5e":(i=i.toExponential()).slice(0,i.indexOf("e")+1))+o)):t=new r(i+""),o=t.e+(r.DP+=4);do s=t,t=a.times(s.plus(n.div(s)));while(s.c.slice(0,o).join("")!==t.c.slice(0,o).join(""));return Xn(t,(r.DP-=4)+t.e+1,r.RM)};Se.times=Se.mul=function(t){var e,s=this,n=s.constructor,r=s.c,i=(t=new n(t)).c,o=r.length,a=i.length,c=s.e,l=t.e;if(t.s=s.s==t.s?1:-1,!r[0]||!i[0])return t.c=[t.e=0],t;for(t.e=c+l,o<a&&(e=r,r=i,i=e,l=o,o=a,a=l),e=new Array(l=o+a);l--;)e[l]=0;for(c=a;c--;){for(a=0,l=o+c;l>c;)a=e[l]+i[c]*r[l-c-1]+a,e[l--]=a%10,a=a/10|0;e[l]=a}for(a?++t.e:e.shift(),c=e.length;!e[--c];)e.pop();return t.c=e,t};Se.toExponential=function(t,e){var s=this,n=s.c[0];if(t!==As){if(t!==~~t||t<0||t>Wn)throw Error(Mo);for(s=Xn(new s.constructor(s),++t,e);s.c.length<t;)s.c.push(0)}return Zn(s,!0,!!n)};Se.toFixed=function(t,e){var s=this,n=s.c[0];if(t!==As){if(t!==~~t||t<0||t>Wn)throw Error(Mo);for(s=Xn(new s.constructor(s),t+s.e+1,e),t=t+s.e+1;s.c.length<t;)s.c.push(0)}return Zn(s,!1,!!n)};Se[Symbol.for("nodejs.util.inspect.custom")]=Se.toJSON=Se.toString=function(){var t=this,e=t.constructor;return Zn(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};Se.toNumber=function(){var t=+Zn(this,!0,!0);if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(Ci+"Imprecise conversion");return t};Se.toPrecision=function(t,e){var s=this,n=s.constructor,r=s.c[0];if(t!==As){if(t!==~~t||t<1||t>Wn)throw Error(Jn+"precision");for(s=Xn(new n(s),t,e);s.c.length<t;)s.c.push(0)}return Zn(s,t<=s.e||s.e<=n.NE||s.e>=n.PE,!!r)};Se.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(Ci+"valueOf disallowed");return Zn(t,t.e<=e.NE||t.e>=e.PE,!0)};var us=Uh();const $h={bigNumber(t,e={safe:!1}){try{return t?new us(t):new us(0)}catch(s){if(e.safe)return new us(0);throw s}},formatNumber(t,e){const{decimals:s,round:n=8,safe:r=!0}=e;return $h.bigNumber(t,{safe:r}).div(new us(10).pow(s)).round(n)},multiply(t,e){if(t===void 0||e===void 0)return new us(0);const s=new us(t),n=new us(e);return s.times(n)},toFixed(t,e=2){return t===void 0||t===""?new us(0).toFixed(e):new us(t).toFixed(e)},formatNumberToLocalString(t,e=2){return t===void 0||t===""?"0.00":typeof t=="number"?t.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e,roundingMode:"floor"}):parseFloat(t).toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e,roundingMode:"floor"})},parseLocalStringToNumber(t){if(t===void 0||t==="")return 0;const e=t.replace(/,/gu,"");return new us(e).toNumber()}},em=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],tm=[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],sm=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],nm={getERC20Abi:t=>k.USDT_CONTRACT_ADDRESSES.includes(t)?sm:em,getSwapAbi:()=>tm},sr={ConnectorExplorerIds:{[k.CONNECTOR_ID.COINBASE]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[k.CONNECTOR_ID.COINBASE_SDK]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[k.CONNECTOR_ID.BASE_ACCOUNT]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[k.CONNECTOR_ID.SAFE]:"225affb176778569276e484e1b92637ad061b01e13a048b35a9d280c3b58970f",[k.CONNECTOR_ID.LEDGER]:"19177a98252e07ddfc9af2083ba8e07ef627cb6103467ffebb3f8f4205fd7927",[k.CONNECTOR_ID.OKX]:"971e689d0a5be527bac79629b4ee9b925e82208e5168b733496a09c0faed0709",[k.METMASK_CONNECTOR_NAME]:"c57ca95b47569778a828d19178114f4db188b89b763c899ba0be274e97267d96",[k.TRUST_CONNECTOR_NAME]:"4622a2b2d6af1c9844944291e5e7351a6aa24cd7b23099efac1b2fd875da31a0",[k.SOLFLARE_CONNECTOR_NAME]:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",[k.PHANTOM_CONNECTOR_NAME]:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",[k.COIN98_CONNECTOR_NAME]:"2a3c89040ac3b723a1972a33a125b1db11e258a6975d3a61252cd64e6ea5ea01",[k.MAGIC_EDEN_CONNECTOR_NAME]:"8b830a2b724a9c3fbab63af6f55ed29c9dfa8a55e732dc88c80a196a2ba136c6",[k.BACKPACK_CONNECTOR_NAME]:"2bd8c14e035c2d48f184aaa168559e86b0e3433228d3c4075900a221785019b0",[k.BITGET_CONNECTOR_NAME]:"38f5d18bd8522c244bdd70cb4a68e0e718865155811c043f052fb9f1c51de662",[k.FRONTIER_CONNECTOR_NAME]:"85db431492aa2e8672e93f4ea7acf10c88b97b867b0d373107af63dc4880f041",[k.XVERSE_CONNECTOR_NAME]:"2a87d74ae02e10bdd1f51f7ce6c4e1cc53cd5f2c0b6b5ad0d7b3007d2b13de7b",[k.LEATHER_CONNECTOR_NAME]:"483afe1df1df63daf313109971ff3ef8356ddf1cc4e45877d205eee0b7893a13",[k.OKX_CONNECTOR_NAME]:"971e689d0a5be527bac79629b4ee9b925e82208e5168b733496a09c0faed0709",[k.BINANCE_CONNECTOR_NAME]:"2fafea35bb471d22889ccb49c08d99dd0a18a37982602c33f696a5723934ba25"}},Qe={validateCaipAddress(t){var e;if(((e=t.split(":"))==null?void 0:e.length)!==3)throw new Error("Invalid CAIP Address");return t},parseCaipAddress(t){const e=t.split(":");if(e.length!==3)throw new Error(`Invalid CAIP-10 address: ${t}`);const[s,n,r]=e;if(!s||!n||!r)throw new Error(`Invalid CAIP-10 address: ${t}`);return{chainNamespace:s,chainId:n,address:r}},parseCaipNetworkId(t){const e=t.split(":");if(e.length!==2)throw new Error(`Invalid CAIP-2 network id: ${t}`);const[s,n]=e;if(!s||!n)throw new Error(`Invalid CAIP-2 network id: ${t}`);return{chainNamespace:s,chainId:n}}},Fs={RPC_ERROR_CODE:{USER_REJECTED_REQUEST:4001,USER_REJECTED_METHODS:5002,USER_REJECTED:5e3,SEND_TRANSACTION_ERROR:5001},PROVIDER_RPC_ERROR_NAME:{PROVIDER_RPC:"ProviderRpcError",USER_REJECTED_REQUEST:"UserRejectedRequestError",SEND_TRANSACTION_ERROR:"SendTransactionError"},isRpcProviderError(t){try{if(typeof t=="object"&&t!==null){const e=t,s=typeof e.message=="string",n=typeof e.code=="number";return s&&n}return!1}catch{return!1}},isUserRejectedMessage(t){return t.toLowerCase().includes("user rejected")||t.toLowerCase().includes("user cancelled")||t.toLowerCase().includes("user canceled")},isUserRejectedRequestError(t){if(Fs.isRpcProviderError(t)){const e=t.code===Fs.RPC_ERROR_CODE.USER_REJECTED_REQUEST,s=t.code===Fs.RPC_ERROR_CODE.USER_REJECTED_METHODS;return e||s||Fs.isUserRejectedMessage(t.message)}return t instanceof Error?Fs.isUserRejectedMessage(t.message):!1}};class rm extends Error{constructor(e,s){super(s.message,{cause:e}),this.name=Fs.PROVIDER_RPC_ERROR_NAME.PROVIDER_RPC,this.code=s.code}}class Dh extends rm{constructor(e){super(e,{code:Fs.RPC_ERROR_CODE.USER_REJECTED_REQUEST,message:"User rejected the request"}),this.name=Fs.PROVIDER_RPC_ERROR_NAME.USER_REJECTED_REQUEST}}const ee={WALLET_ID:"@appkit/wallet_id",WALLET_NAME:"@appkit/wallet_name",SOLANA_WALLET:"@appkit/solana_wallet",SOLANA_CAIP_CHAIN:"@appkit/solana_caip_chain",ACTIVE_CAIP_NETWORK_ID:"@appkit/active_caip_network_id",CONNECTED_SOCIAL:"@appkit/connected_social",CONNECTED_SOCIAL_USERNAME:"@appkit-wallet/SOCIAL_USERNAME",RECENT_WALLETS:"@appkit/recent_wallets",RECENT_WALLET:"@appkit/recent_wallet",DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",ACTIVE_NAMESPACE:"@appkit/active_namespace",CONNECTED_NAMESPACES:"@appkit/connected_namespaces",CONNECTION_STATUS:"@appkit/connection_status",SIWX_AUTH_TOKEN:"@appkit/siwx-auth-token",SIWX_NONCE_TOKEN:"@appkit/siwx-nonce-token",TELEGRAM_SOCIAL_PROVIDER:"@appkit/social_provider",NATIVE_BALANCE_CACHE:"@appkit/native_balance_cache",PORTFOLIO_CACHE:"@appkit/portfolio_cache",ENS_CACHE:"@appkit/ens_cache",IDENTITY_CACHE:"@appkit/identity_cache",PREFERRED_ACCOUNT_TYPES:"@appkit/preferred_account_types",CONNECTIONS:"@appkit/connections",DISCONNECTED_CONNECTOR_IDS:"@appkit/disconnected_connector_ids",HISTORY_TRANSACTIONS_CACHE:"@appkit/history_transactions_cache",TOKEN_PRICE_CACHE:"@appkit/token_price_cache",RECENT_EMAILS:"@appkit/recent_emails",LATEST_APPKIT_VERSION:"@appkit/latest_version",TON_WALLETS_CACHE:"@appkit/ton_wallets_cache"};function sa(t){if(!t)throw new Error("Namespace is required for CONNECTED_CONNECTOR_ID");return`@appkit/${t}:connected_connector_id`}const Z={setItem(t,e){Jr()&&e!==void 0&&localStorage.setItem(t,e)},getItem(t){if(Jr())return localStorage.getItem(t)||void 0},removeItem(t){Jr()&&localStorage.removeItem(t)},clear(){Jr()&&localStorage.clear()}};function Jr(){return typeof window<"u"&&typeof localStorage<"u"}function yo(t,e){const s=(t==null?void 0:t["--apkt-accent"])??(t==null?void 0:t["--w3m-accent"]);return e==="light"?{"--w3m-accent":s||"hsla(231, 100%, 70%, 1)","--w3m-background":"#fff"}:{"--w3m-accent":s||"hsla(230, 100%, 67%, 1)","--w3m-background":"#202020"}}const im=Symbol(),jl=Object.getPrototypeOf,Qa=new WeakMap,om=t=>t&&(Qa.has(t)?Qa.get(t):jl(t)===Object.prototype||jl(t)===Array.prototype),am=t=>om(t)&&t[im]||null,ql=(t,e=!0)=>{Qa.set(t,e)},bo={},tl=t=>typeof t=="object"&&t!==null,cm=t=>tl(t)&&!Ai.has(t)&&(Array.isArray(t)||!(Symbol.iterator in t))&&!(t instanceof WeakMap)&&!(t instanceof WeakSet)&&!(t instanceof Error)&&!(t instanceof Number)&&!(t instanceof Date)&&!(t instanceof String)&&!(t instanceof RegExp)&&!(t instanceof ArrayBuffer)&&!(t instanceof Promise),Bh=(t,e)=>{const s=ec.get(t);if((s==null?void 0:s[0])===e)return s[1];const n=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));return ql(n,!0),ec.set(t,[e,n]),Reflect.ownKeys(t).forEach(r=>{if(Object.getOwnPropertyDescriptor(n,r))return;const i=Reflect.get(t,r),{enumerable:o}=Reflect.getOwnPropertyDescriptor(t,r),a={value:i,enumerable:o,configurable:!0};if(Ai.has(i))ql(i,!1);else if(mn.has(i)){const[c,l]=mn.get(i);a.value=Bh(c,l())}Object.defineProperty(n,r,a)}),Object.preventExtensions(n)},lm=(t,e,s,n)=>({deleteProperty(r,i){const o=Reflect.get(r,i);s(i);const a=Reflect.deleteProperty(r,i);return a&&n(["delete",[i],o]),a},set(r,i,o,a){const c=!t()&&Reflect.has(r,i),l=Reflect.get(r,i,a);if(c&&(Wl(l,o)||di.has(o)&&Wl(l,di.get(o))))return!0;s(i),tl(o)&&(o=am(o)||o);const d=!mn.has(o)&&um(o)?ke(o):o;return e(i,d),Reflect.set(r,i,d,a),n(["set",[i],o,l]),!0}}),mn=new WeakMap,Ai=new WeakSet,ec=new WeakMap,ro=[1],di=new WeakMap;let Wl=Object.is,dm=(t,e)=>new Proxy(t,e),um=cm,hm=Bh,fm=lm;function ke(t={}){if(!tl(t))throw new Error("object required");const e=di.get(t);if(e)return e;let s=ro[0];const n=new Set,r=(w,b=++ro[0])=>{s!==b&&(i=s=b,n.forEach(I=>I(w,b)))};let i=s;const o=(w=ro[0])=>(i!==w&&(i=w,c.forEach(([b])=>{const I=b[1](w);I>s&&(s=I)})),s),a=w=>(b,I)=>{const v=[...b];v[1]=[w,...v[1]],r(v,I)},c=new Map,l=(w,b)=>{const I=!Ai.has(b)&&mn.get(b);if(I){if((bo?"production":void 0)!=="production"&&c.has(w))throw new Error("prop listener already exists");if(n.size){const v=I[2](a(w));c.set(w,[I,v])}else c.set(w,[I])}},d=w=>{var b;const I=c.get(w);I&&(c.delete(w),(b=I[1])==null||b.call(I))},u=w=>(n.add(w),n.size===1&&c.forEach(([I,v],E)=>{if((bo?"production":void 0)!=="production"&&v)throw new Error("remove already exists");const _=I[2](a(E));c.set(E,[I,_])}),()=>{n.delete(w),n.size===0&&c.forEach(([I,v],E)=>{v&&(v(),c.set(E,[I]))})});let h=!0;const f=fm(()=>h,l,d,r),g=dm(t,f);di.set(t,g);const p=[t,o,u];return mn.set(g,p),Reflect.ownKeys(t).forEach(w=>{const b=Object.getOwnPropertyDescriptor(t,w);"value"in b&&b.writable&&(g[w]=t[w])}),h=!1,g}function et(t,e,s){const n=mn.get(t);(bo?"production":void 0)!=="production"&&!n&&console.warn("Please use proxy object");let r;const i=[],o=n[2];let a=!1;const l=o(d=>{i.push(d),r||(r=Promise.resolve().then(()=>{r=void 0,a&&e(i.splice(0))}))});return a=!0,()=>{a=!1,l()}}function ui(t){const e=mn.get(t);(bo?"production":void 0)!=="production"&&!e&&console.warn("Please use proxy object");const[s,n]=e;return hm(s,n())}function hi(t){return Ai.add(t),t}function pm(){return{proxyStateMap:mn,refSet:Ai,snapCache:ec,versionHolder:ro,proxyCache:di}}function tt(t,e,s,n){let r=t[e];return et(t,()=>{const i=t[e];Object.is(r,i)||s(r=i)})}const{proxyStateMap:gm,snapCache:mm}=pm(),Bi=t=>gm.has(t);function wm(t){const e=[];let s=0;const n=new Map,r=new WeakMap,i=()=>{const l=mm.get(a),d=l==null?void 0:l[1];if(d&&!r.has(d)){const u=new Map(n);r.set(d,u)}},o=l=>r.get(l)||n,a={data:e,index:s,epoch:0,get size(){return Bi(this)||i(),o(this).size},get(l){const u=o(this).get(l);if(u===void 0){this.epoch;return}return this.data[u]},has(l){const d=o(this);return this.epoch,d.has(l)},set(l,d){if(!Bi(this))throw new Error("Cannot perform mutations on a snapshot");const u=n.get(l);return u===void 0?(n.set(l,this.index),this.data[this.index++]=d):this.data[u]=d,this.epoch++,this},delete(l){if(!Bi(this))throw new Error("Cannot perform mutations on a snapshot");const d=n.get(l);return d===void 0?!1:(delete this.data[d],n.delete(l),this.epoch++,!0)},clear(){if(!Bi(this))throw new Error("Cannot perform mutations on a snapshot");this.data.length=0,this.index=0,this.epoch++,n.clear()},forEach(l){this.epoch,o(this).forEach((u,h)=>{l(this.data[u],h,this)})},*entries(){this.epoch;const l=o(this);for(const[d,u]of l)yield[d,this.data[u]]},*keys(){this.epoch;const l=o(this);for(const d of l.keys())yield d},*values(){this.epoch;const l=o(this);for(const d of l.values())yield this.data[d]},[Symbol.iterator](){return this.entries()},get[Symbol.toStringTag](){return"Map"},toJSON(){return new Map(this.entries())}},c=ke(a);return Object.defineProperties(c,{size:{enumerable:!1},index:{enumerable:!1},epoch:{enumerable:!1},data:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(c),c}var Hl={};const na=(typeof process<"u"&&typeof Hl<"u"?Hl.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",Lh=[{label:"Meld.io",name:"meld",feeRange:"1-2%",url:"https://meldcrypto.com",supportedChains:["eip155","solana"]}],ym="WXETMuFUQmqqybHuRkSgxv:25B8LJHSfpG6LVjR2ytU5Cwh7Z4Sch2ocoU",fe={FOUR_MINUTES_MS:24e4,TEN_SEC_MS:1e4,FIVE_SEC_MS:5e3,THREE_SEC_MS:3e3,ONE_SEC_MS:1e3,SECURE_SITE:na,SECURE_SITE_DASHBOARD:`${na}/dashboard`,SECURE_SITE_FAVICON:`${na}/images/favicon.png`,SOLANA_NATIVE_TOKEN_ADDRESS:"So11111111111111111111111111111111111111111",RESTRICTED_TIMEZONES:["ASIA/SHANGHAI","ASIA/URUMQI","ASIA/CHONGQING","ASIA/HARBIN","ASIA/KASHGAR","ASIA/MACAU","ASIA/HONG_KONG","ASIA/MACAO","ASIA/BEIJING","ASIA/HARBIN"],SWAP_SUGGESTED_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP"],SWAP_POPULAR_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP","METAL","DAI","CHAMP","WOLF","SALE","BAL","BUSD","MUST","BTCpx","ROUTE","HEX","WELT","amDAI","VSQ","VISION","AURUM","pSP","SNX","VC","LINK","CHP","amUSDT","SPHERE","FOX","GIDDY","GFC","OMEN","OX_OLD","DE","WNT"],SUGGESTED_TOKENS_BY_CHAIN:{"eip155:42161":["USDâ‚®0"]},BALANCE_SUPPORTED_CHAINS:[k.CHAIN.EVM,k.CHAIN.SOLANA],SEND_PARAMS_SUPPORTED_CHAINS:[k.CHAIN.EVM],SWAP_SUPPORTED_NETWORKS:["eip155:1","eip155:42161","eip155:10","eip155:324","eip155:8453","eip155:56","eip155:137","eip155:100","eip155:43114","eip155:250","eip155:8217","eip155:1313161554"],NAMES_SUPPORTED_CHAIN_NAMESPACES:[k.CHAIN.EVM],ONRAMP_SUPPORTED_CHAIN_NAMESPACES:[k.CHAIN.EVM,k.CHAIN.SOLANA],PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES:[k.CHAIN.EVM,k.CHAIN.SOLANA],ACTIVITY_ENABLED_CHAIN_NAMESPACES:[k.CHAIN.EVM,k.CHAIN.TON],NATIVE_TOKEN_ADDRESS:{eip155:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",solana:"So11111111111111111111111111111111111111111",polkadot:"0x",bip122:"0x",cosmos:"0x",sui:"0x",stacks:"0x",ton:"0x"},CONVERT_SLIPPAGE_TOLERANCE:1,CONNECT_LABELS:{MOBILE:"Open and continue in the wallet app",WEB:"Open and continue in the wallet app"},SEND_SUPPORTED_NAMESPACES:[k.CHAIN.EVM,k.CHAIN.SOLANA],DEFAULT_REMOTE_FEATURES:{swaps:["1inch"],onramp:["meld"],email:!0,socials:["google","x","discord","farcaster","github","apple","facebook"],activity:!0,reownBranding:!0,multiWallet:!1,emailCapture:!1,payWithExchange:!1,payments:!1,reownAuthentication:!1,headless:!1},DEFAULT_REMOTE_FEATURES_DISABLED:{email:!1,socials:!1,swaps:!1,onramp:!1,activity:!1,reownBranding:!1,emailCapture:!1,reownAuthentication:!1,headless:!1},DEFAULT_FEATURES:{receive:!0,send:!0,emailShowWallets:!0,connectorTypeOrder:["walletConnect","recent","injected","featured","custom","external","recommended"],analytics:!0,allWallets:!0,legalCheckbox:!1,smartSessions:!1,collapseWallets:!1,walletFeaturesOrder:["onramp","swaps","receive","send"],connectMethodsOrder:void 0,pay:!1,reownAuthentication:!1,headless:!1},DEFAULT_SOCIALS:["google","x","farcaster","discord","apple","github","facebook"],DEFAULT_ACCOUNT_TYPES:{bip122:"payment",eip155:"smartAccount",polkadot:"eoa",solana:"eoa",ton:"eoa"},ADAPTER_TYPES:{UNIVERSAL:"universal",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5",BITCOIN:"bitcoin"},SIWX_DEFAULTS:{signOutOnDisconnect:!0},MANDATORY_WALLET_IDS_ON_MOBILE:[sr.ConnectorExplorerIds[k.CONNECTOR_ID.COINBASE],sr.ConnectorExplorerIds[k.CONNECTOR_ID.COINBASE_SDK],sr.ConnectorExplorerIds[k.CONNECTOR_ID.BASE_ACCOUNT],sr.ConnectorExplorerIds[k.SOLFLARE_CONNECTOR_NAME],sr.ConnectorExplorerIds[k.PHANTOM_CONNECTOR_NAME],sr.ConnectorExplorerIds[k.BINANCE_CONNECTOR_NAME]],DEFAULT_CONNECT_METHOD_ORDER:["email","social","wallet"]},L={cacheExpiry:{portfolio:3e4,nativeBalance:3e4,ens:3e5,identity:3e5,transactionsHistory:15e3,tokenPrice:15e3,latestAppKitVersion:6048e5,tonWallets:864e5},isCacheExpired(t,e){return Date.now()-t>e},getActiveNetworkProps(){const t=L.getActiveNamespace(),e=L.getActiveCaipNetworkId(),s=e?e.split(":")[1]:void 0,n=s?isNaN(Number(s))?s:Number(s):void 0;return{namespace:t,caipNetworkId:e,chainId:n}},setWalletConnectDeepLink({name:t,href:e}){try{Z.setItem(ee.DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))}catch{console.info("Unable to set WalletConnect deep link")}},getWalletConnectDeepLink(){try{const t=Z.getItem(ee.DEEPLINK_CHOICE);if(t)return JSON.parse(t)}catch{console.info("Unable to get WalletConnect deep link")}},deleteWalletConnectDeepLink(){try{Z.removeItem(ee.DEEPLINK_CHOICE)}catch{console.info("Unable to delete WalletConnect deep link")}},setActiveNamespace(t){try{Z.setItem(ee.ACTIVE_NAMESPACE,t)}catch{console.info("Unable to set active namespace")}},setActiveCaipNetworkId(t){try{Z.setItem(ee.ACTIVE_CAIP_NETWORK_ID,t),L.setActiveNamespace(t.split(":")[0])}catch{console.info("Unable to set active caip network id")}},getActiveCaipNetworkId(){try{return Z.getItem(ee.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to get active caip network id");return}},deleteActiveCaipNetworkId(){try{Z.removeItem(ee.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to delete active caip network id")}},deleteConnectedConnectorId(t){try{const e=sa(t);Z.removeItem(e)}catch{console.info("Unable to delete connected connector id")}},setAppKitRecent(t){try{const e=L.getRecentWallets();e.find(n=>n.id===t.id)||(e.unshift(t),e.length>2&&e.pop(),Z.setItem(ee.RECENT_WALLETS,JSON.stringify(e)),Z.setItem(ee.RECENT_WALLET,JSON.stringify(t)))}catch{console.info("Unable to set AppKit recent")}},getRecentWallets(){try{const t=Z.getItem(ee.RECENT_WALLETS);return t?JSON.parse(t):[]}catch{console.info("Unable to get AppKit recent")}return[]},getRecentWallet(){try{const t=Z.getItem(ee.RECENT_WALLET);return t?JSON.parse(t):null}catch{console.info("Unable to get AppKit recent")}return null},deleteRecentWallet(){try{Z.removeItem(ee.RECENT_WALLET)}catch{console.info("Unable to delete AppKit recent")}},setConnectedConnectorId(t,e){try{const s=sa(t);Z.setItem(s,e)}catch{console.info("Unable to set Connected Connector Id")}},getActiveNamespace(){try{return Z.getItem(ee.ACTIVE_NAMESPACE)}catch{console.info("Unable to get active namespace")}},getConnectedConnectorId(t){if(t)try{const e=sa(t);return Z.getItem(e)}catch{console.info("Unable to get connected connector id in namespace",t)}},setConnectedSocialProvider(t){try{Z.setItem(ee.CONNECTED_SOCIAL,t)}catch{console.info("Unable to set connected social provider")}},getConnectedSocialProvider(){try{return Z.getItem(ee.CONNECTED_SOCIAL)}catch{console.info("Unable to get connected social provider")}},deleteConnectedSocialProvider(){try{Z.removeItem(ee.CONNECTED_SOCIAL)}catch{console.info("Unable to delete connected social provider")}},getConnectedSocialUsername(){try{return Z.getItem(ee.CONNECTED_SOCIAL_USERNAME)}catch{console.info("Unable to get connected social username")}},getStoredActiveCaipNetworkId(){var s;const t=Z.getItem(ee.ACTIVE_CAIP_NETWORK_ID);return(s=t==null?void 0:t.split(":"))==null?void 0:s[1]},setConnectionStatus(t){try{Z.setItem(ee.CONNECTION_STATUS,t)}catch{console.info("Unable to set connection status")}},getConnectionStatus(){try{return Z.getItem(ee.CONNECTION_STATUS)}catch{return}},getConnectedNamespaces(){try{const t=Z.getItem(ee.CONNECTED_NAMESPACES);return t!=null&&t.length?t.split(","):[]}catch{return[]}},setConnectedNamespaces(t){try{const e=Array.from(new Set(t));Z.setItem(ee.CONNECTED_NAMESPACES,e.join(","))}catch{console.info("Unable to set namespaces in storage")}},addConnectedNamespace(t){try{const e=L.getConnectedNamespaces();e.includes(t)||(e.push(t),L.setConnectedNamespaces(e))}catch{console.info("Unable to add connected namespace")}},removeConnectedNamespace(t){try{const e=L.getConnectedNamespaces(),s=e.indexOf(t);s>-1&&(e.splice(s,1),L.setConnectedNamespaces(e))}catch{console.info("Unable to remove connected namespace")}},getTelegramSocialProvider(){try{return Z.getItem(ee.TELEGRAM_SOCIAL_PROVIDER)}catch{return console.info("Unable to get telegram social provider"),null}},setTelegramSocialProvider(t){try{Z.setItem(ee.TELEGRAM_SOCIAL_PROVIDER,t)}catch{console.info("Unable to set telegram social provider")}},removeTelegramSocialProvider(){try{Z.removeItem(ee.TELEGRAM_SOCIAL_PROVIDER)}catch{console.info("Unable to remove telegram social provider")}},getBalanceCache(){let t={};try{const e=Z.getItem(ee.PORTFOLIO_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromBalanceCache(t){try{const e=L.getBalanceCache();Z.setItem(ee.PORTFOLIO_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getBalanceCacheForCaipAddress(t){try{const s=L.getBalanceCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.portfolio))return s.balance;L.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateBalanceCache(t){try{const e=L.getBalanceCache();e[t.caipAddress]=t,Z.setItem(ee.PORTFOLIO_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getNativeBalanceCache(){let t={};try{const e=Z.getItem(ee.NATIVE_BALANCE_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromNativeBalanceCache(t){try{const e=L.getBalanceCache();Z.setItem(ee.NATIVE_BALANCE_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getNativeBalanceCacheForCaipAddress(t){try{const s=L.getNativeBalanceCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.nativeBalance))return s;console.info("Discarding cache for address",t),L.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateNativeBalanceCache(t){try{const e=L.getNativeBalanceCache();e[t.caipAddress]=t,Z.setItem(ee.NATIVE_BALANCE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getEnsCache(){let t={};try{const e=Z.getItem(ee.ENS_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get ens name cache")}return t},getEnsFromCacheForAddress(t){try{const s=L.getEnsCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.ens))return s.ens;L.removeEnsFromCache(t)}catch{console.info("Unable to get ens name from cache",t)}},updateEnsCache(t){try{const e=L.getEnsCache();e[t.address]=t,Z.setItem(ee.ENS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ens name cache",t)}},removeEnsFromCache(t){try{const e=L.getEnsCache();Z.setItem(ee.ENS_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove ens name from cache",t)}},getIdentityCache(){let t={};try{const e=Z.getItem(ee.IDENTITY_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get identity cache")}return t},getIdentityFromCacheForAddress(t){try{const s=L.getIdentityCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.identity))return s.identity;L.removeIdentityFromCache(t)}catch{console.info("Unable to get identity from cache",t)}},updateIdentityCache(t){try{const e=L.getIdentityCache();e[t.address]={identity:t.identity,timestamp:t.timestamp},Z.setItem(ee.IDENTITY_CACHE,JSON.stringify(e))}catch{console.info("Unable to update identity cache",t)}},removeIdentityFromCache(t){try{const e=L.getIdentityCache();Z.setItem(ee.IDENTITY_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove identity from cache",t)}},getTonWalletsCache(){try{const t=Z.getItem(ee.TON_WALLETS_CACHE),e=t?JSON.parse(t):void 0;if(e&&!this.isCacheExpired(e.timestamp,this.cacheExpiry.tonWallets))return e;L.removeTonWalletsCache()}catch{console.info("Unable to get ton wallets cache")}},updateTonWalletsCache(t){try{const e=L.getTonWalletsCache()||{timestamp:0,wallets:[]};e.timestamp=new Date().getTime(),e.wallets=t,Z.setItem(ee.TON_WALLETS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ton wallets cache",t)}},removeTonWalletsCache(){try{Z.removeItem(ee.TON_WALLETS_CACHE)}catch{console.info("Unable to remove ton wallets cache")}},clearAddressCache(){try{Z.removeItem(ee.PORTFOLIO_CACHE),Z.removeItem(ee.NATIVE_BALANCE_CACHE),Z.removeItem(ee.ENS_CACHE),Z.removeItem(ee.IDENTITY_CACHE),Z.removeItem(ee.HISTORY_TRANSACTIONS_CACHE)}catch{console.info("Unable to clear address cache")}},setPreferredAccountTypes(t){try{Z.setItem(ee.PREFERRED_ACCOUNT_TYPES,JSON.stringify(t))}catch{console.info("Unable to set preferred account types",t)}},getPreferredAccountTypes(){try{const t=Z.getItem(ee.PREFERRED_ACCOUNT_TYPES);return t?JSON.parse(t):{}}catch{console.info("Unable to get preferred account types")}return{}},setConnections(t,e){try{const s=L.getConnections(),n=s[e]??[],r=new Map;for(const o of n)r.set(o.connectorId,{...o});for(const o of t){const a=r.get(o.connectorId),c=o.connectorId===k.CONNECTOR_ID.AUTH;if(a&&!c){const l=new Set(a.accounts.map(u=>u.address.toLowerCase())),d=o.accounts.filter(u=>!l.has(u.address.toLowerCase()));a.accounts.push(...d)}else r.set(o.connectorId,{...o})}const i={...s,[e]:Array.from(r.values())};Z.setItem(ee.CONNECTIONS,JSON.stringify(i))}catch(s){console.error("Unable to sync connections to storage",s)}},getConnections(){try{const t=Z.getItem(ee.CONNECTIONS);return t?JSON.parse(t):{}}catch(t){return console.error("Unable to get connections from storage",t),{}}},deleteAddressFromConnection({connectorId:t,address:e,namespace:s}){try{const n=L.getConnections(),r=n[s]??[],i=new Map(r.map(a=>[a.connectorId,a])),o=i.get(t);o&&(o.accounts.filter(c=>c.address.toLowerCase()!==e.toLowerCase()).length===0?i.delete(t):i.set(t,{...o,accounts:o.accounts.filter(c=>c.address.toLowerCase()!==e.toLowerCase())})),Z.setItem(ee.CONNECTIONS,JSON.stringify({...n,[s]:Array.from(i.values())}))}catch{console.error(`Unable to remove address "${e}" from connector "${t}" in namespace "${s}"`)}},getDisconnectedConnectorIds(){try{const t=Z.getItem(ee.DISCONNECTED_CONNECTOR_IDS);return t?JSON.parse(t):{}}catch{console.info("Unable to get disconnected connector ids")}return{}},addDisconnectedConnectorId(t,e){try{const s=L.getDisconnectedConnectorIds(),n=s[e]??[];n.push(t),Z.setItem(ee.DISCONNECTED_CONNECTOR_IDS,JSON.stringify({...s,[e]:Array.from(new Set(n))}))}catch{console.error(`Unable to set disconnected connector id "${t}" for namespace "${e}"`)}},removeDisconnectedConnectorId(t,e){try{const s=L.getDisconnectedConnectorIds();let n=s[e]??[];n=n.filter(r=>r.toLowerCase()!==t.toLowerCase()),Z.setItem(ee.DISCONNECTED_CONNECTOR_IDS,JSON.stringify({...s,[e]:Array.from(new Set(n))}))}catch{console.error(`Unable to remove disconnected connector id "${t}" for namespace "${e}"`)}},isConnectorDisconnected(t,e){try{return(L.getDisconnectedConnectorIds()[e]??[]).some(r=>r.toLowerCase()===t.toLowerCase())}catch{console.info(`Unable to get disconnected connector id "${t}" for namespace "${e}"`)}return!1},getTransactionsCache(){try{const t=Z.getItem(ee.HISTORY_TRANSACTIONS_CACHE);return t?JSON.parse(t):{}}catch{console.info("Unable to get transactions cache")}return{}},getTransactionsCacheForAddress({address:t,chainId:e=""}){var s;try{const r=(s=L.getTransactionsCache()[t])==null?void 0:s[e];if(r&&!this.isCacheExpired(r.timestamp,this.cacheExpiry.transactionsHistory))return r.transactions;L.removeTransactionsCache({address:t,chainId:e})}catch{console.info("Unable to get transactions cache")}},updateTransactionsCache({address:t,chainId:e="",timestamp:s,transactions:n}){try{const r=L.getTransactionsCache();r[t]={...r[t],[e]:{timestamp:s,transactions:n}},Z.setItem(ee.HISTORY_TRANSACTIONS_CACHE,JSON.stringify(r))}catch{console.info("Unable to update transactions cache",{address:t,chainId:e,timestamp:s,transactions:n})}},removeTransactionsCache({address:t,chainId:e}){try{const s=L.getTransactionsCache(),n=(s==null?void 0:s[t])||{},{[e]:r,...i}=n;Z.setItem(ee.HISTORY_TRANSACTIONS_CACHE,JSON.stringify({...s,[t]:i}))}catch{console.info("Unable to remove transactions cache",{address:t,chainId:e})}},getTokenPriceCache(){try{const t=Z.getItem(ee.TOKEN_PRICE_CACHE);return t?JSON.parse(t):{}}catch{console.info("Unable to get token price cache")}return{}},getTokenPriceCacheForAddresses(t){try{const s=L.getTokenPriceCache()[t.join(",")];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.tokenPrice))return s.tokenPrice;L.removeTokenPriceCache(t)}catch{console.info("Unable to get token price cache for addresses",t)}},updateTokenPriceCache(t){try{const e=L.getTokenPriceCache();e[t.addresses.join(",")]={timestamp:t.timestamp,tokenPrice:t.tokenPrice},Z.setItem(ee.TOKEN_PRICE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update token price cache",t)}},removeTokenPriceCache(t){try{const e=L.getTokenPriceCache();Z.setItem(ee.TOKEN_PRICE_CACHE,JSON.stringify({...e,[t.join(",")]:void 0}))}catch{console.info("Unable to remove token price cache",t)}},getLatestAppKitVersion(){try{const t=this.getLatestAppKitVersionCache(),e=t==null?void 0:t.version;return e&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.latestAppKitVersion)?e:void 0}catch{console.info("Unable to get latest AppKit version")}},getLatestAppKitVersionCache(){try{const t=Z.getItem(ee.LATEST_APPKIT_VERSION);return t?JSON.parse(t):{}}catch{console.info("Unable to get latest AppKit version cache")}return{}},updateLatestAppKitVersion(t){try{const e=L.getLatestAppKitVersionCache();e.timestamp=t.timestamp,e.version=t.version,Z.setItem(ee.LATEST_APPKIT_VERSION,JSON.stringify(e))}catch{console.info("Unable to update latest AppKit version on local storage",t)}}},Y={getWindow(){if(!(typeof window>"u"))return window},isMobile(){var t;return this.isClient()?!!(window!=null&&window.matchMedia&&typeof window.matchMedia=="function"&&((t=window.matchMedia("(pointer:coarse)"))!=null&&t.matches)||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},checkCaipNetwork(t,e=""){return t==null?void 0:t.caipNetworkId.toLocaleLowerCase().includes(e.toLowerCase())},isAndroid(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return Y.isMobile()&&t.includes("android")},isIos(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("iphone")||t.includes("ipad")},isSafari(){return this.isClient()?(window==null?void 0:window.navigator.userAgent.toLowerCase()).includes("safari"):!1},isClient(){return typeof window<"u"},isPairingExpired(t){return t?t-Date.now()<=fe.TEN_SEC_MS:!0},isAllowedRetry(t,e=fe.ONE_SEC_MS){return Date.now()-t>=e},copyToClopboard(t){navigator.clipboard.writeText(t)},isIframe(){try{return(window==null?void 0:window.self)!==(window==null?void 0:window.top)}catch{return!1}},isSafeApp(){var t,e;if(Y.isClient()&&window.self!==window.top)try{const s=(e=(t=window==null?void 0:window.location)==null?void 0:t.ancestorOrigins)==null?void 0:e[0],n="https://app.safe.global";if(s){const r=new URL(s),i=new URL(n);return r.hostname===i.hostname}}catch{return!1}return!1},getPairingExpiry(){return Date.now()+fe.FOUR_MINUTES_MS},getNetworkId(t){return t==null?void 0:t.split(":")[1]},getPlainAddress(t){return t==null?void 0:t.split(":")[2]},async wait(t){return new Promise(e=>{setTimeout(e,t)})},debounce(t,e=500){let s;return(...n)=>{function r(){t(...n)}s&&clearTimeout(s),s=setTimeout(r,e)}},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},formatNativeUrl(t,e,s=null){if(Y.isHttpUrl(t))return this.formatUniversalUrl(t,e);let n=t,r=s;n.includes("://")||(n=t.replaceAll("/","").replaceAll(":",""),n=`${n}://`),n.endsWith("/")||(n=`${n}/`),r&&!(r!=null&&r.endsWith("/"))&&(r=`${r}/`),this.isTelegram()&&this.isAndroid()&&(e=encodeURIComponent(e));const i=encodeURIComponent(e);return{redirect:`${n}wc?uri=${i}`,redirectUniversalLink:r?`${r}wc?uri=${i}`:void 0,href:n}},formatUniversalUrl(t,e){if(!Y.isHttpUrl(t))return this.formatNativeUrl(t,e);let s=t;s.endsWith("/")||(s=`${s}/`);const n=encodeURIComponent(e);return{redirect:`${s}wc?uri=${n}`,href:s}},getOpenTargetForPlatform(t){return t==="popupWindow"?t:this.isTelegram()?L.getTelegramSocialProvider()?"_top":"_blank":t},openHref(t,e,s){window==null||window.open(t,this.getOpenTargetForPlatform(e),s||"noreferrer noopener")},returnOpenHref(t,e,s){return window==null?void 0:window.open(t,this.getOpenTargetForPlatform(e),s||"noreferrer noopener")},isTelegram(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)},isPWA(){var s,n;if(typeof window>"u")return!1;const t=window!=null&&window.matchMedia&&typeof window.matchMedia=="function"?(s=window.matchMedia("(display-mode: standalone)"))==null?void 0:s.matches:!1,e=(n=window==null?void 0:window.navigator)==null?void 0:n.standalone;return!!(t||e)},async preloadImage(t){const e=new Promise((s,n)=>{const r=new Image;r.onload=s,r.onerror=n,r.crossOrigin="anonymous",r.src=t});return Promise.race([e,Y.wait(2e3)])},parseBalance(t,e){let s="0.000";if(typeof t=="string"){const c=Number(t);if(!isNaN(c)){const l=(Math.floor(c*1e3)/1e3).toFixed(3);l&&(s=l)}}const[n,r]=s.split("."),i=n||"0",o=r||"000";return{formattedText:`${i}.${o}${e?` ${e}`:""}`,value:i,decimals:o,symbol:e}},getApiUrl(){return k.W3M_API_URL},getBlockchainApiUrl(){return k.BLOCKCHAIN_API_RPC_URL},getAnalyticsUrl(){return k.PULSE_API_URL},getUUID(){return crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})},parseError(t){var e,s;return typeof t=="string"?t:typeof((s=(e=t==null?void 0:t.issues)==null?void 0:e[0])==null?void 0:s.message)=="string"?t.issues[0].message:t instanceof Error?t.message:"Unknown error"},sortRequestedNetworks(t,e=[]){const s={};return e&&t&&(t.forEach((n,r)=>{s[n]=r}),e.sort((n,r)=>{const i=s[n.id],o=s[r.id];return i!==void 0&&o!==void 0?i-o:i!==void 0?-1:o!==void 0?1:0})),e},calculateBalance(t){let e=0;for(const s of t)e+=s.value??0;return e},formatTokenBalance(t){const e=t.toFixed(2),[s,n]=e.split(".");return{dollars:s,pennies:n}},isAddress(t,e="eip155"){switch(e){case"eip155":if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)){if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)||/^(?:0x)?[0-9A-F]{40}$/iu.test(t))return!0}else return!1;return!1;case"solana":return/[1-9A-HJ-NP-Za-km-z]{32,44}$/iu.test(t);case"bip122":{const s=/^[1][a-km-zA-HJ-NP-Z1-9]{25,34}$/u.test(t),n=/^[3][a-km-zA-HJ-NP-Z1-9]{25,34}$/u.test(t),r=/^bc1[a-z0-9]{39,87}$/u.test(t),i=/^bc1p[a-z0-9]{58}$/u.test(t);return s||n||r||i}default:return!1}},uniqueBy(t,e){const s=new Set;return t.filter(n=>{const r=n[e];return s.has(r)?!1:(s.add(r),!0)})},generateSdkVersion(t,e,s){const r=t.length===0?fe.ADAPTER_TYPES.UNIVERSAL:t.map(i=>i.adapterType).join(",");return`${e}-${r}-${s}`},createAccount(t,e,s,n,r){return{namespace:t,address:e,type:s,publicKey:n,path:r}},isCaipAddress(t){if(typeof t!="string")return!1;const e=t.split(":"),s=e[0];return e.filter(Boolean).length===3&&s in k.CHAIN_NAME_MAP},getAccount(t){return t?typeof t=="string"?{address:t,chainId:void 0}:{address:t.address,chainId:t.chainId}:{address:void 0,chainId:void 0}},isMac(){const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("macintosh")&&!t.includes("safari")},formatTelegramSocialLoginUrl(t){const e=`--${encodeURIComponent(window==null?void 0:window.location.href)}`,s="state=";if(new URL(t).host==="auth.magic.link"){const r="provider_authorization_url=",i=t.substring(t.indexOf(r)+r.length),o=this.injectIntoUrl(decodeURIComponent(i),s,e);return t.replace(i,encodeURIComponent(o))}return this.injectIntoUrl(t,s,e)},injectIntoUrl(t,e,s){const n=t.indexOf(e);if(n===-1)throw new Error(`${e} parameter not found in the URL: ${t}`);const r=t.indexOf("&",n),i=e.length,o=r!==-1?r:t.length,a=t.substring(0,n+i),c=t.substring(n+i,o),l=t.substring(r),d=c+s;return a+d+l},isNumber(t){return typeof t!="number"&&typeof t!="string"?!1:!isNaN(Number(t))}},io={STORAGE_KEY:"@appkit-wallet/",SMART_ACCOUNT_ENABLED_NETWORKS:"SMART_ACCOUNT_ENABLED_NETWORKS"},js={SAFE_RPC_METHODS:["eth_accounts","eth_blockNumber","eth_call","eth_chainId","eth_estimateGas","eth_feeHistory","eth_gasPrice","eth_getAccount","eth_getBalance","eth_getBlockByHash","eth_getBlockByNumber","eth_getBlockReceipts","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getCode","eth_getFilterChanges","eth_getFilterLogs","eth_getLogs","eth_getProof","eth_getStorageAt","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionByHash","eth_getTransactionCount","eth_getTransactionReceipt","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_maxPriorityFeePerGas","eth_newBlockFilter","eth_newFilter","eth_newPendingTransactionFilter","eth_sendRawTransaction","eth_syncing","eth_uninstallFilter","wallet_getCapabilities","wallet_getCallsStatus","eth_getUserOperationReceipt","eth_estimateUserOperationGas","eth_getUserOperationByHash","eth_supportedEntryPoints","wallet_getAssets"],NOT_SAFE_RPC_METHODS:["personal_sign","eth_signTypedData_v4","eth_sendTransaction","solana_signMessage","solana_signTransaction","solana_signAllTransactions","solana_signAndSendTransaction","wallet_sendCalls","wallet_grantPermissions","wallet_revokePermissions","eth_sendUserOperation"],GET_CHAIN_ID:"eth_chainId",RPC_METHOD_NOT_ALLOWED_MESSAGE:"Requested RPC call is not allowed",RPC_METHOD_NOT_ALLOWED_UI_MESSAGE:"Action not allowed",ACCOUNT_TYPES:{EOA:"eoa",SMART_ACCOUNT:"smartAccount"}},bm={set(t,e){ra.isClient&&localStorage.setItem(`${io.STORAGE_KEY}${t}`,e)},get(t){return ra.isClient?localStorage.getItem(`${io.STORAGE_KEY}${t}`):null},delete(t,e){ra.isClient&&(e?localStorage.removeItem(t):localStorage.removeItem(`${io.STORAGE_KEY}${t}`))}},ra={isClient:typeof window<"u"};async function Dr(...t){const e=await fetch(...t);if(!e.ok)throw new Error(`HTTP status code: ${e.status}`,{cause:e});return e}class Ii{constructor({baseUrl:e,clientId:s}){this.baseUrl=e,this.clientId=s}async get({headers:e,signal:s,cache:n,...r}){const i=this.createUrl(r);return(await Dr(i,{method:"GET",headers:e,signal:s,cache:n})).json()}async getBlob({headers:e,signal:s,...n}){const r=this.createUrl(n);return(await Dr(r,{method:"GET",headers:e,signal:s})).blob()}async post({body:e,headers:s,signal:n,...r}){const i=this.createUrl(r);return(await Dr(i,{method:"POST",headers:s,body:e?JSON.stringify(e):void 0,signal:n})).json()}async put({body:e,headers:s,signal:n,...r}){const i=this.createUrl(r);return(await Dr(i,{method:"PUT",headers:s,body:e?JSON.stringify(e):void 0,signal:n})).json()}async delete({body:e,headers:s,signal:n,...r}){const i=this.createUrl(r);return(await Dr(i,{method:"DELETE",headers:s,body:e?JSON.stringify(e):void 0,signal:n})).json()}createUrl({path:e,params:s}){const n=new URL(e,this.baseUrl);return s&&Object.entries(s).forEach(([r,i])=>{i&&n.searchParams.append(r,i)}),this.clientId&&n.searchParams.append("clientId",this.clientId),n}sendBeacon({body:e,...s}){const n=this.createUrl(s);return navigator.sendBeacon(n.toString(),e?JSON.stringify(e):void 0)}}const tc={getFeatureValue(t,e){const s=e==null?void 0:e[t];return s===void 0?fe.DEFAULT_FEATURES[t]:s},filterSocialsByPlatform(t){if(!t||!t.length)return t;let e=t;return Y.isTelegram()&&(Y.isIos()&&(e=e.filter(s=>s!=="google")),Y.isMac()&&(e=e.filter(s=>s!=="x")),Y.isAndroid()&&(e=e.filter(s=>!["facebook","x"].includes(s)))),Y.isMobile()&&(e=e.filter(s=>s!=="facebook")),e},isSocialsEnabled(){var t,e,s,n;return Array.isArray((t=U.state.features)==null?void 0:t.socials)&&((e=U.state.features)==null?void 0:e.socials.length)>0||Array.isArray((s=U.state.remoteFeatures)==null?void 0:s.socials)&&((n=U.state.remoteFeatures)==null?void 0:n.socials.length)>0},isEmailEnabled(){var t,e;return!!((t=U.state.features)!=null&&t.email||(e=U.state.remoteFeatures)!=null&&e.email)}},te=ke({features:fe.DEFAULT_FEATURES,projectId:"",sdkType:"appkit",sdkVersion:"html-wagmi-undefined",defaultAccountTypes:fe.DEFAULT_ACCOUNT_TYPES,enableNetworkSwitch:!0,experimental_preferUniversalLinks:!1,remoteFeatures:{},enableMobileFullScreen:!1,coinbasePreference:"all"}),U={state:te,subscribeKey(t,e){return tt(te,t,e)},setOptions(t){Object.assign(te,t)},setRemoteFeatures(t){var s,n;if(!t)return;const e={...te.remoteFeatures,...t};te.remoteFeatures=e,(s=te.remoteFeatures)!=null&&s.socials&&(te.remoteFeatures.socials=tc.filterSocialsByPlatform(te.remoteFeatures.socials)),(n=te.features)!=null&&n.pay&&(te.remoteFeatures.email=!1,te.remoteFeatures.socials=!1)},setFeatures(t){var s;if(!t)return;te.features||(te.features=fe.DEFAULT_FEATURES);const e={...te.features,...t};te.features=e,(s=te.features)!=null&&s.pay&&te.remoteFeatures&&(te.remoteFeatures.email=!1,te.remoteFeatures.socials=!1)},setProjectId(t){te.projectId=t},setCustomRpcUrls(t){te.customRpcUrls=t},setAllWallets(t){te.allWallets=t},setIncludeWalletIds(t){te.includeWalletIds=t},setExcludeWalletIds(t){te.excludeWalletIds=t},setFeaturedWalletIds(t){te.featuredWalletIds=t},setTokens(t){te.tokens=t},setTermsConditionsUrl(t){te.termsConditionsUrl=t},setPrivacyPolicyUrl(t){te.privacyPolicyUrl=t},setCustomWallets(t){te.customWallets=t},setIsSiweEnabled(t){te.isSiweEnabled=t},setIsUniversalProvider(t){te.isUniversalProvider=t},setSdkVersion(t){te.sdkVersion=t},setMetadata(t){te.metadata=t},setDisableAppend(t){te.disableAppend=t},setEIP6963Enabled(t){te.enableEIP6963=t},setDebug(t){te.debug=t},setEnableWalletGuide(t){te.enableWalletGuide=t},setEnableAuthLogger(t){te.enableAuthLogger=t},setEnableWallets(t){te.enableWallets=t},setPreferUniversalLinks(t){te.experimental_preferUniversalLinks=t},setSIWX(t){if(t)for(const[e,s]of Object.entries(fe.SIWX_DEFAULTS))t[e]??(t[e]=s);te.siwx=t},setConnectMethodsOrder(t){te.features={...te.features,connectMethodsOrder:t}},setWalletFeaturesOrder(t){te.features={...te.features,walletFeaturesOrder:t}},setSocialsOrder(t){te.remoteFeatures={...te.remoteFeatures,socials:t}},setCollapseWallets(t){te.features={...te.features,collapseWallets:t}},setEnableEmbedded(t){te.enableEmbedded=t},setAllowUnsupportedChain(t){te.allowUnsupportedChain=t},setManualWCControl(t){te.manualWCControl=t},setEnableNetworkSwitch(t){te.enableNetworkSwitch=t},setEnableMobileFullScreen(t){te.enableMobileFullScreen=Y.isMobile()&&t},setEnableReconnect(t){te.enableReconnect=t},setCoinbasePreference(t){te.coinbasePreference=t},setDefaultAccountTypes(t={}){Object.entries(t).forEach(([e,s])=>{s&&(te.defaultAccountTypes[e]=s)})},setUniversalProviderConfigOverride(t){te.universalProviderConfigOverride=t},getUniversalProviderConfigOverride(){return te.universalProviderConfigOverride},getSnapshot(){return ui(te)}},Tn=Object.freeze({message:"",variant:"success",svg:void 0,open:!1,autoClose:!0}),je=ke({...Tn}),Em={state:je,subscribeKey(t,e){return tt(je,t,e)},showLoading(t,e={}){this._showMessage({message:t,variant:"loading",...e})},showSuccess(t){this._showMessage({message:t,variant:"success"})},showSvg(t,e){this._showMessage({message:t,svg:e})},showError(t){const e=Y.parseError(t);this._showMessage({message:e,variant:"error"})},hide(){je.message=Tn.message,je.variant=Tn.variant,je.svg=Tn.svg,je.open=Tn.open,je.autoClose=Tn.autoClose},_showMessage({message:t,svg:e,variant:s="success",autoClose:n=Tn.autoClose}){je.open?(je.open=!1,setTimeout(()=>{je.message=t,je.variant=s,je.svg=e,je.open=!0,je.autoClose=n},150)):(je.message=t,je.variant=s,je.svg=e,je.open=!0,je.autoClose=n)}},Es=Em,vm={purchaseCurrencies:[{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"Ether",symbol:"ETH",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]}],paymentCurrencies:[{id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},{id:"EUR",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]}]},Mh=Y.getBlockchainApiUrl(),dt=ke({clientId:null,api:new Ii({baseUrl:Mh,clientId:null}),supportedChains:{http:[],ws:[]}}),re={state:dt,async get(t){const{st:e,sv:s}=re.getSdkProperties(),n=U.state.projectId,r={...t.params||{},st:e,sv:s,projectId:n};return dt.api.get({...t,params:r})},getSdkProperties(){const{sdkType:t,sdkVersion:e}=U.state;return{st:t||"unknown",sv:e||"unknown"}},async isNetworkSupported(t){if(!t)return!1;try{dt.supportedChains.http.length||await re.getSupportedNetworks()}catch{return!1}return dt.supportedChains.http.includes(t)},async getSupportedNetworks(){try{const t=await re.get({path:"v1/supported-chains"});return dt.supportedChains=t,t}catch{return dt.supportedChains}},async fetchIdentity({address:t}){const e=L.getIdentityFromCacheForAddress(t);if(e)return e;const s=await re.get({path:`/v1/identity/${t}`,params:{sender:m.state.activeCaipAddress?Y.getPlainAddress(m.state.activeCaipAddress):void 0}});return L.updateIdentityCache({address:t,identity:s,timestamp:Date.now()}),s},async fetchTransactions({account:t,cursor:e,signal:s,cache:n,chainId:r}){var c;if(!await re.isNetworkSupported((c=m.state.activeCaipNetwork)==null?void 0:c.caipNetworkId))return{data:[],next:void 0};const o=L.getTransactionsCacheForAddress({address:t,chainId:r});if(o)return o;const a=await re.get({path:`/v1/account/${t}/history`,params:{cursor:e,chainId:r},signal:s,cache:n});return L.updateTransactionsCache({address:t,chainId:r,timestamp:Date.now(),transactions:a}),a},async fetchSwapQuote({amount:t,userAddress:e,from:s,to:n,gasPrice:r}){var o;return await re.isNetworkSupported((o=m.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)?re.get({path:"/v1/convert/quotes",headers:{"Content-Type":"application/json"},params:{amount:t,userAddress:e,from:s,to:n,gasPrice:r}}):{quotes:[]}},async fetchSwapTokens({chainId:t}){var s;return await re.isNetworkSupported((s=m.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?re.get({path:"/v1/convert/tokens",params:{chainId:t}}):{tokens:[]}},async getAddressBalance({caipNetworkId:t,address:e}){return dt.api.post({path:`/v1?chainId=${t}&projectId=${U.state.projectId}`,body:{id:"1",jsonrpc:"2.0",method:"getAddressBalance",params:{address:e}}}).then(s=>s.result)},async fetchTokenPrice({addresses:t,caipNetworkId:e=(s=>(s=m.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)()}){if(!await re.isNetworkSupported(e))return{fungibles:[]};const r=L.getTokenPriceCacheForAddresses(t);if(r)return r;const i=await dt.api.post({path:"/v1/fungible/price",body:{currency:"usd",addresses:t,projectId:U.state.projectId},headers:{"Content-Type":"application/json"}});return L.updateTokenPriceCache({addresses:t,timestamp:Date.now(),tokenPrice:i}),i},async fetchSwapAllowance({tokenAddress:t,userAddress:e}){var n;return await re.isNetworkSupported((n=m.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?re.get({path:"/v1/convert/allowance",params:{tokenAddress:t,userAddress:e},headers:{"Content-Type":"application/json"}}):{allowance:"0"}},async fetchGasPrice({chainId:t}){var r;const{st:e,sv:s}=re.getSdkProperties();if(!await re.isNetworkSupported((r=m.state.activeCaipNetwork)==null?void 0:r.caipNetworkId))throw new Error("Network not supported for Gas Price");return re.get({path:"/v1/convert/gas-price",headers:{"Content-Type":"application/json"},params:{chainId:t,st:e,sv:s}})},async generateSwapCalldata({amount:t,from:e,to:s,userAddress:n,disableEstimate:r}){var o;if(!await re.isNetworkSupported((o=m.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return dt.api.post({path:"/v1/convert/build-transaction",headers:{"Content-Type":"application/json"},body:{amount:t,eip155:{slippage:fe.CONVERT_SLIPPAGE_TOLERANCE},projectId:U.state.projectId,from:e,to:s,userAddress:n,disableEstimate:r}})},async generateApproveCalldata({from:t,to:e,userAddress:s}){var o;const{st:n,sv:r}=re.getSdkProperties();if(!await re.isNetworkSupported((o=m.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return re.get({path:"/v1/convert/build-approve",headers:{"Content-Type":"application/json"},params:{userAddress:s,from:t,to:e,st:n,sv:r}})},async getBalance(t,e,s){var l;const{st:n,sv:r}=re.getSdkProperties();if(!await re.isNetworkSupported((l=m.state.activeCaipNetwork)==null?void 0:l.caipNetworkId))return Es.showError("Token Balance Unavailable"),{balances:[]};const o=`${e}:${t}`,a=L.getBalanceCacheForCaipAddress(o);if(a)return a;const c=await re.get({path:`/v1/account/${t}/balance`,params:{currency:"usd",chainId:e,forceUpdate:s,st:n,sv:r}});return L.updateBalanceCache({caipAddress:o,balance:c,timestamp:Date.now()}),c},async lookupEnsName(t){var s;return await re.isNetworkSupported((s=m.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?re.get({path:`/v1/profile/account/${t}`,params:{apiVersion:"2"}}):{addresses:{},attributes:[]}},async reverseLookupEnsName({address:t}){var n,r;if(!await re.isNetworkSupported((n=m.state.activeCaipNetwork)==null?void 0:n.caipNetworkId))return[];const s=(r=m.getAccountData())==null?void 0:r.address;return re.get({path:`/v1/profile/reverse/${t}`,params:{sender:s,apiVersion:"2"}})},async getEnsNameSuggestions(t){var s;return await re.isNetworkSupported((s=m.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?re.get({path:`/v1/profile/suggestions/${t}`,params:{zone:"reown.id"}}):{suggestions:[]}},async registerEnsName({coinType:t,address:e,message:s,signature:n}){var i;return await re.isNetworkSupported((i=m.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)?dt.api.post({path:"/v1/profile/account",body:{coin_type:t,address:e,message:s,signature:n},headers:{"Content-Type":"application/json"}}):{success:!1}},async generateOnRampURL({destinationWallets:t,partnerUserId:e,defaultNetwork:s,purchaseAmount:n,paymentAmount:r}){var a;return await re.isNetworkSupported((a=m.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)?(await dt.api.post({path:"/v1/generators/onrampurl",params:{projectId:U.state.projectId},body:{destinationWallets:t,defaultNetwork:s,partnerUserId:e,defaultExperience:"buy",presetCryptoAmount:n,presetFiatAmount:r}})).url:""},async getOnrampOptions(){var e;if(!await re.isNetworkSupported((e=m.state.activeCaipNetwork)==null?void 0:e.caipNetworkId))return{paymentCurrencies:[],purchaseCurrencies:[]};try{return await re.get({path:"/v1/onramp/options"})}catch{return vm}},async getOnrampQuote({purchaseCurrency:t,paymentCurrency:e,amount:s,network:n}){var r;try{return await re.isNetworkSupported((r=m.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?await dt.api.post({path:"/v1/onramp/quote",params:{projectId:U.state.projectId},body:{purchaseCurrency:t,paymentCurrency:e,amount:s,network:n}}):null}catch{return{networkFee:{amount:s,currency:e.id},paymentSubtotal:{amount:s,currency:e.id},paymentTotal:{amount:s,currency:e.id},purchaseAmount:{amount:s,currency:e.id},quoteId:"mocked-quote-id"}}},async getSmartSessions(t){var s;return await re.isNetworkSupported((s=m.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?re.get({path:`/v1/sessions/${t}`}):[]},async revokeSmartSession(t,e,s){var r;return await re.isNetworkSupported((r=m.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?dt.api.post({path:`/v1/sessions/${t}/revoke`,params:{projectId:U.state.projectId},body:{pci:e,signature:s}}):{success:!1}},setClientId(t){dt.clientId=t,dt.api=new Ii({baseUrl:Mh,clientId:t})}},Cm=Object.freeze({enabled:!0,events:[]}),Am=new Ii({baseUrl:Y.getAnalyticsUrl(),clientId:null}),Im=5,Nm=60*1e3,Ys=ke({...Cm}),Sm={state:Ys,subscribeKey(t,e){return tt(Ys,t,e)},async sendError(t,e){if(!Ys.enabled)return;const s=Date.now();if(Ys.events.filter(i=>{const o=new Date(i.properties.timestamp||"").getTime();return s-o<Nm}).length>=Im)return;const r={type:"error",event:e,properties:{errorType:t.name,errorMessage:t.message,stackTrace:t.stack,timestamp:new Date().toISOString()}};Ys.events.push(r);try{if(typeof window>"u")return;const{projectId:i,sdkType:o,sdkVersion:a}=U.state;await Am.post({path:"/e",params:{projectId:i,st:o,sv:a||"html-wagmi-4.2.2"},body:{eventId:Y.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:new Date().toISOString(),props:{type:"error",event:e,errorType:t.name,errorMessage:t.message,stackTrace:t.stack}}})}catch{}},enable(){Ys.enabled=!0},disable(){Ys.enabled=!1},clearEvents(){Ys.events=[]}};class Hn extends Error{constructor(e,s,n){super(e),this.originalName="AppKitError",this.name="AppKitError",this.category=s,this.originalError=n,n&&n instanceof Error&&(this.originalName=n.name),Object.setPrototypeOf(this,Hn.prototype);let r=!1;if(n instanceof Error&&typeof n.stack=="string"&&n.stack){const i=n.stack,o=i.indexOf(`
`);if(o>-1){const a=i.substring(o+1);this.stack=`${this.name}: ${this.message}
${a}`,r=!0}}r||(Error.captureStackTrace?Error.captureStackTrace(this,Hn):this.stack||(this.stack=`${this.name}: ${this.message}`))}}function zl(t,e){let s="";try{t instanceof Error?s=t.message:typeof t=="string"?s=t:typeof t=="object"&&t!==null?Object.keys(t).length===0?s="Unknown error":s=(t==null?void 0:t.message)||JSON.stringify(t):s=String(t)}catch(r){s="Unknown error",console.error("Error parsing error message",r)}const n=t instanceof Hn?t:new Hn(s,e,t);throw Sm.sendError(n,n.category),n}function es(t,e="INTERNAL_SDK_ERROR"){const s={};return Object.keys(t).forEach(n=>{const r=t[n];if(typeof r=="function"){let i=r;r.constructor.name==="AsyncFunction"?i=async(...o)=>{try{return await r(...o)}catch(a){return zl(a,e)}}:i=(...o)=>{try{return r(...o)}catch(a){return zl(a,e)}},s[n]=i}else s[n]=r}),s}const Tt=ke({walletImages:{},networkImages:{},chainImages:{},connectorImages:{},tokenImages:{},currencyImages:{}}),_m={state:Tt,subscribeNetworkImages(t){return et(Tt.networkImages,()=>t(Tt.networkImages))},subscribeKey(t,e){return tt(Tt,t,e)},subscribe(t){return et(Tt,()=>t(Tt))},setWalletImage(t,e){Tt.walletImages[t]=e},setNetworkImage(t,e){Tt.networkImages[t]=e},setChainImage(t,e){Tt.chainImages[t]=e},setConnectorImage(t,e){Tt.connectorImages={...Tt.connectorImages,[t]:e}},setTokenImage(t,e){Tt.tokenImages[t]=e},setCurrencyImage(t,e){Tt.currencyImages[t]=e}},Jt=es(_m),Kl={eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"a1b58899-f671-4276-6a5e-56ca5bd59700",polkadot:"",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00",cosmos:"",sui:"",stacks:"",ton:"20f673c0-095e-49b2-07cf-eb5049dcf600"},nr=ke({networkImagePromises:{},tokenImagePromises:{}}),Eo={async fetchWalletImage(t){if(t)return await X._fetchWalletImage(t),this.getWalletImageById(t)},async fetchNetworkImage(t){if(!t)return;const e=this.getNetworkImageById(t);return e||(nr.networkImagePromises[t]||(nr.networkImagePromises[t]=X._fetchNetworkImage(t)),await nr.networkImagePromises[t],this.getNetworkImageById(t))},async fetchTokenImage(t){if(t)return nr.tokenImagePromises[t]||(nr.tokenImagePromises[t]=X._fetchTokenImage(t)),await nr.tokenImagePromises[t],this.getTokenImage(t)},getWalletImageById(t){if(t)return Jt.state.walletImages[t]},getWalletImage(t){if(t!=null&&t.image_url)return t==null?void 0:t.image_url;if(t!=null&&t.image_id)return Jt.state.walletImages[t.image_id]},getNetworkImage(t){var e,s,n;if((e=t==null?void 0:t.assets)!=null&&e.imageUrl)return(s=t==null?void 0:t.assets)==null?void 0:s.imageUrl;if((n=t==null?void 0:t.assets)!=null&&n.imageId)return Jt.state.networkImages[t.assets.imageId]},getNetworkImageById(t){if(t)return Jt.state.networkImages[t]},getConnectorImage(t){var e;if(t!=null&&t.imageUrl)return t.imageUrl;if((e=t==null?void 0:t.info)!=null&&e.icon)return t.info.icon;if(t!=null&&t.imageId)return Jt.state.connectorImages[t.imageId]},getChainImage(t){return Jt.state.networkImages[Kl[t]]},getTokenImage(t){if(t)return Jt.state.tokenImages[t]},getWalletImageUrl(t){if(!t)return"";const{projectId:e,sdkType:s,sdkVersion:n}=U.state,r=new URL(`${k.W3M_API_URL}/getWalletImage/${t}`);return r.searchParams.set("projectId",e),r.searchParams.set("st",s),r.searchParams.set("sv",n),r.toString()},getAssetImageUrl(t){if(!t)return"";const{projectId:e,sdkType:s,sdkVersion:n}=U.state,r=new URL(`${k.W3M_API_URL}/public/getAssetImage/${t}`);return r.searchParams.set("projectId",e),r.searchParams.set("st",s),r.searchParams.set("sv",n),r.toString()},getChainNamespaceImageUrl(t){return this.getAssetImageUrl(Kl[t])},async getImageByToken(t,e){if(t==="native"){const n=k.NATIVE_IMAGE_IDS_BY_NAMESPACE[e]??null;return n?Eo.fetchNetworkImage(n):void 0}const[,s]=Object.entries(k.TOKEN_SYMBOLS_BY_ADDRESS).find(([n])=>n.toLowerCase()===t.toLowerCase())??[];if(s)return Eo.fetchTokenImage(s)}},Kt={PHANTOM:{id:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",url:"https://phantom.app"},SOLFLARE:{id:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",url:"https://solflare.com"},COINBASE:{id:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",url:"https://go.cb-w.com"},BINANCE:{id:"2fafea35bb471d22889ccb49c08d99dd0a18a37982602c33f696a5723934ba25",appId:"yFK5FCqYprrXDiVFbhyRx7",deeplink:"bnc://app.binance.com/mp/app",url:"https://app.binance.com/en/download"}},Tm={handleMobileDeeplinkRedirect(t,e){const s=window.location.href,n=encodeURIComponent(s);if(t===Kt.PHANTOM.id&&!("phantom"in window)){const r=s.startsWith("https")?"https":"http",i=s.split("/")[2],o=encodeURIComponent(`${r}://${i}`);window.location.href=`${Kt.PHANTOM.url}/ul/browse/${n}?ref=${o}`}if(t===Kt.SOLFLARE.id&&!("solflare"in window)&&(window.location.href=`${Kt.SOLFLARE.url}/ul/v1/browse/${n}?ref=${n}`),e===k.CHAIN.SOLANA&&t===Kt.COINBASE.id&&!("coinbaseSolana"in window)&&(window.location.href=`${Kt.COINBASE.url}/dapp?cb_url=${n}`),e===k.CHAIN.BITCOIN&&t===Kt.BINANCE.id&&!("binancew3w"in window)){const r=m.state.activeCaipNetwork,i=window.btoa("/pages/browser/index"),o=window.btoa(`url=${n}&defaultChainId=${(r==null?void 0:r.id)??1}`),a=new URL(Kt.BINANCE.deeplink);a.searchParams.set("appId",Kt.BINANCE.appId),a.searchParams.set("startPagePath",i),a.searchParams.set("startPageQuery",o);const c=new URL(Kt.BINANCE.url);c.searchParams.set("_dp",window.btoa(a.toString())),window.location.href=c.toString()}}},xm=Y.getAnalyticsUrl(),Om=new Ii({baseUrl:xm,clientId:null}),Pm=["MODAL_CREATED"],km=45,Vl=1e3*10,De=ke({timestamp:Date.now(),lastFlush:Date.now(),reportedErrors:{},data:{type:"track",event:"MODAL_CREATED"},pendingEvents:[],subscribedToVisibilityChange:!1,walletImpressions:[]}),de={state:De,subscribe(t){return et(De,()=>t(De))},getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:s}=U.state;return{projectId:t,st:e,sv:s||"html-wagmi-4.2.2"}},shouldFlushEvents(){const t=JSON.stringify(De.pendingEvents).length/1024>km,e=De.lastFlush+Vl<Date.now();return t||e},_setPendingEvent(t){var e,s;try{let n=(e=m.getAccountData())==null?void 0:e.address;if("address"in t.data&&t.data.address&&(n=t.data.address),Pm.includes(t.data.event)||typeof window>"u")return;const r=(s=m.getActiveCaipNetwork())==null?void 0:s.caipNetworkId;this.state.pendingEvents.push({eventId:Y.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:t.timestamp,props:{...t.data,address:n,properties:{..."properties"in t.data?t.data.properties:{},caipNetworkId:r}}}),De.reportedErrors.FORBIDDEN=!1,de.shouldFlushEvents()&&de._submitPendingEvents()}catch(n){console.warn("_setPendingEvent",n)}},sendEvent(t){var s;De.timestamp=Date.now(),De.data=t;const e=["INITIALIZE","CONNECT_SUCCESS","SOCIAL_LOGIN_SUCCESS"];((s=U.state.features)!=null&&s.analytics||e.includes(t.event))&&de._setPendingEvent(De),this.subscribeToFlushTriggers()},sendWalletImpressionEvent(t){De.walletImpressions.push(t)},_transformPendingEventsForBatch(t){try{return t.filter(e=>e.props.event!=="WALLET_IMPRESSION_V2")}catch{return t}},_submitPendingEvents(){if(De.lastFlush=Date.now(),!(De.pendingEvents.length===0&&De.walletImpressions.length===0))try{const t=de._transformPendingEventsForBatch(De.pendingEvents);De.walletImpressions.length&&t.push({eventId:Y.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:Date.now(),props:{type:"track",event:"WALLET_IMPRESSION_V2",items:[...De.walletImpressions]}}),Om.sendBeacon({path:"/batch",params:de.getSdkProperties(),body:t}),De.reportedErrors.FORBIDDEN=!1,De.pendingEvents=[],De.walletImpressions=[]}catch{De.reportedErrors.FORBIDDEN=!0}},subscribeToFlushTriggers(){var t,e,s;De.subscribedToVisibilityChange||typeof document>"u"||(De.subscribedToVisibilityChange=!0,(t=document==null?void 0:document.addEventListener)==null||t.call(document,"visibilitychange",()=>{document.visibilityState==="hidden"&&de._submitPendingEvents()}),(e=document==null?void 0:document.addEventListener)==null||e.call(document,"freeze",()=>{de._submitPendingEvents()}),(s=window==null?void 0:window.addEventListener)==null||s.call(window,"pagehide",()=>{de._submitPendingEvents()}),setInterval(()=>{de._submitPendingEvents()},Vl))}},Rm=Y.getApiUrl(),ut=new Ii({baseUrl:Rm,clientId:null}),Um=40,Gl=4,$m=20,oe=ke({promises:{},page:1,count:0,featured:[],allFeatured:[],recommended:[],allRecommended:[],wallets:[],filteredWallets:[],search:[],isAnalyticsEnabled:!1,excludedWallets:[],isFetchingRecommendedWallets:!1,explorerWallets:[],explorerFilteredWallets:[],plan:{tier:"none",hasExceededUsageLimit:!1,limits:{isAboveRpcLimit:!1,isAboveMauLimit:!1}}}),X={state:oe,subscribeKey(t,e){return tt(oe,t,e)},_getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:s}=U.state;return{projectId:t,st:e||"appkit",sv:s||"html-wagmi-4.2.2"}},_filterOutExtensions(t){return U.state.isUniversalProvider?t.filter(e=>!!(e.mobile_link||e.desktop_link||e.webapp_link)):t},async _fetchWalletImage(t){const e=`${ut.baseUrl}/getWalletImage/${t}`,s=await ut.getBlob({path:e,params:X._getSdkProperties()});Jt.setWalletImage(t,URL.createObjectURL(s))},async _fetchNetworkImage(t){const e=`${ut.baseUrl}/public/getAssetImage/${t}`,s=await ut.getBlob({path:e,params:X._getSdkProperties()});Jt.setNetworkImage(t,URL.createObjectURL(s))},async _fetchConnectorImage(t){const e=`${ut.baseUrl}/public/getAssetImage/${t}`,s=await ut.getBlob({path:e,params:X._getSdkProperties()});Jt.setConnectorImage(t,URL.createObjectURL(s))},async _fetchCurrencyImage(t){const e=`${ut.baseUrl}/public/getCurrencyImage/${t}`,s=await ut.getBlob({path:e,params:X._getSdkProperties()});Jt.setCurrencyImage(t,URL.createObjectURL(s))},async _fetchTokenImage(t){const e=`${ut.baseUrl}/public/getTokenImage/${t}`,s=await ut.getBlob({path:e,params:X._getSdkProperties()});Jt.setTokenImage(t,URL.createObjectURL(s))},_filterWalletsByPlatform(t){const e=t.length,s=Y.isMobile()?t==null?void 0:t.filter(r=>r.mobile_link||r.webapp_link?!0:Object.values(Kt).map(o=>o.id).includes(r.id)):t,n=e-s.length;return{filteredWallets:s,mobileFilteredOutWalletsLength:n}},async fetchProjectConfig(){return(await ut.get({path:"/appkit/v1/config",params:X._getSdkProperties()})).features},async fetchUsage(){try{const t=await ut.get({path:"/appkit/v1/project-limits",params:X._getSdkProperties()}),{tier:e,isAboveMauLimit:s,isAboveRpcLimit:n}=t.planLimits,r=e==="starter",i=s||n;X.state.plan={tier:e,hasExceededUsageLimit:r&&i,limits:{isAboveRpcLimit:n,isAboveMauLimit:s}}}catch(t){console.warn("Failed to fetch usage",t)}},async fetchAllowedOrigins(){try{const{allowedOrigins:t}=await ut.get({path:"/projects/v1/origins",params:X._getSdkProperties()});return t}catch(t){if(t instanceof Error&&t.cause instanceof Response){const e=t.cause.status;if(e===k.HTTP_STATUS_CODES.TOO_MANY_REQUESTS)throw new Error("RATE_LIMITED",{cause:t});if(e>=k.HTTP_STATUS_CODES.SERVER_ERROR&&e<600)throw new Error("SERVER_ERROR",{cause:t});return[]}return[]}},async fetchNetworkImages(){const t=m.getAllRequestedCaipNetworks(),e=t==null?void 0:t.map(({assets:s})=>s==null?void 0:s.imageId).filter(Boolean).filter(s=>!Eo.getNetworkImageById(s));e&&await Promise.allSettled(e.map(s=>X._fetchNetworkImage(s)))},async fetchConnectorImages(){const{connectors:t}=j.state,e=t.map(({imageId:s})=>s).filter(Boolean);await Promise.allSettled(e.map(s=>X._fetchConnectorImage(s)))},async fetchCurrencyImages(t=[]){await Promise.allSettled(t.map(e=>X._fetchCurrencyImage(e)))},async fetchTokenImages(t=[]){await Promise.allSettled(t.map(e=>X._fetchTokenImage(e)))},async fetchWallets(t){var o;const e=t.exclude??[];X._getSdkProperties().sv.startsWith("html-core-")&&e.push(...Object.values(Kt).map(a=>a.id));const n=await ut.get({path:"/getWallets",params:{...X._getSdkProperties(),...t,page:String(t.page),entries:String(t.entries),include:(o=t.include)==null?void 0:o.join(","),exclude:e.join(",")}}),{filteredWallets:r,mobileFilteredOutWalletsLength:i}=X._filterWalletsByPlatform(n==null?void 0:n.data);return{data:r||[],count:n==null?void 0:n.count,mobileFilteredOutWalletsLength:i}},async prefetchWalletRanks(){const t=j.state.connectors;if(!(t!=null&&t.length))return;const e={page:1,entries:20,badge:"certified"};if(e.names=t.map(r=>r.name).join(","),m.state.activeChain===k.CHAIN.EVM){const r=[...t.flatMap(i=>{var o;return((o=i.connectors)==null?void 0:o.map(a=>{var c;return(c=a.info)==null?void 0:c.rdns}))||[]}),...t.map(i=>{var o;return(o=i.info)==null?void 0:o.rdns})].filter(i=>typeof i=="string"&&i.length>0);r.length&&(e.rdns=r.join(","))}const{data:s}=await X.fetchWallets(e);oe.explorerWallets=s,j.extendConnectorsWithExplorerWallets(s);const n=m.getRequestedCaipNetworkIds().join(",");oe.explorerFilteredWallets=s.filter(r=>{var i;return(i=r.chains)==null?void 0:i.some(o=>n.includes(o))})},async fetchFeaturedWallets(){const{featuredWalletIds:t}=U.state;if(t!=null&&t.length){const e={...X._getSdkProperties(),page:1,entries:(t==null?void 0:t.length)??Gl,include:t},{data:s}=await X.fetchWallets(e),n=[...s].sort((i,o)=>t.indexOf(i.id)-t.indexOf(o.id)),r=n.map(i=>i.image_id).filter(Boolean);await Promise.allSettled(r.map(i=>X._fetchWalletImage(i))),oe.featured=n,oe.allFeatured=n}},async fetchRecommendedWallets(){try{oe.isFetchingRecommendedWallets=!0;const{includeWalletIds:t,excludeWalletIds:e,featuredWalletIds:s}=U.state,n=[...e??[],...s??[]].filter(Boolean),r=m.getRequestedCaipNetworkIds().join(","),i={page:1,entries:Gl,include:t,exclude:n,chains:r},{data:o,count:a}=await X.fetchWallets(i),c=L.getRecentWallets(),l=o.map(u=>u.image_id).filter(Boolean),d=c.map(u=>u.image_id).filter(Boolean);await Promise.allSettled([...l,...d].map(u=>X._fetchWalletImage(u))),oe.recommended=o,oe.allRecommended=o,oe.count=a??0}catch{}finally{oe.isFetchingRecommendedWallets=!1}},async fetchWalletsByPage({page:t}){const{includeWalletIds:e,excludeWalletIds:s,featuredWalletIds:n}=U.state,r=m.getRequestedCaipNetworkIds().join(","),i=[...oe.recommended.map(({id:u})=>u),...s??[],...n??[]].filter(Boolean),o={page:t,entries:Um,include:e,exclude:i,chains:r},{data:a,count:c,mobileFilteredOutWalletsLength:l}=await X.fetchWallets(o);oe.mobileFilteredOutWalletsLength=l+(oe.mobileFilteredOutWalletsLength??0);const d=a.slice(0,$m).map(u=>u.image_id).filter(Boolean);await Promise.allSettled(d.map(u=>X._fetchWalletImage(u))),oe.wallets=Y.uniqueBy([...oe.wallets,...X._filterOutExtensions(a)],"id").filter(u=>{var h;return(h=u.chains)==null?void 0:h.some(f=>r.includes(f))}),oe.count=c>oe.count?c:oe.count,oe.page=t},async initializeExcludedWallets({ids:t}){const e={page:1,entries:t.length,include:t},{data:s}=await X.fetchWallets(e);s&&s.forEach(n=>{oe.excludedWallets.push({rdns:n.rdns,name:n.name})})},async searchWallet({search:t,badge:e}){const{includeWalletIds:s,excludeWalletIds:n}=U.state,r=m.getRequestedCaipNetworkIds().join(",");oe.search=[];const i={page:1,entries:100,search:t==null?void 0:t.trim(),badge_type:e,include:s,exclude:n,chains:r},{data:o}=await X.fetchWallets(i);de.sendEvent({type:"track",event:"SEARCH_WALLET",properties:{badge:e??"",search:t??""}});const a=o.map(c=>c.image_id).filter(Boolean);await Promise.allSettled([...a.map(c=>X._fetchWalletImage(c)),Y.wait(300)]),oe.search=X._filterOutExtensions(o)},initPromise(t,e){const s=oe.promises[t];return s||(oe.promises[t]=e())},prefetch({fetchConnectorImages:t=!0,fetchFeaturedWallets:e=!0,fetchRecommendedWallets:s=!0,fetchNetworkImages:n=!0,fetchWalletRanks:r=!0}={}){const i=[t&&X.initPromise("connectorImages",X.fetchConnectorImages),e&&X.initPromise("featuredWallets",X.fetchFeaturedWallets),s&&X.initPromise("recommendedWallets",X.fetchRecommendedWallets),n&&X.initPromise("networkImages",X.fetchNetworkImages),r&&X.initPromise("walletRanks",X.prefetchWalletRanks)].filter(Boolean);return Promise.allSettled(i)},prefetchAnalyticsConfig(){var t;(t=U.state.features)!=null&&t.analytics&&X.fetchAnalyticsConfig()},async fetchAnalyticsConfig(){try{const{isAnalyticsEnabled:t}=await ut.get({path:"/getAnalyticsConfig",params:X._getSdkProperties()});U.setFeatures({analytics:t})}catch{U.setFeatures({analytics:!1})}},filterByNamespaces(t){if(!(t!=null&&t.length)){oe.featured=oe.allFeatured,oe.recommended=oe.allRecommended;return}const e=m.getRequestedCaipNetworkIds().join(",");oe.featured=oe.allFeatured.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(r=>e.includes(r))}),oe.recommended=oe.allRecommended.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(r=>e.includes(r))}),oe.filteredWallets=oe.wallets.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(r=>e.includes(r))})},clearFilterByNamespaces(){oe.filteredWallets=[]},setFilterByNamespace(t){if(!t){oe.featured=oe.allFeatured,oe.recommended=oe.allRecommended;return}const e=m.getRequestedCaipNetworkIds().join(",");oe.featured=oe.allFeatured.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(r=>e.includes(r))}),oe.recommended=oe.allRecommended.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(r=>e.includes(r))}),oe.filteredWallets=oe.wallets.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(r=>e.includes(r))})}},hn={filterOutDuplicatesByRDNS(t){const e=U.state.enableEIP6963?j.state.connectors:[],s=L.getRecentWallets(),n=e.map(a=>{var c;return(c=a.info)==null?void 0:c.rdns}).filter(Boolean),r=s.map(a=>a.rdns).filter(Boolean),i=n.concat(r);if(i.includes("io.metamask.mobile")&&Y.isMobile()){const a=i.indexOf("io.metamask.mobile");i[a]="io.metamask"}return t.filter(a=>!(a!=null&&a.rdns&&i.includes(String(a.rdns))||!(a!=null&&a.rdns)&&e.some(l=>l.name===a.name)))},filterOutDuplicatesByIds(t){const e=j.state.connectors.filter(a=>a.type==="ANNOUNCED"||a.type==="INJECTED"||a.type==="MULTI_CHAIN"),s=L.getRecentWallets(),n=e.map(a=>{var c;return a.explorerId||((c=a.explorerWallet)==null?void 0:c.id)||a.id}),r=s.map(a=>a.id),i=n.concat(r);return t.filter(a=>!i.includes(a==null?void 0:a.id))},filterOutDuplicateWallets(t){const e=this.filterOutDuplicatesByRDNS(t);return this.filterOutDuplicatesByIds(e)},markWalletsAsInstalled(t){const{connectors:e}=j.state,{featuredWalletIds:s}=U.state,n=e.filter(o=>o.type==="ANNOUNCED").reduce((o,a)=>{var c;return(c=a.info)!=null&&c.rdns&&(o[a.info.rdns]=!0),o},{});return t.map(o=>({...o,installed:!!o.rdns&&!!n[o.rdns??""]})).sort((o,a)=>{const c=Number(a.installed)-Number(o.installed);if(c!==0)return c;if(s!=null&&s.length){const l=s.indexOf(o.id),d=s.indexOf(a.id);if(l!==-1&&d!==-1)return l-d;if(l!==-1)return-1;if(d!==-1)return 1}return 0})},getConnectOrderMethod(t,e){var c;const s=(t==null?void 0:t.connectMethodsOrder)||((c=U.state.features)==null?void 0:c.connectMethodsOrder),n=e||j.state.connectors;if(s)return s;const{injected:r,announced:i}=ht.getConnectorsByType(n,X.state.recommended,X.state.featured),o=r.filter(ht.showConnector),a=i.filter(ht.showConnector);return o.length||a.length?["wallet","email","social"]:fe.DEFAULT_CONNECT_METHOD_ORDER},isExcluded(t){const e=!!t.rdns&&X.state.excludedWallets.some(n=>n.rdns===t.rdns),s=!!t.name&&X.state.excludedWallets.some(n=>Oh.isLowerCaseMatch(n.name,t.name));return e||s},markWalletsWithDisplayIndex(t){return t.map((e,s)=>({...e,display_index:s}))},filterWalletsByWcSupport(t){return H.state.wcBasic?t.filter(e=>e.supports_wc):Y.isMobile()?t.filter(e=>e.supports_wc||fe.MANDATORY_WALLET_IDS_ON_MOBILE.includes(e.id)):t},getWalletConnectWallets(t){var i;const e=[...X.state.featured,...X.state.recommended];((i=X.state.filteredWallets)==null?void 0:i.length)>0?e.push(...X.state.filteredWallets):e.push(...t);const s=Y.uniqueBy(e,"id"),n=hn.markWalletsAsInstalled(s),r=hn.filterWalletsByWcSupport(n);return hn.markWalletsWithDisplayIndex(r)}},ht={getConnectorsByType(t,e,s){const{customWallets:n}=U.state,r=L.getRecentWallets(),i=hn.filterOutDuplicateWallets(e),o=hn.filterOutDuplicateWallets(s),a=t.filter(u=>u.type==="MULTI_CHAIN"),c=t.filter(u=>u.type==="ANNOUNCED"),l=t.filter(u=>u.type==="INJECTED"),d=t.filter(u=>u.type==="EXTERNAL");return{custom:n,recent:r,external:d,multiChain:a,announced:c,injected:l,recommended:i,featured:o}},showConnector(t){var r;const e=(r=t.info)==null?void 0:r.rdns,s=!!e&&X.state.excludedWallets.some(i=>!!i.rdns&&i.rdns===e),n=!!t.name&&X.state.excludedWallets.some(i=>Oh.isLowerCaseMatch(i.name,t.name));return!(t.type==="INJECTED"&&(t.name==="Browser Wallet"&&(!Y.isMobile()||Y.isMobile()&&!e&&!H.checkInstalled())||s||n)||(t.type==="ANNOUNCED"||t.type==="EXTERNAL")&&(s||n))},getIsConnectedWithWC(){return Array.from(m.state.chains.values()).some(s=>j.getConnectorId(s.namespace)===k.CONNECTOR_ID.WALLET_CONNECT)},getConnectorTypeOrder({recommended:t,featured:e,custom:s,recent:n,announced:r,injected:i,multiChain:o,external:a,overriddenConnectors:c=(l=>(l=U.state.features)==null?void 0:l.connectorTypeOrder)()??[]}){const u=[{type:"walletConnect",isEnabled:!0},{type:"recent",isEnabled:n.length>0},{type:"injected",isEnabled:[...i,...r,...o].length>0},{type:"featured",isEnabled:e.length>0},{type:"custom",isEnabled:s&&s.length>0},{type:"external",isEnabled:a.length>0},{type:"recommended",isEnabled:t.length>0}].filter(p=>p.isEnabled),h=new Set(u.map(p=>p.type)),f=c.filter(p=>h.has(p)).map(p=>({type:p,isEnabled:!0})),g=u.filter(({type:p})=>!f.some(({type:b})=>b===p));return Array.from(new Set([...f,...g].map(({type:p})=>p)))},sortConnectorsByExplorerWallet(t){return[...t].sort((e,s)=>e.explorerWallet&&s.explorerWallet?(e.explorerWallet.order??0)-(s.explorerWallet.order??0):e.explorerWallet?-1:s.explorerWallet?1:0)},getPriority(t){return t.id===k.CONNECTOR_ID.BASE_ACCOUNT?0:t.id===k.CONNECTOR_ID.COINBASE||t.id===k.CONNECTOR_ID.COINBASE_SDK?1:2},sortConnectorsByPriority(t){return[...t].sort((e,s)=>ht.getPriority(e)-ht.getPriority(s))},getAuthName({email:t,socialUsername:e,socialProvider:s}){return e?s&&s==="discord"&&e.endsWith("0")?e.slice(0,-1):e:t.length>30?`${t.slice(0,-3)}...`:t},async fetchProviderData(t){var e,s;try{if(t.name==="Browser Wallet"&&!Y.isMobile())return{accounts:[],chainId:void 0};if(t.id===k.CONNECTOR_ID.AUTH)return{accounts:[],chainId:void 0};const[n,r]=await Promise.all([(e=t.provider)==null?void 0:e.request({method:"eth_accounts"}),(s=t.provider)==null?void 0:s.request({method:"eth_chainId"}).then(i=>Number(i))]);return{accounts:n,chainId:r}}catch(n){return console.warn(`Failed to fetch provider data for ${t.name}`,n),{accounts:[],chainId:void 0}}},getFilteredCustomWallets(t){const e=L.getRecentWallets(),s=j.state.connectors.map(o=>{var a;return(a=o.info)==null?void 0:a.rdns}).filter(Boolean),n=e.map(o=>o.rdns).filter(Boolean),r=s.concat(n);if(r.includes("io.metamask.mobile")&&Y.isMobile()){const o=r.indexOf("io.metamask.mobile");r[o]="io.metamask"}return t.filter(o=>!r.includes(String(o==null?void 0:o.rdns)))},hasWalletConnector(t){return j.state.connectors.some(e=>e.id===t.id||e.name===t.name)},isWalletCompatibleWithCurrentChain(t){const e=m.state.activeChain;return e&&t.chains?t.chains.some(s=>{const n=s.split(":")[0];return e===n}):!0},getFilteredRecentWallets(){return L.getRecentWallets().filter(s=>!hn.isExcluded(s)).filter(s=>!this.hasWalletConnector(s)).filter(s=>this.isWalletCompatibleWithCurrentChain(s))},getCappedRecommendedWallets(t){const{connectors:e}=j.state,{customWallets:s,featuredWalletIds:n}=U.state,r=e.find(I=>I.id==="walletConnect"),i=e.filter(I=>I.type==="INJECTED"||I.type==="ANNOUNCED"||I.type==="MULTI_CHAIN");if(!r&&!i.length&&!(s!=null&&s.length))return[];const o=tc.isEmailEnabled(),a=tc.isSocialsEnabled(),c=i.filter(I=>I.name!=="Browser Wallet"&&I.name!=="WalletConnect"),l=(n==null?void 0:n.length)||0,d=(s==null?void 0:s.length)||0,u=c.length||0,h=o?1:0,f=a?1:0,g=l+d+u+h+f,w=Math.max(0,4-g);return w<=0?[]:hn.filterOutDuplicateWallets(t).slice(0,w)},processConnectorsByType(t,e=!0){const s=ht.sortConnectorsByExplorerWallet([...t]);return e?s.filter(ht.showConnector):s},connectorList(){const t=ht.getConnectorsByType(j.state.connectors,X.state.recommended,X.state.featured),e=this.processConnectorsByType(t.announced.filter(f=>f.id!=="walletConnect")),s=this.processConnectorsByType(t.injected),n=this.processConnectorsByType(t.multiChain.filter(f=>f.name!=="WalletConnect"),!1),r=t.custom,i=t.recent,o=this.processConnectorsByType(t.external.filter(f=>f.id!==k.CONNECTOR_ID.COINBASE_SDK&&f.id!==k.CONNECTOR_ID.BASE_ACCOUNT)),a=t.recommended,c=t.featured,l=ht.getConnectorTypeOrder({custom:r,recent:i,announced:e,injected:s,multiChain:n,recommended:a,featured:c,external:o}),d=j.state.connectors.find(f=>f.id==="walletConnect"),u=Y.isMobile(),h=[];for(const f of l)switch(f){case"walletConnect":{!u&&d&&h.push({kind:"connector",subtype:"walletConnect",connector:d});break}case"recent":{ht.getFilteredRecentWallets().forEach(p=>h.push({kind:"wallet",subtype:"recent",wallet:p}));break}case"injected":{n.forEach(g=>h.push({kind:"connector",subtype:"multiChain",connector:g})),e.forEach(g=>h.push({kind:"connector",subtype:"announced",connector:g})),s.forEach(g=>h.push({kind:"connector",subtype:"injected",connector:g}));break}case"featured":{c.forEach(g=>h.push({kind:"wallet",subtype:"featured",wallet:g}));break}case"custom":{ht.getFilteredCustomWallets(r??[]).forEach(p=>h.push({kind:"wallet",subtype:"custom",wallet:p}));break}case"external":{o.forEach(g=>h.push({kind:"connector",subtype:"external",connector:g}));break}case"recommended":{ht.getCappedRecommendedWallets(a).forEach(p=>h.push({kind:"wallet",subtype:"recommended",wallet:p}));break}default:console.warn(`Unknown connector type: ${f}`)}return h},hasInjectedConnectors(){return j.state.connectors.filter(t=>(t.type==="INJECTED"||t.type==="ANNOUNCED"||t.type==="MULTI_CHAIN")&&t.name!=="Browser Wallet"&&t.name!=="WalletConnect").length}},Dm=["ConnectingExternal","ConnectingMultiChain","ConnectingSocial","ConnectingFarcaster"],Ae=ke({view:"Connect",history:["Connect"],transactionStack:[]}),Bm={state:Ae,subscribeKey(t,e){return tt(Ae,t,e)},pushTransactionStack(t){Ae.transactionStack.push(t)},popTransactionStack(t){const e=Ae.transactionStack.pop();if(!e)return;const{onSuccess:s,onError:n,onCancel:r}=e;switch(t){case"success":s==null||s();break;case"error":n==null||n(),se.goBack();break;case"cancel":r==null||r(),se.goBack();break}},push(t,e){let s=t,n=e;X.state.plan.hasExceededUsageLimit&&Dm.includes(t)&&(s="UsageExceeded",n=void 0),s!==Ae.view&&(Ae.view=s,Ae.history.push(s),Ae.data=n)},reset(t,e){Ae.view=t,Ae.history=[t],Ae.data=e},replace(t,e){Ae.history.at(-1)===t||(Ae.view=t,Ae.history[Ae.history.length-1]=t,Ae.data=e)},goBack(){var n,r;const t=m.state.activeCaipAddress,e=se.state.view==="ConnectingFarcaster",s=!t&&e;if(Ae.history.length>1){Ae.history.pop();const[i]=Ae.history.slice(-1);i&&(t&&i==="Connect"?Ae.view="Account":Ae.view=i)}else pe.close();(n=Ae.data)!=null&&n.wallet&&(Ae.data.wallet=void 0),(r=Ae.data)!=null&&r.redirectView&&(Ae.data.redirectView=void 0),setTimeout(()=>{var i,o,a;if(s){m.setAccountProp("farcasterUrl",void 0,m.state.activeChain);const c=j.getAuthConnector();(i=c==null?void 0:c.provider)==null||i.reload();const l=ui(U.state);(a=(o=c==null?void 0:c.provider)==null?void 0:o.syncDappData)==null||a.call(o,{metadata:l.metadata,sdkVersion:l.sdkVersion,projectId:l.projectId,sdkType:l.sdkType})}},100)},goBackToIndex(t){if(Ae.history.length>1){Ae.history=Ae.history.slice(0,t+1);const[e]=Ae.history.slice(-1);e&&(Ae.view=e)}},goBackOrCloseModal(){se.state.history.length>1?se.goBack():pe.close()}},se=es(Bm),_s=ke({themeMode:"dark",themeVariables:{},w3mThemeVariables:void 0}),sc={state:_s,subscribe(t){return et(_s,()=>t(_s))},setThemeMode(t){_s.themeMode=t;try{const e=j.getAuthConnector();if(e){const s=sc.getSnapshot().themeVariables;e.provider.syncTheme({themeMode:t,themeVariables:s,w3mThemeVariables:yo(s,t)})}}catch{console.info("Unable to sync theme to auth connector")}},setThemeVariables(t){_s.themeVariables={..._s.themeVariables,...t};try{const e=j.getAuthConnector();if(e){const s=sc.getSnapshot().themeVariables;e.provider.syncTheme({themeVariables:s,w3mThemeVariables:yo(_s.themeVariables,_s.themeMode)})}}catch{console.info("Unable to sync theme to auth connector")}},getSnapshot(){return ui(_s)}},Rt=es(sc),Fh=Object.fromEntries(kh.map(t=>[t,void 0])),Lm=Object.fromEntries(kh.map(t=>[t,!0])),we=ke({allConnectors:[],connectors:[],activeConnector:void 0,filterByNamespace:void 0,activeConnectorIds:Fh,filterByNamespaceMap:Lm}),Mm={state:we,subscribe(t){return et(we,()=>{t(we)})},subscribeKey(t,e){return tt(we,t,e)},initialize(t){t.forEach(e=>{const s=L.getConnectedConnectorId(e);s&&j.setConnectorId(s,e)})},setActiveConnector(t){t&&(we.activeConnector=hi(t))},setConnectors(t){t.filter(r=>!we.allConnectors.some(i=>i.id===r.id&&j.getConnectorName(i.name)===j.getConnectorName(r.name)&&i.chain===r.chain)).forEach(r=>{r.type!=="MULTI_CHAIN"&&we.allConnectors.push(hi(r))});const s=j.getEnabledNamespaces(),n=j.getEnabledConnectors(s);we.connectors=j.mergeMultiChainConnectors(n)},filterByNamespaces(t){Object.keys(we.filterByNamespaceMap).forEach(e=>{we.filterByNamespaceMap[e]=!1}),t.forEach(e=>{we.filterByNamespaceMap[e]=!0}),j.updateConnectorsForEnabledNamespaces()},filterByNamespace(t,e){we.filterByNamespaceMap[t]=e,j.updateConnectorsForEnabledNamespaces()},updateConnectorsForEnabledNamespaces(){const t=j.getEnabledNamespaces(),e=j.getEnabledConnectors(t),s=j.areAllNamespacesEnabled();we.connectors=j.mergeMultiChainConnectors(e),s?X.clearFilterByNamespaces():X.filterByNamespaces(t)},getEnabledNamespaces(){return Object.entries(we.filterByNamespaceMap).filter(([t,e])=>e).map(([t])=>t)},getEnabledConnectors(t){return we.allConnectors.filter(e=>t.includes(e.chain))},areAllNamespacesEnabled(){return Object.values(we.filterByNamespaceMap).every(t=>t)},mergeMultiChainConnectors(t){const e=j.generateConnectorMapByName(t),s=[];return e.forEach(n=>{const r=n[0],i=(r==null?void 0:r.id)===k.CONNECTOR_ID.AUTH;n.length>1&&r?s.push({name:r.name,imageUrl:r.imageUrl,imageId:r.imageId,connectors:[...n],type:i?"AUTH":"MULTI_CHAIN",chain:"eip155",id:(r==null?void 0:r.id)||""}):r&&s.push(r)}),s},generateConnectorMapByName(t){const e=new Map;return t.forEach(s=>{const{name:n}=s,r=j.getConnectorName(n);if(!r)return;const i=e.get(r)||[];i.find(a=>a.chain===s.chain)||i.push(s),e.set(r,i)}),e},getConnectorName(t){return t&&({"Trust Wallet":"Trust"}[t]||t)},getUniqueConnectorsByName(t){const e=[];return t.forEach(s=>{e.find(n=>n.chain===s.chain)||e.push(s)}),e},addConnector(t){var e,s,n;if(t.id===k.CONNECTOR_ID.AUTH){const r=t,i=ui(U.state),o=Rt.getSnapshot().themeMode,a=Rt.getSnapshot().themeVariables;(s=(e=r==null?void 0:r.provider)==null?void 0:e.syncDappData)==null||s.call(e,{metadata:i.metadata,sdkVersion:i.sdkVersion,projectId:i.projectId,sdkType:i.sdkType}),(n=r==null?void 0:r.provider)==null||n.syncTheme({themeMode:o,themeVariables:a,w3mThemeVariables:yo(a,o)}),j.setConnectors([t])}else j.setConnectors([t])},getAuthConnector(t){var n;const e=t||m.state.activeChain,s=we.connectors.find(r=>r.id===k.CONNECTOR_ID.AUTH);if(s)return(n=s==null?void 0:s.connectors)!=null&&n.length?s.connectors.find(i=>i.chain===e):s},getAnnouncedConnectorRdns(){return we.connectors.filter(t=>t.type==="ANNOUNCED").map(t=>{var e;return(e=t.info)==null?void 0:e.rdns})},getConnectorById(t){return ht.sortConnectorsByPriority(we.allConnectors).find(s=>s.id===t)},getConnector({id:t,namespace:e}){const s=e||m.state.activeChain,n=we.allConnectors.filter(o=>o.chain===s);return ht.sortConnectorsByPriority(n).find(o=>o.id===t||o.explorerId===t)},syncIfAuthConnector(t){var i,o;if(t.id!=="AUTH")return;const e=t,s=ui(U.state),n=Rt.getSnapshot().themeMode,r=Rt.getSnapshot().themeVariables;(o=(i=e==null?void 0:e.provider)==null?void 0:i.syncDappData)==null||o.call(i,{metadata:s.metadata,sdkVersion:s.sdkVersion,sdkType:s.sdkType,projectId:s.projectId}),e.provider.syncTheme({themeMode:n,themeVariables:r,w3mThemeVariables:yo(r,n)})},getConnectorsByNamespace(t){const e=we.allConnectors.filter(s=>s.chain===t);return j.mergeMultiChainConnectors(e)},canSwitchToSmartAccount(t){return m.checkIfSmartAccountEnabled()&&Zt(t)===js.ACCOUNT_TYPES.EOA},selectWalletConnector(t){var r;const e=(r=se.state.data)==null?void 0:r.redirectView,s=m.state.activeChain,n=s?j.getConnector({id:t.id,namespace:s}):void 0;Tm.handleMobileDeeplinkRedirect((n==null?void 0:n.explorerId)||t.id,m.state.activeChain),n?se.push("ConnectingExternal",{connector:n,wallet:t,redirectView:e}):se.push("ConnectingWalletConnect",{wallet:t,redirectView:e})},getConnectors(t){return t?j.getConnectorsByNamespace(t):j.mergeMultiChainConnectors(we.allConnectors)},setFilterByNamespace(t){we.filterByNamespace=t,we.connectors=j.getConnectors(t),X.setFilterByNamespace(t)},setConnectorId(t,e){t&&(we.activeConnectorIds={...we.activeConnectorIds,[e]:t},L.setConnectedConnectorId(e,t))},removeConnectorId(t){we.activeConnectorIds={...we.activeConnectorIds,[t]:void 0},L.deleteConnectedConnectorId(t)},getConnectorId(t){if(t)return we.activeConnectorIds[t]},isConnected(t){return t?!!we.activeConnectorIds[t]:Object.values(we.activeConnectorIds).some(e=>!!e)},resetConnectorIds(){we.activeConnectorIds={...Fh}},extendConnectorsWithExplorerWallets(t){we.allConnectors.forEach(n=>{const r=t.find(i=>{var o;return i.id===n.id||i.rdns&&i.rdns===((o=n.info)==null?void 0:o.rdns)});r&&(n.explorerWallet=r)});const e=j.getEnabledNamespaces(),s=j.getEnabledConnectors(e);we.connectors=j.mergeMultiChainConnectors(s)},async connect(t={}){const{namespace:e}=t;return j.setFilterByNamespace(e),se.push("Connect",{addWalletForNamespace:e}),new Promise((s,n)=>{if(e){const r=m.subscribeChainProp("accountState",o=>{o!=null&&o.caipAddress&&(s({caipAddress:o==null?void 0:o.caipAddress}),r())},e),i=pe.subscribeKey("open",o=>{o||(n(new Error("Modal closed")),i())})}else{const r=m.subscribeKey("activeCaipAddress",o=>{o&&(s({caipAddress:o}),r())}),i=pe.subscribeKey("open",o=>{o||(n(new Error("Modal closed")),i())})}})}},j=es(Mm),Fm=1e3,Br={checkNamespaceConnectorId(t,e){return j.getConnectorId(t)===e},isSocialProvider(t){return fe.DEFAULT_REMOTE_FEATURES.socials.includes(t)},connectWalletConnect({walletConnect:t,connector:e,closeModalOnConnect:s=!0,redirectViewOnModalClose:n="Connect",onOpen:r,onConnect:i}){return new Promise((o,a)=>{if(t&&j.setActiveConnector(e),r==null||r(Y.isMobile()&&t),n){const l=pe.subscribeKey("open",d=>{d||(se.state.view!==n&&se.replace(n),l(),a(new Error("Modal closed")))})}const c=m.subscribeKey("activeCaipAddress",l=>{l&&(i==null||i(),s&&pe.close(),c(),o(Qe.parseCaipAddress(l)))})})},connectExternal(t){return new Promise((e,s)=>{const n=m.subscribeKey("activeCaipAddress",r=>{r&&(pe.close(),n(),e(Qe.parseCaipAddress(r)))});H.connectExternal(t,t.chain).catch(()=>{n(),s(new Error("Connection rejected"))})})},connectSocial({social:t,namespace:e,closeModalOnConnect:s=!0,onOpenFarcaster:n,onConnect:r}){let i,o=!1,a=null;const c=e||m.state.activeChain,l=m.subscribeKey("activeCaipAddress",d=>{d&&(s&&pe.close(),l())});return new Promise((d,u)=>{async function h(g){var p;if((p=g.data)!=null&&p.resultUri)if(g.origin===k.SECURE_SITE_SDK_ORIGIN){window.removeEventListener("message",h,!1);try{const w=j.getAuthConnector(c);if(w&&!o){i&&i.close(),o=!0;const b=g.data.resultUri;de.sendEvent({type:"track",event:"SOCIAL_LOGIN_REQUEST_USER_DATA",properties:{provider:t}}),L.setConnectedSocialProvider(t),await H.connectExternal({id:w.id,type:w.type,socialUri:b},w.chain);const I=m.state.activeCaipAddress;if(!I){u(new Error("Failed to connect"));return}d(Qe.parseCaipAddress(I)),de.sendEvent({type:"track",event:"SOCIAL_LOGIN_SUCCESS",properties:{provider:t}})}}catch(w){de.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:t,message:Y.parseError(w)}}),u(new Error("Failed to connect"))}}else de.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:t,message:"Untrusted Origin"}})}async function f(){if(de.sendEvent({type:"track",event:"SOCIAL_LOGIN_STARTED",properties:{provider:t}}),t==="farcaster"){n==null||n();const g=pe.subscribeKey("open",w=>{!w&&t==="farcaster"&&(u(new Error("Popup closed")),r==null||r(),g())}),p=j.getAuthConnector();if(p){const w=m.getAccountData(c);if(!(w!=null&&w.farcasterUrl))try{const{url:b}=await p.provider.getFarcasterUri();m.setAccountProp("farcasterUrl",b,c)}catch{u(new Error("Failed to connect to farcaster"))}}}else{const g=j.getAuthConnector();a=Y.returnOpenHref(`${k.SECURE_SITE_SDK_ORIGIN}/loading`,"popupWindow","width=600,height=800,scrollbars=yes");try{if(g){const{uri:p}=await g.provider.getSocialRedirectUri({provider:t});if(a&&p){a.location.href=p,i=a;const w=setInterval(()=>{i!=null&&i.closed&&!o&&(u(new Error("Popup closed")),clearInterval(w))},1e3);window.addEventListener("message",h,!1)}else a==null||a.close(),u(new Error("Failed to initiate social connection"))}}catch{u(new Error("Failed to initiate social connection")),a==null||a.close()}}}f()})},connectEmail({closeModalOnConnect:t=!0,redirectViewOnModalClose:e="Connect",onOpen:s,onConnect:n}){return new Promise((r,i)=>{if(s==null||s(),e){const a=pe.subscribeKey("open",c=>{c||(se.state.view!==e&&se.replace(e),a(),i(new Error("Modal closed")))})}const o=m.subscribeKey("activeCaipAddress",a=>{a&&(n==null||n(),t&&pe.close(),o(),r(Qe.parseCaipAddress(a)))})})},async updateEmail(){const t=L.getConnectedConnectorId(m.state.activeChain),e=j.getAuthConnector();if(!e)throw new Error("No auth connector found");if(t!==k.CONNECTOR_ID.AUTH)throw new Error("Not connected to email or social");const s=e.provider.getEmail()??"";return await pe.open({view:"UpdateEmailWallet",data:{email:s,redirectView:void 0}}),new Promise((n,r)=>{const i=setInterval(()=>{const a=e.provider.getEmail()??"";a!==s&&(pe.close(),clearInterval(i),o(),n({email:a}))},Fm),o=pe.subscribeKey("open",a=>{a||(se.state.view!=="Connect"&&se.push("Connect"),clearInterval(i),o(),r(new Error("Modal closed")))})})},canSwitchToSmartAccount(t){return m.checkIfSmartAccountEnabled()&&Zt(t)===js.ACCOUNT_TYPES.EOA}};function jh(){var n,r;const t=((n=m.state.activeCaipNetwork)==null?void 0:n.chainNamespace)||"eip155",e=((r=m.state.activeCaipNetwork)==null?void 0:r.id)||1,s=fe.NATIVE_TOKEN_ADDRESS[t];return`${t}:${e}:${s}`}function _2(t){return fe.NATIVE_TOKEN_ADDRESS[t]}function Zt(t){var s;return(s=m.getAccountData(t))==null?void 0:s.preferredAccountType}function Li(t){return m.state.activeCaipNetwork}const vo={getConnectionStatus(t,e){const s=j.state.activeConnectorIds[e],n=H.getConnections(e);return!!s&&t.connectorId===s?"connected":n.some(o=>o.connectorId.toLowerCase()===t.connectorId.toLowerCase())?"active":"disconnected"},excludeConnectorAddressFromConnections({connections:t,connectorId:e,addresses:s}){return t.map(n=>{if((e?n.connectorId.toLowerCase()===e.toLowerCase():!1)&&s){const i=n.accounts.filter(o=>!s.some(c=>c.toLowerCase()===o.address.toLowerCase()));return{...n,accounts:i}}return n})},excludeExistingConnections(t,e){const s=new Set(t);return e.filter(n=>!s.has(n.connectorId))},getConnectionsByConnectorId(t,e){return t.filter(s=>s.connectorId.toLowerCase()===e.toLowerCase())},getConnectionsData(t){var a;const e=!!((a=U.state.remoteFeatures)!=null&&a.multiWallet),s=j.state.activeConnectorIds[t],n=H.getConnections(t),i=(H.state.recentConnections.get(t)??[]).filter(c=>j.getConnectorById(c.connectorId)),o=vo.excludeExistingConnections([...n.map(c=>c.connectorId),...s?[s]:[]],i);return e?{connections:n,recentConnections:o}:{connections:n.filter(c=>c.connectorId.toLowerCase()===(s==null?void 0:s.toLowerCase())),recentConnections:[]}},onConnectMobile(t){const e=H.state.wcUri;if(t!=null&&t.mobile_link&&e)try{H.setWcError(!1);const{mobile_link:s,link_mode:n,name:r}=t,{redirect:i,redirectUniversalLink:o,href:a}=Y.formatNativeUrl(s,e,n),c=i,l=o,d=Y.isIframe()?"_top":"_self";H.setWcLinking({name:r,href:a}),H.setRecentWallet(t),U.state.experimental_preferUniversalLinks&&l?Y.openHref(l,d):Y.openHref(c,d)}catch(s){de.sendEvent({type:"track",event:"CONNECT_PROXY_ERROR",properties:{message:s instanceof Error?s.message:"Error parsing the deep link",uri:e,mobile_link:t.mobile_link,name:t.name}}),H.setWcError(!0)}}},rr=ke({loading:!1,open:!1,selectedNetworkId:void 0,activeChain:void 0,initialized:!1,connectingWallet:void 0}),cs={state:rr,subscribe(t){return et(rr,()=>t(rr))},subscribeOpen(t){return tt(rr,"open",t)},set(t){Object.assign(rr,{...rr,...t})}},Re=ke({transactions:[],transactionsByYear:{},lastNetworkInView:void 0,loading:!1,empty:!1,next:void 0}),jm={state:Re,subscribe(t){return et(Re,()=>t(Re))},setLastNetworkInView(t){Re.lastNetworkInView=t},async fetchTransactions(t){var e;if(!t)throw new Error("Transactions can't be fetched without an accountAddress");Re.loading=!0;try{const s=await re.fetchTransactions({account:t,cursor:Re.next,chainId:(e=m.state.activeCaipNetwork)==null?void 0:e.caipNetworkId}),n=oo.filterSpamTransactions(s.data),r=oo.filterByConnectedChain(n),i=[...Re.transactions,...r];Re.loading=!1,Re.transactions=i,Re.transactionsByYear=oo.groupTransactionsByYearAndMonth(Re.transactionsByYear,r),Re.empty=i.length===0,Re.next=s.next?s.next:void 0}catch{const n=m.state.activeChain;de.sendEvent({type:"track",event:"ERROR_FETCH_TRANSACTIONS",properties:{address:t,projectId:U.state.projectId,cursor:Re.next,isSmartAccount:Zt(n)===js.ACCOUNT_TYPES.SMART_ACCOUNT}}),Es.showError("Failed to fetch transactions"),Re.loading=!1,Re.empty=!0,Re.next=void 0}},groupTransactionsByYearAndMonth(t={},e=[]){const s=t;return e.forEach(n=>{const r=new Date(n.metadata.minedAt).getFullYear(),i=new Date(n.metadata.minedAt).getMonth(),o=s[r]??{},c=(o[i]??[]).filter(l=>l.id!==n.id);s[r]={...o,[i]:[...c,n].sort((l,d)=>new Date(d.metadata.minedAt).getTime()-new Date(l.metadata.minedAt).getTime())}}),s},filterSpamTransactions(t){return t.filter(e=>{var n;return!((n=e.transfers)==null?void 0:n.every(r=>{var i;return((i=r.nft_info)==null?void 0:i.flags.is_spam)===!0}))})},filterByConnectedChain(t){var n;const e=(n=m.state.activeCaipNetwork)==null?void 0:n.caipNetworkId;return t.filter(r=>r.metadata.chain===e)},clearCursor(){Re.next=void 0},resetTransactions(){Re.transactions=[],Re.transactionsByYear={},Re.lastNetworkInView=void 0,Re.loading=!1,Re.empty=!1,Re.next=void 0}},oo=es(jm,"API_ERROR"),he=ke({connections:new Map,recentConnections:new Map,isSwitchingConnection:!1,wcError:!1,wcFetchingUri:!1,buffering:!1,status:"disconnected"});let Cn;const qm={state:he,subscribe(t){return et(he,()=>t(he))},subscribeKey(t,e){return tt(he,t,e)},_getClient(){return he._client},setClient(t){he._client=hi(t)},initialize(t){const e=t.filter(s=>!!s.namespace).map(s=>s.namespace);H.syncStorageConnections(e)},syncStorageConnections(t){const e=L.getConnections(),s=t??Array.from(m.state.chains.keys());for(const n of s){const r=e[n]??[],i=new Map(he.recentConnections);i.set(n,r),he.recentConnections=i}},getConnections(t){return t?he.connections.get(t)??[]:[]},hasAnyConnection(t){const e=H.state.connections;return Array.from(e.values()).flatMap(s=>s).some(({connectorId:s})=>s===t)},async connectWalletConnect({cache:t="auto"}={}){var s,n,r,i;he.wcFetchingUri=!0;const e=Y.isTelegram()||Y.isSafari()&&Y.isIos();if(t==="always"||t==="auto"&&e){if(Cn){await Cn,Cn=void 0;return}if(!Y.isPairingExpired(he==null?void 0:he.wcPairingExpiry)){const o=he.wcUri;he.wcUri=o;return}Cn=(n=(s=H._getClient())==null?void 0:s.connectWalletConnect)==null?void 0:n.call(s).catch(()=>{}),H.state.status="connecting",await Cn,Cn=void 0,he.wcPairingExpiry=void 0,H.state.status="connected"}else await((i=(r=H._getClient())==null?void 0:r.connectWalletConnect)==null?void 0:i.call(r))},async connectExternal(t,e,s=!0){var o,a,c;const n=await((a=(o=H._getClient())==null?void 0:o.connectExternal)==null?void 0:a.call(o,t));s&&m.setActiveNamespace(e);const r=j.state.allConnectors.find(l=>l.id===(t==null?void 0:t.id)),i=t.type==="AUTH"?"email":"browser";return de.sendEvent({type:"track",event:"CONNECT_SUCCESS",properties:{method:i,name:(r==null?void 0:r.name)||"Unknown",view:se.state.view,walletRank:(c=r==null?void 0:r.explorerWallet)==null?void 0:c.order}}),n},async reconnectExternal(t){var s,n;await((n=(s=H._getClient())==null?void 0:s.reconnectExternal)==null?void 0:n.call(s,t));const e=t.chain||m.state.activeChain;e&&j.setConnectorId(t.id,e)},async setPreferredAccountType(t,e){var n;if(!e)return;pe.setLoading(!0,m.state.activeChain);const s=j.getAuthConnector();s&&(m.setAccountProp("preferredAccountType",t,e),await s.provider.setPreferredAccount(t),L.setPreferredAccountTypes(Object.entries(m.state.chains).reduce((r,[i,o])=>{const a=i,c=Zt(a);return c!==void 0&&(r[a]=c),r},{})),await H.reconnectExternal(s),pe.setLoading(!1,m.state.activeChain),de.sendEvent({type:"track",event:"SET_PREFERRED_ACCOUNT_TYPE",properties:{accountType:t,network:((n=m.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)||""}}))},async signMessage(t){var e;return(e=H._getClient())==null?void 0:e.signMessage(t)},parseUnits(t,e){var s;return(s=H._getClient())==null?void 0:s.parseUnits(t,e)},formatUnits(t,e){var s;return(s=H._getClient())==null?void 0:s.formatUnits(t,e)},updateBalance(t){var e;return(e=H._getClient())==null?void 0:e.updateBalance(t)},async sendTransaction(t){var e;return(e=H._getClient())==null?void 0:e.sendTransaction(t)},async getCapabilities(t){var e;return(e=H._getClient())==null?void 0:e.getCapabilities(t)},async grantPermissions(t){var e;return(e=H._getClient())==null?void 0:e.grantPermissions(t)},async walletGetAssets(t){var e;return((e=H._getClient())==null?void 0:e.walletGetAssets(t))??{}},async estimateGas(t){var e;return(e=H._getClient())==null?void 0:e.estimateGas(t)},async writeContract(t){var e;return(e=H._getClient())==null?void 0:e.writeContract(t)},async writeSolanaTransaction(t){var e;return(e=H._getClient())==null?void 0:e.writeSolanaTransaction(t)},async getEnsAddress(t){var e;return(e=H._getClient())==null?void 0:e.getEnsAddress(t)},async getEnsAvatar(t){var e;return(e=H._getClient())==null?void 0:e.getEnsAvatar(t)},checkInstalled(t){var e,s;return((s=(e=H._getClient())==null?void 0:e.checkInstalled)==null?void 0:s.call(e,t))||!1},resetWcConnection(){he.wcUri=void 0,he.wcPairingExpiry=void 0,he.wcLinking=void 0,he.recentWallet=void 0,he.wcFetchingUri=!1,he.status="disconnected",oo.resetTransactions(),L.deleteWalletConnectDeepLink(),L.deleteRecentWallet(),cs.set({connectingWallet:void 0})},resetUri(){he.wcUri=void 0,he.wcPairingExpiry=void 0,Cn=void 0,he.wcFetchingUri=!1,cs.set({connectingWallet:void 0})},finalizeWcConnection(t){var n,r;const{wcLinking:e,recentWallet:s}=H.state;e&&L.setWalletConnectDeepLink(e),s&&L.setAppKitRecent(s),t&&de.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:t,properties:{method:e?"mobile":"qrcode",name:((r=(n=se.state.data)==null?void 0:n.wallet)==null?void 0:r.name)||"Unknown",view:se.state.view,walletRank:s==null?void 0:s.order}})},setWcBasic(t){he.wcBasic=t},setUri(t){he.wcUri=t,he.wcFetchingUri=!1,he.wcPairingExpiry=Y.getPairingExpiry()},setWcLinking(t){he.wcLinking=t},setWcError(t){he.wcError=t,he.wcFetchingUri=!1,he.buffering=!1},setRecentWallet(t){he.recentWallet=t},setBuffering(t){he.buffering=t},setStatus(t){he.status=t},setIsSwitchingConnection(t){he.isSwitchingConnection=t},async disconnect({id:t,namespace:e,initialDisconnect:s}={}){var n;try{await((n=H._getClient())==null?void 0:n.disconnect({id:t,chainNamespace:e,initialDisconnect:s}))}catch(r){throw new Hn("Failed to disconnect","INTERNAL_SDK_ERROR",r)}},async disconnectConnector({id:t,namespace:e}){var s;try{await((s=H._getClient())==null?void 0:s.disconnectConnector({id:t,namespace:e}))}catch(n){throw new Hn("Failed to disconnect connector","INTERNAL_SDK_ERROR",n)}},setConnections(t,e){const s=new Map(he.connections);s.set(e,t),he.connections=s},async handleAuthAccountSwitch({address:t,namespace:e}){var i,o;const s=m.getAccountData(e),n=(o=(i=s==null?void 0:s.user)==null?void 0:i.accounts)==null?void 0:o.find(a=>a.type==="smartAccount"),r=n&&n.address.toLowerCase()===t.toLowerCase()&&Br.canSwitchToSmartAccount(e)?"smartAccount":"eoa";await H.setPreferredAccountType(r,e)},async handleActiveConnection({connection:t,namespace:e,address:s}){const n=j.getConnectorById(t.connectorId),r=t.connectorId===k.CONNECTOR_ID.AUTH;if(!n)throw new Error(`No connector found for connection: ${t.connectorId}`);if(r)s&&await H.handleAuthAccountSwitch({address:s,namespace:e});else{const i=await H.connectExternal({id:n.id,type:n.type,provider:n.provider,address:s,chain:e},e);return i==null?void 0:i.address}return s},async handleDisconnectedConnection({connection:t,namespace:e,address:s,closeModalOnConnect:n}){var l,d;const r=j.getConnectorById(t.connectorId),i=(d=(l=t.auth)==null?void 0:l.name)==null?void 0:d.toLowerCase(),o=t.connectorId===k.CONNECTOR_ID.AUTH,a=t.connectorId===k.CONNECTOR_ID.WALLET_CONNECT;if(!r)throw new Error(`No connector found for connection: ${t.connectorId}`);let c;if(o)if(i&&Br.isSocialProvider(i)){const{address:u}=await Br.connectSocial({social:i,closeModalOnConnect:n,onOpenFarcaster(){pe.open({view:"ConnectingFarcaster"})},onConnect(){se.replace("ProfileWallets")}});c=u}else{const{address:u}=await Br.connectEmail({closeModalOnConnect:n,onOpen(){pe.open({view:"EmailLogin"})},onConnect(){se.replace("ProfileWallets")}});c=u}else if(a){const{address:u}=await Br.connectWalletConnect({walletConnect:!0,connector:r,closeModalOnConnect:n,onOpen(h){const f=h?"AllWallets":"ConnectingWalletConnect";pe.state.open?se.push(f):pe.open({view:f})},onConnect(){se.replace("ProfileWallets")}});c=u}else{const u=await H.connectExternal({id:r.id,type:r.type,provider:r.provider,chain:e},e);u&&(c=u.address)}return o&&s&&await H.handleAuthAccountSwitch({address:s,namespace:e}),c},async switchConnection({connection:t,address:e,namespace:s,closeModalOnConnect:n,onChange:r}){var c;let i;const o=(c=m.getAccountData(s))==null?void 0:c.caipAddress;if(o){const{address:l}=Qe.parseCaipAddress(o);i=l}const a=vo.getConnectionStatus(t,s);switch(a){case"connected":case"active":{const l=await H.handleActiveConnection({connection:t,namespace:s,address:e});if(i&&l){const d=l.toLowerCase()!==i.toLowerCase();r==null||r({address:l,namespace:s,hasSwitchedAccount:d,hasSwitchedWallet:a==="active"})}break}case"disconnected":{const l=await H.handleDisconnectedConnection({connection:t,namespace:s,address:e,closeModalOnConnect:n});l&&(r==null||r({address:l,namespace:s,hasSwitchedAccount:!0,hasSwitchedWallet:!0}));break}default:throw new Error(`Invalid connection status: ${a}`)}}},H=es(qm),ia={createBalance(t,e){const s={name:t.metadata.name||"",symbol:t.metadata.symbol||"",decimals:t.metadata.decimals||0,value:t.metadata.value||0,price:t.metadata.price||0,iconUrl:t.metadata.iconUrl||""};return{name:s.name,symbol:s.symbol,chainId:e,address:t.address==="native"?void 0:this.convertAddressToCAIP10Address(t.address,e),value:s.value,price:s.price,quantity:{decimals:s.decimals.toString(),numeric:this.convertHexToBalance({hex:t.balance,decimals:s.decimals})},iconUrl:s.iconUrl}},convertHexToBalance({hex:t,decimals:e}){return Nh(BigInt(t),e)},convertAddressToCAIP10Address(t,e){return`${e}:${t}`},createCAIP2ChainId(t,e){return`${e}:${parseInt(t,16)}`},getChainIdHexFromCAIP2ChainId(t){const e=t.split(":");if(e.length<2||!e[1])return"0x0";const s=e[1],n=parseInt(s,10);return isNaN(n)?"0x0":`0x${n.toString(16)}`},isWalletGetAssetsResponse(t){return typeof t!="object"||t===null?!1:Object.values(t).every(e=>Array.isArray(e)&&e.every(s=>this.isValidAsset(s)))},isValidAsset(t){return typeof t=="object"&&t!==null&&typeof t.address=="string"&&typeof t.balance=="string"&&(t.type==="ERC20"||t.type==="NATIVE")&&typeof t.metadata=="object"&&t.metadata!==null&&typeof t.metadata.name=="string"&&typeof t.metadata.symbol=="string"&&typeof t.metadata.decimals=="number"&&typeof t.metadata.price=="number"&&typeof t.metadata.iconUrl=="string"}};let oa;async function Yl(){if(!oa){const{createPublicClient:t,http:e,defineChain:s}=await mo(async()=>{const{createPublicClient:n,http:r,defineChain:i}=await import("./index-BO-BmR-4.js");return{createPublicClient:n,http:r,defineChain:i}},__vite__mapDeps([0,1,2,3,4,5,6,7]));oa={createPublicClient:t,http:e,defineChain:s}}return oa}const nc={getBlockchainApiRpcUrl(t,e){const s=new URL("https://rpc.walletconnect.org/v1/");return s.searchParams.set("chainId",t),s.searchParams.set("projectId",e),s.toString()},async getViemChain(t){const{defineChain:e}=await Yl(),{chainId:s}=Qe.parseCaipNetworkId(t.caipNetworkId);return e({...t,id:Number(s)})},async createViemPublicClient(t){const{createPublicClient:e,http:s}=await Yl(),n=U.state.projectId,r=await nc.getViemChain(t);if(!r)throw new Error(`Chain ${t.caipNetworkId} not found in viem/chains`);return e({chain:r,transport:s(nc.getBlockchainApiRpcUrl(t.caipNetworkId,n))})}},sl={async getMyTokensWithBalance(t={forceUpdate:void 0,caipNetwork:m.state.activeCaipNetwork,address:(e=>(e=m.getAccountData())==null?void 0:e.address)()}){const{forceUpdate:s,caipNetwork:n,address:r}=t,i=j.getConnectorId("eip155")===k.CONNECTOR_ID.AUTH;if(!r)return[];const o=n?`${n.caipNetworkId}:${r}`:r,a=L.getBalanceCacheForCaipAddress(o);if(a)return a.balances;if(n&&n.chainNamespace===k.CHAIN.EVM&&i){const l=await this.getEIP155Balances(r,n);if(l)return this.filterLowQualityTokens(l)}const c=await re.getBalance(r,n==null?void 0:n.caipNetworkId,s);return this.filterLowQualityTokens(c.balances)},async getEIP155Balances(t,e){var s,n;try{const r=ia.getChainIdHexFromCAIP2ChainId(e.caipNetworkId),i=await H.getCapabilities(t);if(!((n=(s=i==null?void 0:i[r])==null?void 0:s.assetDiscovery)!=null&&n.supported))return null;const o=await H.walletGetAssets({account:t,chainFilter:[r]});if(!ia.isWalletGetAssetsResponse(o))return null;const c=(o[r]||[]).map(l=>ia.createBalance(l,e.caipNetworkId));return L.updateBalanceCache({caipAddress:`${e.caipNetworkId}:${t}`,balance:{balances:c},timestamp:Date.now()}),c}catch{return null}},filterLowQualityTokens(t){return t.filter(e=>e.quantity.decimals!=="0")},async fetchERC20Balance({caipAddress:t,assetAddress:e,caipNetwork:s}){const n=await nc.createViemPublicClient(s),{address:r}=Qe.parseCaipAddress(t),[{result:i},{result:o},{result:a},{result:c}]=await n.multicall({contracts:[{address:e,functionName:"name",args:[],abi:Ui},{address:e,functionName:"symbol",args:[],abi:Ui},{address:e,functionName:"balanceOf",args:[r],abi:Ui},{address:e,functionName:"decimals",args:[],abi:Ui}]});return{name:i,symbol:o,decimals:c,balance:a&&c?Nh(a,c):"0"}}},aa={adapters:{}},qh={state:aa,initialize(t){aa.adapters={...t}},get(t){return aa.adapters[t]}},Co={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0,sui:void 0,stacks:void 0,ton:void 0},wt=ke({providers:{...Co},providerIds:{...Co}}),Oe={state:wt,subscribeKey(t,e){return tt(wt,t,e)},subscribe(t){return et(wt,()=>{t(wt)})},subscribeProviders(t){return et(wt.providers,()=>t(wt.providers))},setProvider(t,e){t&&e&&(wt.providers[t]=hi(e))},getProvider(t){if(t)return wt.providers[t]},setProviderId(t,e){e&&(wt.providerIds[t]=e)},getProviderId(t){if(t)return wt.providerIds[t]},reset(){wt.providers={...Co},wt.providerIds={...Co}},resetChain(t){wt.providers[t]=void 0,wt.providerIds[t]=void 0}},Wm={async getTokenList(t){var n;const e=await re.fetchSwapTokens({chainId:t});return((n=e==null?void 0:e.tokens)==null?void 0:n.map(r=>({...r,eip2612:!1,quantity:{decimals:"0",numeric:"0"},price:0,value:0})))||[]},async fetchGasPrice(){var e;const t=m.state.activeCaipNetwork;if(!t)return null;try{switch(t.chainNamespace){case"solana":const s=(e=await(H==null?void 0:H.estimateGas({chainNamespace:"solana"})))==null?void 0:e.toString();return{standard:s,fast:s,instant:s};case"eip155":default:return await re.fetchGasPrice({chainId:t.caipNetworkId})}}catch{return null}},async fetchSwapAllowance({tokenAddress:t,userAddress:e,sourceTokenAmount:s,sourceTokenDecimals:n}){const r=await re.fetchSwapAllowance({tokenAddress:t,userAddress:e});if(r!=null&&r.allowance&&s&&n){const i=H.parseUnits(s,n)||0;return BigInt(r.allowance)>=i}return!1},async getMyTokensWithBalance(t){var s;const e=await sl.getMyTokensWithBalance({forceUpdate:t,caipNetwork:m.state.activeCaipNetwork,address:(s=m.getAccountData())==null?void 0:s.address});return m.setAccountProp("tokenBalance",e,m.state.activeChain),this.mapBalancesToSwapTokens(e)},mapBalancesToSwapTokens(t){return(t==null?void 0:t.map(e=>({...e,address:e!=null&&e.address?e.address:jh(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1})))||[]},async handleSwapError(t){var e,s;try{const n=t==null?void 0:t.cause;if(!(n!=null&&n.json))return;const r=await n.json(),i=(s=(e=r==null?void 0:r.reasons)==null?void 0:e[0])==null?void 0:s.description;return i!=null&&i.includes("insufficient liquidity")?"Insufficient liquidity":void 0}catch{return}}},ye=ke({tokenBalances:[],loading:!1}),Hm={state:ye,subscribe(t){return et(ye,()=>t(ye))},subscribeKey(t,e){return tt(ye,t,e)},setToken(t){t&&(ye.token=hi(t))},setTokenAmount(t){ye.sendTokenAmount=t},setReceiverAddress(t){ye.receiverAddress=t},setReceiverProfileImageUrl(t){ye.receiverProfileImageUrl=t},setReceiverProfileName(t){ye.receiverProfileName=t},setNetworkBalanceInUsd(t){ye.networkBalanceInUSD=t},setLoading(t){ye.loading=t},getSdkEventProperties(t){var e,s;return{message:Y.parseError(t),isSmartAccount:Zt(m.state.activeChain)===js.ACCOUNT_TYPES.SMART_ACCOUNT,token:((e=ye.token)==null?void 0:e.symbol)||"",amount:ye.sendTokenAmount??0,network:((s=m.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)||""}},async sendToken(){var t;try{switch(ue.setLoading(!0),(t=m.state.activeCaipNetwork)==null?void 0:t.chainNamespace){case"eip155":await ue.sendEvmToken();return;case"solana":await ue.sendSolanaToken();return;default:throw new Error("Unsupported chain")}}catch(e){throw Fs.isUserRejectedRequestError(e)?new Dh(e):e}finally{ue.setLoading(!1)}},async sendEvmToken(){var s,n,r;const t=m.state.activeChain;if(!t)throw new Error("SendController:sendEvmToken - activeChainNamespace is required");const e=Zt(t);if(!ue.state.sendTokenAmount||!ue.state.receiverAddress)throw new Error("An amount and receiver address are required");if(!ue.state.token)throw new Error("A token is required");if((s=ue.state.token)!=null&&s.address){de.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===js.ACCOUNT_TYPES.SMART_ACCOUNT,token:ue.state.token.address,amount:ue.state.sendTokenAmount,network:((n=m.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)||""}});const{hash:i}=await ue.sendERC20Token({receiverAddress:ue.state.receiverAddress,tokenAddress:ue.state.token.address,sendTokenAmount:ue.state.sendTokenAmount,decimals:ue.state.token.quantity.decimals});i&&(ye.hash=i)}else{de.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===js.ACCOUNT_TYPES.SMART_ACCOUNT,token:ue.state.token.symbol||"",amount:ue.state.sendTokenAmount,network:((r=m.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)||""}});const{hash:i}=await ue.sendNativeToken({receiverAddress:ue.state.receiverAddress,sendTokenAmount:ue.state.sendTokenAmount,decimals:ue.state.token.quantity.decimals});i&&(ye.hash=i)}},async fetchTokenBalance(t){var o,a,c;ye.loading=!0;const e=m.state.activeChain,s=(o=m.state.activeCaipNetwork)==null?void 0:o.caipNetworkId,n=(a=m.state.activeCaipNetwork)==null?void 0:a.chainNamespace,r=((c=m.getAccountData(e))==null?void 0:c.caipAddress)??m.state.activeCaipAddress,i=r?Y.getPlainAddress(r):void 0;if(ye.lastRetry&&!Y.isAllowedRetry(ye.lastRetry,30*fe.ONE_SEC_MS))return ye.loading=!1,[];try{if(i&&s&&n){const l=await sl.getMyTokensWithBalance();return ye.tokenBalances=l,ye.lastRetry=void 0,l}}catch(l){ye.lastRetry=Date.now(),t==null||t(l),Es.showError("Token Balance Unavailable")}finally{ye.loading=!1}return[]},fetchNetworkBalance(){if(ye.tokenBalances.length===0)return;const t=Wm.mapBalancesToSwapTokens(ye.tokenBalances);if(!t)return;const e=t.find(s=>s.address===jh());e&&(ye.networkBalanceInUSD=e?$h.multiply(e.quantity.numeric,e.price).toString():"0")},async sendNativeToken(t){var o,a,c,l;se.pushTransactionStack({});const e=t.receiverAddress,s=(o=m.getAccountData())==null?void 0:o.address,n=H.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals)),i=await H.sendTransaction({chainNamespace:k.CHAIN.EVM,to:e,address:s,data:"0x",value:n??BigInt(0)});return de.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Zt("eip155")===js.ACCOUNT_TYPES.SMART_ACCOUNT,token:((a=ue.state.token)==null?void 0:a.symbol)||"",amount:t.sendTokenAmount,network:((c=m.state.activeCaipNetwork)==null?void 0:c.caipNetworkId)||"",hash:i||""}}),(l=H._getClient())==null||l.updateBalance("eip155"),ue.resetSend(),{hash:i}},async sendERC20Token(t){var n,r,i;se.pushTransactionStack({onSuccess(){se.replace("Account")}});const e=H.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals)),s=(n=m.getAccountData())==null?void 0:n.address;if(s&&t.sendTokenAmount&&t.receiverAddress&&t.tokenAddress){const o=Y.getPlainAddress(t.tokenAddress);if(!o)throw new Error("SendController:sendERC20Token - tokenAddress is required");const a=await H.writeContract({fromAddress:s,tokenAddress:o,args:[t.receiverAddress,e??BigInt(0)],method:"transfer",abi:nm.getERC20Abi(o),chainNamespace:k.CHAIN.EVM});return de.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Zt("eip155")===js.ACCOUNT_TYPES.SMART_ACCOUNT,token:((r=ue.state.token)==null?void 0:r.symbol)||"",amount:t.sendTokenAmount,network:((i=m.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)||"",hash:a||""}}),ue.resetSend(),{hash:a}}return{hash:void 0}},async sendSolanaToken(){var s,n,r;if(!ue.state.sendTokenAmount||!ue.state.receiverAddress)throw new Error("An amount and receiver address are required");se.pushTransactionStack({onSuccess(){se.replace("Account")}});let t;ue.state.token&&ue.state.token.address!==fe.SOLANA_NATIVE_TOKEN_ADDRESS&&(Y.isCaipAddress(ue.state.token.address)?t=Y.getPlainAddress(ue.state.token.address):t=ue.state.token.address);const e=await H.sendTransaction({chainNamespace:"solana",tokenMint:t,to:ue.state.receiverAddress,value:ue.state.sendTokenAmount});e&&(ye.hash=e),(s=H._getClient())==null||s.updateBalance("solana"),de.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:!1,token:((n=ue.state.token)==null?void 0:n.symbol)||"",amount:ue.state.sendTokenAmount,network:((r=m.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)||"",hash:e||""}}),ue.resetSend()},resetSend(){ye.token=void 0,ye.sendTokenAmount=void 0,ye.receiverAddress=void 0,ye.receiverProfileImageUrl=void 0,ye.receiverProfileName=void 0,ye.loading=!1,ye.tokenBalances=[]}},ue=es(Hm),ca={currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,user:void 0,preferredAccountType:void 0},Mi={caipNetwork:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]},G=ke({chains:wm(),activeCaipAddress:void 0,activeChain:void 0,activeCaipNetwork:void 0,noAdapters:!1,universalAdapter:{connectionControllerClient:void 0},isSwitchingNamespace:!1}),Wh={state:G,subscribe(t){return et(G,()=>{t(G)})},subscribeKey(t,e){return tt(G,t,e)},subscribeAccountStateProp(t,e,s){var r;const n=s||G.activeChain;return n?tt(((r=G.chains.get(n))==null?void 0:r.accountState)||{},t,e):()=>{}},subscribeChainProp(t,e,s){let n;return et(G.chains,()=>{var i;const r=s||G.activeChain;if(r){const o=(i=G.chains.get(r))==null?void 0:i[t];n!==o&&(n=o,e(o))}})},initialize(t,e,s){const{chainId:n,namespace:r}=L.getActiveNetworkProps(),i=e==null?void 0:e.find(d=>d.id.toString()===(n==null?void 0:n.toString())),a=t.find(d=>(d==null?void 0:d.namespace)===r)||(t==null?void 0:t[0]),c=t.map(d=>d.namespace).filter(d=>d!==void 0),l=U.state.enableEmbedded?new Set([...c]):new Set([...(e==null?void 0:e.map(d=>d.chainNamespace))??[]]);((t==null?void 0:t.length)===0||!a)&&(G.noAdapters=!0),G.noAdapters||(G.activeChain=a==null?void 0:a.namespace,G.activeCaipNetwork=i,m.setChainNetworkData(a==null?void 0:a.namespace,{caipNetwork:i}),G.activeChain&&cs.set({activeChain:a==null?void 0:a.namespace})),l.forEach(d=>{const u=e==null?void 0:e.filter(g=>g.chainNamespace===d),h=L.getPreferredAccountTypes()||{},f={...U.state.defaultAccountTypes,...h};m.state.chains.set(d,{namespace:d,networkState:ke({...Mi,caipNetwork:u==null?void 0:u[0]}),accountState:ke({...ca,preferredAccountType:f[d]}),caipNetworks:u??[],...s}),m.setRequestedCaipNetworks(u??[],d)})},removeAdapter(t){var e,s;if(G.activeChain===t){const n=Array.from(G.chains.entries()).find(([r])=>r!==t);if(n){const r=(s=(e=n[1])==null?void 0:e.caipNetworks)==null?void 0:s[0];r&&m.setActiveCaipNetwork(r)}}G.chains.delete(t)},addAdapter(t,{connectionControllerClient:e},s){if(!t.namespace)throw new Error("ChainController:addAdapter - adapter must have a namespace");G.chains.set(t.namespace,{namespace:t.namespace,networkState:{...Mi,caipNetwork:s[0]},accountState:{...ca},caipNetworks:s,connectionControllerClient:e}),m.setRequestedCaipNetworks((s==null?void 0:s.filter(n=>n.chainNamespace===t.namespace))??[],t.namespace)},addNetwork(t){var s;const e=G.chains.get(t.chainNamespace);if(e){const n=[...e.caipNetworks||[]];(s=e.caipNetworks)!=null&&s.find(r=>r.id===t.id)||n.push(t),G.chains.set(t.chainNamespace,{...e,caipNetworks:n}),m.setRequestedCaipNetworks(n,t.chainNamespace),j.filterByNamespace(t.chainNamespace,!0)}},removeNetwork(t,e){var n,r,i;const s=G.chains.get(t);if(s){const o=((n=G.activeCaipNetwork)==null?void 0:n.id)===e,a=[...((r=s.caipNetworks)==null?void 0:r.filter(c=>c.id!==e))||[]];o&&((i=s==null?void 0:s.caipNetworks)!=null&&i[0])&&m.setActiveCaipNetwork(s.caipNetworks[0]),G.chains.set(t,{...s,caipNetworks:a}),m.setRequestedCaipNetworks(a||[],t),a.length===0&&j.filterByNamespace(t,!1)}},setAdapterNetworkState(t,e){const s=G.chains.get(t);s&&(s.networkState={...s.networkState||Mi,...e},G.chains.set(t,s))},setChainAccountData(t,e,s=!0){if(!t)throw new Error("Chain is required to update chain account data");const n=G.chains.get(t);if(n){const r={...n.accountState||ca,...e};G.chains.set(t,{...n,accountState:r}),(G.chains.size===1||G.activeChain===t)&&e.caipAddress&&(G.activeCaipAddress=e.caipAddress)}},setChainNetworkData(t,e){if(!t)return;const s=G.chains.get(t);if(s){const n={...s.networkState||Mi,...e};G.chains.set(t,{...s,networkState:n})}},setAccountProp(t,e,s,n=!0){m.setChainAccountData(s,{[t]:e},n)},setActiveNamespace(t){var n,r;G.activeChain=t;const e=t?G.chains.get(t):void 0,s=(n=e==null?void 0:e.networkState)==null?void 0:n.caipNetwork;s!=null&&s.id&&t&&(G.activeCaipAddress=(r=e==null?void 0:e.accountState)==null?void 0:r.caipAddress,G.activeCaipNetwork=s,m.setChainNetworkData(t,{caipNetwork:s}),L.setActiveCaipNetworkId(s==null?void 0:s.caipNetworkId),cs.set({activeChain:t,selectedNetworkId:s==null?void 0:s.caipNetworkId}))},setActiveCaipNetwork(t){var i,o;if(!t)return;const e=G.activeChain===t.chainNamespace;e||m.setIsSwitchingNamespace(!0);const s=G.chains.get(t.chainNamespace);G.activeChain=t.chainNamespace,G.activeCaipNetwork=t,m.setChainNetworkData(t.chainNamespace,{caipNetwork:t});let n=(i=s==null?void 0:s.accountState)==null?void 0:i.address;if(n)G.activeCaipAddress=`${t.chainNamespace}:${t.id}:${n}`;else if(e&&G.activeCaipAddress){const{address:a}=Qe.parseCaipAddress(G.activeCaipAddress);n=a,G.activeCaipAddress=`${t.caipNetworkId}:${n}`}else G.activeCaipAddress=void 0;m.setChainAccountData(t.chainNamespace,{address:n,caipAddress:G.activeCaipAddress}),ue.resetSend(),cs.set({activeChain:G.activeChain,selectedNetworkId:(o=G.activeCaipNetwork)==null?void 0:o.caipNetworkId}),L.setActiveCaipNetworkId(t.caipNetworkId),!m.checkIfSupportedNetwork(t.chainNamespace)&&U.state.enableNetworkSwitch&&!U.state.allowUnsupportedChain&&!H.state.wcBasic&&m.showUnsupportedChainUI()},addCaipNetwork(t){var s;if(!t)return;const e=G.chains.get(t.chainNamespace);e&&((s=e==null?void 0:e.caipNetworks)==null||s.push(t))},async switchActiveNamespace(t){var r;if(!t)return;const e=t!==m.state.activeChain,s=(r=m.getNetworkData(t))==null?void 0:r.caipNetwork,n=m.getCaipNetworkByNamespace(t,s==null?void 0:s.id);e&&n&&await m.switchActiveNetwork(n)},async switchActiveNetwork(t,{throwOnFailure:e=!1}={}){var o;const s=m.state.activeChain;if(!s)throw new Error("ChainController:switchActiveNetwork - namespace is required");const n=Oe.getProviderId(G.activeChain)==="AUTH",r=(o=m.getAccountData(s))==null?void 0:o.address,i=k.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(t.chainNamespace);try{if(r&&t.chainNamespace===s||n&&i){const a=qh.get(t.chainNamespace);if(!a)throw new Error("Adapter not found");await a.switchNetwork({caipNetwork:t})}m.setActiveCaipNetwork(t)}catch(a){if(e)throw a}de.sendEvent({type:"track",event:"SWITCH_NETWORK",properties:{network:t.caipNetworkId}})},getConnectionControllerClient(t){const e=t||G.activeChain;if(!e)throw new Error("Chain is required to get connection controller client");const s=G.chains.get(e);if(!(s!=null&&s.connectionControllerClient))throw new Error("ConnectionController client not set");return s.connectionControllerClient},getNetworkProp(t,e){var n;const s=(n=G.chains.get(e))==null?void 0:n.networkState;if(s)return s[t]},getRequestedCaipNetworks(t){const e=G.chains.get(t),{approvedCaipNetworkIds:s=[],requestedCaipNetworks:n=[]}=(e==null?void 0:e.networkState)||{};return Y.sortRequestedNetworks(s,n).filter(o=>o==null?void 0:o.id)},getAllRequestedCaipNetworks(){const t=[];return G.chains.forEach(e=>{if(!e.namespace)throw new Error("ChainController:getAllRequestedCaipNetworks - chainAdapter must have a namespace");const s=m.getRequestedCaipNetworks(e.namespace);t.push(...s)}),t},setRequestedCaipNetworks(t,e){m.setAdapterNetworkState(e,{requestedCaipNetworks:t});const n=m.getAllRequestedCaipNetworks().map(i=>i.chainNamespace),r=Array.from(new Set(n));j.filterByNamespaces(r)},getAllApprovedCaipNetworkIds(){const t=[];return G.chains.forEach(e=>{if(!e.namespace)throw new Error("ChainController:getAllApprovedCaipNetworkIds - chainAdapter must have a namespace");const s=m.getApprovedCaipNetworkIds(e.namespace);t.push(...s)}),t},getActiveCaipNetwork(t){var e,s;return t?(s=(e=G.chains.get(t))==null?void 0:e.networkState)==null?void 0:s.caipNetwork:G.activeCaipNetwork},getActiveCaipAddress(){return G.activeCaipAddress},getApprovedCaipNetworkIds(t){var n;const e=G.chains.get(t);return((n=e==null?void 0:e.networkState)==null?void 0:n.approvedCaipNetworkIds)||[]},setApprovedCaipNetworksData(t,e){m.setAdapterNetworkState(t,e)},checkIfSupportedNetwork(t,e){var r;const s=e||((r=G.activeCaipNetwork)==null?void 0:r.caipNetworkId),n=m.getRequestedCaipNetworks(t);return n.length?n==null?void 0:n.some(i=>i.caipNetworkId===s):!0},checkIfSupportedChainId(t){if(!G.activeChain)return!0;const e=m.getRequestedCaipNetworks(G.activeChain);return e==null?void 0:e.some(s=>s.id===t)},checkIfSmartAccountEnabled(){var n,r;const t=Ph.caipNetworkIdToNumber((n=G.activeCaipNetwork)==null?void 0:n.caipNetworkId);if(!G.activeChain||!t)return!1;const s=((r=bm.get(io.SMART_ACCOUNT_ENABLED_NETWORKS))==null?void 0:r.split(","))||[];return!!(s!=null&&s.includes(t.toString()))},showUnsupportedChainUI(){pe.open({view:"UnsupportedChain"})},checkIfNamesSupported(){const t=G.activeCaipNetwork;return!!(t!=null&&t.chainNamespace&&fe.NAMES_SUPPORTED_CHAIN_NAMESPACES.includes(t.chainNamespace))},resetNetwork(t){m.setAdapterNetworkState(t,{approvedCaipNetworkIds:void 0,supportsAllNetworks:!0})},resetAccount(t){var r,i;const e=t;if(!e)throw new Error("Chain is required to set account prop");const s=(i=(r=m.state.chains.get(e))==null?void 0:r.accountState)==null?void 0:i.preferredAccountType,n=U.state.defaultAccountTypes[e];G.activeCaipAddress=void 0,m.setChainAccountData(e,{smartAccountDeployed:!1,currentTab:0,caipAddress:void 0,address:void 0,balance:void 0,balanceSymbol:void 0,profileName:void 0,profileImage:void 0,addressExplorerUrl:void 0,tokenBalance:[],connectedWalletInfo:void 0,preferredAccountType:n||s,socialProvider:void 0,socialWindow:void 0,farcasterUrl:void 0,user:void 0,status:"disconnected"}),j.removeConnectorId(e)},setIsSwitchingNamespace(t){G.isSwitchingNamespace=t},getFirstCaipNetworkSupportsAuthConnector(){var s,n;const t=[];let e;if(G.chains.forEach(r=>{k.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(i=>i===r.namespace)&&r.namespace&&t.push(r.namespace)}),t.length>0){const r=t[0];return e=r?(n=(s=G.chains.get(r))==null?void 0:s.caipNetworks)==null?void 0:n[0]:void 0,e}},getAccountData(t){var s;const e=t||G.activeChain;if(e)return(s=m.state.chains.get(e))==null?void 0:s.accountState},getNetworkData(t){var s;const e=t||G.activeChain;if(e)return(s=m.state.chains.get(e))==null?void 0:s.networkState},getCaipNetworkByNamespace(t,e){var r,i,o;if(!t)return;const s=m.state.chains.get(t),n=(r=s==null?void 0:s.caipNetworks)==null?void 0:r.find(a=>a.id.toString()===(e==null?void 0:e.toString()));return n||((i=s==null?void 0:s.networkState)==null?void 0:i.caipNetwork)||((o=s==null?void 0:s.caipNetworks)==null?void 0:o[0])},getRequestedCaipNetworkIds(){const t=j.state.filterByNamespace;return(t?[G.chains.get(t)]:Array.from(G.chains.values())).flatMap(s=>(s==null?void 0:s.caipNetworks)||[]).map(s=>s.caipNetworkId)},getCaipNetworks(t){return t?m.getRequestedCaipNetworks(t):m.getAllRequestedCaipNetworks()},getCaipNetworkById(t,e){return Wh.getCaipNetworks(e).find(s=>s.id.toString()===t.toString()||s.caipNetworkId.toString()===t.toString())},setLastConnectedSIWECaipNetwork(t){G.lastConnectedSIWECaipNetwork=t},getLastConnectedSIWECaipNetwork(){return G.lastConnectedSIWECaipNetwork},async fetchTokenBalance(t){var o,a;const e=m.getAccountData();if(!e)return[];const s=(o=m.state.activeCaipNetwork)==null?void 0:o.caipNetworkId,n=(a=m.state.activeCaipNetwork)==null?void 0:a.chainNamespace,r=m.state.activeCaipAddress,i=r?Y.getPlainAddress(r):void 0;if(m.setAccountProp("balanceLoading",!0,n),e.lastRetry&&!Y.isAllowedRetry(e.lastRetry,30*fe.ONE_SEC_MS))return m.setAccountProp("balanceLoading",!1,n),[];try{if(i&&s&&n){const c=await sl.getMyTokensWithBalance();return m.setAccountProp("tokenBalance",c,n),m.setAccountProp("lastRetry",void 0,n),m.setAccountProp("balanceLoading",!1,n),c}}catch(c){m.setAccountProp("lastRetry",Date.now(),n),t==null||t(c),Es.showError("Token Balance Unavailable")}finally{m.setAccountProp("balanceLoading",!1,n)}return[]},isCaipNetworkDisabled(t){var c;const e=t.chainNamespace,s=!!((c=m.getAccountData(e))!=null&&c.caipAddress),n=m.getAllApprovedCaipNetworkIds(),r=m.getNetworkProp("supportsAllNetworks",e)!==!1,i=j.getConnectorId(e),o=j.getAuthConnector(),a=i===k.CONNECTOR_ID.AUTH&&o;return!s||r||a?!1:!(n!=null&&n.includes(t.caipNetworkId))}},m=es(Wh),zm={onSwitchNetwork({network:t,ignoreSwitchConfirmation:e=!1}){var h,f;const s=m.state.activeCaipNetwork,n=m.state.activeChain,r=se.state.data;if(t.id===(s==null?void 0:s.id))return;const o=!!((h=m.getAccountData(n))!=null&&h.address),a=!!((f=m.getAccountData(t.chainNamespace))!=null&&f.address),c=t.chainNamespace!==n,d=j.getConnectorId(n)===k.CONNECTOR_ID.AUTH,u=k.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(g=>g===t.chainNamespace);e||d&&u?se.push("SwitchNetwork",{...r,network:t}):o&&c&&!a?se.push("SwitchActiveChain",{switchToChain:t.chainNamespace,navigateTo:"Connect",navigateWithReplace:!0,network:t}):se.push("SwitchNetwork",{...r,network:t})}},yt=ke({loading:!1,loadingNamespaceMap:new Map,open:!1,shake:!1,namespace:void 0}),Km={state:yt,subscribe(t){return et(yt,()=>t(yt))},subscribeKey(t,e){return tt(yt,t,e)},async open(t){var o,a;const e=t==null?void 0:t.namespace,s=m.state.activeChain,n=e&&e!==s,r=(o=m.getAccountData(t==null?void 0:t.namespace))==null?void 0:o.caipAddress,i=m.state.noAdapters;if(H.state.wcBasic?X.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1,fetchWalletRanks:!1}):await X.prefetch(),j.setFilterByNamespace(t==null?void 0:t.namespace),pe.setLoading(!0,e),e&&n){const c=((a=m.getNetworkData(e))==null?void 0:a.caipNetwork)||m.getRequestedCaipNetworks(e)[0];c&&(i?(await m.switchActiveNetwork(c),se.push("ConnectingWalletConnectBasic")):zm.onSwitchNetwork({network:c,ignoreSwitchConfirmation:!0}))}else U.state.manualWCControl||i&&!r?Y.isMobile()?se.reset("AllWallets"):se.reset("ConnectingWalletConnectBasic"):t!=null&&t.view?se.reset(t.view,t.data):r?se.reset("Account"):se.reset("Connect");yt.open=!0,cs.set({open:!0}),de.sendEvent({type:"track",event:"MODAL_OPEN",properties:{connected:!!r}})},close(){const t=U.state.enableEmbedded,e=!!m.state.activeCaipAddress;yt.open&&de.sendEvent({type:"track",event:"MODAL_CLOSE",properties:{connected:e}}),yt.open=!1,se.reset("Connect"),pe.clearLoading(),t?e?se.replace("Account"):se.push("Connect"):cs.set({open:!1}),H.resetUri()},setLoading(t,e){e&&yt.loadingNamespaceMap.set(e,t),yt.loading=t,cs.set({loading:t})},clearLoading(){yt.loadingNamespaceMap.clear(),yt.loading=!1,cs.set({loading:!1})},shake(){yt.shake||(yt.shake=!0,setTimeout(()=>{yt.shake=!1},500))}},pe=es(Km),ti={id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},rc={id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},Vm={providers:Lh,selectedProvider:null,error:null,purchaseCurrency:ti,paymentCurrency:rc,purchaseCurrencies:[ti],paymentCurrencies:[],quotesLoading:!1},be=ke(Vm),Gm={state:be,subscribe(t){return et(be,()=>t(be))},subscribeKey(t,e){return tt(be,t,e)},setSelectedProvider(t){var e,s;if(t&&t.name==="meld"){const n=m.state.activeChain,r=n===k.CHAIN.SOLANA?"SOL":"USDC",i=n?((s=(e=m.state.chains.get(n))==null?void 0:e.accountState)==null?void 0:s.address)??"":"",o=new URL(t.url);o.searchParams.append("publicKey",ym),o.searchParams.append("destinationCurrencyCode",r),o.searchParams.append("walletAddress",i),o.searchParams.append("externalCustomerId",U.state.projectId),be.selectedProvider={...t,url:o.toString()}}else be.selectedProvider=t},setOnrampProviders(t){if(Array.isArray(t)&&t.every(e=>typeof e=="string")){const e=t,s=Lh.filter(n=>e.includes(n.name));be.providers=s}else be.providers=[]},setPurchaseCurrency(t){be.purchaseCurrency=t},setPaymentCurrency(t){be.paymentCurrency=t},setPurchaseAmount(t){ic.state.purchaseAmount=t},setPaymentAmount(t){ic.state.paymentAmount=t},async getAvailableCurrencies(){const t=await re.getOnrampOptions();be.purchaseCurrencies=t.purchaseCurrencies,be.paymentCurrencies=t.paymentCurrencies,be.paymentCurrency=t.paymentCurrencies[0]||rc,be.purchaseCurrency=t.purchaseCurrencies[0]||ti,await X.fetchCurrencyImages(t.paymentCurrencies.map(e=>e.id)),await X.fetchTokenImages(t.purchaseCurrencies.map(e=>e.symbol))},async getQuote(){var t,e;be.quotesLoading=!0;try{const s=await re.getOnrampQuote({purchaseCurrency:be.purchaseCurrency,paymentCurrency:be.paymentCurrency,amount:((t=be.paymentAmount)==null?void 0:t.toString())||"0",network:(e=be.purchaseCurrency)==null?void 0:e.symbol});return be.quotesLoading=!1,be.purchaseAmount=Number(s==null?void 0:s.purchaseAmount.amount),s}catch(s){return be.error=s.message,be.quotesLoading=!1,null}finally{be.quotesLoading=!1}},resetState(){be.selectedProvider=null,be.error=null,be.purchaseCurrency=ti,be.paymentCurrency=rc,be.purchaseCurrencies=[ti],be.paymentCurrencies=[],be.paymentAmount=void 0,be.purchaseAmount=void 0,be.quotesLoading=!1}},ic=es(Gm);function Ym(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const d=t.charAt(l),u=d.charCodeAt(0);if(e[u]!==255)throw new TypeError(d+" is ambiguous");e[u]=l}const s=t.length,n=t.charAt(0),r=Math.log(s)/Math.log(256),i=Math.log(256)/Math.log(s);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let d=0,u=0,h=0;const f=l.length;for(;h!==f&&l[h]===0;)h++,d++;const g=(f-h)*i+1>>>0,p=new Uint8Array(g);for(;h!==f;){let I=l[h],v=0;for(let E=g-1;(I!==0||v<u)&&E!==-1;E--,v++)I+=256*p[E]>>>0,p[E]=I%s>>>0,I=I/s>>>0;if(I!==0)throw new Error("Non-zero carry");u=v,h++}let w=g-u;for(;w!==g&&p[w]===0;)w++;let b=n.repeat(d);for(;w<g;++w)b+=t.charAt(p[w]);return b}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let d=0,u=0,h=0;for(;l[d]===n;)u++,d++;const f=(l.length-d)*r+1>>>0,g=new Uint8Array(f);for(;d<l.length;){const I=l.charCodeAt(d);if(I>255)return;let v=e[I];if(v===255)return;let E=0;for(let _=f-1;(v!==0||E<h)&&_!==-1;_--,E++)v+=s*g[_]>>>0,g[_]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");h=E,d++}let p=f-h;for(;p!==f&&g[p]===0;)p++;const w=new Uint8Array(u+(f-p));let b=u;for(;p!==f;)w[b++]=g[p++];return w}function c(l){const d=a(l);if(d)return d;throw new Error("Non-base"+s+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Jm="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Rr=Ym(Jm),Jl=2147483648,Xm={convertEVMChainIdToCoinType(t){if(t>=Jl)throw new Error("Invalid chainId");return(Jl|t)>>>0}},jt=ke({suggestions:[],loading:!1}),Zm={state:jt,subscribe(t){return et(jt,()=>t(jt))},subscribeKey(t,e){return tt(jt,t,e)},async resolveName(t){var e,s;try{return await re.lookupEnsName(t)}catch(n){const r=n;throw new Error(((s=(e=r==null?void 0:r.reasons)==null?void 0:e[0])==null?void 0:s.description)||"Error resolving name")}},async isNameRegistered(t){try{return await re.lookupEnsName(t),!0}catch{return!1}},async getSuggestions(t){try{jt.loading=!0,jt.suggestions=[];const e=await re.getEnsNameSuggestions(t);return jt.suggestions=e.suggestions||[],jt.suggestions}catch(e){const s=si.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(s)}finally{jt.loading=!1}},async getNamesForAddress(t){try{if(!m.state.activeCaipNetwork)return[];const s=L.getEnsFromCacheForAddress(t);if(s)return s;const n=await re.reverseLookupEnsName({address:t});return L.updateEnsCache({address:t,ens:n,timestamp:Date.now()}),n}catch(e){const s=si.parseEnsApiError(e,"Error fetching names for address");throw new Error(s)}},async registerName(t){var r;const e=m.state.activeCaipNetwork,s=(r=m.getAccountData(e==null?void 0:e.chainNamespace))==null?void 0:r.address,n=j.getAuthConnector();if(!e)throw new Error("Network not found");if(!s||!n)throw new Error("Address or auth connector not found");jt.loading=!0;try{const i=JSON.stringify({name:t,attributes:{},timestamp:Math.floor(Date.now()/1e3)});se.pushTransactionStack({onCancel(){se.replace("RegisterAccountName")}});const o=await H.signMessage(i);jt.loading=!1;const a=e.id;if(!a)throw new Error("Network not found");const c=Xm.convertEVMChainIdToCoinType(Number(a));await re.registerEnsName({coinType:c,address:s,signature:o,message:i}),m.setAccountProp("profileName",t,e.chainNamespace),L.updateEnsCache({address:s,ens:[{name:t,registered_at:new Date().toISOString(),updated_at:void 0,addresses:{},attributes:[]}],timestamp:Date.now()}),se.replace("RegisterAccountNameSuccess")}catch(i){const o=si.parseEnsApiError(i,`Error registering name ${t}`);throw se.replace("RegisterAccountName"),new Error(o)}finally{jt.loading=!1}},validateName(t){return/^[a-zA-Z0-9-]{4,}$/u.test(t)},parseEnsApiError(t,e){var n,r;const s=t;return((r=(n=s==null?void 0:s.reasons)==null?void 0:n[0])==null?void 0:r.description)||e}},si=es(Zm);function oc(t){try{return new URL(t)}catch{return null}}function Qm(t){const e=t.split("/"),s=e.length>0&&e[0]!==void 0?e[0]:"",n=s.lastIndexOf(":");return n===-1?{host:s}:{host:s.slice(0,n),port:s.slice(n+1)}}function ew(t){const e=t.indexOf("://");if(e===-1)return null;const s=t.slice(0,e),n=e+3;let r=t.indexOf("/",n);r===-1&&(r=t.length);const i=t.slice(n,r),o=i.lastIndexOf(":");return o===-1?{scheme:s,host:i}:{scheme:s,host:i.slice(0,o),port:i.slice(o+1)}}function tw(t,e){if(e.includes("://")){const o=oc(e);return o?o.origin===t:!1}const{host:s,port:n}=Qm(e),r=t.indexOf("://");if(r!==-1){const o=r+3;let a=t.indexOf("/",o);a===-1&&(a=t.length);const c=t.slice(o,a);if(n!==void 0)return`${s}:${n}`===c;const l=c.split(":")[0];return s===l}const i=oc(t);return i?n!==void 0?s===i.hostname&&n===(i.port||void 0):s===i.hostname:!1}function sw(t,e,s){let n=s,r;const i=n.indexOf("://");i!==-1&&(r=n.slice(0,i),n=n.slice(i+3));const o=n.indexOf("/");o!==-1&&(n=n.slice(0,o));let a=n,c;const l=a.lastIndexOf(":");l!==-1&&(c=a.slice(l+1),a=a.slice(0,l));const d=a.split(".");for(const p of d)if(p.includes("*")&&p!=="*")return!1;const u=t.protocol.replace(/:$/u,"");if(r&&r!==u||c!==void 0&&c!=="*"&&c!==t.port)return!1;const h=ew(e),g=(h?h.host:t.hostname).split(".");if(d.length!==g.length)return!1;for(let p=d.length-1;p>=0;p-=1){const w=d[p],b=g[p];if(w!=="*"&&w!==b)return!1}return!0}const nw={ton:["ton_sendMessage","ton_signData"],solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},fn={RPC_ERROR_CODE:{USER_REJECTED:5e3,USER_REJECTED_METHODS:5002},getMethodsByChainNamespace(t){return nw[t]||[]},createDefaultNamespace(t){return{methods:this.getMethodsByChainNamespace(t),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(t,e){if(!e)return{...t};const s={...t},n=new Set;if(e.methods&&Object.keys(e.methods).forEach(r=>n.add(r)),e.chains&&Object.keys(e.chains).forEach(r=>n.add(r)),e.events&&Object.keys(e.events).forEach(r=>n.add(r)),e.rpcMap&&Object.keys(e.rpcMap).forEach(r=>{const[i]=r.split(":");i&&n.add(i)}),n.forEach(r=>{s[r]||(s[r]=this.createDefaultNamespace(r))}),e.methods&&Object.entries(e.methods).forEach(([r,i])=>{s[r]&&(s[r].methods=i)}),e.chains&&Object.entries(e.chains).forEach(([r,i])=>{s[r]&&(s[r].chains=i)}),e.events&&Object.entries(e.events).forEach(([r,i])=>{s[r]&&(s[r].events=i)}),e.rpcMap){const r=new Set;Object.entries(e.rpcMap).forEach(([i,o])=>{const[a,c]=i.split(":");!a||!c||!s[a]||(s[a].rpcMap||(s[a].rpcMap={}),r.has(a)||(s[a].rpcMap={},r.add(a)),s[a].rpcMap[c]=o)})}return s},createNamespaces(t,e){const s=t.reduce((n,r)=>{const{id:i,chainNamespace:o,rpcUrls:a}=r,c=a.default.http[0];n[o]||(n[o]=this.createDefaultNamespace(o));const l=`${o}:${i}`,d=n[o];switch(d.chains.push(l),l){case"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":d.chains.push("solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ");break;case"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1":d.chains.push("solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K");break}return d!=null&&d.rpcMap&&c&&(d.rpcMap[i]=c),n},{});return this.applyNamespaceOverrides(s,e)},resolveReownName:async t=>{var n;const e=await si.resolveName(t);return((n=(e!=null&&e.addresses?Object.values(e.addresses):[])[0])==null?void 0:n.address)||!1},getChainsFromNamespaces(t={}){return Object.values(t).flatMap(e=>{const s=e.chains||[],n=e.accounts.map(r=>{const[i,o]=r.split(":");return`${i}:${o}`});return Array.from(new Set([...s,...n]))})},isSessionEventData(t){return typeof t=="object"&&t!==null&&"id"in t&&"topic"in t&&"params"in t&&typeof t.params=="object"&&t.params!==null&&"chainId"in t.params&&"event"in t.params&&typeof t.params.event=="object"&&t.params.event!==null},isUserRejectedRequestError(t){try{if(typeof t=="object"&&t!==null){const e=t,s=typeof e.code=="number",n=s&&e.code===fn.RPC_ERROR_CODE.USER_REJECTED_METHODS,r=s&&e.code===fn.RPC_ERROR_CODE.USER_REJECTED;return n||r}return!1}catch{return!1}},isOriginAllowed(t,e,s){const n=[...e,...s];if(e.length===0)return!0;const r=oc(t);if(!r)return n.some(i=>!i.includes("*")&&i===t);if(r.hostname==="localhost"||r.hostname==="127.0.0.1")return!0;for(const i of n)if(i.includes("*")){if(sw(r,t,i))return!0}else if(tw(t,i))return!0;return!1},listenWcProvider({universalProvider:t,namespace:e,onConnect:s,onDisconnect:n,onAccountsChanged:r,onChainChanged:i,onDisplayUri:o}){s&&t.on("connect",()=>{const a=fn.getWalletConnectAccounts(t,e);s(a)}),n&&t.on("disconnect",()=>{n()}),r&&t.on("accountsChanged",a=>{var c,l,d,u,h;try{const f=((d=(l=(c=t.session)==null?void 0:c.namespaces)==null?void 0:l[e])==null?void 0:d.accounts)||[],g=(h=(u=t.rpcProviders)==null?void 0:u[e])==null?void 0:h.getDefaultChain(),p=a.map(w=>{const b=f.find(E=>E.includes(`${e}:${g}:${w}`));if(!b)return;const{chainId:I,chainNamespace:v}=Qe.parseCaipAddress(b);return{address:w,chainId:I,chainNamespace:v}}).filter(w=>w!==void 0);p.length>0&&r(p)}catch(f){console.warn("Failed to parse accounts for namespace on accountsChanged event",e,a,f)}}),i&&t.on("chainChanged",a=>{i(a)}),o&&t.on("display_uri",a=>{o(a)})},getWalletConnectAccounts(t,e){var r,i,o,a;const s=new Set,n=(a=(o=(i=(r=t==null?void 0:t.session)==null?void 0:r.namespaces)==null?void 0:i[e])==null?void 0:o.accounts)==null?void 0:a.map(c=>Qe.parseCaipAddress(c)).filter(({address:c})=>s.has(c.toLowerCase())?!1:(s.add(c.toLowerCase()),!0));return n&&n.length>0?n:[]}},rw=[k.CONNECTOR_ID.AUTH,k.CONNECTOR_ID.WALLET_CONNECT];class iw{constructor(e){this.availableConnectors=[],this.availableConnections=[],this.providerHandlers={},this.eventListeners=new Map,this.getCaipNetworks=s=>m.getCaipNetworks(s),this.getConnectorId=s=>j.getConnectorId(s),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get connections(){return this.availableConnections}get networks(){return this.getCaipNetworks(this.namespace)}onAuthConnected({accounts:e,chainId:s}){const n=this.getCaipNetworks().filter(r=>r.chainNamespace===this.namespace).find(r=>r.id.toString()===(s==null?void 0:s.toString()));e&&n&&this.addConnection({connectorId:k.CONNECTOR_ID.AUTH,accounts:e,caipNetwork:n})}setAuthProvider(e){e.onConnect(this.onAuthConnected.bind(this)),e.onSocialConnected(this.onAuthConnected.bind(this)),this.addConnector({id:k.CONNECTOR_ID.AUTH,type:"AUTH",name:k.CONNECTOR_NAMES.AUTH,provider:e,imageId:void 0,chain:this.namespace,chains:[]})}addConnector(...e){const s=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(n=>s.has(n.id)?!1:(s.add(n.id),!0)),this.emit("connectors",this.availableConnectors)}addConnection(...e){const s=new Set;this.availableConnections=[...e,...this.availableConnections].filter(n=>s.has(n.connectorId.toLowerCase())?!1:(s.add(n.connectorId.toLowerCase()),!0)),this.emit("connections",this.availableConnections)}deleteConnection(e){this.availableConnections=this.availableConnections.filter(s=>s.connectorId.toLowerCase()!==e.toLowerCase()),this.emit("connections",this.availableConnections)}clearConnections(e=!1){this.availableConnections=[],e&&this.emit("connections",this.availableConnections)}setStatus(e,s){m.setAccountProp("status",e,s)}on(e,s){var n;this.eventListeners.has(e)||this.eventListeners.set(e,new Set),(n=this.eventListeners.get(e))==null||n.add(s)}off(e,s){const n=this.eventListeners.get(e);n&&n.delete(s)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,s){const n=this.eventListeners.get(e);n&&n.forEach(r=>r(s))}async connectWalletConnect(e){try{return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}catch(s){throw fn.isUserRejectedRequestError(s)?new Dh(s):s}}async switchNetwork(e){var i;const{caipNetwork:s}=e,n=Oe.getProviderId(s.chainNamespace),r=Oe.getProvider(s.chainNamespace);if(!r)throw new Error("Provider not found");if(n==="WALLET_CONNECT"){r.setDefaultChain(s.caipNetworkId);return}if(n==="AUTH"){const o=(i=j.getAuthConnector())==null?void 0:i.provider;if(!o)throw new Error("Auth provider not found");const a=Zt(s.chainNamespace);await o.switchNetwork({chainId:s.caipNetworkId});const c=await o.getUser({chainId:s.caipNetworkId,preferredAccountType:a});this.emit("switchNetwork",c)}}getWalletConnectConnector(){const e=this.connectors.find(s=>s.id==="walletConnect");if(!e)throw new Error("WalletConnectConnector not found");return e}onConnect(e,s){if(e.length>0){const{address:n,chainId:r}=Y.getAccount(e[0]),i=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===(r==null?void 0:r.toString())),o=this.connectors.find(a=>a.id===s);n&&(this.emit("accountChanged",{address:n,chainId:r,connector:o}),this.addConnection({connectorId:s,accounts:e.map(a=>{const{address:c}=Y.getAccount(a);return{address:c}}),caipNetwork:i}))}}onAccountsChanged(e,s,n=!0){var r,i;if(e.length>0){const{address:o}=Y.getAccount(e[0]),a=this.getConnection({connectorId:s,connections:this.connections,connectors:this.connectors});o&&((r=this.getConnectorId(k.CHAIN.EVM))==null?void 0:r.toLowerCase())===s.toLowerCase()&&this.emit("accountChanged",{address:o,chainId:(i=a==null?void 0:a.caipNetwork)==null?void 0:i.id,connector:a==null?void 0:a.connector}),this.addConnection({connectorId:s,accounts:e.map(c=>{const{address:l}=Y.getAccount(c);return{address:l}}),caipNetwork:a==null?void 0:a.caipNetwork})}else n&&this.onDisconnect(s)}onDisconnect(e){var s;this.removeProviderListeners(e),this.deleteConnection(e),((s=this.getConnectorId(k.CHAIN.EVM))==null?void 0:s.toLowerCase())===e.toLowerCase()&&this.emitFirstAvailableConnection(),this.connections.length===0&&this.emit("disconnect")}onChainChanged(e,s){var o;const n=typeof e=="string"&&e.startsWith("0x")?parseInt(e,16).toString():e.toString(),r=this.getConnection({connectorId:s,connections:this.connections,connectors:this.connectors}),i=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===n);r&&this.addConnection({connectorId:s,accounts:r.accounts,caipNetwork:i}),((o=this.getConnectorId(k.CHAIN.EVM))==null?void 0:o.toLowerCase())===s.toLowerCase()&&this.emit("switchNetwork",{chainId:n})}listenProviderEvents(e,s){if(rw.includes(e))return;const n=o=>this.onAccountsChanged(o,e),r=o=>this.onChainChanged(o,e),i=()=>this.onDisconnect(e);this.providerHandlers[e]||(s.on("disconnect",i),s.on("accountsChanged",n),s.on("chainChanged",r),this.providerHandlers[e]={provider:s,disconnect:i,accountsChanged:n,chainChanged:r})}removeProviderListeners(e){if(this.providerHandlers[e]){const{provider:s,disconnect:n,accountsChanged:r,chainChanged:i}=this.providerHandlers[e];s.removeListener("disconnect",n),s.removeListener("accountsChanged",r),s.removeListener("chainChanged",i),this.providerHandlers[e]=null}}emitFirstAvailableConnection(){var s;const e=this.getConnection({connections:this.connections,connectors:this.connectors});if(e){const[n]=e.accounts;this.emit("accountChanged",{address:n==null?void 0:n.address,chainId:(s=e.caipNetwork)==null?void 0:s.id,connector:e.connector})}}getConnection({address:e,connectorId:s,connections:n,connectors:r}){if(s){const o=n.find(l=>l.connectorId.toLowerCase()===s.toLowerCase());if(!o)return null;const a=r.find(l=>l.id.toLowerCase()===o.connectorId.toLowerCase()),c=e?o.accounts.find(l=>l.address.toLowerCase()===e.toLowerCase()):o.accounts[0];return{...o,account:c,connector:a}}const i=n.find(o=>o.accounts.length>0&&r.some(a=>a.id.toLowerCase()===o.connectorId.toLowerCase()));if(i){const[o]=i.accounts,a=r.find(c=>c.id.toLowerCase()===i.connectorId.toLowerCase());return{...i,account:o,connector:a}}return null}}let An=null;const as={getSIWX(){return U.state.siwx},async initializeIfEnabled(t=m.getActiveCaipAddress()){var i,o,a;const e=U.state.siwx;if(!(e&&t))return;const[s,n,r]=t.split(":");if(m.checkIfSupportedNetwork(s,`${s}:${n}`))try{if((i=U.state.remoteFeatures)!=null&&i.emailCapture){const l=(o=m.getAccountData(s))==null?void 0:o.user;await pe.open({view:"DataCapture",data:{email:(l==null?void 0:l.email)??void 0}});return}if(An&&await An,(await e.getSessions(`${s}:${n}`,r)).length)return;await pe.open({view:"SIWXSignMessage"})}catch(c){console.error("SIWXUtil:initializeIfEnabled",c),de.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(c)}),await((a=H._getClient())==null?void 0:a.disconnect().catch(console.error)),se.reset("Connect"),Es.showError("A problem occurred while trying initialize authentication")}},async isAuthenticated(t=m.getActiveCaipAddress()){if(!U.state.siwx||!t)return!0;const{chainNamespace:s,chainId:n,address:r}=Qe.parseCaipAddress(t),i=`${s}:${n}`;return(await as.getSessions({address:r,caipNetworkId:i})).length>0},async requestSignMessage(){const t=U.state.siwx,e=Y.getPlainAddress(m.getActiveCaipAddress()),s=Li();if(!t)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!s)throw new Error("No ActiveCaipNetwork or client found");try{const n=await t.createMessage({chainId:s.caipNetworkId,accountAddress:e}),r=n.toString();let i="";t.signMessage?i=await t.signMessage({message:r,chainId:s.caipNetworkId,accountAddress:e}):(j.getConnectorId(s.chainNamespace)===k.CONNECTOR_ID.AUTH&&se.pushTransactionStack({}),i=await H.signMessage(r)||""),await t.addSession({data:n,message:r,signature:i}),m.setLastConnectedSIWECaipNetwork(s),pe.close(),de.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(n){(!pe.state.open||se.state.view==="ApproveTransaction")&&await pe.open({view:"SIWXSignMessage"}),Es.showError("Error signing message"),de.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(n)}),console.error("SWIXUtil:requestSignMessage",n)}},async cancelSignMessage(){var t;try{const e=this.getSIWX();if((t=e==null?void 0:e.getRequired)==null?void 0:t.call(e)){const n=m.getLastConnectedSIWECaipNetwork();if(n){const r=await(e==null?void 0:e.getSessions(n==null?void 0:n.caipNetworkId,Y.getPlainAddress(m.getActiveCaipAddress())||""));r&&r.length>0?await m.switchActiveNetwork(n):await H.disconnect()}else await H.disconnect()}else pe.close();pe.close(),de.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(e){console.error("SIWXUtil:cancelSignMessage",e)}},async getAllSessions(){const t=this.getSIWX(),e=m.getAllRequestedCaipNetworks(),s=[];return await Promise.all(e.map(async n=>{const r=await(t==null?void 0:t.getSessions(n.caipNetworkId,Y.getPlainAddress(m.getActiveCaipAddress())||""));r&&s.push(...r)})),s},async getSessions(t){const e=U.state.siwx;let s=t==null?void 0:t.address;if(!s){const r=m.getActiveCaipAddress();s=Y.getPlainAddress(r)}let n=t==null?void 0:t.caipNetworkId;if(!n){const r=m.getActiveCaipNetwork();n=r==null?void 0:r.caipNetworkId}return e&&s&&n?e.getSessions(n,s):[]},async isSIWXCloseDisabled(){var e;const t=this.getSIWX();if(t){const s=se.state.view==="ApproveTransaction",n=se.state.view==="SIWXSignMessage";if(s||n)return((e=t.getRequired)==null?void 0:e.call(t))&&(await this.getSessions()).length===0}return!1},async authConnectorAuthenticate({authConnector:t,chainId:e,socialUri:s,preferredAccountType:n,chainNamespace:r}){var u;const i=as.getSIWX(),o=Li();if(!i||!r.includes(k.CHAIN.EVM)||(u=U.state.remoteFeatures)!=null&&u.emailCapture){const h=await t.connect({chainId:e,socialUri:s,preferredAccountType:n});return{address:h.address,chainId:h.chainId,accounts:h.accounts}}const a=`${r}:${e}`,c=await i.createMessage({chainId:a,accountAddress:"<<AccountAddress>>"}),l={accountAddress:c.accountAddress,chainId:c.chainId,domain:c.domain,uri:c.uri,version:c.version,nonce:c.nonce,notBefore:c.notBefore,statement:c.statement,resources:c.resources,requestId:c.requestId,issuedAt:c.issuedAt,expirationTime:c.expirationTime,serializedMessage:c.toString()},d=await t.connect({chainId:e,socialUri:s,siwxMessage:l,preferredAccountType:n});return l.accountAddress=d.address,l.serializedMessage=d.message||"",d.signature&&d.message&&await as.addEmbeddedWalletSession(l,d.message,d.signature),m.setLastConnectedSIWECaipNetwork(o),{address:d.address,chainId:d.chainId,accounts:d.accounts}},async addEmbeddedWalletSession(t,e,s){if(An)return An;const n=as.getSIWX();return n?(An=n.addSession({data:t,message:e,signature:s}).finally(()=>{An=null}),An):Promise.resolve()},async universalProviderAuthenticate({universalProvider:t,chains:e,methods:s}){var l,d,u;const n=as.getSIWX(),r=Li(),i=new Set(e.map(h=>h.split(":")[0]));if(!n||i.size!==1||!i.has("eip155"))return!1;const o=await n.createMessage({chainId:((l=Li())==null?void 0:l.caipNetworkId)||"",accountAddress:""}),a=await t.authenticate({nonce:o.nonce,domain:o.domain,uri:o.uri,exp:o.expirationTime,iat:o.issuedAt,nbf:o.notBefore,requestId:o.requestId,version:o.version,resources:o.resources,statement:o.statement,chainId:o.chainId,methods:s,chains:[o.chainId,...e.filter(h=>h!==o.chainId)]});Es.showLoading("Authenticating...",{autoClose:!1});const c={...a.session.peer.metadata,name:a.session.peer.metadata.name,icon:(d=a.session.peer.metadata.icons)==null?void 0:d[0],type:"WALLET_CONNECT"};if(m.setAccountProp("connectedWalletInfo",c,Array.from(i)[0]),(u=a==null?void 0:a.auths)!=null&&u.length){const h=a.auths.map(f=>{const g=t.client.formatAuthMessage({request:f.p,iss:f.p.iss});return{data:{...f.p,accountAddress:f.p.iss.split(":").slice(-1).join(""),chainId:f.p.iss.split(":").slice(2,4).join(":"),uri:f.p.aud??"",version:f.p.version||o.version,expirationTime:f.p.exp,issuedAt:f.p.iat,notBefore:f.p.nbf},message:g,signature:f.s.s,cacao:f}});try{await n.setSessions(h),r&&m.setLastConnectedSIWECaipNetwork(r),de.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:as.getSIWXEventProperties()})}catch(f){throw console.error("SIWX:universalProviderAuth - failed to set sessions",f),de.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:as.getSIWXEventProperties(f)}),await t.disconnect().catch(console.error),f}finally{Es.hide()}}return!0},getSIWXEventProperties(t){var s;const e=m.state.activeChain;if(!e)throw new Error("SIWXUtil:getSIWXEventProperties - namespace is required");return{network:((s=m.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)||"",isSmartAccount:Zt(e)===js.ACCOUNT_TYPES.SMART_ACCOUNT,message:t?Y.parseError(t):void 0}},async clearSessions(){const t=this.getSIWX();t&&await t.setSessions([])}};class ow{constructor({provider:e,namespace:s}){this.id=k.CONNECTOR_ID.WALLET_CONNECT,this.name="WalletConnect",this.type="WALLET_CONNECT",this.imageId="ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",this.getCaipNetworks=m.getCaipNetworks.bind(m),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=s}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){const s=this.getCaipNetworks(),n=U.state.universalProviderConfigOverride,r=fn.createNamespaces(s,n);await this.provider.connect({optionalNamespaces:r})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){const e=this.chains.map(s=>s.caipNetworkId);return as.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:aw})}}const aw=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],ts=ke({message:"",variant:"info",open:!1}),cw={state:ts,subscribeKey(t,e){return tt(ts,t,e)},open(t,e){const{debug:s}=U.state,{code:n,displayMessage:r,debugMessage:i}=t;r&&s&&(ts.message=r,ts.variant=e,ts.open=!0)},warn(t,e,s){ts.open=!0,ts.message=t,ts.variant="warning",e&&console.warn(e,s)},close(){ts.open=!1,ts.message="",ts.variant="info"}},Pt=es(cw),lw={asset:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913"},dw={asset:"0x036CbD53842c5426634e7929541eC2318f3dCF7e"};function uw(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function ze(t,...e){try{return uw(t(...e))}catch(s){return Promise.reject(s)}}function hw(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function fw(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function ao(t){if(hw(t))return String(t);if(fw(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return ao(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const ac="base64:";function pw(t){return typeof t=="string"?t:ac+ww(t)}function gw(t){return typeof t!="string"||!t.startsWith(ac)?t:mw(t.slice(ac.length))}function mw(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function ww(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Et(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function yw(...t){return Et(t.join(":"))}function Fi(t){return t=Et(t),t?t+":":""}function bw(t,e){if(e===void 0)return!0;let s=0,n=t.indexOf(":");for(;n>-1;)s++,n=t.indexOf(":",n+1);return s<=e}function Ew(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const vw="memory",Cw=()=>{const t=new Map;return{name:vw,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,s){t.set(e,s)},setItemRaw(e,s){t.set(e,s)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Aw(t={}){const e={mounts:{"":t.driver||Cw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},s=l=>{for(const d of e.mountpoints)if(l.startsWith(d))return{base:d,relativeKey:l.slice(d.length),driver:e.mounts[d]};return{base:"",relativeKey:l,driver:e.mounts[""]}},n=(l,d)=>e.mountpoints.filter(u=>u.startsWith(l)||d&&l.startsWith(u)).map(u=>({relativeBase:l.length>u.length?l.slice(u.length):void 0,mountpoint:u,driver:e.mounts[u]})),r=(l,d)=>{if(e.watching){d=Et(d);for(const u of e.watchListeners)u(l,d)}},i=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await Xl(e.mounts[l],r,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,d,u)=>{const h=new Map,f=g=>{let p=h.get(g.base);return p||(p={driver:g.driver,base:g.base,items:[]},h.set(g.base,p)),p};for(const g of l){const p=typeof g=="string",w=Et(p?g:g.key),b=p?void 0:g.value,I=p||!g.options?d:{...d,...g.options},v=s(w);f(v).items.push({key:w,value:b,relativeKey:v.relativeKey,options:I})}return Promise.all([...h.values()].map(g=>u(g))).then(g=>g.flat())},c={hasItem(l,d={}){l=Et(l);const{relativeKey:u,driver:h}=s(l);return ze(h.hasItem,u,d)},getItem(l,d={}){l=Et(l);const{relativeKey:u,driver:h}=s(l);return ze(h.getItem,u,d).then(f=>Di(f))},getItems(l,d={}){return a(l,d,u=>u.driver.getItems?ze(u.driver.getItems,u.items.map(h=>({key:h.relativeKey,options:h.options})),d).then(h=>h.map(f=>({key:yw(u.base,f.key),value:Di(f.value)}))):Promise.all(u.items.map(h=>ze(u.driver.getItem,h.relativeKey,h.options).then(f=>({key:h.key,value:Di(f)})))))},getItemRaw(l,d={}){l=Et(l);const{relativeKey:u,driver:h}=s(l);return h.getItemRaw?ze(h.getItemRaw,u,d):ze(h.getItem,u,d).then(f=>gw(f))},async setItem(l,d,u={}){if(d===void 0)return c.removeItem(l);l=Et(l);const{relativeKey:h,driver:f}=s(l);f.setItem&&(await ze(f.setItem,h,ao(d),u),f.watch||r("update",l))},async setItems(l,d){await a(l,d,async u=>{if(u.driver.setItems)return ze(u.driver.setItems,u.items.map(h=>({key:h.relativeKey,value:ao(h.value),options:h.options})),d);u.driver.setItem&&await Promise.all(u.items.map(h=>ze(u.driver.setItem,h.relativeKey,ao(h.value),h.options)))})},async setItemRaw(l,d,u={}){if(d===void 0)return c.removeItem(l,u);l=Et(l);const{relativeKey:h,driver:f}=s(l);if(f.setItemRaw)await ze(f.setItemRaw,h,d,u);else if(f.setItem)await ze(f.setItem,h,pw(d),u);else return;f.watch||r("update",l)},async removeItem(l,d={}){typeof d=="boolean"&&(d={removeMeta:d}),l=Et(l);const{relativeKey:u,driver:h}=s(l);h.removeItem&&(await ze(h.removeItem,u,d),(d.removeMeta||d.removeMata)&&await ze(h.removeItem,u+"$",d),h.watch||r("remove",l))},async getMeta(l,d={}){typeof d=="boolean"&&(d={nativeOnly:d}),l=Et(l);const{relativeKey:u,driver:h}=s(l),f=Object.create(null);if(h.getMeta&&Object.assign(f,await ze(h.getMeta,u,d)),!d.nativeOnly){const g=await ze(h.getItem,u+"$",d).then(p=>Di(p));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(f,g))}return f},setMeta(l,d,u={}){return this.setItem(l+"$",d,u)},removeMeta(l,d={}){return this.removeItem(l+"$",d)},async getKeys(l,d={}){var w;l=Fi(l);const u=n(l,!0);let h=[];const f=[];let g=!0;for(const b of u){(w=b.driver.flags)!=null&&w.maxDepth||(g=!1);const I=await ze(b.driver.getKeys,b.relativeBase,d);for(const v of I){const E=b.mountpoint+Et(v);h.some(_=>E.startsWith(_))||f.push(E)}h=[b.mountpoint,...h.filter(v=>!v.startsWith(b.mountpoint))]}const p=d.maxDepth!==void 0&&!g;return f.filter(b=>(!p||bw(b,d.maxDepth))&&Ew(b,l))},async clear(l,d={}){l=Fi(l),await Promise.all(n(l,!1).map(async u=>{if(u.driver.clear)return ze(u.driver.clear,u.relativeBase,d);if(u.driver.removeItem){const h=await u.driver.getKeys(u.relativeBase||"",d);return Promise.all(h.map(f=>u.driver.removeItem(f,d)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Zl(l)))},async watch(l){return await i(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(d=>d!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,d){if(l=Fi(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((u,h)=>h.length-u.length)),e.mounts[l]=d,e.watching&&Promise.resolve(Xl(d,r,l)).then(u=>{e.unwatch[l]=u}).catch(console.error),c},async unmount(l,d=!0){var u,h;l=Fi(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((h=(u=e.unwatch)[l])==null||h.call(u),delete e.unwatch[l]),d&&await Zl(e.mounts[l]),e.mountpoints=e.mountpoints.filter(f=>f!==l),delete e.mounts[l])},getMount(l=""){l=Et(l)+":";const d=s(l);return{driver:d.driver,base:d.base}},getMounts(l="",d={}){return l=Et(l),n(l,d.parents).map(h=>({driver:h.driver,base:h.mountpoint}))},keys:(l,d={})=>c.getKeys(l,d),get:(l,d={})=>c.getItem(l,d),set:(l,d,u={})=>c.setItem(l,d,u),has:(l,d={})=>c.hasItem(l,d),del:(l,d={})=>c.removeItem(l,d),remove:(l,d={})=>c.removeItem(l,d)};return c}function Xl(t,e,s){return t.watch?t.watch((n,r)=>e(n,s+r)):()=>{}}async function Zl(t){typeof t.dispose=="function"&&await ze(t.dispose)}const Iw="idb-keyval";var Nw=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",s=r=>e+r;let n;return t.dbName&&t.storeName&&(n=Mg(t.dbName,t.storeName)),{name:Iw,options:t,async hasItem(r){return!(typeof await Bl(s(r),n)>"u")},async getItem(r){return await Bl(s(r),n)??null},setItem(r,i){return Wg(s(r),i,n)},removeItem(r){return qg(s(r),n)},getKeys(){return jg(n)},clear(){return Fg(n)}}};const Sw="WALLET_CONNECT_V2_INDEXED_DB",_w="keyvaluestorage";let Tw=class{constructor(){this.indexedDb=Aw({driver:Nw({dbName:Sw,storeName:_w})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const s=await this.indexedDb.getItem(e);if(s!==null)return s}async setItem(e,s){await this.indexedDb.setItem(e,Jc(s))}async removeItem(e){await this.indexedDb.removeItem(e)}};var la=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},co={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(s){return this.hasOwnProperty(s)?String(this[s]):null},t.prototype.setItem=function(s,n){this[s]=String(n)},t.prototype.removeItem=function(s){delete this[s]},t.prototype.clear=function(){const s=this;Object.keys(s).forEach(function(n){s[n]=void 0,delete s[n]})},t.prototype.key=function(s){return s=s||0,Object.keys(this)[s]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof la<"u"&&la.localStorage?co.exports=la.localStorage:typeof window<"u"&&window.localStorage?co.exports=window.localStorage:co.exports=new e})();function xw(t){var e;return[t[0],wo((e=t[1])!=null?e:"")]}let Ow=class{constructor(){this.localStorage=co.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(xw)}async getItem(e){const s=this.localStorage.getItem(e);if(s!==null)return wo(s)}async setItem(e,s){this.localStorage.setItem(e,Jc(s))}async removeItem(e){this.localStorage.removeItem(e)}};const Pw="wc_storage_version",Ql=1,kw=async(t,e,s)=>{const n=Pw,r=await e.getItem(n);if(r&&r>=Ql){s(e);return}const i=await t.getKeys();if(!i.length){s(e);return}const o=[];for(;i.length;){const a=i.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(n,Ql),s(e),Rw(t,o)},Rw=async(t,e)=>{e.length&&e.forEach(async s=>{await t.removeItem(s)})};let Uw=class{constructor(){this.initialized=!1,this.setInitialized=s=>{this.storage=s,this.initialized=!0};const e=new Ow;this.storage=e;try{const s=new Tw;kw(e,s,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,s){return await this.initialize(),this.storage.setItem(e,s)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const s=setInterval(()=>{this.initialized&&(clearInterval(s),e())},20)})}};var $w=Object.defineProperty,Dw=(t,e,s)=>e in t?$w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ed=(t,e,s)=>Dw(t,typeof e!="symbol"?e+"":e,s);let Bw=class extends Pr{constructor(e){super(),this.opts=e,ed(this,"protocol","wc"),ed(this,"version",2)}};var Lw=Object.defineProperty,Mw=(t,e,s)=>e in t?Lw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Fw=(t,e,s)=>Mw(t,e+"",s);let jw=class extends Pr{constructor(e,s){super(),this.core=e,this.logger=s,Fw(this,"records",new Map)}},qw=class{constructor(e,s){this.logger=e,this.core=s}},Ww=class extends Pr{constructor(e,s){super(),this.relayer=e,this.logger=s}},Hw=class extends Pr{constructor(e){super()}},zw=class{constructor(e,s,n,r){this.core=e,this.logger=s,this.name=n}},Kw=class extends Pr{constructor(e,s){super(),this.relayer=e,this.logger=s}},Vw=class extends Pr{constructor(e,s){super(),this.core=e,this.logger=s}},Gw=class{constructor(e,s,n){this.core=e,this.logger=s,this.store=n}};class Yw{constructor(e,s){this.projectId=e,this.logger=s}}let Jw=class{constructor(e,s,n){this.core=e,this.logger=s,this.telemetryEnabled=n}};var Xw=Object.defineProperty,Zw=(t,e,s)=>e in t?Xw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,td=(t,e,s)=>Zw(t,typeof e!="symbol"?e+"":e,s);let Qw=class{constructor(e){this.opts=e,td(this,"protocol","wc"),td(this,"version",2)}},ey=class{constructor(e){this.client=e}};const ty="0.1.1";function sy(){return ty}class $e extends Error{constructor(e,s={}){const n=(()=>{var c;if(s.cause instanceof $e){if(s.cause.details)return s.cause.details;if(s.cause.shortMessage)return s.cause.shortMessage}return s.cause&&"details"in s.cause&&typeof s.cause.details=="string"?s.cause.details:(c=s.cause)!=null&&c.message?s.cause.message:s.details})(),r=s.cause instanceof $e&&s.cause.docsPath||s.docsPath,o=`https://oxlib.sh${r??""}`,a=[e||"An error occurred.",...s.metaMessages?["",...s.metaMessages]:[],...n||r?["",n?`Details: ${n}`:void 0,r?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,s.cause?{cause:s.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${sy()}`}),this.cause=s.cause,this.details=n,this.docs=o,this.docsPath=r,this.shortMessage=e}walk(e){return Hh(this,e)}}function Hh(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?Hh(t.cause,e):e?null:t}const ir=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ny(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function fi(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function zn(t,...e){if(!ny(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function ry(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");fi(t.outputLen),fi(t.blockLen)}function Nr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function zh(t,e){zn(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function iy(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Sr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function da(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function hs(t,e){return t<<32-e|t>>>e}const oy=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ay(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function cy(t){for(let e=0;e<t.length;e++)t[e]=ay(t[e]);return t}const sd=oy?t=>t:cy;function ly(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Fo(t){return typeof t=="string"&&(t=ly(t)),zn(t),t}function dy(...t){let e=0;for(let n=0;n<t.length;n++){const r=t[n];zn(r),e+=r.length}const s=new Uint8Array(e);for(let n=0,r=0;n<t.length;n++){const i=t[n];s.set(i,r),r+=i.length}return s}class nl{}function Kh(t){const e=n=>t().update(Fo(n)).digest(),s=t();return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=()=>t(),e}function uy(t=32){if(ir&&typeof ir.getRandomValues=="function")return ir.getRandomValues(new Uint8Array(t));if(ir&&typeof ir.randomBytes=="function")return Uint8Array.from(ir.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function hy(t,e,s,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,n);const r=BigInt(32),i=BigInt(4294967295),o=Number(s>>r&i),a=Number(s&i),c=n?4:0,l=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+l,a,n)}function fy(t,e,s){return t&e^~t&s}function py(t,e,s){return t&e^t&s^e&s}class gy extends nl{constructor(e,s,n,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=s,this.padOffset=n,this.isLE=r,this.buffer=new Uint8Array(e),this.view=da(this.buffer)}update(e){Nr(this),e=Fo(e),zn(e);const{view:s,buffer:n,blockLen:r}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(r-this.pos,i-o);if(a===r){const c=da(e);for(;r<=i-o;o+=r)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(s,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Nr(this),zh(e,this),this.finished=!0;const{buffer:s,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;s[o++]=128,Sr(this.buffer.subarray(o)),this.padOffset>r-o&&(this.process(n,0),o=0);for(let u=o;u<r;u++)s[u]=0;hy(n,r-8,BigInt(this.length*8),i),this.process(n,0);const a=da(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,d[u],i)}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const n=e.slice(0,s);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:s,buffer:n,length:r,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=r,e.pos=a,r%s&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const Js=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ji=BigInt(2**32-1),nd=BigInt(32);function my(t,e=!1){return e?{h:Number(t&ji),l:Number(t>>nd&ji)}:{h:Number(t>>nd&ji)|0,l:Number(t&ji)|0}}function wy(t,e=!1){const s=t.length;let n=new Uint32Array(s),r=new Uint32Array(s);for(let i=0;i<s;i++){const{h:o,l:a}=my(t[i],e);[n[i],r[i]]=[o,a]}return[n,r]}const yy=(t,e,s)=>t<<s|e>>>32-s,by=(t,e,s)=>e<<s|t>>>32-s,Ey=(t,e,s)=>e<<s-32|t>>>64-s,vy=(t,e,s)=>t<<s-32|e>>>64-s,Cy=BigInt(0),Lr=BigInt(1),Ay=BigInt(2),Iy=BigInt(7),Ny=BigInt(256),Sy=BigInt(113),Vh=[],Gh=[],Yh=[];for(let t=0,e=Lr,s=1,n=0;t<24;t++){[s,n]=[n,(2*s+3*n)%5],Vh.push(2*(5*n+s)),Gh.push((t+1)*(t+2)/2%64);let r=Cy;for(let i=0;i<7;i++)e=(e<<Lr^(e>>Iy)*Sy)%Ny,e&Ay&&(r^=Lr<<(Lr<<BigInt(i))-Lr);Yh.push(r)}const Jh=wy(Yh,!0),_y=Jh[0],Ty=Jh[1],rd=(t,e,s)=>s>32?Ey(t,e,s):yy(t,e,s),id=(t,e,s)=>s>32?vy(t,e,s):by(t,e,s);function xy(t,e=24){const s=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)s[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=s[c],d=s[c+1],u=rd(l,d,1)^s[a],h=id(l,d,1)^s[a+1];for(let f=0;f<50;f+=10)t[o+f]^=u,t[o+f+1]^=h}let r=t[2],i=t[3];for(let o=0;o<24;o++){const a=Gh[o],c=rd(r,i,a),l=id(r,i,a),d=Vh[o];r=t[d],i=t[d+1],t[d]=c,t[d+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)s[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~s[(a+2)%10]&s[(a+4)%10]}t[0]^=_y[n],t[1]^=Ty[n]}Sr(s)}class rl extends nl{constructor(e,s,n,r=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=s,this.outputLen=n,this.enableXOF=r,this.rounds=i,fi(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=iy(this.state)}clone(){return this._cloneInto()}keccak(){sd(this.state32),xy(this.state32,this.rounds),sd(this.state32),this.posOut=0,this.pos=0}update(e){Nr(this),e=Fo(e),zn(e);const{blockLen:s,state:n}=this,r=e.length;for(let i=0;i<r;){const o=Math.min(s-this.pos,r-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:s,pos:n,blockLen:r}=this;e[n]^=s,s&128&&n===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){Nr(this,!1),zn(e),this.finish();const s=this.state,{blockLen:n}=this;for(let r=0,i=e.length;r<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-r);e.set(s.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return fi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(zh(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Sr(this.state)}_cloneInto(e){const{blockLen:s,suffix:n,outputLen:r,rounds:i,enableXOF:o}=this;return e||(e=new rl(s,n,r,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Oy=(t,e,s)=>Kh(()=>new rl(e,t,s)),Py=Oy(1,136,256/8),ky=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Xs=new Uint32Array(64);class Ry extends gy{constructor(e=32){super(64,e,8,!1),this.A=Js[0]|0,this.B=Js[1]|0,this.C=Js[2]|0,this.D=Js[3]|0,this.E=Js[4]|0,this.F=Js[5]|0,this.G=Js[6]|0,this.H=Js[7]|0}get(){const{A:e,B:s,C:n,D:r,E:i,F:o,G:a,H:c}=this;return[e,s,n,r,i,o,a,c]}set(e,s,n,r,i,o,a,c){this.A=e|0,this.B=s|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,s){for(let u=0;u<16;u++,s+=4)Xs[u]=e.getUint32(s,!1);for(let u=16;u<64;u++){const h=Xs[u-15],f=Xs[u-2],g=hs(h,7)^hs(h,18)^h>>>3,p=hs(f,17)^hs(f,19)^f>>>10;Xs[u]=p+Xs[u-7]+g+Xs[u-16]|0}let{A:n,B:r,C:i,D:o,E:a,F:c,G:l,H:d}=this;for(let u=0;u<64;u++){const h=hs(a,6)^hs(a,11)^hs(a,25),f=d+h+fy(a,c,l)+ky[u]+Xs[u]|0,p=(hs(n,2)^hs(n,13)^hs(n,22))+py(n,r,i)|0;d=l,l=c,c=a,a=o+f|0,o=i,i=r,r=n,n=f+p|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,r,i,o,a,c,l,d)}roundClean(){Sr(Xs)}destroy(){this.set(0,0,0,0,0,0,0,0),Sr(this.buffer)}}const Uy=Kh(()=>new Ry);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const il=BigInt(0),cc=BigInt(1);function Ni(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ol(t){if(!Ni(t))throw new Error("Uint8Array expected")}function pi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function qi(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Xh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?il:BigInt("0x"+t)}const Zh=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",$y=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function gi(t){if(ol(t),Zh)return t.toHex();let e="";for(let s=0;s<t.length;s++)e+=$y[t[s]];return e}const Ts={_0:48,_9:57,A:65,F:70,a:97,f:102};function od(t){if(t>=Ts._0&&t<=Ts._9)return t-Ts._0;if(t>=Ts.A&&t<=Ts.F)return t-(Ts.A-10);if(t>=Ts.a&&t<=Ts.f)return t-(Ts.a-10)}function Ao(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Zh)return Uint8Array.fromHex(t);const e=t.length,s=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(s);for(let r=0,i=0;r<s;r++,i+=2){const o=od(t.charCodeAt(i)),a=od(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[r]=o*16+a}return n}function jn(t){return Xh(gi(t))}function Qh(t){return ol(t),Xh(gi(Uint8Array.from(t).reverse()))}function Si(t,e){return Ao(t.toString(16).padStart(e*2,"0"))}function ef(t,e){return Si(t,e).reverse()}function Gt(t,e,s){let n;if(typeof e=="string")try{n=Ao(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Ni(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const r=n.length;if(typeof s=="number"&&r!==s)throw new Error(t+" of length "+s+" expected, got "+r);return n}function Io(...t){let e=0;for(let n=0;n<t.length;n++){const r=t[n];ol(r),e+=r.length}const s=new Uint8Array(e);for(let n=0,r=0;n<t.length;n++){const i=t[n];s.set(i,r),r+=i.length}return s}const ua=t=>typeof t=="bigint"&&il<=t;function al(t,e,s){return ua(t)&&ua(e)&&ua(s)&&e<=t&&t<s}function yr(t,e,s,n){if(!al(e,s,n))throw new Error("expected valid "+t+": "+s+" <= n < "+n+", got "+e)}function Dy(t){let e;for(e=0;t>il;t>>=cc,e+=1);return e}const jo=t=>(cc<<BigInt(t))-cc,ha=t=>new Uint8Array(t),ad=t=>Uint8Array.from(t);function By(t,e,s){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof s!="function")throw new Error("hmacFn must be a function");let n=ha(t),r=ha(t),i=0;const o=()=>{n.fill(1),r.fill(0),i=0},a=(...u)=>s(r,n,...u),c=(u=ha(0))=>{r=a(ad([0]),u),n=a(),u.length!==0&&(r=a(ad([1]),u),n=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const h=[];for(;u<e;){n=a();const f=n.slice();h.push(f),u+=n.length}return Io(...h)};return(u,h)=>{o(),c(u);let f;for(;!(f=h(l()));)c();return o(),f}}const Ly={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ni(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function qo(t,e,s={}){const n=(r,i,o)=>{const a=Ly[i];if(typeof a!="function")throw new Error("invalid validator function");const c=t[r];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(r)+" is invalid. Expected "+i+", got "+c)};for(const[r,i]of Object.entries(e))n(r,i,!1);for(const[r,i]of Object.entries(s))n(r,i,!0);return t}function cd(t){const e=new WeakMap;return(s,...n)=>{const r=e.get(s);if(r!==void 0)return r;const i=t(s,...n);return e.set(s,i),i}}function My(t,e){if(hd(t)>e)throw new o0({givenSize:hd(t),maxSize:e})}const xs={zero:48,nine:57,A:65,F:70,a:97,f:102};function ld(t){if(t>=xs.zero&&t<=xs.nine)return t-xs.zero;if(t>=xs.A&&t<=xs.F)return t-(xs.A-10);if(t>=xs.a&&t<=xs.f)return t-(xs.a-10)}function Fy(t,e={}){const{dir:s,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new a0({size:t.length,targetSize:n,type:"Bytes"});const r=new Uint8Array(n);for(let i=0;i<n;i++){const o=s==="right";r[o?i:n-i-1]=t[o?i:t.length-i-1]}return r}function tf(t,e){if(wn(t)>e)throw new Jy({givenSize:wn(t),maxSize:e})}function jy(t,e){if(typeof e=="number"&&e>0&&e>wn(t)-1)throw new rf({offset:e,position:"start",size:wn(t)})}function qy(t,e,s){if(typeof e=="number"&&typeof s=="number"&&wn(t)!==s-e)throw new rf({offset:s,position:"end",size:wn(t)})}function sf(t,e={}){const{dir:s,size:n=32}=e;if(n===0)return t;const r=t.replace("0x","");if(r.length>n*2)throw new Xy({size:Math.ceil(r.length/2),targetSize:n,type:"Hex"});return`0x${r[s==="right"?"padEnd":"padStart"](n*2,"0")}`}const Wy="#__bigint";function cl(t,e,s){return JSON.stringify(t,(n,r)=>typeof r=="bigint"?r.toString()+Wy:r,s)}const Hy=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function zy(t,e={}){const{strict:s=!1}=e;if(!t)throw new dd(t);if(typeof t!="string")throw new dd(t);if(s&&!/^0x[0-9a-fA-F]*$/.test(t))throw new ud(t);if(!t.startsWith("0x"))throw new ud(t)}function Ky(...t){return`0x${t.reduce((e,s)=>e+s.replace("0x",""),"")}`}function ll(t){return t instanceof Uint8Array?No(t):Array.isArray(t)?No(new Uint8Array(t)):t}function No(t,e={}){let s="";for(let r=0;r<t.length;r++)s+=Hy[t[r]];const n=`0x${s}`;return typeof e.size=="number"?(tf(n,e.size),nf(n,e.size)):n}function fa(t,e={}){const{signed:s,size:n}=e,r=BigInt(t);let i;n?s?i=(1n<<BigInt(n)*8n-1n)-1n:i=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&s?-i-1n:0;if(i&&r>i||r<o){const l=typeof t=="bigint"?"n":"";throw new Yy({max:i?`${i}${l}`:void 0,min:`${o}${l}`,signed:s,size:n,value:`${t}${l}`})}const c=`0x${(s&&r<0?(1n<<BigInt(n*8))+BigInt(r):r).toString(16)}`;return n?Vy(c,n):c}function Vy(t,e){return sf(t,{dir:"left",size:e})}function nf(t,e){return sf(t,{dir:"right",size:e})}function Ds(t,e,s,n={}){const{strict:r}=n;jy(t,e);const i=`0x${t.replace("0x","").slice((e??0)*2,(s??t.length)*2)}`;return r&&qy(i,e,s),i}function wn(t){return Math.ceil((t.length-2)/2)}function Gy(t,e={}){const{strict:s=!1}=e;try{return zy(t,{strict:s}),!0}catch{return!1}}class Yy extends $e{constructor({max:e,min:s,signed:n,size:r,value:i}){super(`Number \`${i}\` is not in safe${r?` ${r*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${s}\` to \`${e}\`)`:`(above \`${s}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class dd extends $e{constructor(e){super(`Value \`${typeof e=="object"?cl(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class ud extends $e{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let Jy=class extends $e{constructor({givenSize:e,maxSize:s}){super(`Size cannot exceed \`${s}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class rf extends $e{constructor({offset:e,position:s,size:n}){super(`Slice ${s==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let Xy=class extends $e{constructor({size:e,targetSize:s,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${s}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const Zy=new TextEncoder;function Qy(t){if(!(t instanceof Uint8Array)){if(!t)throw new Wi(t);if(typeof t!="object")throw new Wi(t);if(!("BYTES_PER_ELEMENT"in t))throw new Wi(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Wi(t)}}function e0(t){return t instanceof Uint8Array?t:typeof t=="string"?s0(t):t0(t)}function t0(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function s0(t,e={}){const{size:s}=e;let n=t;s&&(tf(t,s),n=nf(t,s));let r=n.slice(2);r.length%2&&(r=`0${r}`);const i=r.length/2,o=new Uint8Array(i);for(let a=0,c=0;a<i;a++){const l=ld(r.charCodeAt(c++)),d=ld(r.charCodeAt(c++));if(l===void 0||d===void 0)throw new $e(`Invalid byte sequence ("${r[c-2]}${r[c-1]}" in "${r}").`);o[a]=l*16+d}return o}function n0(t,e={}){const{size:s}=e,n=Zy.encode(t);return typeof s=="number"?(My(n,s),r0(n,s)):n}function r0(t,e){return Fy(t,{dir:"right",size:e})}function hd(t){return t.length}function i0(t){try{return Qy(t),!0}catch{return!1}}class Wi extends $e{constructor(e){super(`Value \`${typeof e=="object"?cl(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class o0 extends $e{constructor({givenSize:e,maxSize:s}){super(`Size cannot exceed \`${s}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class a0 extends $e{constructor({size:e,targetSize:s,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${s}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function of(t,e={}){const{as:s=typeof t=="string"?"Hex":"Bytes"}=e,n=Py(e0(t));return s==="Bytes"?n:No(n)}class c0 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const s=super.get(e);return super.has(e)&&s!==void 0&&(this.delete(e),super.set(e,s)),s}set(e,s){if(super.set(e,s),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const l0={checksum:new c0(8192)},pa=l0.checksum;function af(t,e={}){const{compressed:s}=e,{prefix:n,x:r,y:i}=t;if(s===!1||typeof r=="bigint"&&typeof i=="bigint"){if(n!==4)throw new fd({prefix:n,cause:new g0});return}if(s===!0||typeof r=="bigint"&&typeof i>"u"){if(n!==3&&n!==2)throw new fd({prefix:n,cause:new p0});return}throw new f0({publicKey:t})}function d0(t){const e=(()=>{if(Gy(t))return cf(t);if(i0(t))return u0(t);const{prefix:s,x:n,y:r}=t;return typeof n=="bigint"&&typeof r=="bigint"?{prefix:s??4,x:n,y:r}:{prefix:s,x:n}})();return af(e),e}function u0(t){return cf(No(t))}function cf(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new m0({publicKey:t});if(t.length===130){const n=BigInt(Ds(t,0,32)),r=BigInt(Ds(t,32,64));return{prefix:4,x:n,y:r}}if(t.length===132){const n=Number(Ds(t,0,1)),r=BigInt(Ds(t,1,33)),i=BigInt(Ds(t,33,65));return{prefix:n,x:r,y:i}}const e=Number(Ds(t,0,1)),s=BigInt(Ds(t,1,33));return{prefix:e,x:s}}function h0(t,e={}){af(t);const{prefix:s,x:n,y:r}=t,{includePrefix:i=!0}=e;return Ky(i?fa(s,{size:1}):"0x",fa(n,{size:32}),typeof r=="bigint"?fa(r,{size:32}):"0x")}class f0 extends $e{constructor({publicKey:e}){super(`Value \`${cl(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class fd extends $e{constructor({prefix:e,cause:s}){super(`Prefix "${e}" is invalid.`,{cause:s}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class p0 extends $e{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class g0 extends $e{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let m0=class extends $e{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${wn(ll(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const w0=/^0x[a-fA-F0-9]{40}$/;function lf(t,e={}){const{strict:s=!0}=e;if(!w0.test(t))throw new pd({address:t,cause:new E0});if(s){if(t.toLowerCase()===t)return;if(df(t)!==t)throw new pd({address:t,cause:new v0})}}function df(t){if(pa.has(t))return pa.get(t);lf(t,{strict:!1});const e=t.substring(2).toLowerCase(),s=of(n0(e),{as:"Bytes"}),n=e.split("");for(let i=0;i<40;i+=2)s[i>>1]>>4>=8&&n[i]&&(n[i]=n[i].toUpperCase()),(s[i>>1]&15)>=8&&n[i+1]&&(n[i+1]=n[i+1].toUpperCase());const r=`0x${n.join("")}`;return pa.set(t,r),r}function y0(t,e={}){const{checksum:s=!1}=e;return lf(t),s?df(t):t}function b0(t,e={}){const s=of(`0x${h0(t).slice(4)}`).substring(26);return y0(`0x${s}`,e)}class pd extends $e{constructor({address:e,cause:s}){super(`Address "${e}" is invalid.`,{cause:s}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class E0 extends $e{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class v0 extends $e{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}class uf extends nl{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,ry(e);const n=Fo(s);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Sr(i)}update(e){return Nr(this),this.iHash.update(e),this}digestInto(e){Nr(this),zn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:s,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=s._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hf=(t,e,s)=>new uf(t,e).update(s).digest();hf.create=(t,e)=>new uf(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Nt=BigInt(0),ft=BigInt(1),Un=BigInt(2),C0=BigInt(3),ff=BigInt(4),pf=BigInt(5),gf=BigInt(8);function Ct(t,e){const s=t%e;return s>=Nt?s:e+s}function qt(t,e,s){let n=t;for(;e-- >Nt;)n*=n,n%=s;return n}function lc(t,e){if(t===Nt)throw new Error("invert: expected non-zero number");if(e<=Nt)throw new Error("invert: expected positive modulus, got "+e);let s=Ct(t,e),n=e,r=Nt,i=ft;for(;s!==Nt;){const a=n/s,c=n%s,l=r-i*a;n=s,s=c,r=i,i=l}if(n!==ft)throw new Error("invert: does not exist");return Ct(r,e)}function mf(t,e){const s=(t.ORDER+ft)/ff,n=t.pow(e,s);if(!t.eql(t.sqr(n),e))throw new Error("Cannot find square root");return n}function A0(t,e){const s=(t.ORDER-pf)/gf,n=t.mul(e,Un),r=t.pow(n,s),i=t.mul(e,r),o=t.mul(t.mul(i,Un),r),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function I0(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-ft,s=0;for(;e%Un===Nt;)e/=Un,s++;let n=Un;const r=dl(t);for(;gd(r,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(s===1)return mf;let i=r.pow(n,e);const o=(e+ft)/Un;return function(c,l){if(c.is0(l))return l;if(gd(c,l)!==1)throw new Error("Cannot find square root");let d=s,u=c.mul(c.ONE,i),h=c.pow(l,e),f=c.pow(l,o);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let g=1,p=c.sqr(h);for(;!c.eql(p,c.ONE);)if(g++,p=c.sqr(p),g===d)throw new Error("Cannot find square root");const w=ft<<BigInt(d-g-1),b=c.pow(u,w);d=g,u=c.sqr(b),h=c.mul(h,u),f=c.mul(f,b)}return f}}function N0(t){return t%ff===C0?mf:t%gf===pf?A0:I0(t)}const S0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function _0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},s=S0.reduce((n,r)=>(n[r]="function",n),e);return qo(t,s)}function T0(t,e,s){if(s<Nt)throw new Error("invalid exponent, negatives unsupported");if(s===Nt)return t.ONE;if(s===ft)return e;let n=t.ONE,r=e;for(;s>Nt;)s&ft&&(n=t.mul(n,r)),r=t.sqr(r),s>>=ft;return n}function wf(t,e,s=!1){const n=new Array(e.length).fill(s?t.ZERO:void 0),r=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(r);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function gd(t,e){const s=(t.ORDER-ft)/Un,n=t.pow(e,s),r=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!r&&!i&&!o)throw new Error("invalid Legendre symbol result");return r?1:i?0:-1}function yf(t,e){e!==void 0&&fi(e);const s=e!==void 0?e:t.toString(2).length,n=Math.ceil(s/8);return{nBitLength:s,nByteLength:n}}function dl(t,e,s=!1,n={}){if(t<=Nt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:r,nByteLength:i}=yf(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:s,BITS:r,BYTES:i,MASK:jo(r),ZERO:Nt,ONE:ft,create:c=>Ct(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Nt<=c&&c<t},is0:c=>c===Nt,isOdd:c=>(c&ft)===ft,neg:c=>Ct(-c,t),eql:(c,l)=>c===l,sqr:c=>Ct(c*c,t),add:(c,l)=>Ct(c+l,t),sub:(c,l)=>Ct(c-l,t),mul:(c,l)=>Ct(c*l,t),pow:(c,l)=>T0(a,c,l),div:(c,l)=>Ct(c*lc(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>lc(c,t),sqrt:n.sqrt||(c=>(o||(o=N0(t)),o(a,c))),toBytes:c=>s?ef(c,i):Si(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return s?Qh(c):jn(c)},invertBatch:c=>wf(a,c),cmov:(c,l,d)=>d?l:c});return Object.freeze(a)}function bf(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Ef(t){const e=bf(t);return e+Math.ceil(e/2)}function x0(t,e,s=!1){const n=t.length,r=bf(e),i=Ef(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=s?Qh(t):jn(t),a=Ct(o,e-ft)+ft;return s?ef(a,r):Si(a,r)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const md=BigInt(0),dc=BigInt(1);function ga(t,e){const s=e.negate();return t?s:e}function vf(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ma(t,e){vf(t,e);const s=Math.ceil(e/t)+1,n=2**(t-1),r=2**t,i=jo(t),o=BigInt(t);return{windows:s,windowSize:n,mask:i,maxNumber:r,shiftBy:o}}function wd(t,e,s){const{windowSize:n,mask:r,maxNumber:i,shiftBy:o}=s;let a=Number(t&r),c=t>>o;a>n&&(a-=i,c+=dc);const l=e*n,d=l+Math.abs(a)-1,u=a===0,h=a<0,f=e%2!==0;return{nextN:c,offset:d,isZero:u,isNeg:h,isNegF:f,offsetF:l}}function O0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((s,n)=>{if(!(s instanceof e))throw new Error("invalid point at index "+n)})}function P0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((s,n)=>{if(!e.isValid(s))throw new Error("invalid scalar at index "+n)})}const wa=new WeakMap,Cf=new WeakMap;function ya(t){return Cf.get(t)||1}function k0(t,e){return{constTimeNegate:ga,hasPrecomputes(s){return ya(s)!==1},unsafeLadder(s,n,r=t.ZERO){let i=s;for(;n>md;)n&dc&&(r=r.add(i)),i=i.double(),n>>=dc;return r},precomputeWindow(s,n){const{windows:r,windowSize:i}=ma(n,e),o=[];let a=s,c=a;for(let l=0;l<r;l++){c=a,o.push(c);for(let d=1;d<i;d++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(s,n,r){let i=t.ZERO,o=t.BASE;const a=ma(s,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:d,isZero:u,isNeg:h,isNegF:f,offsetF:g}=wd(r,c,a);r=l,u?o=o.add(ga(f,n[g])):i=i.add(ga(h,n[d]))}return{p:i,f:o}},wNAFUnsafe(s,n,r,i=t.ZERO){const o=ma(s,e);for(let a=0;a<o.windows&&r!==md;a++){const{nextN:c,offset:l,isZero:d,isNeg:u}=wd(r,a,o);if(r=c,!d){const h=n[l];i=i.add(u?h.negate():h)}}return i},getPrecomputes(s,n,r){let i=wa.get(n);return i||(i=this.precomputeWindow(n,s),s!==1&&wa.set(n,r(i))),i},wNAFCached(s,n,r){const i=ya(s);return this.wNAF(i,this.getPrecomputes(i,s,r),n)},wNAFCachedUnsafe(s,n,r,i){const o=ya(s);return o===1?this.unsafeLadder(s,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,s,r),n,i)},setWindowSize(s,n){vf(n,e),Cf.set(s,n),wa.delete(s)}}}function R0(t,e,s,n){O0(s,t),P0(n,e);const r=s.length,i=n.length;if(r!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Dy(BigInt(r));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=jo(c),d=new Array(Number(l)+1).fill(o),u=Math.floor((e.BITS-1)/c)*c;let h=o;for(let f=u;f>=0;f-=c){d.fill(o);for(let p=0;p<i;p++){const w=n[p],b=Number(w>>BigInt(f)&l);d[b]=d[b].add(s[p])}let g=o;for(let p=d.length-1,w=o;p>0;p--)w=w.add(d[p]),g=g.add(w);if(h=h.add(g),f!==0)for(let p=0;p<c;p++)h=h.double()}return h}function Af(t){return _0(t.Fp),qo(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...yf(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function yd(t){t.lowS!==void 0&&pi("lowS",t.lowS),t.prehash!==void 0&&pi("prehash",t.prehash)}function U0(t){const e=Af(t);qo(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:s,Fp:n,a:r}=e;if(s){if(!n.eql(r,n.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof s!="object"||typeof s.beta!="bigint"||typeof s.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class $0 extends Error{constructor(e=""){super(e)}}const Ls={Err:$0,_tlv:{encode:(t,e)=>{const{Err:s}=Ls;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length&1)throw new s("tlv.encode: unpadded data");const n=e.length/2,r=qi(n);if(r.length/2&128)throw new s("tlv.encode: long form length too big");const i=n>127?qi(r.length/2|128):"";return qi(t)+i+r+e},decode(t,e){const{Err:s}=Ls;let n=0;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new s("tlv.decode: wrong tlv");const r=e[n++],i=!!(r&128);let o=0;if(!i)o=r;else{const c=r&127;if(!c)throw new s("tlv.decode(long): indefinite length not supported");if(c>4)throw new s("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new s("tlv.decode: length bytes not complete");if(l[0]===0)throw new s("tlv.decode(long): zero leftmost byte");for(const d of l)o=o<<8|d;if(n+=c,o<128)throw new s("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new s("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Ls;if(t<qs)throw new e("integer: negative integers are not allowed");let s=qi(t);if(Number.parseInt(s[0],16)&8&&(s="00"+s),s.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return s},decode(t){const{Err:e}=Ls;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return jn(t)}},toSig(t){const{Err:e,_int:s,_tlv:n}=Ls,r=Gt("signature",t),{v:i,l:o}=n.decode(48,r);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:d}=n.decode(2,c);if(d.length)throw new e("invalid signature: left bytes after parsing");return{r:s.decode(a),s:s.decode(l)}},hexFromSig(t){const{_tlv:e,_int:s}=Ls,n=e.encode(2,s.encode(t.r)),r=e.encode(2,s.encode(t.s)),i=n+r;return e.encode(48,i)}};function ba(t,e){return gi(Si(t,e))}const qs=BigInt(0),Ke=BigInt(1);BigInt(2);const Ea=BigInt(3),D0=BigInt(4);function B0(t){const e=U0(t),{Fp:s}=e,n=dl(e.n,e.nBitLength),r=e.toBytes||((v,E,_)=>{const R=E.toAffine();return Io(Uint8Array.from([4]),s.toBytes(R.x),s.toBytes(R.y))}),i=e.fromBytes||(v=>{const E=v.subarray(1),_=s.fromBytes(E.subarray(0,s.BYTES)),R=s.fromBytes(E.subarray(s.BYTES,2*s.BYTES));return{x:_,y:R}});function o(v){const{a:E,b:_}=e,R=s.sqr(v),D=s.mul(R,v);return s.add(s.add(D,s.mul(v,E)),_)}function a(v,E){const _=s.sqr(E),R=o(v);return s.eql(_,R)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=s.mul(s.pow(e.a,Ea),D0),l=s.mul(s.sqr(e.b),BigInt(27));if(s.is0(s.add(c,l)))throw new Error("bad curve params: a or b");function d(v){return al(v,Ke,e.n)}function u(v){const{allowedPrivateKeyLengths:E,nByteLength:_,wrapPrivateKey:R,n:D}=e;if(E&&typeof v!="bigint"){if(Ni(v)&&(v=gi(v)),typeof v!="string"||!E.includes(v.length))throw new Error("invalid private key");v=v.padStart(_*2,"0")}let M;try{M=typeof v=="bigint"?v:jn(Gt("private key",v,_))}catch{throw new Error("invalid private key, expected hex or "+_+" bytes, got "+typeof v)}return R&&(M=Ct(M,D)),yr("private key",M,Ke,D),M}function h(v){if(!(v instanceof p))throw new Error("ProjectivePoint expected")}const f=cd((v,E)=>{const{px:_,py:R,pz:D}=v;if(s.eql(D,s.ONE))return{x:_,y:R};const M=v.is0();E==null&&(E=M?s.ONE:s.inv(D));const P=s.mul(_,E),F=s.mul(R,E),W=s.mul(D,E);if(M)return{x:s.ZERO,y:s.ZERO};if(!s.eql(W,s.ONE))throw new Error("invZ was invalid");return{x:P,y:F}}),g=cd(v=>{if(v.is0()){if(e.allowInfinityPoint&&!s.is0(v.py))return;throw new Error("bad point: ZERO")}const{x:E,y:_}=v.toAffine();if(!s.isValid(E)||!s.isValid(_))throw new Error("bad point: x or y not FE");if(!a(E,_))throw new Error("bad point: equation left != right");if(!v.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(E,_,R){if(E==null||!s.isValid(E))throw new Error("x required");if(_==null||!s.isValid(_)||s.is0(_))throw new Error("y required");if(R==null||!s.isValid(R))throw new Error("z required");this.px=E,this.py=_,this.pz=R,Object.freeze(this)}static fromAffine(E){const{x:_,y:R}=E||{};if(!E||!s.isValid(_)||!s.isValid(R))throw new Error("invalid affine point");if(E instanceof p)throw new Error("projective point not allowed");const D=M=>s.eql(M,s.ZERO);return D(_)&&D(R)?p.ZERO:new p(_,R,s.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(E){const _=wf(s,E.map(R=>R.pz));return E.map((R,D)=>R.toAffine(_[D])).map(p.fromAffine)}static fromHex(E){const _=p.fromAffine(i(Gt("pointHex",E)));return _.assertValidity(),_}static fromPrivateKey(E){return p.BASE.multiply(u(E))}static msm(E,_){return R0(p,n,E,_)}_setWindowSize(E){I.setWindowSize(this,E)}assertValidity(){g(this)}hasEvenY(){const{y:E}=this.toAffine();if(s.isOdd)return!s.isOdd(E);throw new Error("Field doesn't support isOdd")}equals(E){h(E);const{px:_,py:R,pz:D}=this,{px:M,py:P,pz:F}=E,W=s.eql(s.mul(_,F),s.mul(M,D)),O=s.eql(s.mul(R,F),s.mul(P,D));return W&&O}negate(){return new p(this.px,s.neg(this.py),this.pz)}double(){const{a:E,b:_}=e,R=s.mul(_,Ea),{px:D,py:M,pz:P}=this;let F=s.ZERO,W=s.ZERO,O=s.ZERO,A=s.mul(D,D),S=s.mul(M,M),y=s.mul(P,P),C=s.mul(D,M);return C=s.add(C,C),O=s.mul(D,P),O=s.add(O,O),F=s.mul(E,O),W=s.mul(R,y),W=s.add(F,W),F=s.sub(S,W),W=s.add(S,W),W=s.mul(F,W),F=s.mul(C,F),O=s.mul(R,O),y=s.mul(E,y),C=s.sub(A,y),C=s.mul(E,C),C=s.add(C,O),O=s.add(A,A),A=s.add(O,A),A=s.add(A,y),A=s.mul(A,C),W=s.add(W,A),y=s.mul(M,P),y=s.add(y,y),A=s.mul(y,C),F=s.sub(F,A),O=s.mul(y,S),O=s.add(O,O),O=s.add(O,O),new p(F,W,O)}add(E){h(E);const{px:_,py:R,pz:D}=this,{px:M,py:P,pz:F}=E;let W=s.ZERO,O=s.ZERO,A=s.ZERO;const S=e.a,y=s.mul(e.b,Ea);let C=s.mul(_,M),T=s.mul(R,P),$=s.mul(D,F),N=s.add(_,R),x=s.add(M,P);N=s.mul(N,x),x=s.add(C,T),N=s.sub(N,x),x=s.add(_,D);let q=s.add(M,F);return x=s.mul(x,q),q=s.add(C,$),x=s.sub(x,q),q=s.add(R,D),W=s.add(P,F),q=s.mul(q,W),W=s.add(T,$),q=s.sub(q,W),A=s.mul(S,x),W=s.mul(y,$),A=s.add(W,A),W=s.sub(T,A),A=s.add(T,A),O=s.mul(W,A),T=s.add(C,C),T=s.add(T,C),$=s.mul(S,$),x=s.mul(y,x),T=s.add(T,$),$=s.sub(C,$),$=s.mul(S,$),x=s.add(x,$),C=s.mul(T,x),O=s.add(O,C),C=s.mul(q,x),W=s.mul(N,W),W=s.sub(W,C),C=s.mul(N,T),A=s.mul(q,A),A=s.add(A,C),new p(W,O,A)}subtract(E){return this.add(E.negate())}is0(){return this.equals(p.ZERO)}wNAF(E){return I.wNAFCached(this,E,p.normalizeZ)}multiplyUnsafe(E){const{endo:_,n:R}=e;yr("scalar",E,qs,R);const D=p.ZERO;if(E===qs)return D;if(this.is0()||E===Ke)return this;if(!_||I.hasPrecomputes(this))return I.wNAFCachedUnsafe(this,E,p.normalizeZ);let{k1neg:M,k1:P,k2neg:F,k2:W}=_.splitScalar(E),O=D,A=D,S=this;for(;P>qs||W>qs;)P&Ke&&(O=O.add(S)),W&Ke&&(A=A.add(S)),S=S.double(),P>>=Ke,W>>=Ke;return M&&(O=O.negate()),F&&(A=A.negate()),A=new p(s.mul(A.px,_.beta),A.py,A.pz),O.add(A)}multiply(E){const{endo:_,n:R}=e;yr("scalar",E,Ke,R);let D,M;if(_){const{k1neg:P,k1:F,k2neg:W,k2:O}=_.splitScalar(E);let{p:A,f:S}=this.wNAF(F),{p:y,f:C}=this.wNAF(O);A=I.constTimeNegate(P,A),y=I.constTimeNegate(W,y),y=new p(s.mul(y.px,_.beta),y.py,y.pz),D=A.add(y),M=S.add(C)}else{const{p:P,f:F}=this.wNAF(E);D=P,M=F}return p.normalizeZ([D,M])[0]}multiplyAndAddUnsafe(E,_,R){const D=p.BASE,M=(F,W)=>W===qs||W===Ke||!F.equals(D)?F.multiplyUnsafe(W):F.multiply(W),P=M(this,_).add(M(E,R));return P.is0()?void 0:P}toAffine(E){return f(this,E)}isTorsionFree(){const{h:E,isTorsionFree:_}=e;if(E===Ke)return!0;if(_)return _(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:E,clearCofactor:_}=e;return E===Ke?this:_?_(p,this):this.multiplyUnsafe(e.h)}toRawBytes(E=!0){return pi("isCompressed",E),this.assertValidity(),r(p,this,E)}toHex(E=!0){return pi("isCompressed",E),gi(this.toRawBytes(E))}}p.BASE=new p(e.Gx,e.Gy,s.ONE),p.ZERO=new p(s.ZERO,s.ONE,s.ZERO);const{endo:w,nBitLength:b}=e,I=k0(p,w?Math.ceil(b/2):b);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:u,weierstrassEquation:o,isWithinCurveOrder:d}}function L0(t){const e=Af(t);return qo(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function M0(t){const e=L0(t),{Fp:s,n,nByteLength:r,nBitLength:i}=e,o=s.BYTES+1,a=2*s.BYTES+1;function c(y){return Ct(y,n)}function l(y){return lc(y,n)}const{ProjectivePoint:d,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:f}=B0({...e,toBytes(y,C,T){const $=C.toAffine(),N=s.toBytes($.x),x=Io;return pi("isCompressed",T),T?x(Uint8Array.from([C.hasEvenY()?2:3]),N):x(Uint8Array.from([4]),N,s.toBytes($.y))},fromBytes(y){const C=y.length,T=y[0],$=y.subarray(1);if(C===o&&(T===2||T===3)){const N=jn($);if(!al(N,Ke,s.ORDER))throw new Error("Point is not on curve");const x=h(N);let q;try{q=s.sqrt(x)}catch(ne){const Q=ne instanceof Error?": "+ne.message:"";throw new Error("Point is not on curve"+Q)}const z=(q&Ke)===Ke;return(T&1)===1!==z&&(q=s.neg(q)),{x:N,y:q}}else if(C===a&&T===4){const N=s.fromBytes($.subarray(0,s.BYTES)),x=s.fromBytes($.subarray(s.BYTES,2*s.BYTES));return{x:N,y:x}}else{const N=o,x=a;throw new Error("invalid Point, expected length of "+N+", or uncompressed "+x+", got "+C)}}});function g(y){const C=n>>Ke;return y>C}function p(y){return g(y)?c(-y):y}const w=(y,C,T)=>jn(y.slice(C,T));class b{constructor(C,T,$){yr("r",C,Ke,n),yr("s",T,Ke,n),this.r=C,this.s=T,$!=null&&(this.recovery=$),Object.freeze(this)}static fromCompact(C){const T=r;return C=Gt("compactSignature",C,T*2),new b(w(C,0,T),w(C,T,2*T))}static fromDER(C){const{r:T,s:$}=Ls.toSig(Gt("DER",C));return new b(T,$)}assertValidity(){}addRecoveryBit(C){return new b(this.r,this.s,C)}recoverPublicKey(C){const{r:T,s:$,recovery:N}=this,x=D(Gt("msgHash",C));if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");const q=N===2||N===3?T+e.n:T;if(q>=s.ORDER)throw new Error("recovery id 2 or 3 invalid");const z=N&1?"03":"02",ae=d.fromHex(z+ba(q,s.BYTES)),ne=l(q),Q=c(-x*ne),le=c($*ne),ie=d.BASE.multiplyAndAddUnsafe(ae,Q,le);if(!ie)throw new Error("point at infinify");return ie.assertValidity(),ie}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new b(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Ao(this.toDERHex())}toDERHex(){return Ls.hexFromSig(this)}toCompactRawBytes(){return Ao(this.toCompactHex())}toCompactHex(){const C=r;return ba(this.r,C)+ba(this.s,C)}}const I={isValidPrivateKey(y){try{return u(y),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const y=Ef(e.n);return x0(e.randomBytes(y),e.n)},precompute(y=8,C=d.BASE){return C._setWindowSize(y),C.multiply(BigInt(3)),C}};function v(y,C=!0){return d.fromPrivateKey(y).toRawBytes(C)}function E(y){if(typeof y=="bigint")return!1;if(y instanceof d)return!0;const T=Gt("key",y).length,$=s.BYTES,N=$+1,x=2*$+1;if(!(e.allowedPrivateKeyLengths||r===N))return T===N||T===x}function _(y,C,T=!0){if(E(y)===!0)throw new Error("first arg must be private key");if(E(C)===!1)throw new Error("second arg must be public key");return d.fromHex(C).multiply(u(y)).toRawBytes(T)}const R=e.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");const C=jn(y),T=y.length*8-i;return T>0?C>>BigInt(T):C},D=e.bits2int_modN||function(y){return c(R(y))},M=jo(i);function P(y){return yr("num < 2^"+i,y,qs,M),Si(y,r)}function F(y,C,T=W){if(["recovered","canonical"].some(ce=>ce in T))throw new Error("sign() legacy options not supported");const{hash:$,randomBytes:N}=e;let{lowS:x,prehash:q,extraEntropy:z}=T;x==null&&(x=!0),y=Gt("msgHash",y),yd(T),q&&(y=Gt("prehashed msgHash",$(y)));const ae=D(y),ne=u(C),Q=[P(ne),P(ae)];if(z!=null&&z!==!1){const ce=z===!0?N(s.BYTES):z;Q.push(Gt("extraEntropy",ce))}const le=Io(...Q),ie=ae;function Ie(ce){const _e=R(ce);if(!f(_e))return;const ct=l(_e),mt=d.BASE.multiply(_e).toAffine(),lt=c(mt.x);if(lt===qs)return;const Ft=c(ct*c(ie+lt*ne));if(Ft===qs)return;let vn=(mt.x===lt?0:2)|Number(mt.y&Ke),tr=Ft;return x&&g(Ft)&&(tr=p(Ft),vn^=1),new b(lt,tr,vn)}return{seed:le,k2sig:Ie}}const W={lowS:e.lowS,prehash:!1},O={lowS:e.lowS,prehash:!1};function A(y,C,T=W){const{seed:$,k2sig:N}=F(y,C,T),x=e;return By(x.hash.outputLen,x.nByteLength,x.hmac)($,N)}d.BASE._setWindowSize(8);function S(y,C,T,$=O){var vn;const N=y;C=Gt("msgHash",C),T=Gt("publicKey",T);const{lowS:x,prehash:q,format:z}=$;if(yd($),"strict"in $)throw new Error("options.strict was renamed to lowS");if(z!==void 0&&z!=="compact"&&z!=="der")throw new Error("format must be compact or der");const ae=typeof N=="string"||Ni(N),ne=!ae&&!z&&typeof N=="object"&&N!==null&&typeof N.r=="bigint"&&typeof N.s=="bigint";if(!ae&&!ne)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let Q,le;try{if(ne&&(Q=new b(N.r,N.s)),ae){try{z!=="compact"&&(Q=b.fromDER(N))}catch(tr){if(!(tr instanceof Ls.Err))throw tr}!Q&&z!=="der"&&(Q=b.fromCompact(N))}le=d.fromHex(T)}catch{return!1}if(!Q||x&&Q.hasHighS())return!1;q&&(C=e.hash(C));const{r:ie,s:Ie}=Q,ce=D(C),_e=l(Ie),ct=c(ce*_e),mt=c(ie*_e),lt=(vn=d.BASE.multiplyAndAddUnsafe(le,ct,mt))==null?void 0:vn.toAffine();return lt?c(lt.x)===ie:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:_,sign:A,verify:S,ProjectivePoint:d,Signature:b,utils:I}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function F0(t){return{hash:t,hmac:(e,...s)=>hf(t,e,dy(...s)),randomBytes:uy}}function j0(t,e){const s=n=>M0({...t,...F0(n)});return{...s(e),create:s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const If=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),bd=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),q0=BigInt(0),W0=BigInt(1),uc=BigInt(2),Ed=(t,e)=>(t+e/uc)/e;function H0(t){const e=If,s=BigInt(3),n=BigInt(6),r=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,d=l*l*t%e,u=qt(d,s,e)*d%e,h=qt(u,s,e)*d%e,f=qt(h,uc,e)*l%e,g=qt(f,r,e)*f%e,p=qt(g,i,e)*g%e,w=qt(p,a,e)*p%e,b=qt(w,c,e)*w%e,I=qt(b,a,e)*p%e,v=qt(I,s,e)*d%e,E=qt(v,o,e)*g%e,_=qt(E,n,e)*l%e,R=qt(_,uc,e);if(!hc.eql(hc.sqr(R),t))throw new Error("Cannot find square root");return R}const hc=dl(If,void 0,void 0,{sqrt:H0}),z0=j0({a:q0,b:BigInt(7),Fp:hc,n:bd,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=bd,s=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-W0*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),r=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=s,o=BigInt("0x100000000000000000000000000000000"),a=Ed(i*t,e),c=Ed(-n*t,e);let l=Ct(t-a*s-c*r,e),d=Ct(-a*n-c*i,e);const u=l>o,h=d>o;if(u&&(l=e-l),h&&(d=e-d),l>o||d>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:l,k2neg:h,k2:d}}}},Uy);function K0(t){if(t.length!==130&&t.length!==132)throw new G0({signature:t});const e=BigInt(Ds(t,0,32)),s=BigInt(Ds(t,32,64)),n=(()=>{const r=+`0x${t.slice(130)}`;if(!Number.isNaN(r))try{return V0(r)}catch{throw new Y0({value:r})}})();return typeof n>"u"?{r:e,s}:{r:e,s,yParity:n}}function V0(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new J0({value:t})}class G0 extends $e{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${wn(ll(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class Y0 extends $e{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class J0 extends $e{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function X0(t){return b0(Z0(t))}function Z0(t){const{payload:e,signature:s}=t,{r:n,s:r,yParity:i}=s,a=new z0.Signature(BigInt(n),BigInt(r)).addRecoveryBit(i).recoverPublicKey(ll(e).substring(2));return d0(a)}function Q0(t){const e=t.length;let s=0,n=0;for(;n<e;){let r=t.charCodeAt(n++);if(r&4294967168)if(!(r&4294965248))s+=2;else{if(r>=55296&&r<=56319&&n<e){const i=t.charCodeAt(n);(i&64512)===56320&&(++n,r=((r&1023)<<10)+(i&1023)+65536)}r&4294901760?s+=4:s+=3}else{s++;continue}}return s}function eb(t,e,s){const n=t.length;let r=s,i=0;for(;i<n;){let o=t.charCodeAt(i++);if(o&4294967168)if(!(o&4294965248))e[r++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&i<n){const a=t.charCodeAt(i);(a&64512)===56320&&(++i,o=((o&1023)<<10)+(a&1023)+65536)}o&4294901760?(e[r++]=o>>18&7|240,e[r++]=o>>12&63|128,e[r++]=o>>6&63|128):(e[r++]=o>>12&15|224,e[r++]=o>>6&63|128)}else{e[r++]=o;continue}e[r++]=o&63|128}}const tb=new TextEncoder,sb=50;function nb(t,e,s){tb.encodeInto(t,e.subarray(s))}function rb(t,e,s){t.length>sb?nb(t,e,s):eb(t,e,s)}const ib=4096;function Nf(t,e,s){let n=e;const r=n+s,i=[];let o="";for(;n<r;){const a=t[n++];if(!(a&128))i.push(a);else if((a&224)===192){const c=t[n++]&63;i.push((a&31)<<6|c)}else if((a&240)===224){const c=t[n++]&63,l=t[n++]&63;i.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[n++]&63,l=t[n++]&63,d=t[n++]&63;let u=(a&7)<<18|c<<12|l<<6|d;u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|u&1023),i.push(u)}else i.push(a);i.length>=ib&&(o+=String.fromCharCode(...i),i.length=0)}return i.length>0&&(o+=String.fromCharCode(...i)),o}const ob=new TextDecoder,ab=200;function cb(t,e,s){const n=t.subarray(e,e+s);return ob.decode(n)}function lb(t,e,s){return s>ab?cb(t,e,s):Nf(t,e,s)}class Hi{constructor(e,s){this.type=e,this.data=s}}class Ut extends Error{constructor(e){super(e);const s=Object.create(Ut.prototype);Object.setPrototypeOf(this,s),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:Ut.name})}}const Mr=4294967295;function db(t,e,s){const n=s/4294967296,r=s;t.setUint32(e,n),t.setUint32(e+4,r)}function Sf(t,e,s){const n=Math.floor(s/4294967296),r=s;t.setUint32(e,n),t.setUint32(e+4,r)}function _f(t,e){const s=t.getInt32(e),n=t.getUint32(e+4);return s*4294967296+n}function ub(t,e){const s=t.getUint32(e),n=t.getUint32(e+4);return s*4294967296+n}const hb=-1,fb=4294967296-1,pb=17179869184-1;function gb({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=pb)if(e===0&&t<=fb){const s=new Uint8Array(4);return new DataView(s.buffer).setUint32(0,t),s}else{const s=t/4294967296,n=t&4294967295,r=new Uint8Array(8),i=new DataView(r.buffer);return i.setUint32(0,e<<2|s&3),i.setUint32(4,n),r}else{const s=new Uint8Array(12),n=new DataView(s.buffer);return n.setUint32(0,e),Sf(n,4,t),s}}function mb(t){const e=t.getTime(),s=Math.floor(e/1e3),n=(e-s*1e3)*1e6,r=Math.floor(n/1e9);return{sec:s+r,nsec:n-r*1e9}}function wb(t){if(t instanceof Date){const e=mb(t);return gb(e)}else return null}function yb(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const s=e.getUint32(0),n=e.getUint32(4),r=(s&3)*4294967296+n,i=s>>>2;return{sec:r,nsec:i}}case 12:{const s=_f(e,4),n=e.getUint32(0);return{sec:s,nsec:n}}default:throw new Ut(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function bb(t){const e=yb(t);return new Date(e.sec*1e3+e.nsec/1e6)}const Eb={type:hb,encode:wb,decode:bb};class So{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Eb)}register({type:e,encode:s,decode:n}){if(e>=0)this.encoders[e]=s,this.decoders[e]=n;else{const r=-1-e;this.builtInEncoders[r]=s,this.builtInDecoders[r]=n}}tryToEncode(e,s){for(let n=0;n<this.builtInEncoders.length;n++){const r=this.builtInEncoders[n];if(r!=null){const i=r(e,s);if(i!=null){const o=-1-n;return new Hi(o,i)}}}for(let n=0;n<this.encoders.length;n++){const r=this.encoders[n];if(r!=null){const i=r(e,s);if(i!=null){const o=n;return new Hi(o,i)}}}return e instanceof Hi?e:null}decode(e,s,n){const r=s<0?this.builtInDecoders[-1-s]:this.decoders[s];return r?r(e,s,n):new Hi(s,e)}}So.defaultCodec=new So;function vb(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function fc(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):vb(t)?new Uint8Array(t):Uint8Array.from(t)}const Cb=100,Ab=2048;class ul{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??So.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??Cb,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??Ab,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new ul({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,s){if(s>this.maxDepth)throw new Error(`Too deep objects in depth ${s}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,s)}ensureBufferSizeToWrite(e){const s=this.pos+e;this.view.byteLength<s&&this.resizeBuffer(s*2)}resizeBuffer(e){const s=new ArrayBuffer(e),n=new Uint8Array(s),r=new DataView(s);n.set(this.bytes),this.view=r,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const n=Q0(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),rb(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,s){const n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,s);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,s);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const s=e.byteLength;if(s<256)this.writeU8(196),this.writeU8(s);else if(s<65536)this.writeU8(197),this.writeU16(s);else if(s<4294967296)this.writeU8(198),this.writeU32(s);else throw new Error(`Too large binary: ${s}`);const n=fc(e);this.writeU8a(n)}encodeArray(e,s){const n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const r of e)this.doEncode(r,s+1)}countWithoutUndefined(e,s){let n=0;for(const r of s)e[r]!==void 0&&n++;return n}encodeMap(e,s){const n=Object.keys(e);this.sortKeys&&n.sort();const r=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else if(r<4294967296)this.writeU8(223),this.writeU32(r);else throw new Error(`Too large map object: ${r}`);for(const i of n){const o=e[i];this.ignoreUndefined&&o===void 0||(this.encodeString(i),this.doEncode(o,s+1))}}encodeExtension(e){if(typeof e.data=="function"){const n=e.data(this.pos+6),r=n.length;if(r>=4294967296)throw new Error(`Too large extension object: ${r}`);this.writeU8(201),this.writeU32(r),this.writeI8(e.type),this.writeU8a(n);return}const s=e.data.length;if(s===1)this.writeU8(212);else if(s===2)this.writeU8(213);else if(s===4)this.writeU8(214);else if(s===8)this.writeU8(215);else if(s===16)this.writeU8(216);else if(s<256)this.writeU8(199),this.writeU8(s);else if(s<65536)this.writeU8(200),this.writeU16(s);else if(s<4294967296)this.writeU8(201),this.writeU32(s);else throw new Error(`Too large extension object: ${s}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const s=e.length;this.ensureBufferSizeToWrite(s),this.bytes.set(e,this.pos),this.pos+=s}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),db(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Sf(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function Ib(t,e){return new ul(e).encodeSharedRef(t)}function va(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Nb=16,Sb=16;class _b{constructor(e=Nb,s=Sb){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=s,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,s,n){const r=this.caches[n-1];e:for(const i of r){const o=i.bytes;for(let a=0;a<n;a++)if(o[a]!==e[s+a])continue e;return i.str}return null}store(e,s){const n=this.caches[e.length-1],r={bytes:e,str:s};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)}decode(e,s,n){const r=this.find(e,s,n);if(r!=null)return this.hit++,r;this.miss++;const i=Nf(e,s,n),o=Uint8Array.prototype.slice.call(e,s,s+n);return this.store(o,i),i}}const pc="array",ni="map_key",Tf="map_value",Tb=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new Ut("The type of key must be string or number but "+typeof t)};class xb{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const s=this.getUninitializedStateFromPool();s.type=pc,s.position=0,s.size=e,s.array=new Array(e)}pushMapState(e){const s=this.getUninitializedStateFromPool();s.type=ni,s.readCount=0,s.size=e,s.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===pc){const n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===ni||e.type===Tf){const n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Fr=-1,hl=new DataView(new ArrayBuffer(0)),Ob=new Uint8Array(hl.buffer);try{hl.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const vd=new RangeError("Insufficient data"),Pb=new _b;class fl{constructor(e){this.totalPos=0,this.pos=0,this.view=hl,this.bytes=Ob,this.headByte=Fr,this.stack=new xb,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??So.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??Mr,this.maxBinLength=(e==null?void 0:e.maxBinLength)??Mr,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??Mr,this.maxMapLength=(e==null?void 0:e.maxMapLength)??Mr,this.maxExtLength=(e==null?void 0:e.maxExtLength)??Mr,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:Pb,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??Tb}clone(){return new fl({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Fr,this.stack.reset()}setBuffer(e){const s=fc(e);this.bytes=s,this.view=new DataView(s.buffer,s.byteOffset,s.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Fr&&!this.hasRemaining(1))this.setBuffer(e);else{const s=this.bytes.subarray(this.pos),n=fc(e),r=new Uint8Array(s.length+n.length);r.set(s),r.set(n,s.length),this.setBuffer(r)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:s,pos:n}=this;return new RangeError(`Extra ${s.byteLength-n} of ${s.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const s=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return s}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let s=!1,n;for await(const a of e){if(s)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),s=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(s){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:r,pos:i,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${va(r)} at ${o} (${i} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,s){if(this.entered){yield*this.clone().decodeMultiAsync(e,s);return}try{this.entered=!0;let n=s,r=-1;for await(const i of e){if(s&&r===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(i),n&&(r=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--r!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let s;if(e>=224)s=e-256;else if(e<192)if(e<128)s=e;else if(e<144){const r=e-128;if(r!==0){this.pushMapState(r),this.complete();continue e}else s={}}else if(e<160){const r=e-144;if(r!==0){this.pushArrayState(r),this.complete();continue e}else s=[]}else{const r=e-160;s=this.decodeString(r,0)}else if(e===192)s=null;else if(e===194)s=!1;else if(e===195)s=!0;else if(e===202)s=this.readF32();else if(e===203)s=this.readF64();else if(e===204)s=this.readU8();else if(e===205)s=this.readU16();else if(e===206)s=this.readU32();else if(e===207)this.useBigInt64?s=this.readU64AsBigInt():s=this.readU64();else if(e===208)s=this.readI8();else if(e===209)s=this.readI16();else if(e===210)s=this.readI32();else if(e===211)this.useBigInt64?s=this.readI64AsBigInt():s=this.readI64();else if(e===217){const r=this.lookU8();s=this.decodeString(r,1)}else if(e===218){const r=this.lookU16();s=this.decodeString(r,2)}else if(e===219){const r=this.lookU32();s=this.decodeString(r,4)}else if(e===220){const r=this.readU16();if(r!==0){this.pushArrayState(r),this.complete();continue e}else s=[]}else if(e===221){const r=this.readU32();if(r!==0){this.pushArrayState(r),this.complete();continue e}else s=[]}else if(e===222){const r=this.readU16();if(r!==0){this.pushMapState(r),this.complete();continue e}else s={}}else if(e===223){const r=this.readU32();if(r!==0){this.pushMapState(r),this.complete();continue e}else s={}}else if(e===196){const r=this.lookU8();s=this.decodeBinary(r,1)}else if(e===197){const r=this.lookU16();s=this.decodeBinary(r,2)}else if(e===198){const r=this.lookU32();s=this.decodeBinary(r,4)}else if(e===212)s=this.decodeExtension(1,0);else if(e===213)s=this.decodeExtension(2,0);else if(e===214)s=this.decodeExtension(4,0);else if(e===215)s=this.decodeExtension(8,0);else if(e===216)s=this.decodeExtension(16,0);else if(e===199){const r=this.lookU8();s=this.decodeExtension(r,1)}else if(e===200){const r=this.lookU16();s=this.decodeExtension(r,2)}else if(e===201){const r=this.lookU32();s=this.decodeExtension(r,4)}else throw new Ut(`Unrecognized type byte: ${va(e)}`);this.complete();const n=this.stack;for(;n.length>0;){const r=n.top();if(r.type===pc)if(r.array[r.position]=s,r.position++,r.position===r.size)s=r.array,n.release(r);else continue e;else if(r.type===ni){if(s==="__proto__")throw new Ut("The key __proto__ is not allowed");r.key=this.mapKeyConverter(s),r.type=Tf;continue e}else if(r.map[r.key]=s,r.readCount++,r.readCount===r.size)s=r.map,n.release(r);else{r.key=null,r.type=ni;continue e}}return s}}readHeadByte(){return this.headByte===Fr&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Fr}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Ut(`Unrecognized array type byte: ${va(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new Ut(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new Ut(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,s){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,s):this.decodeBinary(e,s)}decodeUtf8String(e,s){var i;if(e>this.maxStrLength)throw new Ut(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+s+e)throw vd;const n=this.pos+s;let r;return this.stateIsMapKey()&&((i=this.keyDecoder)!=null&&i.canBeCached(e))?r=this.keyDecoder.decode(this.bytes,n,e):r=lb(this.bytes,n,e),this.pos+=s+e,r}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===ni:!1}decodeBinary(e,s){if(e>this.maxBinLength)throw new Ut(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+s))throw vd;const n=this.pos+s,r=this.bytes.subarray(n,n+e);return this.pos+=s+e,r}decodeExtension(e,s){if(e>this.maxExtLength)throw new Ut(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+s),r=this.decodeBinary(e,s+1);return this.extensionCodec.decode(r,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=ub(this.view,this.pos);return this.pos+=8,e}readI64(){const e=_f(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function kb(t,e){return new fl(e).decode(t)}var Rb={};const Ub=":";function Hs(t){const[e,s]=t.split(Ub);return{namespace:e,reference:s}}function xf(t,e){return t.includes(":")?[t]:e.chains||[]}var $b=Object.defineProperty,Db=Object.defineProperties,Bb=Object.getOwnPropertyDescriptors,Cd=Object.getOwnPropertySymbols,Lb=Object.prototype.hasOwnProperty,Mb=Object.prototype.propertyIsEnumerable,gc=(t,e,s)=>e in t?$b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ad=(t,e)=>{for(var s in e||(e={}))Lb.call(e,s)&&gc(t,s,e[s]);if(Cd)for(var s of Cd(e))Mb.call(e,s)&&gc(t,s,e[s]);return t},Fb=(t,e)=>Db(t,Bb(e)),Id=(t,e,s)=>gc(t,typeof e!="symbol"?e+"":e,s);const jb="ReactNative",Bt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},qb="js";function _o(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function bn(){return!Ir()&&!!Sh()&&navigator.product===jb}function Wb(){return bn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Hb(){return bn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Ur(){return!_o()&&!!Sh()&&!!Ir()}function _i(){return bn()?Bt.reactNative:_o()?Bt.node:Ur()?Bt.browser:Bt.unknown}function Nd(){var t;try{return bn()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function zb(t,e){const s=new URLSearchParams(t);return Object.entries(e).sort(([n],[r])=>n.localeCompare(r)).forEach(([n,r])=>{r!=null&&s.set(n,String(r))}),s.toString()}function Kb(t){var e,s;const n=Of();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(r=>r!=="")),Fb(Ad(Ad({},n),t),{url:(t==null?void 0:t.url)||n.url,name:(t==null?void 0:t.name)||n.name,description:(t==null?void 0:t.description)||n.description,icons:(s=t==null?void 0:t.icons)!=null&&s.length&&t.icons.length>0?t.icons:n.icons})}catch(r){return console.warn("Error populating app metadata",r),t||n}}function Of(){return xg()||{name:"",description:"",url:"",icons:[""]}}function Vb(){if(_i()===Bt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:s,Version:n}=global.Platform;return[s,n].join("-")}const t=Pg();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Gb(){var t;const e=_i();return e===Bt.browser?[e,((t=kg())==null?void 0:t.host)||"unknown"].join(":"):e}function Pf(t,e,s){const n=Vb(),r=Gb();return[[t,e].join("-"),[qb,s].join("-"),n,r].join("/")}function Yb({protocol:t,version:e,relayUrl:s,sdkVersion:n,auth:r,projectId:i,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=s.split("?"),d=Pf(t,e,n),u={auth:r,ua:d,projectId:i,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},h=zb(l[1]||"",u);return l[0]+"?"+h}function $n(t,e){return t.filter(s=>e.includes(s)).length===t.length}function mc(t){return Object.fromEntries(t.entries())}function wc(t){return new Map(Object.entries(t))}function xn(t=V.FIVE_MINUTES,e){const s=V.toMiliseconds(t||V.FIVE_MINUTES);let n,r,i,o;return{resolve:a=>{i&&n&&(clearTimeout(i),n(a),o=Promise.resolve(a))},reject:a=>{i&&r&&(clearTimeout(i),r(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},s),n=a,r=c})}}function vs(t,e,s){return new Promise(async(n,r)=>{const i=setTimeout(()=>r(new Error(s)),e);try{const o=await t;n(o)}catch(o){r(o)}clearTimeout(i)})}function kf(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Jb(t){return kf("topic",t)}function Xb(t){return kf("id",t)}function Rf(t){const[e,s]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof s=="string")n.topic=s;else if(e==="id"&&Number.isInteger(Number(s)))n.id=Number(s);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${s}`);return n}function Le(t,e){return V.fromMiliseconds(Date.now()+V.toMiliseconds(t))}function bs(t){return Date.now()>=V.toMiliseconds(t)}function Ne(t,e){return`${t}${e?`:${e}`:""}`}function Is(t=[],e=[]){return[...new Set([...t,...e])]}async function Zb({id:t,topic:e,wcDeepLink:s}){var n;try{if(!s)return;const r=typeof s=="string"?JSON.parse(s):s,i=r==null?void 0:r.href;if(typeof i!="string")return;const o=Qb(i,t,e),a=_i();if(a===Bt.browser){if(!((n=Ir())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}eE(o)}else a===Bt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(r){console.error(r)}}function Qb(t,e,s){const n=`requestId=${e}&sessionTopic=${s}`;t.endsWith("/")&&(t=t.slice(0,-1));let r=`${t}`;if(t.startsWith("https://t.me")){const i=t.includes("?")?"&startapp=":"?startapp=";r=`${r}${i}${rE(n,!0)}`}else r=`${r}/wc?${n}`;return r}function eE(t){let e="_self";nE()?e="_top":(sE()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function tE(t,e){let s="";try{if(Ur()&&(s=localStorage.getItem(e),s))return s;s=await t.getItem(e)}catch(n){console.error(n)}return s}function Sd(t,e){if(!t.includes(e))return null;const s=t.split(/([&,?,=])/),n=s.indexOf(e);return s[n+2]}function _d(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function pl(){return typeof process<"u"&&Rb.IS_VITEST==="true"}function sE(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function nE(){try{return window.self!==window.top}catch{return!1}}function rE(t,e=!1){const s=Buffer.from(t).toString("base64");return e?s.replace(/[=]/g,""):s}function Uf(t){return Buffer.from(t,"base64").toString("utf-8")}function iE(t){return new Promise(e=>setTimeout(e,t))}let oE=class{constructor({limit:e}){Id(this,"limit"),Id(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const s=this.set.values().next().value;s&&this.set.delete(s)}this.set.add(e)}}has(e){return this.set.has(e)}};const zi=BigInt(2**32-1),Td=BigInt(32);function $f(t,e=!1){return e?{h:Number(t&zi),l:Number(t>>Td&zi)}:{h:Number(t>>Td&zi)|0,l:Number(t&zi)|0}}function Df(t,e=!1){const s=t.length;let n=new Uint32Array(s),r=new Uint32Array(s);for(let i=0;i<s;i++){const{h:o,l:a}=$f(t[i],e);[n[i],r[i]]=[o,a]}return[n,r]}const xd=(t,e,s)=>t>>>s,Od=(t,e,s)=>t<<32-s|e>>>s,rn=(t,e,s)=>t>>>s|e<<32-s,on=(t,e,s)=>t<<32-s|e>>>s,Xr=(t,e,s)=>t<<64-s|e>>>s-32,Zr=(t,e,s)=>t>>>s-32|e<<64-s,aE=(t,e)=>e,cE=(t,e)=>t,lE=(t,e,s)=>t<<s|e>>>32-s,dE=(t,e,s)=>e<<s|t>>>32-s,uE=(t,e,s)=>e<<s-32|t>>>64-s,hE=(t,e,s)=>t<<s-32|e>>>64-s;function is(t,e,s,n){const r=(e>>>0)+(n>>>0);return{h:t+s+(r/2**32|0)|0,l:r|0}}const gl=(t,e,s)=>(t>>>0)+(e>>>0)+(s>>>0),ml=(t,e,s,n)=>e+s+n+(t/2**32|0)|0,fE=(t,e,s,n)=>(t>>>0)+(e>>>0)+(s>>>0)+(n>>>0),pE=(t,e,s,n,r)=>e+s+n+r+(t/2**32|0)|0,gE=(t,e,s,n,r)=>(t>>>0)+(e>>>0)+(s>>>0)+(n>>>0)+(r>>>0),mE=(t,e,s,n,r,i)=>e+s+n+r+i+(t/2**32|0)|0,or=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Wo(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Vs(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ds(t,...e){if(!Wo(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ho(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Vs(t.outputLen),Vs(t.blockLen)}function yn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function wl(t,e){ds(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function mi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Qt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Ca(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function fs(t,e){return t<<32-e|t>>>e}const Bf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Lf(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const ks=Bf?t=>t:t=>Lf(t);function wE(t){for(let e=0;e<t.length;e++)t[e]=Lf(t[e]);return t}const an=Bf?t=>t:wE,Mf=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",yE=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function br(t){if(ds(t),Mf)return t.toHex();let e="";for(let s=0;s<t.length;s++)e+=yE[t[s]];return e}const Os={_0:48,_9:57,A:65,F:70,a:97,f:102};function Pd(t){if(t>=Os._0&&t<=Os._9)return t-Os._0;if(t>=Os.A&&t<=Os.F)return t-(Os.A-10);if(t>=Os.a&&t<=Os.f)return t-(Os.a-10)}function To(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Mf)return Uint8Array.fromHex(t);const e=t.length,s=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(s);for(let r=0,i=0;r<s;r++,i+=2){const o=Pd(t.charCodeAt(i)),a=Pd(t.charCodeAt(i+1));if(o===void 0||a===void 0){const c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[r]=o*16+a}return n}function Ff(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ls(t){return typeof t=="string"&&(t=Ff(t)),ds(t),t}function cn(...t){let e=0;for(let n=0;n<t.length;n++){const r=t[n];ds(r),e+=r.length}const s=new Uint8Array(e);for(let n=0,r=0;n<t.length;n++){const i=t[n];s.set(i,r),r+=i.length}return s}let zo=class{};function Ti(t){const e=n=>t().update(ls(n)).digest(),s=t();return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=()=>t(),e}function bE(t){const e=(n,r)=>t(r).update(ls(n)).digest(),s=t({});return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=n=>t(n),e}function Qn(t=32){if(or&&typeof or.getRandomValues=="function")return or.getRandomValues(new Uint8Array(t));if(or&&typeof or.randomBytes=="function")return Uint8Array.from(or.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const EE=BigInt(0),jr=BigInt(1),vE=BigInt(2),CE=BigInt(7),AE=BigInt(256),IE=BigInt(113),jf=[],qf=[],Wf=[];for(let t=0,e=jr,s=1,n=0;t<24;t++){[s,n]=[n,(2*s+3*n)%5],jf.push(2*(5*n+s)),qf.push((t+1)*(t+2)/2%64);let r=EE;for(let i=0;i<7;i++)e=(e<<jr^(e>>CE)*IE)%AE,e&vE&&(r^=jr<<(jr<<BigInt(i))-jr);Wf.push(r)}const Hf=Df(Wf,!0),NE=Hf[0],SE=Hf[1],kd=(t,e,s)=>s>32?uE(t,e,s):lE(t,e,s),Rd=(t,e,s)=>s>32?hE(t,e,s):dE(t,e,s);function _E(t,e=24){const s=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)s[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=s[c],d=s[c+1],u=kd(l,d,1)^s[a],h=Rd(l,d,1)^s[a+1];for(let f=0;f<50;f+=10)t[o+f]^=u,t[o+f+1]^=h}let r=t[2],i=t[3];for(let o=0;o<24;o++){const a=qf[o],c=kd(r,i,a),l=Rd(r,i,a),d=jf[o];r=t[d],i=t[d+1],t[d]=c,t[d+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)s[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~s[(a+2)%10]&s[(a+4)%10]}t[0]^=NE[n],t[1]^=SE[n]}Qt(s)}let TE=class zf extends zo{constructor(e,s,n,r=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=s,this.outputLen=n,this.enableXOF=r,this.rounds=i,Vs(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=mi(this.state)}clone(){return this._cloneInto()}keccak(){an(this.state32),_E(this.state32,this.rounds),an(this.state32),this.posOut=0,this.pos=0}update(e){yn(this),e=ls(e),ds(e);const{blockLen:s,state:n}=this,r=e.length;for(let i=0;i<r;){const o=Math.min(s-this.pos,r-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:s,pos:n,blockLen:r}=this;e[n]^=s,s&128&&n===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){yn(this,!1),ds(e),this.finish();const s=this.state,{blockLen:n}=this;for(let r=0,i=e.length;r<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-r);e.set(s.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Vs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(wl(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Qt(this.state)}_cloneInto(e){const{blockLen:s,suffix:n,outputLen:r,rounds:i,enableXOF:o}=this;return e||(e=new zf(s,n,r,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}};const xE=(t,e,s)=>Ti(()=>new TE(e,t,s)),OE=xE(1,136,256/8);function PE(t,e,s,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,n);const r=BigInt(32),i=BigInt(4294967295),o=Number(s>>r&i),a=Number(s&i),c=n?4:0,l=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+l,a,n)}function kE(t,e,s){return t&e^~t&s}function RE(t,e,s){return t&e^t&s^e&s}let Kf=class extends zo{constructor(e,s,n,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=s,this.padOffset=n,this.isLE=r,this.buffer=new Uint8Array(e),this.view=Ca(this.buffer)}update(e){yn(this),e=ls(e),ds(e);const{view:s,buffer:n,blockLen:r}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(r-this.pos,i-o);if(a===r){const c=Ca(e);for(;r<=i-o;o+=r)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(s,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){yn(this),wl(e,this),this.finished=!0;const{buffer:s,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;s[o++]=128,Qt(this.buffer.subarray(o)),this.padOffset>r-o&&(this.process(n,0),o=0);for(let u=o;u<r;u++)s[u]=0;PE(n,r-8,BigInt(this.length*8),i),this.process(n,0);const a=Ca(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,d[u],i)}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const n=e.slice(0,s);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:s,buffer:n,length:r,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=r,e.pos=a,r%s&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const Zs=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),nt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),rt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),UE=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Qs=new Uint32Array(64);class $E extends Kf{constructor(e=32){super(64,e,8,!1),this.A=Zs[0]|0,this.B=Zs[1]|0,this.C=Zs[2]|0,this.D=Zs[3]|0,this.E=Zs[4]|0,this.F=Zs[5]|0,this.G=Zs[6]|0,this.H=Zs[7]|0}get(){const{A:e,B:s,C:n,D:r,E:i,F:o,G:a,H:c}=this;return[e,s,n,r,i,o,a,c]}set(e,s,n,r,i,o,a,c){this.A=e|0,this.B=s|0,this.C=n|0,this.D=r|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,s){for(let u=0;u<16;u++,s+=4)Qs[u]=e.getUint32(s,!1);for(let u=16;u<64;u++){const h=Qs[u-15],f=Qs[u-2],g=fs(h,7)^fs(h,18)^h>>>3,p=fs(f,17)^fs(f,19)^f>>>10;Qs[u]=p+Qs[u-7]+g+Qs[u-16]|0}let{A:n,B:r,C:i,D:o,E:a,F:c,G:l,H:d}=this;for(let u=0;u<64;u++){const h=fs(a,6)^fs(a,11)^fs(a,25),f=d+h+kE(a,c,l)+UE[u]+Qs[u]|0,g=(fs(n,2)^fs(n,13)^fs(n,22))+RE(n,r,i)|0;d=l,l=c,c=a,a=o+f|0,o=i,i=r,r=n,n=f+g|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,r,i,o,a,c,l,d)}roundClean(){Qt(Qs)}destroy(){this.set(0,0,0,0,0,0,0,0),Qt(this.buffer)}}const Vf=Df(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),DE=Vf[0],BE=Vf[1],en=new Uint32Array(80),tn=new Uint32Array(80);let yl=class extends Kf{constructor(e=64){super(128,e,16,!1),this.Ah=rt[0]|0,this.Al=rt[1]|0,this.Bh=rt[2]|0,this.Bl=rt[3]|0,this.Ch=rt[4]|0,this.Cl=rt[5]|0,this.Dh=rt[6]|0,this.Dl=rt[7]|0,this.Eh=rt[8]|0,this.El=rt[9]|0,this.Fh=rt[10]|0,this.Fl=rt[11]|0,this.Gh=rt[12]|0,this.Gl=rt[13]|0,this.Hh=rt[14]|0,this.Hl=rt[15]|0}get(){const{Ah:e,Al:s,Bh:n,Bl:r,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:d,Fh:u,Fl:h,Gh:f,Gl:g,Hh:p,Hl:w}=this;return[e,s,n,r,i,o,a,c,l,d,u,h,f,g,p,w]}set(e,s,n,r,i,o,a,c,l,d,u,h,f,g,p,w){this.Ah=e|0,this.Al=s|0,this.Bh=n|0,this.Bl=r|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=u|0,this.Fl=h|0,this.Gh=f|0,this.Gl=g|0,this.Hh=p|0,this.Hl=w|0}process(e,s){for(let v=0;v<16;v++,s+=4)en[v]=e.getUint32(s),tn[v]=e.getUint32(s+=4);for(let v=16;v<80;v++){const E=en[v-15]|0,_=tn[v-15]|0,R=rn(E,_,1)^rn(E,_,8)^xd(E,_,7),D=on(E,_,1)^on(E,_,8)^Od(E,_,7),M=en[v-2]|0,P=tn[v-2]|0,F=rn(M,P,19)^Xr(M,P,61)^xd(M,P,6),W=on(M,P,19)^Zr(M,P,61)^Od(M,P,6),O=fE(D,W,tn[v-7],tn[v-16]),A=pE(O,R,F,en[v-7],en[v-16]);en[v]=A|0,tn[v]=O|0}let{Ah:n,Al:r,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:d,Eh:u,El:h,Fh:f,Fl:g,Gh:p,Gl:w,Hh:b,Hl:I}=this;for(let v=0;v<80;v++){const E=rn(u,h,14)^rn(u,h,18)^Xr(u,h,41),_=on(u,h,14)^on(u,h,18)^Zr(u,h,41),R=u&f^~u&p,D=h&g^~h&w,M=gE(I,_,D,BE[v],tn[v]),P=mE(M,b,E,R,DE[v],en[v]),F=M|0,W=rn(n,r,28)^Xr(n,r,34)^Xr(n,r,39),O=on(n,r,28)^Zr(n,r,34)^Zr(n,r,39),A=n&i^n&a^i&a,S=r&o^r&c^o&c;b=p|0,I=w|0,p=f|0,w=g|0,f=u|0,g=h|0,{h:u,l:h}=is(l|0,d|0,P|0,F|0),l=a|0,d=c|0,a=i|0,c=o|0,i=n|0,o=r|0;const y=gl(F,O,S);n=ml(y,P,W,A),r=y|0}({h:n,l:r}=is(this.Ah|0,this.Al|0,n|0,r|0)),{h:i,l:o}=is(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=is(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:d}=is(this.Dh|0,this.Dl|0,l|0,d|0),{h:u,l:h}=is(this.Eh|0,this.El|0,u|0,h|0),{h:f,l:g}=is(this.Fh|0,this.Fl|0,f|0,g|0),{h:p,l:w}=is(this.Gh|0,this.Gl|0,p|0,w|0),{h:b,l:I}=is(this.Hh|0,this.Hl|0,b|0,I|0),this.set(n,r,i,o,a,c,l,d,u,h,f,g,p,w,b,I)}roundClean(){Qt(en,tn)}destroy(){Qt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class LE extends yl{constructor(){super(48),this.Ah=nt[0]|0,this.Al=nt[1]|0,this.Bh=nt[2]|0,this.Bl=nt[3]|0,this.Ch=nt[4]|0,this.Cl=nt[5]|0,this.Dh=nt[6]|0,this.Dl=nt[7]|0,this.Eh=nt[8]|0,this.El=nt[9]|0,this.Fh=nt[10]|0,this.Fl=nt[11]|0,this.Gh=nt[12]|0,this.Gl=nt[13]|0,this.Hh=nt[14]|0,this.Hl=nt[15]|0}}const it=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class ME extends yl{constructor(){super(32),this.Ah=it[0]|0,this.Al=it[1]|0,this.Bh=it[2]|0,this.Bl=it[3]|0,this.Ch=it[4]|0,this.Cl=it[5]|0,this.Dh=it[6]|0,this.Dl=it[7]|0,this.Eh=it[8]|0,this.El=it[9]|0,this.Fh=it[10]|0,this.Fl=it[11]|0,this.Gh=it[12]|0,this.Gl=it[13]|0,this.Hh=it[14]|0,this.Hl=it[15]|0}}const Ko=Ti(()=>new $E),FE=Ti(()=>new yl),jE=Ti(()=>new LE),qE=Ti(()=>new ME),WE=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),qe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),J=new Uint32Array(32);function sn(t,e,s,n,r,i){const o=r[i],a=r[i+1];let c=J[2*t],l=J[2*t+1],d=J[2*e],u=J[2*e+1],h=J[2*s],f=J[2*s+1],g=J[2*n],p=J[2*n+1],w=gl(c,d,o);l=ml(w,l,u,a),c=w|0,{Dh:p,Dl:g}={Dh:p^l,Dl:g^c},{Dh:p,Dl:g}={Dh:aE(p,g),Dl:cE(p)},{h:f,l:h}=is(f,h,p,g),{Bh:u,Bl:d}={Bh:u^f,Bl:d^h},{Bh:u,Bl:d}={Bh:rn(u,d,24),Bl:on(u,d,24)},J[2*t]=c,J[2*t+1]=l,J[2*e]=d,J[2*e+1]=u,J[2*s]=h,J[2*s+1]=f,J[2*n]=g,J[2*n+1]=p}function nn(t,e,s,n,r,i){const o=r[i],a=r[i+1];let c=J[2*t],l=J[2*t+1],d=J[2*e],u=J[2*e+1],h=J[2*s],f=J[2*s+1],g=J[2*n],p=J[2*n+1],w=gl(c,d,o);l=ml(w,l,u,a),c=w|0,{Dh:p,Dl:g}={Dh:p^l,Dl:g^c},{Dh:p,Dl:g}={Dh:rn(p,g,16),Dl:on(p,g,16)},{h:f,l:h}=is(f,h,p,g),{Bh:u,Bl:d}={Bh:u^f,Bl:d^h},{Bh:u,Bl:d}={Bh:Xr(u,d,63),Bl:Zr(u,d,63)},J[2*t]=c,J[2*t+1]=l,J[2*e]=d,J[2*e+1]=u,J[2*s]=h,J[2*s+1]=f,J[2*n]=g,J[2*n+1]=p}function HE(t,e={},s,n,r){if(Vs(s),t<0||t>s)throw new Error("outputLen bigger than keyLen");const{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>s))throw new Error("key length must be undefined or 1.."+s);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==r)throw new Error("personalization must be undefined or "+r)}class zE extends zo{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Vs(e),Vs(s),this.blockLen=e,this.outputLen=s,this.buffer=new Uint8Array(e),this.buffer32=mi(this.buffer)}update(e){yn(this),e=ls(e),ds(e);const{blockLen:s,buffer:n,buffer32:r}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===s&&(an(r),this.compress(r,0,!1),an(r),this.pos=0);const l=Math.min(s-this.pos,i-c),d=o+c;if(l===s&&!(d%4)&&c+l<i){const u=new Uint32Array(a,d,Math.floor((i-c)/4));an(u);for(let h=0;c+s<i;h+=r.length,c+=s)this.length+=s,this.compress(u,h,!1);an(u);continue}n.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){yn(this),wl(e,this);const{pos:s,buffer32:n}=this;this.finished=!0,Qt(this.buffer.subarray(s)),an(n),this.compress(n,0,!0),an(n);const r=mi(e);this.get().forEach((i,o)=>r[o]=ks(i))}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const n=e.slice(0,s);return this.destroy(),n}_cloneInto(e){const{buffer:s,length:n,finished:r,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(s),e.destroyed=i,e.finished=r,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class KE extends zE{constructor(e={}){const s=e.dkLen===void 0?64:e.dkLen;super(128,s),this.v0l=qe[0]|0,this.v0h=qe[1]|0,this.v1l=qe[2]|0,this.v1h=qe[3]|0,this.v2l=qe[4]|0,this.v2h=qe[5]|0,this.v3l=qe[6]|0,this.v3h=qe[7]|0,this.v4l=qe[8]|0,this.v4h=qe[9]|0,this.v5l=qe[10]|0,this.v5h=qe[11]|0,this.v6l=qe[12]|0,this.v6h=qe[13]|0,this.v7l=qe[14]|0,this.v7h=qe[15]|0,HE(s,e,64,16,16);let{key:n,personalization:r,salt:i}=e,o=0;if(n!==void 0&&(n=ls(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=ls(i);const a=mi(i);this.v4l^=ks(a[0]),this.v4h^=ks(a[1]),this.v5l^=ks(a[2]),this.v5h^=ks(a[3])}if(r!==void 0){r=ls(r);const a=mi(r);this.v6l^=ks(a[0]),this.v6h^=ks(a[1]),this.v7l^=ks(a[2]),this.v7h^=ks(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:s,v1l:n,v1h:r,v2l:i,v2h:o,v3l:a,v3h:c,v4l:l,v4h:d,v5l:u,v5h:h,v6l:f,v6h:g,v7l:p,v7h:w}=this;return[e,s,n,r,i,o,a,c,l,d,u,h,f,g,p,w]}set(e,s,n,r,i,o,a,c,l,d,u,h,f,g,p,w){this.v0l=e|0,this.v0h=s|0,this.v1l=n|0,this.v1h=r|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=d|0,this.v5l=u|0,this.v5h=h|0,this.v6l=f|0,this.v6h=g|0,this.v7l=p|0,this.v7h=w|0}compress(e,s,n){this.get().forEach((c,l)=>J[l]=c),J.set(qe,16);let{h:r,l:i}=$f(BigInt(this.length));J[24]=qe[8]^i,J[25]=qe[9]^r,n&&(J[28]=~J[28],J[29]=~J[29]);let o=0;const a=WE;for(let c=0;c<12;c++)sn(0,4,8,12,e,s+2*a[o++]),nn(0,4,8,12,e,s+2*a[o++]),sn(1,5,9,13,e,s+2*a[o++]),nn(1,5,9,13,e,s+2*a[o++]),sn(2,6,10,14,e,s+2*a[o++]),nn(2,6,10,14,e,s+2*a[o++]),sn(3,7,11,15,e,s+2*a[o++]),nn(3,7,11,15,e,s+2*a[o++]),sn(0,5,10,15,e,s+2*a[o++]),nn(0,5,10,15,e,s+2*a[o++]),sn(1,6,11,12,e,s+2*a[o++]),nn(1,6,11,12,e,s+2*a[o++]),sn(2,7,8,13,e,s+2*a[o++]),nn(2,7,8,13,e,s+2*a[o++]),sn(3,4,9,14,e,s+2*a[o++]),nn(3,4,9,14,e,s+2*a[o++]);this.v0l^=J[0]^J[16],this.v0h^=J[1]^J[17],this.v1l^=J[2]^J[18],this.v1h^=J[3]^J[19],this.v2l^=J[4]^J[20],this.v2h^=J[5]^J[21],this.v3l^=J[6]^J[22],this.v3h^=J[7]^J[23],this.v4l^=J[8]^J[24],this.v4h^=J[9]^J[25],this.v5l^=J[10]^J[26],this.v5h^=J[11]^J[27],this.v6l^=J[12]^J[28],this.v6h^=J[13]^J[29],this.v7l^=J[14]^J[30],this.v7h^=J[15]^J[31],Qt(J)}destroy(){this.destroyed=!0,Qt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const VE=bE(t=>new KE(t)),GE="https://rpc.walletconnect.org/v1";function Gf(t){const e=`Ethereum Signed Message:
${t.length}`,s=new TextEncoder().encode(e+t);return"0x"+Buffer.from(OE(s)).toString("hex")}async function YE(t,e,s,n,r,i){switch(s.t){case"eip191":return await JE(t,e,s.s);case"eip1271":return await XE(t,e,s.s,n,r,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${s.t}`)}}function JE(t,e,s){const n=K0(s);return X0({payload:Gf(e),signature:n}).toLowerCase()===t.toLowerCase()}async function XE(t,e,s,n,r,i){const o=Hs(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=s.substring(2),d=(l.length/2).toString(16).padStart(64,"0"),u=(e.startsWith("0x")?e:Gf(e)).substring(2),h=a+u+c+d+l,f=await fetch(`${i||GE}/?chainId=${n}&projectId=${r}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:ZE(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:h},"latest"]})}),{result:g}=await f.json();return g?g.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function ZE(){return Date.now()+Math.floor(Math.random()*1e3)}function QE(t){const e=atob(t),s=new Uint8Array(e.length);for(let o=0;o<e.length;o++)s[o]=e.charCodeAt(o);const n=s[0];if(n===0)throw new Error("No signatures found");const r=1+n*64;if(s.length<r)throw new Error("Transaction data too short for claimed signature count");if(s.length<100)throw new Error("Transaction too short");const i=Buffer.from(t,"base64").slice(1,65);return Rr.encode(i)}function ev(t){const e=new Uint8Array(Buffer.from(t,"base64")),s=Array.from("TransactionData::").map(i=>i.charCodeAt(0)),n=new Uint8Array(s.length+e.length);n.set(s),n.set(e,s.length);const r=VE(n,{dkLen:32});return Rr.encode(r)}function Ud(t){const e=new Uint8Array(Ko(tv(t)));return Rr.encode(e)}function tv(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function $d(t){const e=Buffer.from(t,"base64"),s=kb(e).txn;if(!s)throw new Error("Invalid signed transaction: missing 'txn' field");const n=Ib(s),r=Buffer.from("TX"),i=Buffer.concat([r,Buffer.from(n)]),o=qE(i);return Rg.encode(o).replace(/=+$/,"")}function Aa(t){const e=[];let s=BigInt(t);for(;s>=BigInt(128);)e.push(Number(s&BigInt(127)|BigInt(128))),s>>=BigInt(7);return e.push(Number(s)),Buffer.from(e)}function sv(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),s=Buffer.from(t.signed.authInfoBytes,"base64"),n=Buffer.from(t.signature.signature,"base64"),r=[];r.push(Buffer.from([10])),r.push(Aa(e.length)),r.push(e),r.push(Buffer.from([18])),r.push(Aa(s.length)),r.push(s),r.push(Buffer.from([26])),r.push(Aa(n.length)),r.push(n);const i=Buffer.concat(r),o=Ko(i);return Buffer.from(o).toString("hex").toUpperCase()}function nv(t){var e,s;const n=[];try{if(typeof t=="string")return n.push(t),n;if(typeof t!="object")return n;t!=null&&t.id&&n.push(t.id);const r=(s=(e=t==null?void 0:t.capabilities)==null?void 0:e.caip345)==null?void 0:s.transactionHashes;r&&n.push(...r)}catch(r){console.warn("getWalletSendCallsHashes failed: ",r)}return n}var rv=Object.defineProperty,iv=Object.defineProperties,ov=Object.getOwnPropertyDescriptors,Dd=Object.getOwnPropertySymbols,av=Object.prototype.hasOwnProperty,cv=Object.prototype.propertyIsEnumerable,Bd=(t,e,s)=>e in t?rv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,lv=(t,e)=>{for(var s in e||(e={}))av.call(e,s)&&Bd(t,s,e[s]);if(Dd)for(var s of Dd(e))cv.call(e,s)&&Bd(t,s,e[s]);return t},dv=(t,e)=>iv(t,ov(e));const Yf="did:pkh:",uv={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},hv=t=>t?uv[t]||t:"",Vo=t=>t==null?void 0:t.split(":"),fv=t=>{const e=t&&Vo(t);if(e)return t.includes(Yf)?e[3]:e[1]},pv=t=>{const e=t&&Vo(t);if(e)return t.includes(Yf)?e[2]:e[0]},yc=t=>{const e=t&&Vo(t);if(e)return e[2]+":"+e[3]},xo=t=>{const e=t&&Vo(t);if(e)return e.pop()};async function Ld(t){const{cacao:e,projectId:s}=t,{s:n,p:r}=e,i=Jf(r,r.iss),o=xo(r.iss);return await YE(o,i,n,yc(r.iss),s)}const Jf=(t,e)=>{const s=pv(e);if(!s)throw new Error("Invalid issuer: "+e);const n=`${t.domain} wants you to sign in with your ${hv(s)} account:`,r=xo(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${fv(e)}`,l=`Nonce: ${t.nonce}`,d=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,f=t.requestId?`Request ID: ${t.requestId}`:void 0,g=t.resources?`Resources:${t.resources.map(w=>`
- ${w}`).join("")}`:void 0,p=lo(t.resources);if(p){const w=wi(p);i=Av(i,w)}return[n,r,"",i,"",o,a,c,l,d,u,h,f,g].filter(w=>w!=null).join(`
`)};function gv(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function mv(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Kn(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(s=>{const n=t.att[s];if(Array.isArray(n))throw new Error(`Resource must be an object: ${s}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${s}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${s}`);Object.keys(n).forEach(r=>{const i=n[r];if(!Array.isArray(i))throw new Error(`Ability limits ${r} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${r} is empty array, must be an array with objects`);i.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${r}) must be an array of objects, found: ${o}`)})})})}function wv(t,e,s,n={}){return s==null||s.sort((r,i)=>r.localeCompare(i)),{att:{[t]:yv(e,s,n)}}}function yv(t,e,s={}){e=e==null?void 0:e.sort((r,i)=>r.localeCompare(i));const n=e.map(r=>({[`${t}/${r}`]:[s]}));return Object.assign({},...n)}function Xf(t){return Kn(t),`urn:recap:${gv(t).replace(/=/g,"")}`}function wi(t){const e=mv(t.replace("urn:recap:",""));return Kn(e),e}function bv(t,e,s){const n=wv(t,e,s);return Xf(n)}function Ev(t){return t&&t.includes("urn:recap:")}function vv(t,e){const s=wi(t),n=wi(e),r=Cv(s,n);return Xf(r)}function Cv(t,e){Kn(t),Kn(e);const s=Object.keys(t.att).concat(Object.keys(e.att)).sort((r,i)=>r.localeCompare(i)),n={att:{}};return s.forEach(r=>{var i,o;Object.keys(((i=t.att)==null?void 0:i[r])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[r])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;n.att[r]=dv(lv({},n.att[r]),{[a]:((c=t.att[r])==null?void 0:c[a])||((l=e.att[r])==null?void 0:l[a])})})}),n}function Av(t="",e){Kn(e);const s="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(s))return t;const n=[];let r=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(u=>({ability:u.split("/")[0],action:u.split("/")[1]}));c.sort((u,h)=>u.action.localeCompare(h.action));const l={};c.forEach(u=>{l[u.ability]||(l[u.ability]=[]),l[u.ability].push(u.action)});const d=Object.keys(l).map(u=>(r++,`(${r}) '${u}': '${l[u].join("', '")}' for '${a}'.`));n.push(d.join(", ").replace(".,","."))});const i=n.join(" "),o=`${s}${i}`;return`${t?t+" ":""}${o}`}function Md(t){var e;const s=wi(t);Kn(s);const n=(e=s.att)==null?void 0:e.eip155;return n?Object.keys(n).map(r=>r.split("/")[1]):[]}function Fd(t){const e=wi(t);Kn(e);const s=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(r=>{var i;(i=r==null?void 0:r[0])!=null&&i.chains&&s.push(r[0].chains)})}),[...new Set(s.flat())]}function lo(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return Ev(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Zf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function bc(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Ia(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function At(t,...e){if(!Zf(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function jd(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Iv(t,e){At(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function pn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function _r(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Nv(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const Sv=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function _v(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Ec(t){if(typeof t=="string")t=_v(t);else if(Zf(t))t=vc(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function Tv(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function xv(t,e){if(t.length!==e.length)return!1;let s=0;for(let n=0;n<t.length;n++)s|=t[n]^e[n];return s===0}const Ov=(t,e)=>{function s(n,...r){if(At(n),!Sv)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=r[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?At(l):At(l,t.nonceLength)}const i=t.tagLength;i&&r[1]!==void 0&&At(r[1]);const o=e(n,...r),a=(l,d)=>{if(d!==void 0){if(l!==2)throw new Error("cipher output not supported");At(d)}};let c=!1;return{encrypt(l,d){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,At(l),a(o.encrypt.length,d),o.encrypt(l,d)},decrypt(l,d){if(At(l),i&&l.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,d),o.decrypt(l,d)}}}return Object.assign(s,t),s};function qd(t,e,s=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(s&&!kv(e))throw new Error("invalid output, must be aligned");return e}function Wd(t,e,s,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,n);const r=BigInt(32),i=BigInt(4294967295),o=Number(s>>r&i),a=Number(s&i);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function Pv(t,e,s){bc(s);const n=new Uint8Array(16),r=Nv(n);return Wd(r,0,BigInt(e),s),Wd(r,8,BigInt(t),s),n}function kv(t){return t.byteOffset%4===0}function vc(t){return Uint8Array.from(t)}const Qf=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),Rv=Qf("expand 16-byte k"),Uv=Qf("expand 32-byte k"),$v=pn(Rv),Dv=pn(Uv);function Ee(t,e){return t<<e|t>>>32-e}function Cc(t){return t.byteOffset%4===0}const Ki=64,Bv=16,ep=2**32-1,Hd=new Uint32Array;function Lv(t,e,s,n,r,i,o,a){const c=r.length,l=new Uint8Array(Ki),d=pn(l),u=Cc(r)&&Cc(i),h=u?pn(r):Hd,f=u?pn(i):Hd;for(let g=0;g<c;o++){if(t(e,s,n,d,o,a),o>=ep)throw new Error("arx: counter overflow");const p=Math.min(Ki,c-g);if(u&&p===Ki){const w=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let b=0,I;b<Bv;b++)I=w+b,f[I]=h[I]^d[b];g+=Ki;continue}for(let w=0,b;w<p;w++)b=g+w,i[b]=r[b]^l[w];g+=p}}function Mv(t,e){const{allowShortKeys:s,extendNonceFn:n,counterLength:r,counterRight:i,rounds:o}=Tv({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Ia(r),Ia(o),bc(i),bc(s),(a,c,l,d,u=0)=>{At(a),At(c),At(l);const h=l.length;if(d===void 0&&(d=new Uint8Array(h)),At(d),Ia(u),u<0||u>=ep)throw new Error("arx: counter overflow");if(d.length<h)throw new Error(`arx: output (${d.length}) is shorter than data (${h})`);const f=[];let g=a.length,p,w;if(g===32)f.push(p=vc(a)),w=Dv;else if(g===16&&s)p=new Uint8Array(32),p.set(a),p.set(a,16),w=$v,f.push(p);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Cc(c)||f.push(c=vc(c));const b=pn(p);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(w,b,pn(c.subarray(0,16)),b),c=c.subarray(16)}const I=16-r;if(I!==c.length)throw new Error(`arx: nonce must be ${I} or 16 bytes`);if(I!==12){const E=new Uint8Array(12);E.set(c,i?0:12-c.length),c=E,f.push(c)}const v=pn(c);return Lv(t,w,b,v,l,d,u,o),_r(...f),d}}const Ye=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class Fv{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Ec(e),At(e,32);const s=Ye(e,0),n=Ye(e,2),r=Ye(e,4),i=Ye(e,6),o=Ye(e,8),a=Ye(e,10),c=Ye(e,12),l=Ye(e,14);this.r[0]=s&8191,this.r[1]=(s>>>13|n<<3)&8191,this.r[2]=(n>>>10|r<<6)&7939,this.r[3]=(r>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let d=0;d<8;d++)this.pad[d]=Ye(e,16+2*d)}process(e,s,n=!1){const r=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],d=o[3],u=o[4],h=o[5],f=o[6],g=o[7],p=o[8],w=o[9],b=Ye(e,s+0),I=Ye(e,s+2),v=Ye(e,s+4),E=Ye(e,s+6),_=Ye(e,s+8),R=Ye(e,s+10),D=Ye(e,s+12),M=Ye(e,s+14);let P=i[0]+(b&8191),F=i[1]+((b>>>13|I<<3)&8191),W=i[2]+((I>>>10|v<<6)&8191),O=i[3]+((v>>>7|E<<9)&8191),A=i[4]+((E>>>4|_<<12)&8191),S=i[5]+(_>>>1&8191),y=i[6]+((_>>>14|R<<2)&8191),C=i[7]+((R>>>11|D<<5)&8191),T=i[8]+((D>>>8|M<<8)&8191),$=i[9]+(M>>>5|r),N=0,x=N+P*a+F*(5*w)+W*(5*p)+O*(5*g)+A*(5*f);N=x>>>13,x&=8191,x+=S*(5*h)+y*(5*u)+C*(5*d)+T*(5*l)+$*(5*c),N+=x>>>13,x&=8191;let q=N+P*c+F*a+W*(5*w)+O*(5*p)+A*(5*g);N=q>>>13,q&=8191,q+=S*(5*f)+y*(5*h)+C*(5*u)+T*(5*d)+$*(5*l),N+=q>>>13,q&=8191;let z=N+P*l+F*c+W*a+O*(5*w)+A*(5*p);N=z>>>13,z&=8191,z+=S*(5*g)+y*(5*f)+C*(5*h)+T*(5*u)+$*(5*d),N+=z>>>13,z&=8191;let ae=N+P*d+F*l+W*c+O*a+A*(5*w);N=ae>>>13,ae&=8191,ae+=S*(5*p)+y*(5*g)+C*(5*f)+T*(5*h)+$*(5*u),N+=ae>>>13,ae&=8191;let ne=N+P*u+F*d+W*l+O*c+A*a;N=ne>>>13,ne&=8191,ne+=S*(5*w)+y*(5*p)+C*(5*g)+T*(5*f)+$*(5*h),N+=ne>>>13,ne&=8191;let Q=N+P*h+F*u+W*d+O*l+A*c;N=Q>>>13,Q&=8191,Q+=S*a+y*(5*w)+C*(5*p)+T*(5*g)+$*(5*f),N+=Q>>>13,Q&=8191;let le=N+P*f+F*h+W*u+O*d+A*l;N=le>>>13,le&=8191,le+=S*c+y*a+C*(5*w)+T*(5*p)+$*(5*g),N+=le>>>13,le&=8191;let ie=N+P*g+F*f+W*h+O*u+A*d;N=ie>>>13,ie&=8191,ie+=S*l+y*c+C*a+T*(5*w)+$*(5*p),N+=ie>>>13,ie&=8191;let Ie=N+P*p+F*g+W*f+O*h+A*u;N=Ie>>>13,Ie&=8191,Ie+=S*d+y*l+C*c+T*a+$*(5*w),N+=Ie>>>13,Ie&=8191;let ce=N+P*w+F*p+W*g+O*f+A*h;N=ce>>>13,ce&=8191,ce+=S*u+y*d+C*l+T*c+$*a,N+=ce>>>13,ce&=8191,N=(N<<2)+N|0,N=N+x|0,x=N&8191,N=N>>>13,q+=N,i[0]=x,i[1]=q,i[2]=z,i[3]=ae,i[4]=ne,i[5]=Q,i[6]=le,i[7]=ie,i[8]=Ie,i[9]=ce}finalize(){const{h:e,pad:s}=this,n=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=r,r=e[a]>>>13,e[a]&=8191;e[0]+=r*5,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,n[0]=e[0]+5,r=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+r,r=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(r^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+s[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+s[a]|0)+(o>>>16)|0,e[a]=o&65535;_r(n)}update(e){jd(this),e=Ec(e),At(e);const{buffer:s,blockLen:n}=this,r=e.length;for(let i=0;i<r;){const o=Math.min(n-this.pos,r-i);if(o===n){for(;n<=r-i;i+=n)this.process(e,i);continue}s.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(s,0,!1),this.pos=0)}return this}destroy(){_r(this.h,this.r,this.buffer,this.pad)}digestInto(e){jd(this),Iv(e,this),this.finished=!0;const{buffer:s,h:n}=this;let{pos:r}=this;if(r){for(s[r++]=1;r<16;r++)s[r]=0;this.process(s,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const n=e.slice(0,s);return this.destroy(),n}}function jv(t){const e=(n,r)=>t(r).update(Ec(n)).digest(),s=t(new Uint8Array(32));return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=n=>t(n),e}const qv=jv(t=>new Fv(t));function Wv(t,e,s,n,r,i=20){let o=t[0],a=t[1],c=t[2],l=t[3],d=e[0],u=e[1],h=e[2],f=e[3],g=e[4],p=e[5],w=e[6],b=e[7],I=r,v=s[0],E=s[1],_=s[2],R=o,D=a,M=c,P=l,F=d,W=u,O=h,A=f,S=g,y=p,C=w,T=b,$=I,N=v,x=E,q=_;for(let ae=0;ae<i;ae+=2)R=R+F|0,$=Ee($^R,16),S=S+$|0,F=Ee(F^S,12),R=R+F|0,$=Ee($^R,8),S=S+$|0,F=Ee(F^S,7),D=D+W|0,N=Ee(N^D,16),y=y+N|0,W=Ee(W^y,12),D=D+W|0,N=Ee(N^D,8),y=y+N|0,W=Ee(W^y,7),M=M+O|0,x=Ee(x^M,16),C=C+x|0,O=Ee(O^C,12),M=M+O|0,x=Ee(x^M,8),C=C+x|0,O=Ee(O^C,7),P=P+A|0,q=Ee(q^P,16),T=T+q|0,A=Ee(A^T,12),P=P+A|0,q=Ee(q^P,8),T=T+q|0,A=Ee(A^T,7),R=R+W|0,q=Ee(q^R,16),C=C+q|0,W=Ee(W^C,12),R=R+W|0,q=Ee(q^R,8),C=C+q|0,W=Ee(W^C,7),D=D+O|0,$=Ee($^D,16),T=T+$|0,O=Ee(O^T,12),D=D+O|0,$=Ee($^D,8),T=T+$|0,O=Ee(O^T,7),M=M+A|0,N=Ee(N^M,16),S=S+N|0,A=Ee(A^S,12),M=M+A|0,N=Ee(N^M,8),S=S+N|0,A=Ee(A^S,7),P=P+F|0,x=Ee(x^P,16),y=y+x|0,F=Ee(F^y,12),P=P+F|0,x=Ee(x^P,8),y=y+x|0,F=Ee(F^y,7);let z=0;n[z++]=o+R|0,n[z++]=a+D|0,n[z++]=c+M|0,n[z++]=l+P|0,n[z++]=d+F|0,n[z++]=u+W|0,n[z++]=h+O|0,n[z++]=f+A|0,n[z++]=g+S|0,n[z++]=p+y|0,n[z++]=w+C|0,n[z++]=b+T|0,n[z++]=I+$|0,n[z++]=v+N|0,n[z++]=E+x|0,n[z++]=_+q|0}const Hv=Mv(Wv,{counterRight:!1,counterLength:4,allowShortKeys:!1}),zv=new Uint8Array(16),zd=(t,e)=>{t.update(e);const s=e.length%16;s&&t.update(zv.subarray(s))},Kv=new Uint8Array(32);function Kd(t,e,s,n,r){const i=t(e,s,Kv),o=qv.create(i);r&&zd(o,r),zd(o,n);const a=Pv(n.length,r?r.length:0,!0);o.update(a);const c=o.digest();return _r(i,a),c}const Vv=t=>(e,s,n)=>({encrypt(r,i){const o=r.length;i=qd(o+16,i,!1),i.set(r);const a=i.subarray(0,-16);t(e,s,a,a,1);const c=Kd(t,e,s,a,n);return i.set(c,o),_r(c),i},decrypt(r,i){i=qd(r.length-16,i,!1);const o=r.subarray(0,-16),a=r.subarray(-16),c=Kd(t,e,s,o,n);if(!xv(a,c))throw new Error("invalid tag");return i.set(r.subarray(0,-16)),t(e,s,i,i,1),_r(c),i}}),tp=Ov({blockSize:64,nonceLength:12,tagLength:16},Vv(Hv));let sp=class extends zo{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,Ho(e);const n=ls(s);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Qt(i)}update(e){return yn(this),this.iHash.update(e),this}digestInto(e){yn(this),ds(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:s,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=s._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Go=(t,e,s)=>new sp(t,e).update(s).digest();Go.create=(t,e)=>new sp(t,e);function Gv(t,e,s){return Ho(t),s===void 0&&(s=new Uint8Array(t.outputLen)),Go(t,ls(s),ls(e))}const Na=Uint8Array.from([0]),Vd=Uint8Array.of();function Yv(t,e,s,n=32){Ho(t),Vs(n);const r=t.outputLen;if(n>255*r)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/r);s===void 0&&(s=Vd);const o=new Uint8Array(i*r),a=Go.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let d=0;d<i;d++)Na[0]=d+1,c.update(d===0?Vd:l).update(s).update(Na).digestInto(l),o.set(l,r*d),a._cloneInto(c);return a.destroy(),c.destroy(),Qt(l,Na),o.slice(0,n)}const Jv=(t,e,s,n,r)=>Yv(t,Gv(t,e,s),n,r),Yo=Ko,bl=BigInt(0),Ac=BigInt(1);function Oo(t,e=""){if(typeof t!="boolean"){const s=e&&`"${e}"`;throw new Error(s+"expected boolean, got type="+typeof t)}return t}function Dn(t,e,s=""){const n=Wo(t),r=t==null?void 0:t.length,i=e!==void 0;if(!n||i&&r!==e){const o=s&&`"${s}" `,a=i?` of length ${e}`:"",c=n?`length=${r}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Vi(t){const e=t.toString(16);return e.length&1?"0"+e:e}function np(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?bl:BigInt("0x"+t)}function Jo(t){return np(br(t))}function Po(t){return ds(t),np(br(Uint8Array.from(t).reverse()))}function El(t,e){return To(t.toString(16).padStart(e*2,"0"))}function vl(t,e){return El(t,e).reverse()}function at(t,e,s){let n;if(typeof e=="string")try{n=To(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Wo(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const r=n.length;if(typeof s=="number"&&r!==s)throw new Error(t+" of length "+s+" expected, got "+r);return n}const Sa=t=>typeof t=="bigint"&&bl<=t;function Xv(t,e,s){return Sa(t)&&Sa(e)&&Sa(s)&&e<=t&&t<s}function Ic(t,e,s,n){if(!Xv(e,s,n))throw new Error("expected valid "+t+": "+s+" <= n < "+n+", got "+e)}function rp(t){let e;for(e=0;t>bl;t>>=Ac,e+=1);return e}const xi=t=>(Ac<<BigInt(t))-Ac;function Zv(t,e,s){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof s!="function")throw new Error("hmacFn must be a function");const n=h=>new Uint8Array(h),r=h=>Uint8Array.of(h);let i=n(t),o=n(t),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},l=(...h)=>s(o,i,...h),d=(h=n(0))=>{o=l(r(0),h),i=l(),h.length!==0&&(o=l(r(1),h),i=l())},u=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){i=l();const g=i.slice();f.push(g),h+=i.length}return cn(...f)};return(h,f)=>{c(),d(h);let g;for(;!(g=f(u()));)d();return c(),g}}function Xo(t,e,s={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(r,i,o){const a=t[r];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${r}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([r,i])=>n(r,i,!1)),Object.entries(s).forEach(([r,i])=>n(r,i,!0))}function Gd(t){const e=new WeakMap;return(s,...n)=>{const r=e.get(s);if(r!==void 0)return r;const i=t(s,...n);return e.set(s,i),i}}const St=BigInt(0),pt=BigInt(1),Bn=BigInt(2),ip=BigInt(3),op=BigInt(4),ap=BigInt(5),Qv=BigInt(7),cp=BigInt(8),eC=BigInt(9),lp=BigInt(16);function $t(t,e){const s=t%e;return s>=St?s:e+s}function rs(t,e,s){let n=t;for(;e-- >St;)n*=n,n%=s;return n}function Yd(t,e){if(t===St)throw new Error("invert: expected non-zero number");if(e<=St)throw new Error("invert: expected positive modulus, got "+e);let s=$t(t,e),n=e,r=St,i=pt;for(;s!==St;){const o=n/s,a=n%s,c=r-i*o;n=s,s=a,r=i,i=c}if(n!==pt)throw new Error("invert: does not exist");return $t(r,e)}function Cl(t,e,s){if(!t.eql(t.sqr(e),s))throw new Error("Cannot find square root")}function dp(t,e){const s=(t.ORDER+pt)/op,n=t.pow(e,s);return Cl(t,n,e),n}function tC(t,e){const s=(t.ORDER-ap)/cp,n=t.mul(e,Bn),r=t.pow(n,s),i=t.mul(e,r),o=t.mul(t.mul(i,Bn),r),a=t.mul(i,t.sub(o,t.ONE));return Cl(t,a,e),a}function sC(t){const e=En(t),s=up(t),n=s(e,e.neg(e.ONE)),r=s(e,n),i=s(e,e.neg(n)),o=(t+Qv)/lp;return(a,c)=>{let l=a.pow(c,o),d=a.mul(l,n);const u=a.mul(l,r),h=a.mul(l,i),f=a.eql(a.sqr(d),c),g=a.eql(a.sqr(u),c);l=a.cmov(l,d,f),d=a.cmov(h,u,g);const p=a.eql(a.sqr(d),c),w=a.cmov(l,d,p);return Cl(a,w,c),w}}function up(t){if(t<ip)throw new Error("sqrt is not defined for small field");let e=t-pt,s=0;for(;e%Bn===St;)e/=Bn,s++;let n=Bn;const r=En(t);for(;Jd(r,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(s===1)return dp;let i=r.pow(n,e);const o=(e+pt)/Bn;return function(a,c){if(a.is0(c))return c;if(Jd(a,c)!==1)throw new Error("Cannot find square root");let l=s,d=a.mul(a.ONE,i),u=a.pow(c,e),h=a.pow(c,o);for(;!a.eql(u,a.ONE);){if(a.is0(u))return a.ZERO;let f=1,g=a.sqr(u);for(;!a.eql(g,a.ONE);)if(f++,g=a.sqr(g),f===l)throw new Error("Cannot find square root");const p=pt<<BigInt(l-f-1),w=a.pow(d,p);l=f,d=a.sqr(w),u=a.mul(u,d),h=a.mul(h,w)}return h}}function nC(t){return t%op===ip?dp:t%cp===ap?tC:t%lp===eC?sC(t):up(t)}const rC=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function iC(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},s=rC.reduce((n,r)=>(n[r]="function",n),e);return Xo(t,s),t}function oC(t,e,s){if(s<St)throw new Error("invalid exponent, negatives unsupported");if(s===St)return t.ONE;if(s===pt)return e;let n=t.ONE,r=e;for(;s>St;)s&pt&&(n=t.mul(n,r)),r=t.sqr(r),s>>=pt;return n}function hp(t,e,s=!1){const n=new Array(e.length).fill(s?t.ZERO:void 0),r=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),i=t.inv(r);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),i),n}function Jd(t,e){const s=(t.ORDER-pt)/Bn,n=t.pow(e,s),r=t.eql(n,t.ONE),i=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!r&&!i&&!o)throw new Error("invalid Legendre symbol result");return r?1:i?0:-1}function fp(t,e){e!==void 0&&Vs(e);const s=e!==void 0?e:t.toString(2).length,n=Math.ceil(s/8);return{nBitLength:s,nByteLength:n}}function En(t,e,s=!1,n={}){if(t<=St)throw new Error("invalid field: expected ORDER > 0, got "+t);let r,i,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||s)throw new Error("cannot specify opts in two arguments");const h=e;h.BITS&&(r=h.BITS),h.sqrt&&(i=h.sqrt),typeof h.isLE=="boolean"&&(s=h.isLE),typeof h.modFromBytes=="boolean"&&(o=h.modFromBytes),a=h.allowedLengths}else typeof e=="number"&&(r=e),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:l}=fp(t,r);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let d;const u=Object.freeze({ORDER:t,isLE:s,BITS:c,BYTES:l,MASK:xi(c),ZERO:St,ONE:pt,allowedLengths:a,create:h=>$t(h,t),isValid:h=>{if(typeof h!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof h);return St<=h&&h<t},is0:h=>h===St,isValidNot0:h=>!u.is0(h)&&u.isValid(h),isOdd:h=>(h&pt)===pt,neg:h=>$t(-h,t),eql:(h,f)=>h===f,sqr:h=>$t(h*h,t),add:(h,f)=>$t(h+f,t),sub:(h,f)=>$t(h-f,t),mul:(h,f)=>$t(h*f,t),pow:(h,f)=>oC(u,h,f),div:(h,f)=>$t(h*Yd(f,t),t),sqrN:h=>h*h,addN:(h,f)=>h+f,subN:(h,f)=>h-f,mulN:(h,f)=>h*f,inv:h=>Yd(h,t),sqrt:i||(h=>(d||(d=nC(t)),d(u,h))),toBytes:h=>s?vl(h,l):El(h,l),fromBytes:(h,f=!0)=>{if(a){if(!a.includes(h.length)||h.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+h.length);const p=new Uint8Array(l);p.set(h,s?0:p.length-h.length),h=p}if(h.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+h.length);let g=s?Po(h):Jo(h);if(o&&(g=$t(g,t)),!f&&!u.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:h=>hp(u,h),cmov:(h,f,g)=>g?f:h});return Object.freeze(u)}function pp(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function gp(t){const e=pp(t);return e+Math.ceil(e/2)}function aC(t,e,s=!1){const n=t.length,r=pp(e),i=gp(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=s?Po(t):Jo(t),a=$t(o,e-pt)+pt;return s?vl(a,r):El(a,r)}const Tr=BigInt(0),Ln=BigInt(1);function ko(t,e){const s=e.negate();return t?s:e}function _a(t,e){const s=hp(t.Fp,e.map(n=>n.Z));return e.map((n,r)=>t.fromAffine(n.toAffine(s[r])))}function mp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ta(t,e){mp(t,e);const s=Math.ceil(e/t)+1,n=2**(t-1),r=2**t,i=xi(t),o=BigInt(t);return{windows:s,windowSize:n,mask:i,maxNumber:r,shiftBy:o}}function Xd(t,e,s){const{windowSize:n,mask:r,maxNumber:i,shiftBy:o}=s;let a=Number(t&r),c=t>>o;a>n&&(a-=i,c+=Ln);const l=e*n,d=l+Math.abs(a)-1,u=a===0,h=a<0,f=e%2!==0;return{nextN:c,offset:d,isZero:u,isNeg:h,isNegF:f,offsetF:l}}function cC(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((s,n)=>{if(!(s instanceof e))throw new Error("invalid point at index "+n)})}function lC(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((s,n)=>{if(!e.isValid(s))throw new Error("invalid scalar at index "+n)})}const xa=new WeakMap,wp=new WeakMap;function Oa(t){return wp.get(t)||1}function Zd(t){if(t!==Tr)throw new Error("invalid wNAF")}class dC{constructor(e,s){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=s}_unsafeLadder(e,s,n=this.ZERO){let r=e;for(;s>Tr;)s&Ln&&(n=n.add(r)),r=r.double(),s>>=Ln;return n}precomputeWindow(e,s){const{windows:n,windowSize:r}=Ta(s,this.bits),i=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let l=1;l<r;l++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,s,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let r=this.ZERO,i=this.BASE;const o=Ta(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:d,isNeg:u,isNegF:h,offsetF:f}=Xd(n,a,o);n=c,d?i=i.add(ko(h,s[f])):r=r.add(ko(u,s[l]))}return Zd(n),{p:r,f:i}}wNAFUnsafe(e,s,n,r=this.ZERO){const i=Ta(e,this.bits);for(let o=0;o<i.windows&&n!==Tr;o++){const{nextN:a,offset:c,isZero:l,isNeg:d}=Xd(n,o,i);if(n=a,!l){const u=s[c];r=r.add(d?u.negate():u)}}return Zd(n),r}getPrecomputes(e,s,n){let r=xa.get(s);return r||(r=this.precomputeWindow(s,e),e!==1&&(typeof n=="function"&&(r=n(r)),xa.set(s,r))),r}cached(e,s,n){const r=Oa(e);return this.wNAF(r,this.getPrecomputes(r,e,n),s)}unsafe(e,s,n,r){const i=Oa(e);return i===1?this._unsafeLadder(e,s,r):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),s,r)}createCache(e,s){mp(s,this.bits),wp.set(e,s),xa.delete(e)}hasCache(e){return Oa(e)!==1}}function uC(t,e,s,n){let r=e,i=t.ZERO,o=t.ZERO;for(;s>Tr||n>Tr;)s&Ln&&(i=i.add(r)),n&Ln&&(o=o.add(r)),r=r.double(),s>>=Ln,n>>=Ln;return{p1:i,p2:o}}function hC(t,e,s,n){cC(s,t),lC(n,e);const r=s.length,i=n.length;if(r!==i)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=rp(BigInt(r));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=xi(c),d=new Array(Number(l)+1).fill(o),u=Math.floor((e.BITS-1)/c)*c;let h=o;for(let f=u;f>=0;f-=c){d.fill(o);for(let p=0;p<i;p++){const w=n[p],b=Number(w>>BigInt(f)&l);d[b]=d[b].add(s[p])}let g=o;for(let p=d.length-1,w=o;p>0;p--)w=w.add(d[p]),g=g.add(w);if(h=h.add(g),f!==0)for(let p=0;p<c;p++)h=h.double()}return h}function Qd(t,e,s){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return iC(e),e}else return En(t,{isLE:s})}function fC(t,e,s={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Tr))throw new Error(`CURVE.${a} must be positive bigint`)}const r=Qd(e.p,s.Fp,n),i=Qd(e.n,s.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!r.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:r,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Ff("HashToScalar-");const qr=BigInt(0),ar=BigInt(1),Gi=BigInt(2);function pC(t){return Xo(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function gC(t){const e=pC(t),{P:s,type:n,adjustScalarBytes:r,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||Qn,l=a?255:448,d=a?32:56,u=BigInt(a?9:5),h=BigInt(a?121665:39081),f=a?Gi**BigInt(254):Gi**BigInt(447),g=a?BigInt(8)*Gi**BigInt(251)-ar:BigInt(4)*Gi**BigInt(445)-ar,p=f+g+ar,w=O=>$t(O,s),b=I(u);function I(O){return vl(w(O),d)}function v(O){const A=at("u coordinate",O,d);return a&&(A[31]&=127),w(Po(A))}function E(O){return Po(r(at("scalar",O,d)))}function _(O,A){const S=M(v(A),E(O));if(S===qr)throw new Error("invalid private or public key received");return I(S)}function R(O){return _(O,b)}function D(O,A,S){const y=w(O*(A-S));return A=w(A-y),S=w(S+y),{x_2:A,x_3:S}}function M(O,A){Ic("u",O,qr,s),Ic("scalar",A,f,p);const S=A,y=O;let C=ar,T=qr,$=O,N=ar,x=qr;for(let z=BigInt(l-1);z>=qr;z--){const ae=S>>z&ar;x^=ae,{x_2:C,x_3:$}=D(x,C,$),{x_2:T,x_3:N}=D(x,T,N),x=ae;const ne=C+T,Q=w(ne*ne),le=C-T,ie=w(le*le),Ie=Q-ie,ce=$+N,_e=$-N,ct=w(_e*ne),mt=w(ce*le),lt=ct+mt,Ft=ct-mt;$=w(lt*lt),N=w(y*w(Ft*Ft)),C=w(Q*ie),T=w(Ie*(Q+w(h*Ie)))}({x_2:C,x_3:$}=D(x,C,$)),{x_2:T,x_3:N}=D(x,T,N);const q=i(T);return w(C*q)}const P={secretKey:d,publicKey:d,seed:d},F=(O=c(d))=>(ds(O,P.seed),O);function W(O){const A=F(O);return{secretKey:A,publicKey:R(A)}}return{keygen:W,getSharedSecret:(O,A)=>_(O,A),getPublicKey:O=>R(O),scalarMult:_,scalarMultBase:R,utils:{randomSecretKey:F,randomPrivateKey:F},GuBytes:b.slice(),lengths:P}}const mC=BigInt(1),eu=BigInt(2),wC=BigInt(3),yC=BigInt(5);BigInt(8);const yp=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),bC={p:yp,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function EC(t){const e=BigInt(10),s=BigInt(20),n=BigInt(40),r=BigInt(80),i=yp,o=t*t%i*t%i,a=rs(o,eu,i)*o%i,c=rs(a,mC,i)*t%i,l=rs(c,yC,i)*c%i,d=rs(l,e,i)*l%i,u=rs(d,s,i)*d%i,h=rs(u,n,i)*u%i,f=rs(h,r,i)*h%i,g=rs(f,r,i)*h%i,p=rs(g,e,i)*l%i;return{pow_p_5_8:rs(p,eu,i)*t%i,b2:o}}function vC(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const CC=En(bC.p,{isLE:!0}),Nc=(()=>{const t=CC.ORDER;return gC({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:s,b2:n}=EC(e);return $t(rs(s,wC,t)*n,t)},adjustScalarBytes:vC})})(),tu=(t,e)=>(t+(t>=0?e:-e)/bp)/e;function AC(t,e,s){const[[n,r],[i,o]]=e,a=tu(o*t,s),c=tu(-r*t,s);let l=t-a*n-c*i,d=-a*r-c*o;const u=l<Ws,h=d<Ws;u&&(l=-l),h&&(d=-d);const f=xi(Math.ceil(rp(s)/2))+Er;if(l<Ws||l>=f||d<Ws||d>=f)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:u,k1:l,k2neg:h,k2:d}}function Sc(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Pa(t,e){const s={};for(let n of Object.keys(e))s[n]=t[n]===void 0?e[n]:t[n];return Oo(s.lowS,"lowS"),Oo(s.prehash,"prehash"),s.format!==void 0&&Sc(s.format),s}class IC extends Error{constructor(e=""){super(e)}}const Ms={Err:IC,_tlv:{encode:(t,e)=>{const{Err:s}=Ms;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length&1)throw new s("tlv.encode: unpadded data");const n=e.length/2,r=Vi(n);if(r.length/2&128)throw new s("tlv.encode: long form length too big");const i=n>127?Vi(r.length/2|128):"";return Vi(t)+i+r+e},decode(t,e){const{Err:s}=Ms;let n=0;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new s("tlv.decode: wrong tlv");const r=e[n++],i=!!(r&128);let o=0;if(!i)o=r;else{const c=r&127;if(!c)throw new s("tlv.decode(long): indefinite length not supported");if(c>4)throw new s("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new s("tlv.decode: length bytes not complete");if(l[0]===0)throw new s("tlv.decode(long): zero leftmost byte");for(const d of l)o=o<<8|d;if(n+=c,o<128)throw new s("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new s("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=Ms;if(t<Ws)throw new e("integer: negative integers are not allowed");let s=Vi(t);if(Number.parseInt(s[0],16)&8&&(s="00"+s),s.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return s},decode(t){const{Err:e}=Ms;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Jo(t)}},toSig(t){const{Err:e,_int:s,_tlv:n}=Ms,r=at("signature",t),{v:i,l:o}=n.decode(48,r);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:d}=n.decode(2,c);if(d.length)throw new e("invalid signature: left bytes after parsing");return{r:s.decode(a),s:s.decode(l)}},hexFromSig(t){const{_tlv:e,_int:s}=Ms,n=e.encode(2,s.encode(t.r)),r=e.encode(2,s.encode(t.s)),i=n+r;return e.encode(48,i)}},Ws=BigInt(0),Er=BigInt(1),bp=BigInt(2),Yi=BigInt(3),NC=BigInt(4);function pr(t,e){const{BYTES:s}=t;let n;if(typeof e=="bigint")n=e;else{let r=at("private key",e);try{n=t.fromBytes(r)}catch{throw new Error(`invalid private key: expected ui8a of size ${s}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function SC(t,e={}){const s=fC("weierstrass",t,e),{Fp:n,Fn:r}=s;let i=s.CURVE;const{h:o,n:a}=i;Xo(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=vp(n,r);function d(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function u(O,A,S){const{x:y,y:C}=A.toAffine(),T=n.toBytes(y);if(Oo(S,"isCompressed"),S){d();const $=!n.isOdd(C);return cn(Ep($),T)}else return cn(Uint8Array.of(4),T,n.toBytes(C))}function h(O){Dn(O,void 0,"Point");const{publicKey:A,publicKeyUncompressed:S}=l,y=O.length,C=O[0],T=O.subarray(1);if(y===A&&(C===2||C===3)){const $=n.fromBytes(T);if(!n.isValid($))throw new Error("bad point: is not on curve, wrong x");const N=p($);let x;try{x=n.sqrt(N)}catch(z){const ae=z instanceof Error?": "+z.message:"";throw new Error("bad point: is not on curve, sqrt error"+ae)}d();const q=n.isOdd(x);return(C&1)===1!==q&&(x=n.neg(x)),{x:$,y:x}}else if(y===S&&C===4){const $=n.BYTES,N=n.fromBytes(T.subarray(0,$)),x=n.fromBytes(T.subarray($,$*2));if(!w(N,x))throw new Error("bad point: is not on curve");return{x:N,y:x}}else throw new Error(`bad point: got length ${y}, expected compressed=${A} or uncompressed=${S}`)}const f=e.toBytes||u,g=e.fromBytes||h;function p(O){const A=n.sqr(O),S=n.mul(A,O);return n.add(n.add(S,n.mul(O,i.a)),i.b)}function w(O,A){const S=n.sqr(A),y=p(O);return n.eql(S,y)}if(!w(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const b=n.mul(n.pow(i.a,Yi),NC),I=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(b,I)))throw new Error("bad curve params: a or b");function v(O,A,S=!1){if(!n.isValid(A)||S&&n.is0(A))throw new Error(`bad point coordinate ${O}`);return A}function E(O){if(!(O instanceof P))throw new Error("ProjectivePoint expected")}function _(O){if(!c||!c.basises)throw new Error("no endo");return AC(O,c.basises,r.ORDER)}const R=Gd((O,A)=>{const{X:S,Y:y,Z:C}=O;if(n.eql(C,n.ONE))return{x:S,y};const T=O.is0();A==null&&(A=T?n.ONE:n.inv(C));const $=n.mul(S,A),N=n.mul(y,A),x=n.mul(C,A);if(T)return{x:n.ZERO,y:n.ZERO};if(!n.eql(x,n.ONE))throw new Error("invZ was invalid");return{x:$,y:N}}),D=Gd(O=>{if(O.is0()){if(e.allowInfinityPoint&&!n.is0(O.Y))return;throw new Error("bad point: ZERO")}const{x:A,y:S}=O.toAffine();if(!n.isValid(A)||!n.isValid(S))throw new Error("bad point: x or y not field elements");if(!w(A,S))throw new Error("bad point: equation left != right");if(!O.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function M(O,A,S,y,C){return S=new P(n.mul(S.X,O),S.Y,S.Z),A=ko(y,A),S=ko(C,S),A.add(S)}class P{constructor(A,S,y){this.X=v("x",A),this.Y=v("y",S,!0),this.Z=v("z",y),Object.freeze(this)}static CURVE(){return i}static fromAffine(A){const{x:S,y}=A||{};if(!A||!n.isValid(S)||!n.isValid(y))throw new Error("invalid affine point");if(A instanceof P)throw new Error("projective point not allowed");return n.is0(S)&&n.is0(y)?P.ZERO:new P(S,y,n.ONE)}static fromBytes(A){const S=P.fromAffine(g(Dn(A,void 0,"point")));return S.assertValidity(),S}static fromHex(A){return P.fromBytes(at("pointHex",A))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(A=8,S=!0){return W.createCache(this,A),S||this.multiply(Yi),this}assertValidity(){D(this)}hasEvenY(){const{y:A}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(A)}equals(A){E(A);const{X:S,Y:y,Z:C}=this,{X:T,Y:$,Z:N}=A,x=n.eql(n.mul(S,N),n.mul(T,C)),q=n.eql(n.mul(y,N),n.mul($,C));return x&&q}negate(){return new P(this.X,n.neg(this.Y),this.Z)}double(){const{a:A,b:S}=i,y=n.mul(S,Yi),{X:C,Y:T,Z:$}=this;let N=n.ZERO,x=n.ZERO,q=n.ZERO,z=n.mul(C,C),ae=n.mul(T,T),ne=n.mul($,$),Q=n.mul(C,T);return Q=n.add(Q,Q),q=n.mul(C,$),q=n.add(q,q),N=n.mul(A,q),x=n.mul(y,ne),x=n.add(N,x),N=n.sub(ae,x),x=n.add(ae,x),x=n.mul(N,x),N=n.mul(Q,N),q=n.mul(y,q),ne=n.mul(A,ne),Q=n.sub(z,ne),Q=n.mul(A,Q),Q=n.add(Q,q),q=n.add(z,z),z=n.add(q,z),z=n.add(z,ne),z=n.mul(z,Q),x=n.add(x,z),ne=n.mul(T,$),ne=n.add(ne,ne),z=n.mul(ne,Q),N=n.sub(N,z),q=n.mul(ne,ae),q=n.add(q,q),q=n.add(q,q),new P(N,x,q)}add(A){E(A);const{X:S,Y:y,Z:C}=this,{X:T,Y:$,Z:N}=A;let x=n.ZERO,q=n.ZERO,z=n.ZERO;const ae=i.a,ne=n.mul(i.b,Yi);let Q=n.mul(S,T),le=n.mul(y,$),ie=n.mul(C,N),Ie=n.add(S,y),ce=n.add(T,$);Ie=n.mul(Ie,ce),ce=n.add(Q,le),Ie=n.sub(Ie,ce),ce=n.add(S,C);let _e=n.add(T,N);return ce=n.mul(ce,_e),_e=n.add(Q,ie),ce=n.sub(ce,_e),_e=n.add(y,C),x=n.add($,N),_e=n.mul(_e,x),x=n.add(le,ie),_e=n.sub(_e,x),z=n.mul(ae,ce),x=n.mul(ne,ie),z=n.add(x,z),x=n.sub(le,z),z=n.add(le,z),q=n.mul(x,z),le=n.add(Q,Q),le=n.add(le,Q),ie=n.mul(ae,ie),ce=n.mul(ne,ce),le=n.add(le,ie),ie=n.sub(Q,ie),ie=n.mul(ae,ie),ce=n.add(ce,ie),Q=n.mul(le,ce),q=n.add(q,Q),Q=n.mul(_e,ce),x=n.mul(Ie,x),x=n.sub(x,Q),Q=n.mul(Ie,le),z=n.mul(_e,z),z=n.add(z,Q),new P(x,q,z)}subtract(A){return this.add(A.negate())}is0(){return this.equals(P.ZERO)}multiply(A){const{endo:S}=e;if(!r.isValidNot0(A))throw new Error("invalid scalar: out of range");let y,C;const T=$=>W.cached(this,$,N=>_a(P,N));if(S){const{k1neg:$,k1:N,k2neg:x,k2:q}=_(A),{p:z,f:ae}=T(N),{p:ne,f:Q}=T(q);C=ae.add(Q),y=M(S.beta,z,ne,$,x)}else{const{p:$,f:N}=T(A);y=$,C=N}return _a(P,[y,C])[0]}multiplyUnsafe(A){const{endo:S}=e,y=this;if(!r.isValid(A))throw new Error("invalid scalar: out of range");if(A===Ws||y.is0())return P.ZERO;if(A===Er)return y;if(W.hasCache(this))return this.multiply(A);if(S){const{k1neg:C,k1:T,k2neg:$,k2:N}=_(A),{p1:x,p2:q}=uC(P,y,T,N);return M(S.beta,x,q,C,$)}else return W.unsafe(y,A)}multiplyAndAddUnsafe(A,S,y){const C=this.multiplyUnsafe(S).add(A.multiplyUnsafe(y));return C.is0()?void 0:C}toAffine(A){return R(this,A)}isTorsionFree(){const{isTorsionFree:A}=e;return o===Er?!0:A?A(P,this):W.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:A}=e;return o===Er?this:A?A(P,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(A=!0){return Oo(A,"isCompressed"),this.assertValidity(),f(P,this,A)}toHex(A=!0){return br(this.toBytes(A))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(A=!0){return this.toBytes(A)}_setWindowSize(A){this.precompute(A)}static normalizeZ(A){return _a(P,A)}static msm(A,S){return hC(P,r,A,S)}static fromPrivateKey(A){return P.BASE.multiply(pr(r,A))}}P.BASE=new P(i.Gx,i.Gy,n.ONE),P.ZERO=new P(n.ZERO,n.ONE,n.ZERO),P.Fp=n,P.Fn=r;const F=r.BITS,W=new dC(P,e.endo?Math.ceil(F/2):F);return P.BASE.precompute(8),P}function Ep(t){return Uint8Array.of(t?2:3)}function vp(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function _C(t,e={}){const{Fn:s}=t,n=e.randomBytes||Qn,r=Object.assign(vp(t.Fp,s),{seed:gp(s.ORDER)});function i(h){try{return!!pr(s,h)}catch{return!1}}function o(h,f){const{publicKey:g,publicKeyUncompressed:p}=r;try{const w=h.length;return f===!0&&w!==g||f===!1&&w!==p?!1:!!t.fromBytes(h)}catch{return!1}}function a(h=n(r.seed)){return aC(Dn(h,r.seed,"seed"),s.ORDER)}function c(h,f=!0){return t.BASE.multiply(pr(s,h)).toBytes(f)}function l(h){const f=a(h);return{secretKey:f,publicKey:c(f)}}function d(h){if(typeof h=="bigint")return!1;if(h instanceof t)return!0;const{secretKey:f,publicKey:g,publicKeyUncompressed:p}=r;if(s.allowedLengths||f===g)return;const w=at("key",h).length;return w===g||w===p}function u(h,f,g=!0){if(d(h)===!0)throw new Error("first arg must be private key");if(d(f)===!1)throw new Error("second arg must be public key");const p=pr(s,h);return t.fromHex(f).multiply(p).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:u,keygen:l,Point:t,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:h=>pr(s,h),precompute(h=8,f=t.BASE){return f.precompute(h,!1)}},lengths:r})}function TC(t,e,s={}){Ho(e),Xo(s,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=s.randomBytes||Qn,r=s.hmac||((S,...y)=>Go(e,S,cn(...y))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:d,getSharedSecret:u,utils:h,lengths:f}=_C(t,s),g={prehash:!1,lowS:typeof s.lowS=="boolean"?s.lowS:!1,format:void 0,extraEntropy:!1},p="compact";function w(S){const y=a>>Er;return S>y}function b(S,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${S}: out of range 1..Point.Fn.ORDER`);return y}function I(S,y){Sc(y);const C=f.signature,T=y==="compact"?C:y==="recovered"?C+1:void 0;return Dn(S,T,`${y} signature`)}class v{constructor(y,C,T){this.r=b("r",y),this.s=b("s",C),T!=null&&(this.recovery=T),Object.freeze(this)}static fromBytes(y,C=p){I(y,C);let T;if(C==="der"){const{r:q,s:z}=Ms.toSig(Dn(y));return new v(q,z)}C==="recovered"&&(T=y[0],C="compact",y=y.subarray(1));const $=o.BYTES,N=y.subarray(0,$),x=y.subarray($,$*2);return new v(o.fromBytes(N),o.fromBytes(x),T)}static fromHex(y,C){return this.fromBytes(To(y),C)}addRecoveryBit(y){return new v(this.r,this.s,y)}recoverPublicKey(y){const C=i.ORDER,{r:T,s:$,recovery:N}=this;if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");if(a*bp<C&&N>1)throw new Error("recovery id is ambiguous for h>1 curve");const x=N===2||N===3?T+a:T;if(!i.isValid(x))throw new Error("recovery id 2 or 3 invalid");const q=i.toBytes(x),z=t.fromBytes(cn(Ep((N&1)===0),q)),ae=o.inv(x),ne=_(at("msgHash",y)),Q=o.create(-ne*ae),le=o.create($*ae),ie=t.BASE.multiplyUnsafe(Q).add(z.multiplyUnsafe(le));if(ie.is0())throw new Error("point at infinify");return ie.assertValidity(),ie}hasHighS(){return w(this.s)}toBytes(y=p){if(Sc(y),y==="der")return To(Ms.hexFromSig(this));const C=o.toBytes(this.r),T=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return cn(Uint8Array.of(this.recovery),C,T)}return cn(C,T)}toHex(y){return br(this.toBytes(y))}assertValidity(){}static fromCompact(y){return v.fromBytes(at("sig",y),"compact")}static fromDER(y){return v.fromBytes(at("sig",y),"der")}normalizeS(){return this.hasHighS()?new v(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return br(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return br(this.toBytes("compact"))}}const E=s.bits2int||function(S){if(S.length>8192)throw new Error("input is too large");const y=Jo(S),C=S.length*8-c;return C>0?y>>BigInt(C):y},_=s.bits2int_modN||function(S){return o.create(E(S))},R=xi(c);function D(S){return Ic("num < 2^"+c,S,Ws,R),o.toBytes(S)}function M(S,y){return Dn(S,void 0,"message"),y?Dn(e(S),void 0,"prehashed message"):S}function P(S,y,C){if(["recovered","canonical"].some(le=>le in C))throw new Error("sign() legacy options not supported");const{lowS:T,prehash:$,extraEntropy:N}=Pa(C,g);S=M(S,$);const x=_(S),q=pr(o,y),z=[D(q),D(x)];if(N!=null&&N!==!1){const le=N===!0?n(f.secretKey):N;z.push(at("extraEntropy",le))}const ae=cn(...z),ne=x;function Q(le){const ie=E(le);if(!o.isValidNot0(ie))return;const Ie=o.inv(ie),ce=t.BASE.multiply(ie).toAffine(),_e=o.create(ce.x);if(_e===Ws)return;const ct=o.create(Ie*o.create(ne+_e*q));if(ct===Ws)return;let mt=(ce.x===_e?0:2)|Number(ce.y&Er),lt=ct;return T&&w(ct)&&(lt=o.neg(ct),mt^=1),new v(_e,lt,mt)}return{seed:ae,k2sig:Q}}function F(S,y,C={}){S=at("message",S);const{seed:T,k2sig:$}=P(S,y,C);return Zv(e.outputLen,o.BYTES,r)(T,$)}function W(S){let y;const C=typeof S=="string"||Wo(S),T=!C&&S!==null&&typeof S=="object"&&typeof S.r=="bigint"&&typeof S.s=="bigint";if(!C&&!T)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(T)y=new v(S.r,S.s);else if(C){try{y=v.fromBytes(at("sig",S),"der")}catch($){if(!($ instanceof Ms.Err))throw $}if(!y)try{y=v.fromBytes(at("sig",S),"compact")}catch{return!1}}return y||!1}function O(S,y,C,T={}){const{lowS:$,prehash:N,format:x}=Pa(T,g);if(C=at("publicKey",C),y=M(at("message",y),N),"strict"in T)throw new Error("options.strict was renamed to lowS");const q=x===void 0?W(S):v.fromBytes(at("sig",S),x);if(q===!1)return!1;try{const z=t.fromBytes(C);if($&&q.hasHighS())return!1;const{r:ae,s:ne}=q,Q=_(y),le=o.inv(ne),ie=o.create(Q*le),Ie=o.create(ae*le),ce=t.BASE.multiplyUnsafe(ie).add(z.multiplyUnsafe(Ie));return ce.is0()?!1:o.create(ce.x)===ae}catch{return!1}}function A(S,y,C={}){const{prehash:T}=Pa(C,g);return y=M(y,T),v.fromBytes(S,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:l,getPublicKey:d,getSharedSecret:u,utils:h,lengths:f,Point:t,sign:F,verify:O,recoverPublicKey:A,Signature:v,hash:e})}function xC(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},s=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const r=En(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),i={Fp:s,Fn:r,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function OC(t){const{CURVE:e,curveOpts:s}=xC(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:s,hash:t.hash,ecdsaOpts:n}}function PC(t,e){const s=e.Point;return Object.assign({},e,{ProjectivePoint:s,CURVE:Object.assign({},t,fp(s.Fn.ORDER,s.Fn.BITS))})}function kC(t){const{CURVE:e,curveOpts:s,hash:n,ecdsaOpts:r}=OC(t),i=SC(e,s),o=TC(i,n,r);return PC(t,o)}function _c(t,e){const s=n=>kC({...t,hash:n});return{...s(e),create:s}}const Cp={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Ap={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Ip={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},RC=En(Cp.p),UC=En(Ap.p),$C=En(Ip.p),DC=_c({...Cp,Fp:RC,lowS:!1},Ko);_c({...Ap,Fp:UC,lowS:!1},jE),_c({...Ip,Fp:$C,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},FE);const BC=DC,Np="base10",gt="base16",It="base64pad",ln="base64url",Oi="utf8",Sp=0,zs=1,Pi=2,LC=0,su=1,ri=12,Al=32;function MC(){const t=Nc.utils.randomPrivateKey(),e=Nc.getPublicKey(t);return{privateKey:_t(t,gt),publicKey:_t(e,gt)}}function Tc(){const t=Qn(Al);return _t(t,gt)}function FC(t,e){const s=Nc.getSharedSecret(Xt(t,gt),Xt(e,gt)),n=Jv(Yo,s,void 0,void 0,Al);return _t(n,gt)}function uo(t){const e=Yo(Xt(t,gt));return _t(e,gt)}function Yt(t){const e=Yo(Xt(t,Oi));return _t(e,gt)}function _p(t){return Xt(`${t}`,Np)}function Vn(t){return Number(_t(t,Np))}function Tp(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function xp(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),s=(4-e.length%4)%4;return e+"=".repeat(s)}function jC(t){const e=_p(typeof t.type<"u"?t.type:Sp);if(Vn(e)===zs&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const s=typeof t.senderPublicKey<"u"?Xt(t.senderPublicKey,gt):void 0,n=typeof t.iv<"u"?Xt(t.iv,gt):Qn(ri),r=Xt(t.symKey,gt),i=tp(r,n).encrypt(Xt(t.message,Oi)),o=Op({type:e,sealed:i,iv:n,senderPublicKey:s});return t.encoding===ln?Tp(o):o}function qC(t){const e=Xt(t.symKey,gt),{sealed:s,iv:n}=yi({encoded:t.encoded,encoding:t.encoding}),r=tp(e,n).decrypt(s);if(r===null)throw new Error("Failed to decrypt");return _t(r,Oi)}function WC(t,e){const s=_p(Pi),n=Qn(ri),r=Xt(t,Oi),i=Op({type:s,sealed:r,iv:n});return e===ln?Tp(i):i}function HC(t,e){const{sealed:s}=yi({encoded:t,encoding:e});return _t(s,Oi)}function Op(t){if(Vn(t.type)===Pi)return _t(ei([t.type,t.sealed]),It);if(Vn(t.type)===zs){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return _t(ei([t.type,t.senderPublicKey,t.iv,t.sealed]),It)}return _t(ei([t.type,t.iv,t.sealed]),It)}function yi(t){const e=(t.encoding||It)===ln?xp(t.encoded):t.encoded,s=Xt(e,It),n=s.slice(LC,su),r=su;if(Vn(n)===zs){const c=r+Al,l=c+ri,d=s.slice(r,c),u=s.slice(c,l),h=s.slice(l);return{type:n,sealed:h,iv:u,senderPublicKey:d}}if(Vn(n)===Pi){const c=s.slice(r),l=Qn(ri);return{type:n,sealed:c,iv:l}}const i=r+ri,o=s.slice(r,i),a=s.slice(i);return{type:n,sealed:a,iv:o}}function zC(t,e){const s=yi({encoded:t,encoding:e==null?void 0:e.encoding});return Pp({type:Vn(s.type),senderPublicKey:typeof s.senderPublicKey<"u"?_t(s.senderPublicKey,gt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Pp(t){const e=(t==null?void 0:t.type)||Sp;if(e===zs){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function nu(t){return t.type===zs&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function ru(t){return t.type===Pi}function KC(t){const e=Buffer.from(t.x,"base64"),s=Buffer.from(t.y,"base64");return ei([new Uint8Array([4]),e,s])}function VC(t,e){const[s,n,r]=t.split("."),i=Buffer.from(xp(r),"base64");if(i.length!==64)throw new Error("Invalid signature length");const o=i.slice(0,32),a=i.slice(32,64),c=`${s}.${n}`,l=Yo(c),d=KC(e);if(!BC.verify(ei([o,a]),l,d))throw new Error("Invalid signature");return Za(t).payload}const GC="irn";function Ro(t){return(t==null?void 0:t.relay)||{protocol:GC}}function gr(t){const e=Og[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var YC=Object.defineProperty,JC=Object.defineProperties,XC=Object.getOwnPropertyDescriptors,iu=Object.getOwnPropertySymbols,ZC=Object.prototype.hasOwnProperty,QC=Object.prototype.propertyIsEnumerable,ou=(t,e,s)=>e in t?YC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ka=(t,e)=>{for(var s in e||(e={}))ZC.call(e,s)&&ou(t,s,e[s]);if(iu)for(var s of iu(e))QC.call(e,s)&&ou(t,s,e[s]);return t},e1=(t,e)=>JC(t,XC(e));function t1(t,e="-"){const s={},n="relay"+e;return Object.keys(t).forEach(r=>{if(r.startsWith(n)){const i=r.replace(n,""),o=t[r];s[i]=o}}),s}function au(t){if(!t.includes("wc:")){const l=Uf(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),s=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),r=t.substring(e+1,s).split("@"),i=typeof s<"u"?t.substring(s):"",o=new URLSearchParams(i),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:s1(r[0]),version:parseInt(r[1],10),symKey:a.symKey,relay:t1(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function s1(t){return t.startsWith("//")?t.substring(2):t}function n1(t,e="-"){const s="relay",n={};return Object.keys(t).forEach(r=>{const i=r,o=s+e+i;t[i]&&(n[o]=t[i])}),n}function cu(t){const e=new URLSearchParams,s=ka(ka(e1(ka({},n1(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(s).sort(([n],[r])=>n.localeCompare(r)).forEach(([n,r])=>{r!==void 0&&e.append(n,String(r))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function Ji(t,e,s){return`${t}?wc_ev=${s}&topic=${e}`}var r1=Object.defineProperty,i1=Object.defineProperties,o1=Object.getOwnPropertyDescriptors,lu=Object.getOwnPropertySymbols,a1=Object.prototype.hasOwnProperty,c1=Object.prototype.propertyIsEnumerable,du=(t,e,s)=>e in t?r1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,l1=(t,e)=>{for(var s in e||(e={}))a1.call(e,s)&&du(t,s,e[s]);if(lu)for(var s of lu(e))c1.call(e,s)&&du(t,s,e[s]);return t},d1=(t,e)=>i1(t,o1(e));function $r(t){const e=[];return t.forEach(s=>{const[n,r]=s.split(":");e.push(`${n}:${r}`)}),e}function kp(t){const e=[];return Object.values(t).forEach(s=>{e.push(...$r(s.accounts))}),[...new Set(e)]}function u1(t){const e=[];return Object.values(t).forEach(s=>{e.push(...s.methods)}),[...new Set(e)]}function h1(t){const e=[];return Object.values(t).forEach(s=>{e.push(...s.events)}),[...new Set(e)]}function f1(t,e){const s=[];return Object.values(t).forEach(n=>{$r(n.accounts).includes(e)&&s.push(...n.methods)}),s}function p1(t,e){const s=[];return Object.values(t).forEach(n=>{$r(n.accounts).includes(e)&&s.push(...n.events)}),s}function Zo(t){return t.includes(":")}function mr(t){return Zo(t)?t.split(":")[0]:t}function uu(t){var e,s,n;const r={};if(!Ns(t))return r;for(const[i,o]of Object.entries(t)){const a=Zo(i)?[i]:o.chains,c=o.methods||[],l=o.events||[],d=mr(i);r[d]=d1(l1({},r[d]),{chains:Is(a,(e=r[d])==null?void 0:e.chains),methods:Is(c,(s=r[d])==null?void 0:s.methods),events:Is(l,(n=r[d])==null?void 0:n.events)})}return r}function g1(t){const e={};return t==null||t.forEach(s=>{var n;const[r,i]=s.split(":");e[r]||(e[r]={accounts:[],chains:[],events:[],methods:[]}),e[r].accounts.push(s),(n=e[r].chains)==null||n.push(`${r}:${i}`)}),e}function hu(t,e){e=e.map(n=>n.replace("did:pkh:",""));const s=g1(e);for(const[n,r]of Object.entries(s))r.methods?r.methods=Is(r.methods,t):r.methods=t,r.events=["chainChanged","accountsChanged"];return s}function m1(t,e){var s,n,r,i,o,a;const c=uu(t),l=uu(e),d={},u=Object.keys(c).concat(Object.keys(l));for(const h of u)d[h]={chains:Is((s=c[h])==null?void 0:s.chains,(n=l[h])==null?void 0:n.chains),methods:Is((r=c[h])==null?void 0:r.methods,(i=l[h])==null?void 0:i.methods),events:Is((o=c[h])==null?void 0:o.events,(a=l[h])==null?void 0:a.events)};return d}const w1={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},y1={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function K(t,e){const{message:s,code:n}=y1[t];return{message:e?`${s} ${e}`:s,code:n}}function Ue(t,e){const{message:s,code:n}=w1[t];return{message:e?`${s} ${e}`:s,code:n}}function Ks(t,e){return!!Array.isArray(t)}function Ns(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ve(t){return typeof t>"u"}function Fe(t,e){return e&&Ve(t)?!0:typeof t=="string"&&!!t.trim().length}function Il(t,e){return typeof t=="number"&&!isNaN(t)}function b1(t,e){const{requiredNamespaces:s}=e,n=Object.keys(t.namespaces),r=Object.keys(s);let i=!0;return $n(r,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],d=$r(a),u=s[o];(!$n(xf(o,u),d)||!$n(u.methods,c)||!$n(u.events,l))&&(i=!1)}),i):!1}function Uo(t){return Fe(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function E1(t){if(Fe(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const s=e[0]+":"+e[1];return!!e[2]&&Uo(s)}}return!1}function v1(t){function e(s){try{return typeof new URL(s)<"u"}catch{return!1}}try{if(Fe(t,!1)){if(e(t))return!0;const s=Uf(t);return e(s)}}catch{}return!1}function C1(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function A1(t){return t==null?void 0:t.topic}function I1(t,e){let s=null;return Fe(t==null?void 0:t.publicKey,!1)||(s=K("MISSING_OR_INVALID",`${e} controller public key should be a string`)),s}function fu(t){let e=!0;return Ks(t)?t.length&&(e=t.every(s=>Fe(s,!1))):e=!1,e}function N1(t,e,s){let n=null;return Ks(e)&&e.length?e.forEach(r=>{n||Uo(r)||(n=Ue("UNSUPPORTED_CHAINS",`${s}, chain ${r} should be a string and conform to "namespace:chainId" format`))}):Uo(t)||(n=Ue("UNSUPPORTED_CHAINS",`${s}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function S1(t,e,s){let n=null;return Object.entries(t).forEach(([r,i])=>{if(n)return;const o=N1(r,xf(r,i),`${e} ${s}`);o&&(n=o)}),n}function _1(t,e){let s=null;return Ks(t)?t.forEach(n=>{s||E1(n)||(s=Ue("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):s=Ue("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s}function T1(t,e){let s=null;return Object.values(t).forEach(n=>{if(s)return;const r=_1(n==null?void 0:n.accounts,`${e} namespace`);r&&(s=r)}),s}function x1(t,e){let s=null;return fu(t==null?void 0:t.methods)?fu(t==null?void 0:t.events)||(s=Ue("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):s=Ue("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),s}function Rp(t,e){let s=null;return Object.values(t).forEach(n=>{if(s)return;const r=x1(n,`${e}, namespace`);r&&(s=r)}),s}function O1(t,e,s){let n=null;if(t&&Ns(t)){const r=Rp(t,e);r&&(n=r);const i=S1(t,e,s);i&&(n=i)}else n=K("MISSING_OR_INVALID",`${e}, ${s} should be an object with data`);return n}function Ra(t,e){let s=null;if(t&&Ns(t)){const n=Rp(t,e);n&&(s=n);const r=T1(t,e);r&&(s=r)}else s=K("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return s}function Up(t){return Fe(t.protocol,!0)}function P1(t,e){let s=!1;return t?t&&Ks(t)&&t.length&&t.forEach(n=>{s=Up(n)}):s=!0,s}function k1(t){return typeof t=="number"}function vt(t){return typeof t<"u"&&typeof t!==null}function R1(t){return!(!t||typeof t!="object"||!t.code||!Il(t.code)||!t.message||!Fe(t.message,!1))}function U1(t){return!(Ve(t)||!Fe(t.method,!1))}function $1(t){return!(Ve(t)||Ve(t.result)&&Ve(t.error)||!Il(t.id)||!Fe(t.jsonrpc,!1))}function D1(t){return!(Ve(t)||!Fe(t.name,!1))}function pu(t,e){return!(!Uo(e)||!kp(t).includes(e))}function B1(t,e,s){return Fe(s,!1)?f1(t,e).includes(s):!1}function L1(t,e,s){return Fe(s,!1)?p1(t,e).includes(s):!1}function gu(t,e,s){let n=null;const r=M1(t),i=F1(e),o=Object.keys(r),a=Object.keys(i),c=mu(Object.keys(t)),l=mu(Object.keys(e)),d=c.filter(u=>!l.includes(u));return d.length&&(n=K("NON_CONFORMING_NAMESPACES",`${s} namespaces keys don't satisfy requiredNamespaces.
      Required: ${d.toString()}
      Received: ${Object.keys(e).toString()}`)),$n(o,a)||(n=K("NON_CONFORMING_NAMESPACES",`${s} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(u=>{if(!u.includes(":")||n)return;const h=$r(e[u].accounts);h.includes(u)||(n=K("NON_CONFORMING_NAMESPACES",`${s} namespaces accounts don't satisfy namespace accounts for ${u}
        Required: ${u}
        Approved: ${h.toString()}`))}),o.forEach(u=>{n||($n(r[u].methods,i[u].methods)?$n(r[u].events,i[u].events)||(n=K("NON_CONFORMING_NAMESPACES",`${s} namespaces events don't satisfy namespace events for ${u}`)):n=K("NON_CONFORMING_NAMESPACES",`${s} namespaces methods don't satisfy namespace methods for ${u}`))}),n}function M1(t){const e={};return Object.keys(t).forEach(s=>{var n;s.includes(":")?e[s]=t[s]:(n=t[s].chains)==null||n.forEach(r=>{e[r]={methods:t[s].methods,events:t[s].events}})}),e}function mu(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function F1(t){const e={};return Object.keys(t).forEach(s=>{if(s.includes(":"))e[s]=t[s];else{const n=$r(t[s].accounts);n==null||n.forEach(r=>{e[r]={accounts:t[s].accounts.filter(i=>i.includes(`${r}:`)),methods:t[s].methods,events:t[s].events}})}}),e}function j1(t,e){return Il(t)&&t<=e.max&&t>=e.min}function wu(){const t=_i();return new Promise(e=>{switch(t){case Bt.browser:e(q1());break;case Bt.reactNative:e(W1());break;case Bt.node:e(H1());break;default:e(!0)}})}function q1(){return Ur()&&(navigator==null?void 0:navigator.onLine)}async function W1(){if(bn()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function H1(){return!0}function z1(t){switch(_i()){case Bt.browser:K1(t);break;case Bt.reactNative:V1(t);break}}function K1(t){!bn()&&Ur()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function V1(t){bn()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function G1(){var t;return Ur()&&Ir()?((t=Ir())==null?void 0:t.visibilityState)==="visible":!0}const Ua={};class Wr{static get(e){return Ua[e]}static set(e,s){Ua[e]=s}static delete(e){delete Ua[e]}}function Y1(t){const e=Rr.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function J1({publicKey:t,signature:e,payload:s}){var n;const r=xc(s.method),i=128|parseInt(((n=s.version)==null?void 0:n.toString())||"4"),o=Q1(s.address),a=s.era==="00"?new Uint8Array([0]):xc(s.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(s.nonce,16),l=new Uint8Array([c&255,c>>8&255]),d=BigInt(`0x${Z1(s.tip)}`),u=tA(d),h=new Uint8Array([0,...t,o,...e,...a,...l,...u,...r]),f=eA(h.length+1);return new Uint8Array([...f,i,...h])}function X1(t){const e=xc(t),s=Ug.blake2b(e,void 0,32);return"0x"+Buffer.from(s).toString("hex")}function xc(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function Z1(t){return t.startsWith("0x")?t.slice(2):t}function Q1(t){const e=Rr.decode(t)[0];return e===42?0:e===60?2:1}function eA(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function tA(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function sA(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),s=Y1(t.transaction.address),n=J1({publicKey:s,signature:e,payload:t.transaction}),r=Buffer.from(n).toString("hex");return X1(r)}function Nl({logger:t,name:e}){const s=typeof t=="string"?Xc({opts:{level:t,name:e}}).logger:t;return s.level=typeof t=="string"?t:t.level,s}var nA={};const $p="wc",Dp=2,Oc="core",Ss=`${$p}@2:${Oc}:`,rA={logger:"error"},iA={database:":memory:"},oA="crypto",yu="client_ed25519_seed",aA=V.ONE_DAY,cA="keychain",lA="0.3",dA="messages",uA="0.3",hA=V.SIX_HOURS,fA="publisher",Bp="irn",pA="error",Lp="wss://relay.walletconnect.org",gA="relayer",Me={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},mA="_subscription",Wt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},wA=.1,Pc="2.23.2",Pe={link_mode:"link_mode",relay:"relay"},ho={inbound:"inbound",outbound:"outbound"},yA="0.3",bA="WALLETCONNECT_CLIENT_ID",bu="WALLETCONNECT_LINK_MODE_APPS",kt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},EA="subscription",vA="0.3",CA="pairing",AA="0.3",Hr={wc_pairingDelete:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:V.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:V.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:V.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:V.ONE_DAY,prompt:!1,tag:0},res:{ttl:V.ONE_DAY,prompt:!1,tag:0}}},On={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ss={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},IA="history",NA="0.3",SA="expirer",Vt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},_A="0.3",TA="verify-api",xA="https://verify.walletconnect.com",Mp="https://verify.walletconnect.org",ii=Mp,OA=`${ii}/v3`,PA=[xA,Mp],kA="echo",RA="https://echo.walletconnect.com",ms={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Rs={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},ns={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},In={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Nn={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},zr={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},UA=.1,$A="event-client",DA=86400,BA="https://pulse.walletconnect.org/batch";function LA(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),n=0;n<s.length;n++)s[n]=255;for(var r=0;r<t.length;r++){var i=t.charAt(r),o=i.charCodeAt(0);if(s[o]!==255)throw new TypeError(i+" is ambiguous");s[o]=r}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function u(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var p=0,w=0,b=0,I=g.length;b!==I&&g[b]===0;)b++,p++;for(var v=(I-b)*d+1>>>0,E=new Uint8Array(v);b!==I;){for(var _=g[b],R=0,D=v-1;(_!==0||R<w)&&D!==-1;D--,R++)_+=256*E[D]>>>0,E[D]=_%a>>>0,_=_/a>>>0;if(_!==0)throw new Error("Non-zero carry");w=R,b++}for(var M=v-w;M!==v&&E[M]===0;)M++;for(var P=c.repeat(p);M<v;++M)P+=t.charAt(E[M]);return P}function h(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var p=0;if(g[p]!==" "){for(var w=0,b=0;g[p]===c;)w++,p++;for(var I=(g.length-p)*l+1>>>0,v=new Uint8Array(I);g[p];){var E=s[g.charCodeAt(p)];if(E===255)return;for(var _=0,R=I-1;(E!==0||_<b)&&R!==-1;R--,_++)E+=a*v[R]>>>0,v[R]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");b=_,p++}if(g[p]!==" "){for(var D=I-b;D!==I&&v[D]===0;)D++;for(var M=new Uint8Array(w+(I-D)),P=w;D!==I;)M[P++]=v[D++];return M}}}function f(g){var p=h(g);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:h,decode:f}}var MA=LA,FA=MA;const Fp=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},jA=t=>new TextEncoder().encode(t),qA=t=>new TextDecoder().decode(t);class WA{constructor(e,s,n){this.name=e,this.prefix=s,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class HA{constructor(e,s,n){if(this.name=e,this.prefix=s,s.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return jp(this,e)}}class zA{constructor(e){this.decoders=e}or(e){return jp(this,e)}decode(e){const s=e[0],n=this.decoders[s];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const jp=(t,e)=>new zA({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class KA{constructor(e,s,n,r){this.name=e,this.prefix=s,this.baseEncode=n,this.baseDecode=r,this.encoder=new WA(e,s,n),this.decoder=new HA(e,s,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Qo=({name:t,prefix:e,encode:s,decode:n})=>new KA(t,e,s,n),ki=({prefix:t,name:e,alphabet:s})=>{const{encode:n,decode:r}=FA(s,e);return Qo({prefix:t,name:e,encode:n,decode:i=>Fp(r(i))})},VA=(t,e,s,n)=>{const r={};for(let d=0;d<e.length;++d)r[e[d]]=d;let i=t.length;for(;t[i-1]==="=";)--i;const o=new Uint8Array(i*s/8|0);let a=0,c=0,l=0;for(let d=0;d<i;++d){const u=r[t[d]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<s|u,a+=s,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=s||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},GA=(t,e,s)=>{const n=e[e.length-1]==="=",r=(1<<s)-1;let i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>s;)o-=s,i+=e[r&a>>o];if(o&&(i+=e[r&a<<s-o]),n)for(;i.length*s&7;)i+="=";return i},st=({name:t,prefix:e,bitsPerChar:s,alphabet:n})=>Qo({prefix:e,name:t,encode(r){return GA(r,n,s)},decode(r){return VA(r,n,s,t)}}),YA=Qo({prefix:"\0",name:"identity",encode:t=>qA(t),decode:t=>jA(t)});var JA=Object.freeze({__proto__:null,identity:YA});const XA=st({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ZA=Object.freeze({__proto__:null,base2:XA});const QA=st({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var eI=Object.freeze({__proto__:null,base8:QA});const tI=ki({prefix:"9",name:"base10",alphabet:"0123456789"});var sI=Object.freeze({__proto__:null,base10:tI});const nI=st({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),rI=st({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var iI=Object.freeze({__proto__:null,base16:nI,base16upper:rI});const oI=st({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),aI=st({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),cI=st({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),lI=st({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),dI=st({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),uI=st({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),hI=st({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),fI=st({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),pI=st({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var gI=Object.freeze({__proto__:null,base32:oI,base32upper:aI,base32pad:cI,base32padupper:lI,base32hex:dI,base32hexupper:uI,base32hexpad:hI,base32hexpadupper:fI,base32z:pI});const mI=ki({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),wI=ki({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var yI=Object.freeze({__proto__:null,base36:mI,base36upper:wI});const bI=ki({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),EI=ki({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var vI=Object.freeze({__proto__:null,base58btc:bI,base58flickr:EI});const CI=st({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),AI=st({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),II=st({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),NI=st({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var SI=Object.freeze({__proto__:null,base64:CI,base64pad:AI,base64url:II,base64urlpad:NI});const qp=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),_I=qp.reduce((t,e,s)=>(t[s]=e,t),[]),TI=qp.reduce((t,e,s)=>(t[e.codePointAt(0)]=s,t),[]);function xI(t){return t.reduce((e,s)=>(e+=_I[s],e),"")}function OI(t){const e=[];for(const s of t){const n=TI[s.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${s}`);e.push(n)}return new Uint8Array(e)}const PI=Qo({prefix:"ðŸš€",name:"base256emoji",encode:xI,decode:OI});var kI=Object.freeze({__proto__:null,base256emoji:PI}),RI=Wp,Eu=128,UI=-128,$I=Math.pow(2,31);function Wp(t,e,s){e=e||[],s=s||0;for(var n=s;t>=$I;)e[s++]=t&255|Eu,t/=128;for(;t&UI;)e[s++]=t&255|Eu,t>>>=7;return e[s]=t|0,Wp.bytes=s-n+1,e}var DI=kc,BI=128,vu=127;function kc(t,n){var s=0,n=n||0,r=0,i=n,o,a=t.length;do{if(i>=a)throw kc.bytes=0,new RangeError("Could not decode varint");o=t[i++],s+=r<28?(o&vu)<<r:(o&vu)*Math.pow(2,r),r+=7}while(o>=BI);return kc.bytes=i-n,s}var LI=Math.pow(2,7),MI=Math.pow(2,14),FI=Math.pow(2,21),jI=Math.pow(2,28),qI=Math.pow(2,35),WI=Math.pow(2,42),HI=Math.pow(2,49),zI=Math.pow(2,56),KI=Math.pow(2,63),VI=function(t){return t<LI?1:t<MI?2:t<FI?3:t<jI?4:t<qI?5:t<WI?6:t<HI?7:t<zI?8:t<KI?9:10},GI={encode:RI,decode:DI,encodingLength:VI},Hp=GI;const Cu=(t,e,s=0)=>(Hp.encode(t,e,s),e),Au=t=>Hp.encodingLength(t),Rc=(t,e)=>{const s=e.byteLength,n=Au(t),r=n+Au(s),i=new Uint8Array(r+s);return Cu(t,i,0),Cu(s,i,n),i.set(e,r),new YI(t,s,e,i)};class YI{constructor(e,s,n,r){this.code=e,this.size=s,this.digest=n,this.bytes=r}}const zp=({name:t,code:e,encode:s})=>new JI(t,e,s);class JI{constructor(e,s,n){this.name=e,this.code=s,this.encode=n}digest(e){if(e instanceof Uint8Array){const s=this.encode(e);return s instanceof Uint8Array?Rc(this.code,s):s.then(n=>Rc(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Kp=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),XI=zp({name:"sha2-256",code:18,encode:Kp("SHA-256")}),ZI=zp({name:"sha2-512",code:19,encode:Kp("SHA-512")});var QI=Object.freeze({__proto__:null,sha256:XI,sha512:ZI});const Vp=0,eN="identity",Gp=Fp,tN=t=>Rc(Vp,Gp(t)),sN={code:Vp,name:eN,encode:Gp,digest:tN};var nN=Object.freeze({__proto__:null,identity:sN});new TextEncoder,new TextDecoder;const Iu={...JA,...ZA,...eI,...sI,...iI,...gI,...yI,...vI,...SI,...kI};({...QI,...nN});function Yp(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function rN(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Yp(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Jp(t,e,s,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:s},decoder:{decode:n}}}const Nu=Jp("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),$a=Jp("ascii","a",t=>{let e="a";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},t=>{t=t.substring(1);const e=rN(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}),iN={utf8:Nu,"utf-8":Nu,hex:Iu.base16,latin1:$a,ascii:$a,binary:$a,...Iu};function oN(t,e="utf8"){const s=iN[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Yp(globalThis.Buffer.from(t,"utf-8")):s.decoder.decode(`${s.prefix}${t}`)}var aN=Object.defineProperty,cN=(t,e,s)=>e in t?aN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ps=(t,e,s)=>cN(t,typeof e!="symbol"?e+"":e,s);class lN{constructor(e,s){this.core=e,this.logger=s,ps(this,"keychain",new Map),ps(this,"name",cA),ps(this,"version",lA),ps(this,"initialized",!1),ps(this,"storagePrefix",Ss),ps(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),ps(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),ps(this,"set",async(n,r)=>{this.isInitialized(),this.keychain.set(n,r),await this.persist()}),ps(this,"get",n=>{this.isInitialized();const r=this.keychain.get(n);if(typeof r>"u"){const{message:i}=K("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(i)}return r}),ps(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Lt(s,this.name)}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,mc(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?wc(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var dN=Object.defineProperty,uN=(t,e,s)=>e in t?dN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,We=(t,e,s)=>uN(t,typeof e!="symbol"?e+"":e,s);class hN{constructor(e,s,n){this.core=e,this.logger=s,We(this,"name",oA),We(this,"keychain"),We(this,"randomSessionIdentifier",Tc()),We(this,"initialized",!1),We(this,"clientId"),We(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),We(this,"hasKeys",r=>(this.isInitialized(),this.keychain.has(r))),We(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const r=await this.getClientSeed(),i=Dl(r),o=Bg(i.publicKey);return this.clientId=o,o}),We(this,"generateKeyPair",()=>{this.isInitialized();const r=MC();return this.setPrivateKey(r.publicKey,r.privateKey)}),We(this,"signJWT",async r=>{this.isInitialized();const i=await this.getClientSeed(),o=Dl(i),a=this.randomSessionIdentifier;return await Lg(a,r,aA,o)}),We(this,"generateSharedKey",(r,i,o)=>{this.isInitialized();const a=this.getPrivateKey(r),c=FC(a,i);return this.setSymKey(c,o)}),We(this,"setSymKey",async(r,i)=>{this.isInitialized();const o=i||uo(r);return await this.keychain.set(o,r),o}),We(this,"deleteKeyPair",async r=>{this.isInitialized(),await this.keychain.del(r)}),We(this,"deleteSymKey",async r=>{this.isInitialized(),await this.keychain.del(r)}),We(this,"encode",async(r,i,o)=>{this.isInitialized();const a=Pp(o),c=Jc(i);if(ru(a))return WC(c,o==null?void 0:o.encoding);if(nu(a)){const h=a.senderPublicKey,f=a.receiverPublicKey;r=await this.generateSharedKey(h,f)}const l=this.getSymKey(r),{type:d,senderPublicKey:u}=a;return jC({type:d,symKey:l,message:c,senderPublicKey:u,encoding:o==null?void 0:o.encoding})}),We(this,"decode",async(r,i,o)=>{this.isInitialized();const a=zC(i,o);if(ru(a)){const c=HC(i,o==null?void 0:o.encoding);return wo(c)}if(nu(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;r=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(r),l=qC({symKey:c,encoded:i,encoding:o==null?void 0:o.encoding});return wo(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${r}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),We(this,"getPayloadType",(r,i=It)=>{const o=yi({encoded:r,encoding:i});return Vn(o.type)}),We(this,"getPayloadSenderPublicKey",(r,i=It)=>{const o=yi({encoded:r,encoding:i});return o.senderPublicKey?_t(o.senderPublicKey,gt):void 0}),this.core=e,this.logger=Lt(s,this.name),this.keychain=n||new lN(this.core,this.logger)}get context(){return Mt(this.logger)}async setPrivateKey(e,s){return await this.keychain.set(e,s),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(yu)}catch{e=Tc(),await this.keychain.set(yu,e)}return oN(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var fN=Object.defineProperty,pN=Object.defineProperties,gN=Object.getOwnPropertyDescriptors,Su=Object.getOwnPropertySymbols,mN=Object.prototype.hasOwnProperty,wN=Object.prototype.propertyIsEnumerable,Uc=(t,e,s)=>e in t?fN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,yN=(t,e)=>{for(var s in e||(e={}))mN.call(e,s)&&Uc(t,s,e[s]);if(Su)for(var s of Su(e))wN.call(e,s)&&Uc(t,s,e[s]);return t},bN=(t,e)=>pN(t,gN(e)),xt=(t,e,s)=>Uc(t,typeof e!="symbol"?e+"":e,s);class EN extends qw{constructor(e,s){super(e,s),this.logger=e,this.core=s,xt(this,"messages",new Map),xt(this,"messagesWithoutClientAck",new Map),xt(this,"name",dA),xt(this,"version",uA),xt(this,"initialized",!1),xt(this,"storagePrefix",Ss),xt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const r=await this.getRelayerMessagesWithoutClientAck();typeof r<"u"&&(this.messagesWithoutClientAck=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),xt(this,"set",async(n,r,i)=>{this.isInitialized();const o=Yt(r);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=r,this.messages.set(n,a),i===ho.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,bN(yN({},c),{[o]:r}))}return await this.persist(),o}),xt(this,"get",n=>{this.isInitialized();let r=this.messages.get(n);return typeof r>"u"&&(r={}),r}),xt(this,"getWithoutAck",n=>{this.isInitialized();const r={};for(const i of n){const o=this.messagesWithoutClientAck.get(i)||{};r[i]=Object.values(o)}return r}),xt(this,"has",(n,r)=>{this.isInitialized();const i=this.get(n),o=Yt(r);return typeof i[o]<"u"}),xt(this,"ack",async(n,r)=>{this.isInitialized();const i=this.messagesWithoutClientAck.get(n);if(typeof i>"u")return;const o=Yt(r);delete i[o],Object.keys(i).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,i),await this.persist()}),xt(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Lt(e,this.name),this.core=s}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,mc(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,mc(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?wc(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?wc(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var vN=Object.defineProperty,CN=Object.defineProperties,AN=Object.getOwnPropertyDescriptors,_u=Object.getOwnPropertySymbols,IN=Object.prototype.hasOwnProperty,NN=Object.prototype.propertyIsEnumerable,$c=(t,e,s)=>e in t?vN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,cr=(t,e)=>{for(var s in e||(e={}))IN.call(e,s)&&$c(t,s,e[s]);if(_u)for(var s of _u(e))NN.call(e,s)&&$c(t,s,e[s]);return t},Tu=(t,e)=>CN(t,AN(e)),Ht=(t,e,s)=>$c(t,typeof e!="symbol"?e+"":e,s);class SN extends Ww{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,Ht(this,"events",new Yn.EventEmitter),Ht(this,"name",fA),Ht(this,"queue",new Map),Ht(this,"publishTimeout",V.toMiliseconds(V.ONE_MINUTE)),Ht(this,"initialPublishTimeout",V.toMiliseconds(V.ONE_SECOND*15)),Ht(this,"needsTransportRestart",!1),Ht(this,"publish",async(n,r,i)=>{var o,a,c,l,d;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:r,opts:i}});const u=(i==null?void 0:i.ttl)||hA,h=(i==null?void 0:i.prompt)||!1,f=(i==null?void 0:i.tag)||0,g=(i==null?void 0:i.id)||Rn().toString(),p=gr(Ro().protocol),w={id:g,method:(i==null?void 0:i.publishMethod)||p.publish,params:cr({topic:n,message:r,ttl:u,prompt:h,tag:f,attestation:i==null?void 0:i.attestation},i==null?void 0:i.tvf)},b=`Failed to publish payload, please try again. id:${g} tag:${f}`;try{Ve((o=w.params)==null?void 0:o.prompt)&&((a=w.params)==null||delete a.prompt),Ve((c=w.params)==null?void 0:c.tag)&&((l=w.params)==null||delete l.tag);const I=new Promise(async v=>{const E=({id:R})=>{var D;((D=w.id)==null?void 0:D.toString())===R.toString()&&(this.removeRequestFromQueue(R),this.relayer.events.removeListener(Me.publish,E),v())};this.relayer.events.on(Me.publish,E);const _=vs(new Promise((R,D)=>{this.rpcPublish(w,i).then(R).catch(M=>{this.logger.warn(M,M==null?void 0:M.message),D(M)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${g} tag:${f}`);try{await _,this.events.removeListener(Me.publish,E)}catch(R){this.queue.set(g,{request:w,opts:i,attempt:1}),this.logger.warn(R,R==null?void 0:R.message)}});this.logger.trace({type:"method",method:"publish",params:{id:g,topic:n,message:r,opts:i}}),await vs(I,this.publishTimeout,b)}catch(I){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(I),(d=i==null?void 0:i.internal)!=null&&d.throwOnFailedPublish)throw I}finally{this.queue.delete(g)}}),Ht(this,"publishCustom",async n=>{var r,i,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:l,opts:d={}}=n,{attestation:u,tvf:h,publishMethod:f,prompt:g,tag:p,ttl:w=V.FIVE_MINUTES}=d,b=d.id||Rn().toString(),I=gr(Ro().protocol),v=f||I.publish,E={id:b,method:v,params:cr(Tu(cr({},l),{ttl:w,prompt:g,tag:p,attestation:u}),h)},_=`Failed to publish custom payload, please try again. id:${b} tag:${p}`;try{Ve((r=E.params)==null?void 0:r.prompt)&&((i=E.params)==null||delete i.prompt),Ve((o=E.params)==null?void 0:o.tag)&&((a=E.params)==null||delete a.tag);const R=new Promise(async D=>{const M=({id:F})=>{var W;((W=E.id)==null?void 0:W.toString())===F.toString()&&(this.removeRequestFromQueue(F),this.relayer.events.removeListener(Me.publish,M),D())};this.relayer.events.on(Me.publish,M);const P=vs(new Promise((F,W)=>{this.rpcPublish(E,d).then(F).catch(O=>{this.logger.warn(O,O==null?void 0:O.message),W(O)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${v} id:${b} tag:${p}`);try{await P,this.events.removeListener(Me.publish,M)}catch(F){this.queue.set(b,{request:E,opts:d,attempt:1}),this.logger.warn(F,F==null?void 0:F.message)}});this.logger.trace({type:"method",method:"publish",params:{id:b,payload:l,opts:d}}),await vs(R,this.publishTimeout,_)}catch(R){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(R),(c=d==null?void 0:d.internal)!=null&&c.throwOnFailedPublish)throw R}finally{this.queue.delete(b)}}),Ht(this,"on",(n,r)=>{this.events.on(n,r)}),Ht(this,"once",(n,r)=>{this.events.once(n,r)}),Ht(this,"off",(n,r)=>{this.events.off(n,r)}),Ht(this,"removeListener",(n,r)=>{this.events.removeListener(n,r)}),this.relayer=e,this.logger=Lt(s,this.name),this.registerEventListeners()}get context(){return Mt(this.logger)}async rpcPublish(e,s){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(Me.publish,cr(cr({},e),s)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,s)=>{var n;const r=e.attempt+1;this.queue.set(s,Tu(cr({},e),{attempt:r})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${r}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(kr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Me.connection_stalled);return}this.checkQueue()}),this.relayer.on(Me.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var _N=Object.defineProperty,TN=(t,e,s)=>e in t?_N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,lr=(t,e,s)=>TN(t,typeof e!="symbol"?e+"":e,s);class xN{constructor(){lr(this,"map",new Map),lr(this,"set",(e,s)=>{const n=this.get(e);this.exists(e,s)||this.map.set(e,[...n,s])}),lr(this,"get",e=>this.map.get(e)||[]),lr(this,"exists",(e,s)=>this.get(e).includes(s)),lr(this,"delete",(e,s)=>{if(typeof s>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,s))return;const r=n.filter(i=>i!==s);if(!r.length){this.map.delete(e);return}this.map.set(e,r)}),lr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var ON=Object.defineProperty,PN=Object.defineProperties,kN=Object.getOwnPropertyDescriptors,xu=Object.getOwnPropertySymbols,RN=Object.prototype.hasOwnProperty,UN=Object.prototype.propertyIsEnumerable,Dc=(t,e,s)=>e in t?ON(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Kr=(t,e)=>{for(var s in e||(e={}))RN.call(e,s)&&Dc(t,s,e[s]);if(xu)for(var s of xu(e))UN.call(e,s)&&Dc(t,s,e[s]);return t},Da=(t,e)=>PN(t,kN(e)),Te=(t,e,s)=>Dc(t,typeof e!="symbol"?e+"":e,s);class $N extends Kw{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,Te(this,"subscriptions",new Map),Te(this,"topicMap",new xN),Te(this,"events",new Yn.EventEmitter),Te(this,"name",EA),Te(this,"version",vA),Te(this,"pending",new Map),Te(this,"cached",[]),Te(this,"initialized",!1),Te(this,"storagePrefix",Ss),Te(this,"subscribeTimeout",V.toMiliseconds(V.ONE_MINUTE)),Te(this,"initialSubscribeTimeout",V.toMiliseconds(V.ONE_SECOND*15)),Te(this,"clientId"),Te(this,"batchSubscribeTopicsLimit",500),Te(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Te(this,"subscribe",async(n,r)=>{var i;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:r}});try{const o=Ro(r),a={topic:n,relay:o,transportType:r==null?void 0:r.transportType};(i=r==null?void 0:r.internal)!=null&&i.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,r);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:r}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),Te(this,"unsubscribe",async(n,r)=>{this.isInitialized(),typeof(r==null?void 0:r.id)<"u"?await this.unsubscribeById(n,r.id,r):await this.unsubscribeByTopic(n,r)}),Te(this,"isSubscribed",n=>new Promise(r=>{r(this.topicMap.topics.includes(n))})),Te(this,"isKnownTopic",n=>new Promise(r=>{r(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(i=>i.topic===n))})),Te(this,"on",(n,r)=>{this.events.on(n,r)}),Te(this,"once",(n,r)=>{this.events.once(n,r)}),Te(this,"off",(n,r)=>{this.events.off(n,r)}),Te(this,"removeListener",(n,r)=>{this.events.removeListener(n,r)}),Te(this,"start",async()=>{await this.onConnect()}),Te(this,"stop",async()=>{await this.onDisconnect()}),Te(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Te(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(r=>{n.push(r)}),await this.batchSubscribe(n)}),Te(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(kr.pulse,async()=>{await this.checkPending()}),this.events.on(kt.created,async n=>{const r=kt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:n}),await this.persist()}),this.events.on(kt.deleted,async n=>{const r=kt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:n}),await this.persist()})}),this.relayer=e,this.logger=Lt(s,this.name),this.clientId=""}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,s){let n=!1;try{n=this.getSubscription(e).topic===s}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,s){const n=this.topicMap.get(e);await Promise.all(n.map(async r=>await this.unsubscribeById(e,r,s)))}async unsubscribeById(e,s,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:n}});try{const r=Ro(n);await this.restartToComplete({topic:e,id:s,relay:r}),await this.rpcUnsubscribe(e,s,r);const i=Ue("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,s,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:n}})}catch(r){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(r),r}}async rpcSubscribe(e,s,n){var r,i;const o=await this.getSubscriptionId(e);if((r=n==null?void 0:n.internal)!=null&&r.skipSubscribe)return o;(!n||(n==null?void 0:n.transportType)===Pe.relay)&&await this.restartToComplete({topic:e,id:e,relay:s});const a={method:gr(s.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(i=n==null?void 0:n.internal)==null?void 0:i.throwOnFailedPublish;try{if((n==null?void 0:n.transportType)===Pe.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(u=>this.logger.warn(u))},V.toMiliseconds(V.ONE_SECOND)),o;const l=new Promise(async u=>{const h=f=>{f.topic===e&&(this.events.removeListener(kt.created,h),u(f.id))};this.events.on(kt.created,h);try{const f=await vs(new Promise((g,p)=>{this.relayer.request(a).catch(w=>{this.logger.warn(w,w==null?void 0:w.message),p(w)}).then(g)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(kt.created,h),u(f)}catch{}}),d=await vs(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!d&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return d?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Me.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const s=e[0].relay,n={method:gr(s.protocol).batchSubscribe,params:{topics:e.map(r=>r.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await vs(new Promise(r=>{this.relayer.request(n).catch(i=>this.logger.warn(i)).then(r)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Me.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const s=e[0].relay,n={method:gr(s.protocol).batchFetchMessages,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let r;try{r=await await vs(new Promise((i,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(i)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Me.connection_stalled)}return r}rpcUnsubscribe(e,s,n){const r={method:gr(n.protocol).unsubscribe,params:{topic:e,id:s}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.request(r)}onSubscribe(e,s){this.setSubscription(e,Da(Kr({},s),{id:e})),this.pending.delete(s.topic)}onBatchSubscribe(e){e.length&&e.forEach(s=>{this.setSubscription(s.id,Kr({},s)),this.pending.delete(s.topic)})}async onUnsubscribe(e,s,n){this.events.removeAllListeners(s),this.hasSubscription(s,e)&&this.deleteSubscription(s,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,s){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:s}),this.addSubscription(e,s)}addSubscription(e,s){this.subscriptions.set(e,Kr({},s)),this.topicMap.set(s.topic,e),this.events.emit(kt.created,s)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const s=this.subscriptions.get(e);if(!s){const{message:n}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return s}deleteSubscription(e,s){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:s});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(kt.deleted,Da(Kr({},n),{reason:s}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(kt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],s=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<s;n++){const r=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(r)}}this.events.emit(kt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(s=>{var n;return s.topic===((n=this.subscriptions.get(s.id))==null?void 0:n.topic)})){const{message:s}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async s=>Da(Kr({},s),{id:await this.getSubscriptionId(s.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const s=await this.rpcBatchFetchMessages(e);s&&s.messages&&(await iE(V.toMiliseconds(V.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(s.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Yt(e+await this.getClientId())}}var DN=Object.defineProperty,Ou=Object.getOwnPropertySymbols,BN=Object.prototype.hasOwnProperty,LN=Object.prototype.propertyIsEnumerable,Bc=(t,e,s)=>e in t?DN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Pu=(t,e)=>{for(var s in e||(e={}))BN.call(e,s)&&Bc(t,s,e[s]);if(Ou)for(var s of Ou(e))LN.call(e,s)&&Bc(t,s,e[s]);return t},ve=(t,e,s)=>Bc(t,typeof e!="symbol"?e+"":e,s);class MN extends Hw{constructor(e){var s;super(e),ve(this,"protocol","wc"),ve(this,"version",2),ve(this,"core"),ve(this,"logger"),ve(this,"events",new Yn.EventEmitter),ve(this,"provider"),ve(this,"messages"),ve(this,"subscriber"),ve(this,"publisher"),ve(this,"name",gA),ve(this,"transportExplicitlyClosed",!1),ve(this,"initialized",!1),ve(this,"connectionAttemptInProgress",!1),ve(this,"relayUrl"),ve(this,"projectId"),ve(this,"packageName"),ve(this,"bundleId"),ve(this,"hasExperiencedNetworkDisruption",!1),ve(this,"pingTimeout"),ve(this,"heartBeatTimeout",V.toMiliseconds(V.THIRTY_SECONDS+V.FIVE_SECONDS)),ve(this,"reconnectTimeout"),ve(this,"connectPromise"),ve(this,"reconnectInProgress",!1),ve(this,"requestsInFlight",[]),ve(this,"connectTimeout",V.toMiliseconds(V.ONE_SECOND*15)),ve(this,"request",async n=>{var r,i;this.logger.debug("Publishing Request Payload");const o=n.id||Rn().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:n.method,topic:(r=n.params)==null?void 0:r.topic},"relayer.request - publishing...");const a=`${o}:${((i=n.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),ve(this,"resetPingTimeout",()=>{_o()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,r,i,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(i=(r=(n=this.provider)==null?void 0:n.connection)==null?void 0:r.socket)==null?void 0:i.terminate)==null||o.call(i)}catch(a){this.logger.warn(a,a==null?void 0:a.message)}},this.heartBeatTimeout))}),ve(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),ve(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected ðŸ›œ"),this.startPingTimeout(),this.events.emit(Me.connect)}),ve(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected ðŸ›‘"),this.requestsInFlight=[],this.onProviderDisconnect()}),ve(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(Me.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ve(this,"registerProviderListeners",()=>{this.provider.on(Wt.payload,this.onPayloadHandler),this.provider.on(Wt.connect,this.onConnectHandler),this.provider.on(Wt.disconnect,this.onDisconnectHandler),this.provider.on(Wt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=Nl({logger:(s=e.logger)!=null?s:pA,name:this.name}),this.messages=new EN(this.logger,e.core),this.subscriber=new $N(this,this.logger),this.publisher=new SN(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Lp,Wb()?this.packageName=Nd():Hb()&&(this.bundleId=Nd()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return Mt(this.logger)}get connected(){var e,s,n;return((n=(s=(e=this.provider)==null?void 0:e.connection)==null?void 0:s.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,s,n;return((n=(s=(e=this.provider)==null?void 0:e.connection)==null?void 0:s.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,s,n){this.isInitialized(),await this.publisher.publish(e,s,n),await this.recordMessageEvent({topic:e,message:s,publishedAt:Date.now(),transportType:Pe.relay},ho.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,s){var n,r,i;this.isInitialized(),(!(s!=null&&s.transportType)||(s==null?void 0:s.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((n=s==null?void 0:s.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(r=s==null?void 0:s.internal)==null?void 0:r.throwOnFailedPublish;let a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",c;const l=d=>{d.topic===e&&(this.subscriber.off(kt.created,l),c())};return await Promise.all([new Promise(d=>{c=d,this.subscriber.on(kt.created,l)}),new Promise(async(d,u)=>{a=await this.subscriber.subscribe(e,Pu({internal:{throwOnFailedPublish:o}},s)).catch(h=>{o&&u(h)})||a,d()})]),a}async unsubscribe(e,s){this.isInitialized(),await this.subscriber.unsubscribe(e,s)}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await vs(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(s,n)=>{await this.connect(e).then(s).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await wu())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const s=e.sort((n,r)=>n.publishedAt-r.publishedAt);this.logger.debug(`Batch of ${s.length} message events sorted`);for(const n of s)try{await this.onMessageEvent(n)}catch(r){this.logger.warn(r,"Error while processing batch message event: "+(r==null?void 0:r.message))}this.logger.trace(`Batch of ${s.length} message events processed`)}async onLinkMessageEvent(e,s){const{topic:n}=e;if(!s.sessionExists){const r=Le(V.FIVE_MINUTES),i={topic:n,expiry:r,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,i)}this.events.emit(Me.message,e),await this.recordMessageEvent(e,ho.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let s=1;for(;s<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${s}...`),await this.createProvider(),await new Promise(async(n,r)=>{const i=()=>{r(new Error("Connection interrupted while trying to connect"))};this.provider.once(Wt.disconnect,i),await vs(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{r(o)}).finally(()=>{this.provider.off(Wt.disconnect,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{r(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Wt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Wt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const r=n;this.logger.warn({},r.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${s}`);break}await new Promise(n=>setTimeout(n,V.toMiliseconds(s*1))),s++}}startPingTimeout(){var e,s,n,r,i;if(_o())try{(s=(e=this.provider)==null?void 0:e.connection)!=null&&s.socket&&((i=(r=(n=this.provider)==null?void 0:n.connection)==null?void 0:r.socket)==null||i.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Zc(new Dg(Yb({sdkVersion:Pc,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,s){const{topic:n,message:r}=e;await this.messages.set(n,r,s)}async shouldIgnoreMessageEvent(e){const{topic:s,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(s))return this.logger.warn(`Ignoring message for unknown topic ${s}`),!0;const r=this.messages.has(s,n);return r&&this.logger.warn(`Ignoring duplicate message: ${n}`),r}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Qc(e)){if(!e.method.endsWith(mA))return;const s=e.params,{topic:n,message:r,publishedAt:i,attestation:o}=s.data,a={topic:n,message:r,publishedAt:i,transportType:Pe.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Pu({type:"event",event:s.id},a)),this.events.emit(s.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else el(e)&&this.events.emit(Me.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,ho.inbound),this.events.emit(Me.message,e))}async acknowledgePayload(e){const s=li(e.id,!0);await this.provider.connection.send(s)}unregisterProviderListeners(){this.provider.off(Wt.payload,this.onPayloadHandler),this.provider.off(Wt.connect,this.onConnectHandler),this.provider.off(Wt.disconnect,this.onDisconnectHandler),this.provider.off(Wt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await wu();z1(async s=>{e!==s&&(e=s,s?await this.transportOpen().catch(n=>this.logger.error(n,n==null?void 0:n.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(kr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&G1())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(s){this.logger.warn(s,s==null?void 0:s.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Me.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},V.toMiliseconds(wA)))))}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function FN(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function ku(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Ru(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const jN="[object RegExp]",qN="[object String]",WN="[object Number]",HN="[object Boolean]",Uu="[object Arguments]",zN="[object Symbol]",KN="[object Date]",VN="[object Map]",GN="[object Set]",YN="[object Array]",JN="[object Function]",XN="[object ArrayBuffer]",Ba="[object Object]",ZN="[object Error]",QN="[object DataView]",eS="[object Uint8Array]",tS="[object Uint8ClampedArray]",sS="[object Uint16Array]",nS="[object Uint32Array]",rS="[object BigUint64Array]",iS="[object Int8Array]",oS="[object Int16Array]",aS="[object Int32Array]",cS="[object BigInt64Array]",lS="[object Float32Array]",dS="[object Float64Array]";function uS(){}function $u(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function hS(t,e,s){return Qr(t,e,void 0,void 0,void 0,void 0,s)}function Qr(t,e,s,n,r,i,o){const a=o(t,e,s,n,r,i);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return oi(t,e,i,o)}return oi(t,e,i,o)}function oi(t,e,s,n){if(Object.is(t,e))return!0;let r=Ru(t),i=Ru(e);if(r===Uu&&(r=Ba),i===Uu&&(i=Ba),r!==i)return!1;switch(r){case qN:return t.toString()===e.toString();case WN:{const c=t.valueOf(),l=e.valueOf();return FN(c,l)}case HN:case KN:case zN:return Object.is(t.valueOf(),e.valueOf());case jN:return t.source===e.source&&t.flags===e.flags;case JN:return t===e}s=s??new Map;const o=s.get(t),a=s.get(e);if(o!=null&&a!=null)return o===e;s.set(t,e),s.set(e,t);try{switch(r){case VN:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!Qr(l,e.get(c),c,t,e,s,n))return!1;return!0}case GN:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let d=0;d<c.length;d++){const u=c[d],h=l.findIndex(f=>Qr(u,f,void 0,t,e,s,n));if(h===-1)return!1;l.splice(h,1)}return!0}case YN:case eS:case tS:case sS:case nS:case rS:case iS:case oS:case aS:case cS:case lS:case dS:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Qr(t[c],e[c],c,t,e,s,n))return!1;return!0}case XN:return t.byteLength!==e.byteLength?!1:oi(new Uint8Array(t),new Uint8Array(e),s,n);case QN:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:oi(new Uint8Array(t),new Uint8Array(e),s,n);case ZN:return t.name===e.name&&t.message===e.message;case Ba:{if(!(oi(t.constructor,e.constructor,s,n)||$u(t)&&$u(e)))return!1;const c=[...Object.keys(t),...ku(t)],l=[...Object.keys(e),...ku(e)];if(c.length!==l.length)return!1;for(let d=0;d<c.length;d++){const u=c[d],h=t[u];if(!Object.hasOwn(e,u))return!1;const f=e[u];if(!Qr(h,f,u,t,e,s,n))return!1}return!0}default:return!1}}finally{s.delete(t),s.delete(e)}}function fS(t,e){return hS(t,e,uS)}var pS=Object.defineProperty,Du=Object.getOwnPropertySymbols,gS=Object.prototype.hasOwnProperty,mS=Object.prototype.propertyIsEnumerable,Lc=(t,e,s)=>e in t?pS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Bu=(t,e)=>{for(var s in e||(e={}))gS.call(e,s)&&Lc(t,s,e[s]);if(Du)for(var s of Du(e))mS.call(e,s)&&Lc(t,s,e[s]);return t},bt=(t,e,s)=>Lc(t,typeof e!="symbol"?e+"":e,s);class er extends zw{constructor(e,s,n,r=Ss,i=void 0){super(e,s,n,r),this.core=e,this.logger=s,this.name=n,bt(this,"map",new Map),bt(this,"version",yA),bt(this,"cached",[]),bt(this,"initialized",!1),bt(this,"getKey"),bt(this,"storagePrefix",Ss),bt(this,"recentlyDeleted",[]),bt(this,"recentlyDeletedLimit",200),bt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ve(o)?this.map.set(this.getKey(o),o):C1(o)?this.map.set(o.id,o):A1(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),bt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),bt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),bt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>fS(a[c],o[c]))):this.values)),bt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Bu(Bu({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),bt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Lt(s,this.name),this.storagePrefix=r,this.getKey=i}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const s=this.map.get(e);if(!s){if(this.recentlyDeleted.includes(e)){const{message:r}=K("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}const{message:n}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return s}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:s}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var wS=Object.defineProperty,yS=(t,e,s)=>e in t?wS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ge=(t,e,s)=>yS(t,typeof e!="symbol"?e+"":e,s);class bS{constructor(e,s){this.core=e,this.logger=s,ge(this,"name",CA),ge(this,"version",AA),ge(this,"events",new Yc),ge(this,"pairings"),ge(this,"initialized",!1),ge(this,"storagePrefix",Ss),ge(this,"ignoredPayloadTypes",[zs]),ge(this,"registeredMethods",[]),ge(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ge(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),ge(this,"create",async n=>{this.isInitialized();const r=Tc(),i=await this.core.crypto.setSymKey(r),o=Le(V.FIVE_MINUTES),a={protocol:Bp},c={topic:i,expiry:o,relay:a,active:!1,methods:n==null?void 0:n.methods},l=cu({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:r,relay:a,expiryTimestamp:o,methods:n==null?void 0:n.methods});return this.events.emit(On.create,c),this.core.expirer.set(i,o),await this.pairings.set(i,c),await this.core.relayer.subscribe(i,{transportType:n==null?void 0:n.transportType,internal:n==null?void 0:n.internal}),{topic:i,uri:l}}),ge(this,"pair",async n=>{this.isInitialized();const r=this.core.eventClient.createEvent({properties:{topic:n==null?void 0:n.uri,trace:[ms.pairing_started]}});this.isValidPair(n,r);const{topic:i,symKey:o,relay:a,expiryTimestamp:c,methods:l}=au(n.uri);r.props.properties.topic=i,r.addTrace(ms.pairing_uri_validation_success),r.addTrace(ms.pairing_uri_not_expired);let d;if(this.pairings.keys.includes(i)){if(d=this.pairings.get(i),r.addTrace(ms.existing_pairing),d.active)throw r.setError(Rs.active_pairing_already_exists),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);r.addTrace(ms.pairing_not_expired)}const u=c||Le(V.FIVE_MINUTES),h={topic:i,relay:a,expiry:u,active:!1,methods:l};this.core.expirer.set(i,u),await this.pairings.set(i,h),r.addTrace(ms.store_new_pairing),n.activatePairing&&await this.activate({topic:i}),this.events.emit(On.create,h),r.addTrace(ms.emit_inactive_pairing),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(o,i),r.addTrace(ms.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{r.setError(Rs.no_internet_connection)}try{await this.core.relayer.subscribe(i,{relay:a})}catch(f){throw r.setError(Rs.subscribe_pairing_topic_failure),f}return r.addTrace(ms.subscribe_pairing_topic_success),h}),ge(this,"activate",async({topic:n})=>{this.isInitialized();const r=Le(V.FIVE_MINUTES);this.core.expirer.set(n,r),await this.pairings.update(n,{active:!0,expiry:r})}),ge(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:r}=n;if(this.pairings.keys.includes(r)){const i=await this.sendRequest(r,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=xn();this.events.once(Ne("pairing_ping",i),({error:l})=>{l?c(l):a()}),await o()}}),ge(this,"updateExpiry",async({topic:n,expiry:r})=>{this.isInitialized(),await this.pairings.update(n,{expiry:r})}),ge(this,"updateMetadata",async({topic:n,metadata:r})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:r})}),ge(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ge(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:r}=n;this.pairings.keys.includes(r)&&(await this.sendRequest(r,"wc_pairingDelete",Ue("USER_DISCONNECTED")),await this.deletePairing(r))}),ge(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:r,relay:i,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(r);return cu({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:c,relay:i,expiryTimestamp:o,methods:a})}),ge(this,"sendRequest",async(n,r,i)=>{const o=ys(r,i),a=await this.core.crypto.encode(n,o),c=Hr[r].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),ge(this,"sendResult",async(n,r,i)=>{const o=li(n,i),a=await this.core.crypto.encode(r,o),c=(await this.core.history.get(r,n)).request.method,l=Hr[c].res;await this.core.relayer.publish(r,a,l),await this.core.history.resolve(o)}),ge(this,"sendError",async(n,r,i)=>{const o=Th(n,i),a=await this.core.crypto.encode(r,o),c=(await this.core.history.get(r,n)).request.method,l=Hr[c]?Hr[c].res:Hr.unregistered_method.res;await this.core.relayer.publish(r,a,l),await this.core.history.resolve(o)}),ge(this,"deletePairing",async(n,r)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Ue("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),r?Promise.resolve():this.core.expirer.del(n)])}),ge(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(r=>bs(r.expiry));await Promise.all(n.map(r=>this.deletePairing(r.topic)))}),ge(this,"onRelayEventRequest",async n=>{const{topic:r,payload:i}=n;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(r,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(r,i);default:return await this.onUnknownRpcMethodRequest(r,i)}}),ge(this,"onRelayEventResponse",async n=>{const{topic:r,payload:i}=n,o=(await this.core.history.get(r,i.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(r,i);default:return this.onUnknownRpcMethodResponse(o)}}),ge(this,"onPairingPingRequest",async(n,r)=>{const{id:i}=r;try{this.isValidPing({topic:n}),await this.sendResult(i,n,!0),this.events.emit(On.ping,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),ge(this,"onPairingPingResponse",(n,r)=>{const{id:i}=r;setTimeout(()=>{Ps(r)?this.events.emit(Ne("pairing_ping",i),{}):ws(r)&&this.events.emit(Ne("pairing_ping",i),{error:r.error})},500)}),ge(this,"onPairingDeleteRequest",async(n,r)=>{const{id:i}=r;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(On.delete,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),ge(this,"onUnknownRpcMethodRequest",async(n,r)=>{const{id:i,method:o}=r;try{if(this.registeredMethods.includes(o))return;const a=Ue("WC_METHOD_UNSUPPORTED",o);await this.sendError(i,n,a),this.logger.error(a)}catch(a){await this.sendError(i,n,a),this.logger.error(a)}}),ge(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(Ue("WC_METHOD_UNSUPPORTED",n))}),ge(this,"isValidPair",(n,r)=>{var i;if(!vt(n)){const{message:a}=K("MISSING_OR_INVALID",`pair() params: ${n}`);throw r.setError(Rs.malformed_pairing_uri),new Error(a)}if(!v1(n.uri)){const{message:a}=K("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw r.setError(Rs.malformed_pairing_uri),new Error(a)}const o=au(n==null?void 0:n.uri);if(!((i=o==null?void 0:o.relay)!=null&&i.protocol)){const{message:a}=K("MISSING_OR_INVALID","pair() uri#relay-protocol");throw r.setError(Rs.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=K("MISSING_OR_INVALID","pair() uri#symKey");throw r.setError(Rs.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&V.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){r.setError(Rs.pairing_expired);const{message:a}=K("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ge(this,"isValidPing",async n=>{if(!vt(n)){const{message:i}=K("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}const{topic:r}=n;await this.isValidPairingTopic(r)}),ge(this,"isValidDisconnect",async n=>{if(!vt(n)){const{message:i}=K("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}const{topic:r}=n;await this.isValidPairingTopic(r)}),ge(this,"isValidPairingTopic",async n=>{if(!Fe(n,!1)){const{message:r}=K("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(r)}if(!this.pairings.keys.includes(n)){const{message:r}=K("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(r)}if(bs(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:r}=K("EXPIRED",`pairing topic: ${n}`);throw new Error(r)}}),this.core=e,this.logger=Lt(s,this.name),this.pairings=new er(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Mt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Me.message,async e=>{const{topic:s,message:n,transportType:r}=e;if(this.pairings.keys.includes(s)&&r!==Pe.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const i=await this.core.crypto.decode(s,n);Qc(i)?(this.core.history.set(s,i),await this.onRelayEventRequest({topic:s,payload:i})):el(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:s,payload:i}),this.core.history.delete(s,i.id)),await this.core.relayer.messages.ack(s,n)}catch(i){this.logger.error(i)}})}registerExpirerEvents(){this.core.expirer.on(Vt.expired,async e=>{const{topic:s}=Rf(e.target);s&&this.pairings.keys.includes(s)&&(await this.deletePairing(s,!0),this.events.emit(On.expire,{topic:s}))})}}var ES=Object.defineProperty,vS=(t,e,s)=>e in t?ES(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Je=(t,e,s)=>vS(t,typeof e!="symbol"?e+"":e,s);class CS extends jw{constructor(e,s){super(e,s),this.core=e,this.logger=s,Je(this,"records",new Map),Je(this,"events",new Yn.EventEmitter),Je(this,"name",IA),Je(this,"version",NA),Je(this,"cached",[]),Je(this,"initialized",!1),Je(this,"storagePrefix",Ss),Je(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Je(this,"set",(n,r,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:r,chainId:i}),this.records.has(r.id))return;const o={id:r.id,topic:n,request:{method:r.method,params:r.params||null},chainId:i,expiry:Le(V.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(ss.created,o)}),Je(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const r=await this.getRecord(n.id);typeof r.response>"u"&&(r.response=ws(n)?{error:n.error}:{result:n.result},this.records.set(r.id,r),this.persist(),this.events.emit(ss.updated,r))}),Je(this,"get",async(n,r)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:r}),await this.getRecord(r))),Je(this,"delete",(n,r)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:r}),this.values.forEach(i=>{if(i.topic===n){if(typeof r<"u"&&i.id!==r)return;this.records.delete(i.id),this.events.emit(ss.deleted,i)}}),this.persist()}),Je(this,"exists",async(n,r)=>(this.isInitialized(),this.records.has(r)?(await this.getRecord(r)).topic===n:!1)),Je(this,"on",(n,r)=>{this.events.on(n,r)}),Je(this,"once",(n,r)=>{this.events.once(n,r)}),Je(this,"off",(n,r)=>{this.events.off(n,r)}),Je(this,"removeListener",(n,r)=>{this.events.removeListener(n,r)}),this.logger=Lt(s,this.name)}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(s=>{if(typeof s.response<"u")return;const n={topic:s.topic,request:ys(s.request.method,s.request.params,s.id),chainId:s.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const s=this.records.get(e);if(!s){const{message:n}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return s}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ss.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:s}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(ss.created,e=>{const s=ss.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.events.on(ss.updated,e=>{const s=ss.updated;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.events.on(ss.deleted,e=>{const s=ss.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.core.heartbeat.on(kr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(s=>{V.toMiliseconds(s.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${s.id}`),this.records.delete(s.id),this.events.emit(ss.deleted,s,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var AS=Object.defineProperty,IS=(t,e,s)=>e in t?AS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ot=(t,e,s)=>IS(t,typeof e!="symbol"?e+"":e,s);class NS extends Vw{constructor(e,s){super(e,s),this.core=e,this.logger=s,ot(this,"expirations",new Map),ot(this,"events",new Yn.EventEmitter),ot(this,"name",SA),ot(this,"version",_A),ot(this,"cached",[]),ot(this,"initialized",!1),ot(this,"storagePrefix",Ss),ot(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),ot(this,"has",n=>{try{const r=this.formatTarget(n);return typeof this.getExpiration(r)<"u"}catch{return!1}}),ot(this,"set",(n,r)=>{this.isInitialized();const i=this.formatTarget(n),o={target:i,expiry:r};this.expirations.set(i,o),this.checkExpiry(i,o),this.events.emit(Vt.created,{target:i,expiration:o})}),ot(this,"get",n=>{this.isInitialized();const r=this.formatTarget(n);return this.getExpiration(r)}),ot(this,"del",n=>{if(this.isInitialized(),this.has(n)){const r=this.formatTarget(n),i=this.getExpiration(r);this.expirations.delete(r),this.events.emit(Vt.deleted,{target:r,expiration:i})}}),ot(this,"on",(n,r)=>{this.events.on(n,r)}),ot(this,"once",(n,r)=>{this.events.once(n,r)}),ot(this,"off",(n,r)=>{this.events.off(n,r)}),ot(this,"removeListener",(n,r)=>{this.events.removeListener(n,r)}),this.logger=Lt(s,this.name)}get context(){return Mt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Jb(e);if(typeof e=="number")return Xb(e);const{message:s}=K("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(s)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Vt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:s}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const s=this.expirations.get(e);if(!s){const{message:n}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return s}checkExpiry(e,s){const{expiry:n}=s;V.toMiliseconds(n)-Date.now()<=0&&this.expire(e,s)}expire(e,s){this.expirations.delete(e),this.events.emit(Vt.expired,{target:e,expiration:s})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,s)=>this.checkExpiry(s,e))}registerEventListeners(){this.core.heartbeat.on(kr.pulse,()=>this.checkExpirations()),this.events.on(Vt.created,e=>{const s=Vt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on(Vt.expired,e=>{const s=Vt.expired;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on(Vt.deleted,e=>{const s=Vt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var SS=Object.defineProperty,_S=(t,e,s)=>e in t?SS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Be=(t,e,s)=>_S(t,typeof e!="symbol"?e+"":e,s);class TS extends Gw{constructor(e,s,n){super(e,s,n),this.core=e,this.logger=s,this.store=n,Be(this,"name",TA),Be(this,"abortController"),Be(this,"isDevEnv"),Be(this,"verifyUrlV3",OA),Be(this,"storagePrefix",Ss),Be(this,"version",Dp),Be(this,"publicKey"),Be(this,"fetchPromise"),Be(this,"init",async()=>{var r;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&V.toMiliseconds((r=this.publicKey)==null?void 0:r.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Be(this,"register",async r=>{if(!Ur()||this.isDevEnv)return;const i=window.location.origin,{id:o,decryptedId:a}=r,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${i}&id=${o}&decryptedId=${a}`;try{const l=Ir(),d=this.startAbortTimer(V.ONE_SECOND*5),u=await new Promise((h,f)=>{const g=()=>{window.removeEventListener("message",w),l.body.removeChild(p),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const p=l.createElement("iframe");p.src=c,p.style.display="none",p.addEventListener("error",g,{signal:this.abortController.signal});const w=b=>{if(b.data&&typeof b.data=="string")try{const I=JSON.parse(b.data);if(I.type==="verify_attestation"){if(Za(I.attestation).payload.id!==o)return;clearInterval(d),l.body.removeChild(p),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",w),h(I.attestation===null?"":I.attestation)}}catch(I){this.logger.warn(I)}};l.body.appendChild(p),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug(u,"jwt attestation"),u}catch(l){this.logger.warn(l)}return""}),Be(this,"resolve",async r=>{if(this.isDevEnv)return"";const{attestationId:i,hash:o,encryptedId:a}=r;if(i===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(i){if(Za(i).payload.id!==a)return;const l=await this.isValidJwtAttestation(i);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(r==null?void 0:r.verifyUrl);return this.fetchAttestation(o,c)}),Be(this,"fetchAttestation",async(r,i)=>{this.logger.debug(`resolving attestation: ${r} from url: ${i}`);const o=this.startAbortTimer(V.ONE_SECOND*5),a=await fetch(`${i}/attestation/${r}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Be(this,"getVerifyUrl",r=>{let i=r||ii;return PA.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${ii}`),i=ii),i}),Be(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const r=this.startAbortTimer(V.FIVE_SECONDS),i=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(r),await i.json()}catch(r){this.logger.warn(r)}}),Be(this,"persistPublicKey",async r=>{this.logger.debug(r,"persisting public key to local storage"),await this.store.setItem(this.storeKey,r),this.publicKey=r}),Be(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Be(this,"isValidJwtAttestation",async r=>{const i=await this.getPublicKey();try{if(i)return this.validateAttestation(r,i)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(r,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Be(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Be(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async i=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),i(o))});const r=await this.fetchPromise;return this.fetchPromise=void 0,r}),Be(this,"validateAttestation",(r,i)=>{const o=VC(r,i.publicKey),a={hasExpired:V.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Lt(s,this.name),this.abortController=new AbortController,this.isDevEnv=pl(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Mt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),V.toMiliseconds(e))}}var xS=Object.defineProperty,OS=(t,e,s)=>e in t?xS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Lu=(t,e,s)=>OS(t,typeof e!="symbol"?e+"":e,s);class PS extends Yw{constructor(e,s){super(e,s),this.projectId=e,this.logger=s,Lu(this,"context",kA),Lu(this,"registerDeviceToken",async n=>{const{clientId:r,token:i,notificationType:o,enableEncrypted:a=!1}=n,c=`${RA}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:r,type:o,token:i,always_raw:a})})}),this.logger=Lt(s,this.context)}}var kS=Object.defineProperty,Mu=Object.getOwnPropertySymbols,RS=Object.prototype.hasOwnProperty,US=Object.prototype.propertyIsEnumerable,Mc=(t,e,s)=>e in t?kS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Vr=(t,e)=>{for(var s in e||(e={}))RS.call(e,s)&&Mc(t,s,e[s]);if(Mu)for(var s of Mu(e))US.call(e,s)&&Mc(t,s,e[s]);return t},He=(t,e,s)=>Mc(t,typeof e!="symbol"?e+"":e,s);class $S extends Jw{constructor(e,s,n=!0){super(e,s,n),this.core=e,this.logger=s,He(this,"context",$A),He(this,"storagePrefix",Ss),He(this,"storageVersion",UA),He(this,"events",new Map),He(this,"shouldPersist",!1),He(this,"init",async()=>{if(!pl())try{const r={eventId:_d(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Pf(this.core.relayer.protocol,this.core.relayer.version,Pc)}}};await this.sendEvent([r])}catch(r){this.logger.warn(r)}}),He(this,"createEvent",r=>{const{event:i="ERROR",type:o="",properties:{topic:a,trace:c}}=r,l=_d(),d=this.core.projectId||"",u=Date.now(),h=Vr({eventId:l,timestamp:u,props:{event:i,type:o,properties:{topic:a,trace:c}},bundleId:d,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,h),this.shouldPersist=!0),h}),He(this,"getEvent",r=>{const{eventId:i,topic:o}=r;if(i)return this.events.get(i);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Vr(Vr({},a),this.setMethods(a.eventId))}),He(this,"deleteEvent",r=>{const{eventId:i}=r;this.events.delete(i),this.shouldPersist=!0}),He(this,"setEventListeners",()=>{this.core.heartbeat.on(kr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(r=>{V.fromMiliseconds(Date.now())-V.fromMiliseconds(r.timestamp)>DA&&(this.events.delete(r.eventId),this.shouldPersist=!0)})})}),He(this,"setMethods",r=>({addTrace:i=>this.addTrace(r,i),setError:i=>this.setError(r,i)})),He(this,"addTrace",(r,i)=>{const o=this.events.get(r);o&&(o.props.properties.trace.push(i),this.events.set(r,o),this.shouldPersist=!0)}),He(this,"setError",(r,i)=>{const o=this.events.get(r);o&&(o.props.type=i,o.timestamp=Date.now(),this.events.set(r,o),this.shouldPersist=!0)}),He(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),He(this,"restore",async()=>{try{const r=await this.core.storage.getItem(this.storageKey)||[];if(!r.length)return;r.forEach(i=>{this.events.set(i.eventId,Vr(Vr({},i),this.setMethods(i.eventId)))})}catch(r){this.logger.warn(r)}}),He(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const r=[];for(const[i,o]of this.events)o.props.type&&r.push(o);if(r.length!==0)try{if((await this.sendEvent(r)).ok)for(const i of r)this.events.delete(i.eventId),this.shouldPersist=!0}catch(i){this.logger.warn(i)}}),He(this,"sendEvent",async r=>{const i=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${BA}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Pc}${i}`,{method:"POST",body:JSON.stringify(r)})}),He(this,"getAppDomain",()=>Of().url),this.logger=Lt(s,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var DS=Object.defineProperty,Fu=Object.getOwnPropertySymbols,BS=Object.prototype.hasOwnProperty,LS=Object.prototype.propertyIsEnumerable,Fc=(t,e,s)=>e in t?DS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ju=(t,e)=>{for(var s in e||(e={}))BS.call(e,s)&&Fc(t,s,e[s]);if(Fu)for(var s of Fu(e))LS.call(e,s)&&Fc(t,s,e[s]);return t},xe=(t,e,s)=>Fc(t,typeof e!="symbol"?e+"":e,s);let MS=class Xp extends Bw{constructor(e){var s;super(e),xe(this,"protocol",$p),xe(this,"version",Dp),xe(this,"name",Oc),xe(this,"relayUrl"),xe(this,"projectId"),xe(this,"customStoragePrefix"),xe(this,"events",new Yn.EventEmitter),xe(this,"logger"),xe(this,"heartbeat"),xe(this,"relayer"),xe(this,"crypto"),xe(this,"storage"),xe(this,"history"),xe(this,"expirer"),xe(this,"pairing"),xe(this,"verify"),xe(this,"echoClient"),xe(this,"linkModeSupportedApps"),xe(this,"eventClient"),xe(this,"initialized",!1),xe(this,"logChunkController"),xe(this,"on",(a,c)=>this.events.on(a,c)),xe(this,"once",(a,c)=>this.events.once(a,c)),xe(this,"off",(a,c)=>this.events.off(a,c)),xe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),xe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const d={topic:a,message:c,publishedAt:Date.now(),transportType:Pe.link_mode};this.relayer.onLinkMessageEvent(d,{sessionExists:l})});const n=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Lp,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=_h({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:rA.logger,name:Oc}),{logger:i,chunkLoggerController:o}=Xc({opts:r,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(s=this.logChunkController)!=null&&s.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Lt(i,this.name),this.heartbeat=new $g,this.crypto=new hN(this,this.logger,e==null?void 0:e.keychain),this.history=new CS(this,this.logger),this.expirer=new NS(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Uw(ju(ju({},iA),e==null?void 0:e.storageOptions)),this.relayer=new MN({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new bS(this,this.logger),this.verify=new TS(this,this.logger,this.storage),this.echoClient=new PS(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new $S(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const s=new Xp(e);await s.initialize();const n=await s.crypto.getClientId();return await s.storage.setItem(bA,n),s}get context(){return Mt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(bu,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(bu)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const s=`_walletConnectCore_${e}`,n=`${s}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[s]}catch(s){console.warn("Failed to get global WalletConnect core",s);return}}setGlobalCore(e){var s;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((s=e.opts)==null?void 0:s.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&nA.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const FS=MS,Zp="wc",Qp=2,eg="client",Sl=`${Zp}@${Qp}:${eg}:`,La={name:eg,logger:"error"},qu="WALLETCONNECT_DEEPLINK_CHOICE",jS="proposal",Wu="Proposal expired",qS="session",dr=V.SEVEN_DAYS,WS="engine",Xe={wc_sessionPropose:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1104},res:{ttl:V.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1106},res:{ttl:V.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1112},res:{ttl:V.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1114},res:{ttl:V.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:V.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:V.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1119}}},Ma={min:V.FIVE_MINUTES,max:V.SEVEN_DAYS},gs={idle:"IDLE",active:"ACTIVE"},HS={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},zS="request",KS=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],VS="wc",GS="auth",YS="authKeys",JS="pairingTopics",XS="requests",ea=`${VS}@${1.5}:${GS}:`,fo=`${ea}:PUB_KEY`;var ZS=Object.defineProperty,QS=Object.defineProperties,e_=Object.getOwnPropertyDescriptors,Hu=Object.getOwnPropertySymbols,t_=Object.prototype.hasOwnProperty,s_=Object.prototype.propertyIsEnumerable,jc=(t,e,s)=>e in t?ZS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ce=(t,e)=>{for(var s in e||(e={}))t_.call(e,s)&&jc(t,s,e[s]);if(Hu)for(var s of Hu(e))s_.call(e,s)&&jc(t,s,e[s]);return t},Ze=(t,e)=>QS(t,e_(e)),B=(t,e,s)=>jc(t,typeof e!="symbol"?e+"":e,s);class n_ extends ey{constructor(e){super(e),B(this,"name",WS),B(this,"events",new Yc),B(this,"initialized",!1),B(this,"requestQueue",{state:gs.idle,queue:[]}),B(this,"sessionRequestQueue",{state:gs.idle,queue:[]}),B(this,"emittedSessionRequests",new oE({limit:500})),B(this,"requestQueueDelay",V.ONE_SECOND),B(this,"expectedPairingMethodMap",new Map),B(this,"recentlyDeletedMap",new Map),B(this,"recentlyDeletedLimit",200),B(this,"relayMessageCache",[]),B(this,"pendingSessions",new Map),B(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Xe)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},V.toMiliseconds(this.requestQueueDelay)))}),B(this,"connect",async s=>{var n;this.isInitialized(),await this.confirmOnlineStateOrThrow();const r=Ze(Ce({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});await this.isValidConnect(r),r.optionalNamespaces=m1(r.requiredNamespaces,r.optionalNamespaces),r.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:l,relays:d,authentication:u,walletPay:h}=r,f=((n=u==null?void 0:u[0])==null?void 0:n.ttl)||Xe.wc_sessionPropose.req.ttl||V.FIVE_MINUTES;this.validateRequestExpiry(f);let g=i,p,w=!1;try{if(g){const P=this.client.core.pairing.pairings.get(g);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),w=P.active}}catch(P){throw this.client.logger.error(`connect() -> pairing.get(${g}) failed`),P}if(!g||!w){const{topic:P,uri:F}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});g=P,p=F}if(!g){const{message:P}=K("NO_MATCHING_KEY",`connect() pairing topic: ${g}`);throw new Error(P)}const b=await this.client.core.crypto.generateKeyPair(),I=Le(f),v=Ce(Ze(Ce(Ce({requiredNamespaces:o,optionalNamespaces:a,relays:d??[{protocol:Bp}],proposer:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:I,pairingTopic:g},c&&{sessionProperties:c}),l&&{scopedProperties:l}),{id:Gs()}),(u||h)&&{requests:{authentication:u==null?void 0:u.map(P=>{const{domain:F,chains:W,nonce:O,uri:A,exp:S,nbf:y,type:C,statement:T,requestId:$,resources:N,signatureTypes:x}=P;return{domain:F,chains:W,nonce:O,type:C??"caip122",aud:A,version:"1",iat:new Date().toISOString(),exp:S,nbf:y,statement:T,requestId:$,resources:N,signatureTypes:x}}),walletPay:h}}),E=Ne("session_connect",v.id),{reject:_,resolve:R,done:D}=xn(f,Wu),M=({id:P})=>{P===v.id&&(this.client.events.off("proposal_expire",M),this.pendingSessions.delete(v.id),this.events.emit(E,{error:{message:Wu,code:0}}))};return this.client.events.on("proposal_expire",M),this.events.once(E,({error:P,session:F})=>{this.client.events.off("proposal_expire",M),P?_(P):F&&R(F)}),await this.setProposal(v.id,v),await this.sendProposeSession({proposal:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:v.id}}}).catch(P=>{throw this.deleteProposal(v.id),P}),{uri:p,approval:D}}),B(this,"pair",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(s)}catch(n){throw this.client.logger.error("pair() failed"),n}}),B(this,"approve",async s=>{var n,r,i;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=s==null?void 0:s.id)==null?void 0:n.toString(),trace:[ns.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(F){throw o.setError(In.no_internet_connection),F}try{await this.isValidProposalId(s==null?void 0:s.id)}catch(F){throw this.client.logger.error(`approve() -> proposal.get(${s==null?void 0:s.id}) failed`),o.setError(In.proposal_not_found),F}try{await this.isValidApprove(s)}catch(F){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(In.session_approve_namespace_validation_failure),F}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:d,scopedProperties:u,sessionConfig:h,proposalRequestsResponses:f}=s,g=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:w,requiredNamespaces:b,optionalNamespaces:I}=g;let v=(r=this.client.core.eventClient)==null?void 0:r.getEvent({topic:p});v||(v=(i=this.client.core.eventClient)==null?void 0:i.createEvent({type:ns.session_approve_started,properties:{topic:p,trace:[ns.session_approve_started,ns.session_namespaces_validation_success]}}));const E=await this.client.core.crypto.generateKeyPair(),_=w.publicKey,R=await this.client.core.crypto.generateSharedKey(E,_),D=Ze(Ce(Ce(Ce({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:E,metadata:this.client.metadata},expiry:Le(dr)},d&&{sessionProperties:d}),u&&{scopedProperties:u}),h&&{sessionConfig:h}),{proposalRequestsResponses:f}),M=Pe.relay;v.addTrace(ns.subscribing_session_topic);try{await this.client.core.relayer.subscribe(R,{transportType:M,internal:{skipSubscribe:!0}})}catch(F){throw v.setError(In.subscribe_session_topic_failure),F}v.addTrace(ns.subscribe_session_topic_success);const P=Ze(Ce({},D),{topic:R,requiredNamespaces:b,optionalNamespaces:I,pairingTopic:p,acknowledged:!1,self:D.controller,peer:{publicKey:w.publicKey,metadata:w.metadata},controller:E,transportType:Pe.relay,authentication:f==null?void 0:f.authentication,walletPayResult:f==null?void 0:f.walletPay});await this.client.session.set(R,P),v.addTrace(ns.store_session);try{await this.sendApproveSession({sessionTopic:R,proposal:g,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:E},sessionSettleRequest:D,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:Ce({correlationId:a},this.getTVFApproveParams(P))}}),v.addTrace(ns.session_approve_publish_success)}catch(F){throw this.client.logger.error(F),this.client.session.delete(R,Ue("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(R),F}return this.client.core.eventClient.deleteEvent({eventId:v.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:w.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(R,Le(dr)),{topic:R,acknowledged:()=>Promise.resolve(this.client.session.get(R))}}),B(this,"reject",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(s)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:r}=s;let i;try{i=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}i&&await this.sendError({id:n,topic:i,error:r,rpcOpts:Xe.wc_sessionPropose.reject}),await this.deleteProposal(n)}),B(this,"update",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(s)}catch(u){throw this.client.logger.error("update() -> isValidUpdate() failed"),u}const{topic:n,namespaces:r}=s,{done:i,resolve:o,reject:a}=xn(V.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=Gs(),l=Rn().toString(),d=this.client.session.get(n).namespaces;return this.events.once(Ne("session_update",c),({error:u})=>{u?a(u):o()}),await this.client.session.update(n,{namespaces:r}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:r},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(u=>{this.client.logger.error(u),this.client.session.update(n,{namespaces:d}),a(u)}),{acknowledged:i}}),B(this,"extend",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(s)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=s,r=Gs(),{done:i,resolve:o,reject:a}=xn(V.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(Ne("session_extend",r),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,Le(dr)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:r,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:i}}),B(this,"request",async s=>{this.isInitialized();try{await this.isValidRequest(s)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}const{chainId:n,request:r,topic:i,expiry:o=Xe.wc_sessionRequest.req.ttl}=s,a=this.client.session.get(i);(a==null?void 0:a.transportType)===Pe.relay&&await this.confirmOnlineStateOrThrow();const c=Gs(),l=Rn().toString(),{done:d,resolve:u,reject:h}=xn(o,"Request expired. Please try again.");this.events.once(Ne("session_request",c),({error:w,result:b})=>{w?h(w):u(b)});const f="wc_sessionRequest",g=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(g)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:f,params:{request:Ze(Ce({},r),{expiryTimestamp:Le(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:g}).catch(w=>h(w)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:n,id:c}),await d();const p={request:Ze(Ce({},r),{expiryTimestamp:Le(o)}),chainId:n};return await Promise.all([new Promise(async w=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:f,params:p,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,p)}).catch(b=>h(b)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:n,id:c}),w()}),new Promise(async w=>{var b;if(!((b=a.sessionConfig)!=null&&b.disableDeepLink)){const I=await tE(this.client.core.storage,qu);await Zb({id:c,topic:i,wcDeepLink:I})}w()}),d()]).then(w=>w[2])}),B(this,"respond",async s=>{var n,r;this.isInitialized();const i=this.client.core.eventClient.createEvent({properties:{topic:(s==null?void 0:s.topic)||((r=(n=s==null?void 0:s.response)==null?void 0:n.id)==null?void 0:r.toString()),trace:[ns.session_request_response_started]}});try{await this.isValidRespond(s)}catch(u){throw i.addTrace(u==null?void 0:u.message),i.setError(In.session_request_response_validation_failure),u}i.addTrace(ns.session_request_response_validation_success);const{topic:o,response:a}=s,{id:c}=a,l=this.client.session.get(o);l.transportType===Pe.relay&&await this.confirmOnlineStateOrThrow();const d=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{i.addTrace(ns.session_request_response_publish_started),Ps(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:d}):ws(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:d}),this.cleanupAfterResponse(s)}catch(u){throw i.addTrace(u==null?void 0:u.message),i.setError(In.session_request_response_publish_failure),u}}),B(this,"ping",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(s)}catch(r){throw this.client.logger.error("ping() -> isValidPing() failed"),r}const{topic:n}=s;if(this.client.session.keys.includes(n)){const r=Gs(),i=Rn().toString(),{done:o,resolve:a,reject:c}=xn(V.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(Ne("session_ping",r),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:r,relayRpcId:i}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),B(this,"emit",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(s);const{topic:n,event:r,chainId:i}=s,o=Rn().toString(),a=Gs();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:r,chainId:i},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),B(this,"disconnect",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(s);const{topic:n}=s;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:Ue("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:r}=K("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(r)}}),B(this,"find",s=>(this.isInitialized(),this.client.session.getAll().filter(n=>b1(n,s)))),B(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),B(this,"authenticate",async(s,n)=>{var r;this.isInitialized(),this.isValidAuthenticate(s);const i=n&&this.client.core.linkModeSupportedApps.includes(n)&&((r=this.client.metadata.redirect)==null?void 0:r.linkMode),o=i?Pe.link_mode:Pe.relay;o===Pe.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:d,nonce:u,type:h,exp:f,nbf:g,methods:p=[],expiry:w}=s,b=[...s.resources||[]],{topic:I,uri:v}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:I,uri:v}});const E=await this.client.core.crypto.generateKeyPair(),_=uo(E);if(await Promise.all([this.client.auth.authKeys.set(fo,{responseTopic:_,publicKey:E}),this.client.auth.pairingTopics.set(_,{topic:_,pairingTopic:I})]),await this.client.core.relayer.subscribe(_,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${I}`),p.length>0){const{namespace:N}=Hs(a[0]);let x=bv(N,"request",p);lo(b)&&(x=vv(x,b.pop())),b.push(x)}const R=w&&w>Xe.wc_sessionAuthenticate.req.ttl?w:Xe.wc_sessionAuthenticate.req.ttl,D={authPayload:{type:h??"caip122",chains:a,statement:c,aud:l,domain:d,version:"1",nonce:u,iat:new Date().toISOString(),exp:f,nbf:g,resources:b},requester:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:Le(R)},M={eip155:{chains:a,methods:[...new Set(["personal_sign",...p])],events:["chainChanged","accountsChanged"]}},P={requiredNamespaces:{},optionalNamespaces:M,relays:[{protocol:"irn"}],pairingTopic:I,proposer:{publicKey:E,metadata:this.client.metadata},expiryTimestamp:Le(Xe.wc_sessionPropose.req.ttl),id:Gs()},{done:F,resolve:W,reject:O}=xn(R,"Request expired"),A=Gs(),S=Ne("session_connect",P.id),y=Ne("session_request",A),C=async({error:N,session:x})=>{this.events.off(y,T),N?O(N):x&&W({session:x})},T=async N=>{var x,q,z;if(await this.deletePendingAuthRequest(A,{message:"fulfilled",code:0}),N.error){const ce=Ue("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return N.error.code===ce.code?void 0:(this.events.off(S,C),O(N.error.message))}await this.deleteProposal(P.id),this.events.off(S,C);const{cacaos:ae,responder:ne}=N.result,Q=[],le=[];for(const ce of ae){await Ld({cacao:ce,projectId:this.client.core.projectId})||(this.client.logger.error(ce,"Signature verification failed"),O(Ue("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:_e}=ce,ct=lo(_e.resources),mt=[yc(_e.iss)],lt=xo(_e.iss);if(ct){const Ft=Md(ct),vn=Fd(ct);Q.push(...Ft),mt.push(...vn)}for(const Ft of mt)le.push(`${Ft}:${lt}`)}const ie=await this.client.core.crypto.generateSharedKey(E,ne.publicKey);let Ie;Q.length>0&&(Ie={topic:ie,acknowledged:!0,self:{publicKey:E,metadata:this.client.metadata},peer:ne,controller:ne.publicKey,expiry:Le(dr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:I,namespaces:hu([...new Set(Q)],[...new Set(le)]),transportType:o},await this.client.core.relayer.subscribe(ie,{transportType:o}),await this.client.session.set(ie,Ie),I&&await this.client.core.pairing.updateMetadata({topic:I,metadata:ne.metadata}),Ie=this.client.session.get(ie)),(x=this.client.metadata.redirect)!=null&&x.linkMode&&(q=ne.metadata.redirect)!=null&&q.linkMode&&(z=ne.metadata.redirect)!=null&&z.universal&&n&&(this.client.core.addLinkModeSupportedApp(ne.metadata.redirect.universal),this.client.session.update(ie,{transportType:Pe.link_mode})),W({auths:ae,session:Ie})};this.events.once(S,C),this.events.once(y,T);let $;try{if(i){const N=ys("wc_sessionAuthenticate",D,A);this.client.core.history.set(I,N);const x=await this.client.core.crypto.encode("",N,{type:Pi,encoding:ln});$=Ji(n,I,x)}else await Promise.all([this.sendRequest({topic:I,method:"wc_sessionAuthenticate",params:D,expiry:s.expiry,throwOnFailedPublish:!0,clientRpcId:A}),this.sendRequest({topic:I,method:"wc_sessionPropose",params:P,expiry:Xe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:P.id})])}catch(N){throw this.events.off(S,C),this.events.off(y,T),N}return await this.setProposal(P.id,P),await this.setAuthRequest(A,{request:Ze(Ce({},D),{verifyContext:{}}),pairingTopic:I,transportType:o}),{uri:$??v,response:F}}),B(this,"approveSessionAuthenticate",async s=>{const{id:n,auths:r}=s,i=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[Nn.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw i.setError(zr.no_internet_connection),w}const o=this.getPendingAuthRequest(n);if(!o)throw i.setError(zr.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||Pe.relay;a===Pe.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),d=uo(c),u={type:zs,receiverPublicKey:c,senderPublicKey:l},h=[],f=[];for(const w of r){if(!await Ld({cacao:w,projectId:this.client.core.projectId})){i.setError(zr.invalid_cacao);const _=Ue("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:d,error:_,encodeOpts:u}),new Error(_.message)}i.addTrace(Nn.cacaos_verified);const{p:b}=w,I=lo(b.resources),v=[yc(b.iss)],E=xo(b.iss);if(I){const _=Md(I),R=Fd(I);h.push(..._),v.push(...R)}for(const _ of v)f.push(`${_}:${E}`)}const g=await this.client.core.crypto.generateSharedKey(l,c);i.addTrace(Nn.create_authenticated_session_topic);let p;if((h==null?void 0:h.length)>0){p={topic:g,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Le(dr),authentication:r,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:hu([...new Set(h)],[...new Set(f)]),transportType:a},i.addTrace(Nn.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(g,{transportType:a})}catch(w){throw i.setError(zr.subscribe_authenticated_session_topic_failure),w}i.addTrace(Nn.subscribe_authenticated_session_topic_success),await this.client.session.set(g,p),i.addTrace(Nn.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}i.addTrace(Nn.publishing_authenticated_session_approve);try{await this.sendResult({topic:d,id:n,result:{cacaos:r,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:u,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw i.setError(zr.authenticated_session_approve_publish_failure),w}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:p}}),B(this,"rejectSessionAuthenticate",async s=>{this.isInitialized();const{id:n,reason:r}=s,i=this.getPendingAuthRequest(n);if(!i)throw new Error(`Could not find pending auth request with id ${n}`);i.transportType===Pe.relay&&await this.confirmOnlineStateOrThrow();const o=i.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=uo(o),l={type:zs,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:r,encodeOpts:l,rpcOpts:Xe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),B(this,"formatAuthMessage",s=>{this.isInitialized();const{request:n,iss:r}=s;return Jf(n,r)}),B(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const s=this.relayMessageCache.shift();s&&await this.onRelayMessage(s)}catch(s){this.client.logger.error(s)}},50)}),B(this,"cleanupDuplicatePairings",async s=>{if(s.pairingTopic)try{const n=this.client.core.pairing.pairings.get(s.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(i=>{var o,a;return((o=i.peerMetadata)==null?void 0:o.url)&&((a=i.peerMetadata)==null?void 0:a.url)===s.peer.metadata.url&&i.topic&&i.topic!==n.topic});if(r.length===0)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),B(this,"deleteSession",async s=>{var n;const{topic:r,expirerHasDeleted:i=!1,emitEvent:o=!0,id:a=0}=s,{self:c}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await this.client.session.delete(r,Ue("USER_DISCONNECTED")),this.addToRecentlyDeleted(r,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(qu).catch(l=>this.client.logger.warn(l)),r===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=gs.idle),await Promise.all(this.getPendingSessionRequests().filter(l=>l.topic===r).map(l=>this.deletePendingSessionRequest(l.id,Ue("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:r})}),B(this,"deleteProposal",async(s,n)=>{if(n)try{const r=this.client.proposal.get(s),i=this.client.core.eventClient.getEvent({topic:r.pairingTopic});i==null||i.setError(In.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(s,Ue("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"proposal")}),B(this,"deletePendingSessionRequest",async(s,n,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(s,n),r?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==s),r&&(this.sessionRequestQueue.state=gs.idle,this.client.events.emit("session_request_expire",{id:s}))}),B(this,"deletePendingAuthRequest",async(s,n,r=!1)=>{await Promise.all([this.client.auth.requests.delete(s,n),r?Promise.resolve():this.client.core.expirer.del(s)])}),B(this,"setExpiry",async(s,n)=>{this.client.session.keys.includes(s)&&(this.client.core.expirer.set(s,n),await this.client.session.update(s,{expiry:n}))}),B(this,"setProposal",async(s,n)=>{this.client.core.expirer.set(s,Le(Xe.wc_sessionPropose.req.ttl)),await this.client.proposal.set(s,n)}),B(this,"setAuthRequest",async(s,n)=>{const{request:r,pairingTopic:i,transportType:o=Pe.relay}=n;this.client.core.expirer.set(s,r.expiryTimestamp),await this.client.auth.requests.set(s,{authPayload:r.authPayload,requester:r.requester,expiryTimestamp:r.expiryTimestamp,id:s,pairingTopic:i,verifyContext:r.verifyContext,transportType:o})}),B(this,"setPendingSessionRequest",async s=>{const{id:n,topic:r,params:i,verifyContext:o}=s,a=i.request.expiryTimestamp||Le(Xe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:r,params:i,verifyContext:o})}),B(this,"sendRequest",async s=>{const{topic:n,method:r,params:i,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:d,tvf:u,publishOpts:h={}}=s,f=ys(r,i,c);let g;const p=!!d;try{const I=p?ln:It;g=await this.client.core.crypto.encode(n,f,{encoding:I})}catch(I){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),I}let w;if(KS.includes(r)){const I=Yt(JSON.stringify(f)),v=Yt(g);w=await this.client.core.verify.register({id:v,decryptedId:I})}const b=Ce(Ce({},Xe[r].req),h);if(b.attestation=w,o&&(b.ttl=o),a&&(b.id=a),this.client.core.history.set(n,f),p){const I=Ji(d,n,g);await global.Linking.openURL(I,this.client.name)}else b.tvf=Ze(Ce({},u),{correlationId:f.id}),l?(b.internal=Ze(Ce({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,g,b)):this.client.core.relayer.publish(n,g,b).catch(I=>this.client.logger.error(I));return f.id}),B(this,"sendProposeSession",async s=>{const{proposal:n,publishOpts:r}=s,i=ys("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,i);const o=await this.client.core.crypto.encode(n.pairingTopic,i,{encoding:It}),a=Yt(JSON.stringify(i)),c=Yt(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:Ze(Ce({},r),{publishMethod:"wc_proposeSession",attestation:l})})}),B(this,"sendApproveSession",async s=>{const{sessionTopic:n,pairingProposalResponse:r,proposal:i,sessionSettleRequest:o,publishOpts:a}=s,c=li(i.id,r),l=await this.client.core.crypto.encode(i.pairingTopic,c,{encoding:It}),d=ys("wc_sessionSettle",o,a==null?void 0:a.id),u=await this.client.core.crypto.encode(n,d,{encoding:It});this.client.core.history.set(n,d),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:i.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:u},opts:Ze(Ce({},a),{publishMethod:"wc_approveSession"})})}),B(this,"sendResult",async s=>{const{id:n,topic:r,result:i,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=s,l=li(n,i);let d;const u=c&&typeof(global==null?void 0:global.Linking)<"u";try{const g=u?ln:It;d=await this.client.core.crypto.encode(r,l,Ze(Ce({},a||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${r} failed`),g}let h,f;try{h=await this.client.core.history.get(r,n);const g=h.request;try{f=this.getTVFParams(n,g.params,i)}catch(p){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${p==null?void 0:p.message}`)}}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${r}, ${n}) failed`),g}if(u){const g=Ji(c,r,d);await global.Linking.openURL(g,this.client.name)}else{const g=h.request.method,p=Xe[g].res;p.tvf=Ze(Ce({},f),{correlationId:n}),o?(p.internal=Ze(Ce({},p.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,d,p)):this.client.core.relayer.publish(r,d,p).catch(w=>this.client.logger.error(w))}await this.client.core.history.resolve(l)}),B(this,"sendError",async s=>{const{id:n,topic:r,error:i,encodeOpts:o,rpcOpts:a,appLink:c}=s,l=Th(n,i);let d;const u=c&&typeof(global==null?void 0:global.Linking)<"u";try{const f=u?ln:It;d=await this.client.core.crypto.encode(r,l,Ze(Ce({},o||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${r} failed`),f}let h;try{h=await this.client.core.history.get(r,n)}catch(f){throw this.client.logger.error(`sendError() -> history.get(${r}, ${n}) failed`),f}if(u){const f=Ji(c,r,d);await global.Linking.openURL(f,this.client.name)}else{const f=h.request.method,g=a||Xe[f].res;this.client.core.relayer.publish(r,d,g)}await this.client.core.history.resolve(l)}),B(this,"cleanup",async()=>{const s=[],n=[];this.client.session.getAll().forEach(r=>{let i=!1;bs(r.expiry)&&(i=!0),this.client.core.crypto.keychain.has(r.topic)||(i=!0),i&&s.push(r.topic)}),this.client.proposal.getAll().forEach(r=>{bs(r.expiryTimestamp)&&n.push(r.id)}),await Promise.all([...s.map(r=>this.deleteSession({topic:r})),...n.map(r=>this.deleteProposal(r))])}),B(this,"onProviderMessageEvent",async s=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(s):await this.onRelayMessage(s)}),B(this,"onRelayEventRequest",async s=>{this.requestQueue.queue.push(s),await this.processRequestsQueue()}),B(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===gs.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=gs.active;const s=this.requestQueue.queue.shift();if(s)try{await this.processRequest(s)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=gs.idle}),B(this,"processRequest",async s=>{const{topic:n,payload:r,attestation:i,transportType:o,encryptedId:a}=s,c=r.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:r,attestation:i,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,r);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,r);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,r);case"wc_sessionPing":return await this.onSessionPingRequest(n,r);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,r);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:r,attestation:i,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,r);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:r,attestation:i,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),B(this,"onRelayEventResponse",async s=>{const{topic:n,payload:r,transportType:i}=s,o=(await this.client.core.history.get(n,r.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,r,i);case"wc_sessionSettle":return this.onSessionSettleResponse(n,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,r);case"wc_sessionExtend":return this.onSessionExtendResponse(n,r);case"wc_sessionPing":return this.onSessionPingResponse(n,r);case"wc_sessionRequest":return this.onSessionRequestResponse(n,r);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,r);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),B(this,"onRelayEventUnknownPayload",s=>{const{topic:n}=s,{message:r}=K("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(r)}),B(this,"shouldIgnorePairingRequest",s=>{const{topic:n,requestMethod:r}=s,i=this.expectedPairingMethodMap.get(n);return!i||i.includes(r)?!1:!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),B(this,"onSessionProposeRequest",async s=>{const{topic:n,payload:r,attestation:i,encryptedId:o}=s,{params:a,id:c}=r;try{const l=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(Rs.proposal_listener_not_found)),this.isValidConnect(Ce({},r.params));const d=a.expiryTimestamp||Le(Xe.wc_sessionPropose.req.ttl),u=Ce({id:c,pairingTopic:n,expiryTimestamp:d,attestation:i,encryptedId:o},a);await this.setProposal(c,u);const h=await this.getVerifyContext({attestationId:i,hash:Yt(JSON.stringify(r)),encryptedId:o,metadata:u.proposer.metadata});l==null||l.addTrace(ms.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:u,verifyContext:h})}catch(l){await this.sendError({id:c,topic:n,error:l,rpcOpts:Xe.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),B(this,"onSessionProposeResponse",async(s,n,r)=>{const{id:i}=n;if(Ps(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const d=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(i,{sessionTopic:d,pairingTopic:s,proposalId:i,publicKey:c});const u=await this.client.core.relayer.subscribe(d,{transportType:r});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:u}),await this.client.core.pairing.activate({topic:s})}else if(ws(n)){await this.deleteProposal(i);const o=Ne("session_connect",i);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),B(this,"onSessionSettleRequest",async(s,n)=>{const{id:r,params:i}=n;try{this.isValidSessionSettleRequest(i);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:d,scopedProperties:u,sessionConfig:h,proposalRequestsResponses:f}=n.params,g=[...this.pendingSessions.values()].find(b=>b.sessionTopic===s);if(!g)return this.client.logger.error(`Pending session not found for topic ${s}`);const p=this.client.proposal.get(g.proposalId),w=Ze(Ce(Ce(Ce({topic:s,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:g.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:g.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},d&&{sessionProperties:d}),u&&{scopedProperties:u}),h&&{sessionConfig:h}),{transportType:Pe.relay,authentication:f==null?void 0:f.authentication,walletPayResult:f==null?void 0:f.walletPay});await this.client.session.set(w.topic,w),await this.setExpiry(w.topic,w.expiry),await this.client.core.pairing.updateMetadata({topic:g.pairingTopic,metadata:w.peer.metadata}),this.pendingSessions.delete(g.proposalId),this.deleteProposal(g.proposalId,!1),this.cleanupDuplicatePairings(w),await this.sendResult({id:n.id,topic:s,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:w}),this.events.emit(Ne("session_connect",g.proposalId),{session:w})}catch(o){await this.sendError({id:r,topic:s,error:o}),this.client.logger.error(o)}}),B(this,"onSessionSettleResponse",async(s,n)=>{const{id:r}=n;Ps(n)?(await this.client.session.update(s,{acknowledged:!0}),this.events.emit(Ne("session_approve",r),{})):ws(n)&&(await this.client.session.delete(s,Ue("USER_DISCONNECTED")),this.events.emit(Ne("session_approve",r),{error:n.error}))}),B(this,"onSessionUpdateRequest",async(s,n)=>{const{params:r,id:i}=n;try{const o=`${s}_session_update`,a=Wr.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:s,error:Ue("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Ce({topic:s},r));try{Wr.set(o,i),await this.client.session.update(s,{namespaces:r.namespaces}),await this.sendResult({id:i,topic:s,result:!0})}catch(c){throw Wr.delete(o),c}this.client.events.emit("session_update",{id:i,topic:s,params:r})}catch(o){await this.sendError({id:i,topic:s,error:o}),this.client.logger.error(o)}}),B(this,"isRequestOutOfSync",(s,n)=>n.toString().slice(0,-3)<s.toString().slice(0,-3)),B(this,"onSessionUpdateResponse",(s,n)=>{const{id:r}=n,i=Ne("session_update",r);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Ps(n)?this.events.emit(Ne("session_update",r),{}):ws(n)&&this.events.emit(Ne("session_update",r),{error:n.error})}),B(this,"onSessionExtendRequest",async(s,n)=>{const{id:r}=n;try{this.isValidExtend({topic:s}),await this.setExpiry(s,Le(dr)),await this.sendResult({id:r,topic:s,result:!0}),this.client.events.emit("session_extend",{id:r,topic:s})}catch(i){await this.sendError({id:r,topic:s,error:i}),this.client.logger.error(i)}}),B(this,"onSessionExtendResponse",(s,n)=>{const{id:r}=n,i=Ne("session_extend",r);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Ps(n)?this.events.emit(Ne("session_extend",r),{}):ws(n)&&this.events.emit(Ne("session_extend",r),{error:n.error})}),B(this,"onSessionPingRequest",async(s,n)=>{const{id:r}=n;try{this.isValidPing({topic:s}),await this.sendResult({id:r,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:r,topic:s})}catch(i){await this.sendError({id:r,topic:s,error:i}),this.client.logger.error(i)}}),B(this,"onSessionPingResponse",(s,n)=>{const{id:r}=n,i=Ne("session_ping",r);setTimeout(()=>{if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners 2176`);Ps(n)?this.events.emit(Ne("session_ping",r),{}):ws(n)&&this.events.emit(Ne("session_ping",r),{error:n.error})},500)}),B(this,"onSessionDeleteRequest",async(s,n)=>{const{id:r}=n;try{await this.isValidDisconnect({topic:s,reason:n.params}),this.cleanupPendingSentRequestsForTopic({topic:s,error:Ue("USER_DISCONNECTED")}),await this.deleteSession({topic:s,id:r})}catch(i){this.client.logger.error(i)}}),B(this,"onSessionRequest",async s=>{var n,r,i;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:d}=s,{id:u,params:h}=a;try{await this.isValidRequest(Ce({topic:o},h));const f=this.client.session.get(o),g=await this.getVerifyContext({attestationId:c,hash:Yt(JSON.stringify(ys("wc_sessionRequest",h,u))),encryptedId:l,metadata:f.peer.metadata,transportType:d}),p={id:u,topic:o,params:h,verifyContext:g};await this.setPendingSessionRequest(p),d===Pe.link_mode&&(n=f.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((r=f.peer.metadata.redirect)==null?void 0:r.universal),(i=this.client.signConfig)!=null&&i.disableRequestQueue?this.emitSessionRequest(p):(this.addSessionRequestToSessionRequestQueue(p),this.processSessionRequestQueue())}catch(f){await this.sendError({id:u,topic:o,error:f}),this.client.logger.error(f)}}),B(this,"onSessionRequestResponse",(s,n)=>{const{id:r}=n,i=Ne("session_request",r);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Ps(n)?this.events.emit(Ne("session_request",r),{result:n.result}):ws(n)&&this.events.emit(Ne("session_request",r),{error:n.error})}),B(this,"onSessionEventRequest",async(s,n)=>{const{id:r,params:i}=n;try{const o=`${s}_session_event_${i.event.name}`,a=Wr.get(o);if(a&&this.isRequestOutOfSync(a,r)){this.client.logger.info(`Discarding out of sync request - ${r}`);return}this.isValidEmit(Ce({topic:s},i)),this.client.events.emit("session_event",{id:r,topic:s,params:i}),Wr.set(o,r)}catch(o){await this.sendError({id:r,topic:s,error:o}),this.client.logger.error(o)}}),B(this,"onSessionAuthenticateResponse",(s,n)=>{const{id:r}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:s,payload:n}),Ps(n)?this.events.emit(Ne("session_request",r),{result:n.result}):ws(n)&&this.events.emit(Ne("session_request",r),{error:n.error})}),B(this,"onSessionAuthenticateRequest",async s=>{var n;const{topic:r,payload:i,attestation:o,encryptedId:a,transportType:c}=s;try{const{requester:l,authPayload:d,expiryTimestamp:u}=i.params,h=await this.getVerifyContext({attestationId:o,hash:Yt(JSON.stringify(i)),encryptedId:a,metadata:l.metadata,transportType:c}),f={requester:l,pairingTopic:r,id:i.id,authPayload:d,verifyContext:h,expiryTimestamp:u};await this.setAuthRequest(i.id,{request:f,pairingTopic:r,transportType:c}),c===Pe.link_mode&&(n=l.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:r,params:i.params,id:i.id,verifyContext:h})}catch(l){this.client.logger.error(l);const d=i.params.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),h=this.getAppLinkIfEnabled(i.params.requester.metadata,c),f={type:zs,receiverPublicKey:d,senderPublicKey:u};await this.sendError({id:i.id,topic:r,error:l,encodeOpts:f,rpcOpts:Xe.wc_sessionAuthenticate.autoReject,appLink:h})}}),B(this,"addSessionRequestToSessionRequestQueue",s=>{this.sessionRequestQueue.queue.push(s)}),B(this,"cleanupAfterResponse",s=>{this.deletePendingSessionRequest(s.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=gs.idle,this.processSessionRequestQueue()},V.toMiliseconds(this.requestQueueDelay))}),B(this,"cleanupPendingSentRequestsForTopic",({topic:s,error:n})=>{const r=this.client.core.history.pending;r.length>0&&r.filter(i=>i.topic===s&&i.request.method==="wc_sessionRequest").forEach(i=>{this.events.emit(Ne("session_request",i.request.id),{error:n})})}),B(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===gs.active){this.client.logger.info("session request queue is already active.");return}const s=this.sessionRequestQueue.queue[0];if(!s){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(s)}catch(n){this.client.logger.error(n)}}),B(this,"emitSessionRequest",s=>{if(this.emittedSessionRequests.has(s.id)){this.client.logger.warn({id:s.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${s.id}`);return}this.sessionRequestQueue.state=gs.active,this.emittedSessionRequests.add(s.id),this.client.events.emit("session_request",s)}),B(this,"onPairingCreated",s=>{if(s.methods&&this.expectedPairingMethodMap.set(s.topic,s.methods),s.active)return;const n=this.client.proposal.getAll().find(r=>r.pairingTopic===s.topic);n&&this.onSessionProposeRequest({topic:s.topic,payload:ys("wc_sessionPropose",Ze(Ce({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),B(this,"isValidConnect",async s=>{if(!vt(s)){const{message:l}=K("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(l)}const{pairingTopic:n,requiredNamespaces:r,optionalNamespaces:i,sessionProperties:o,scopedProperties:a,relays:c}=s;if(Ve(n)||await this.isValidPairingTopic(n),!P1(c)){const{message:l}=K("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(r&&!Ve(r)&&Ns(r)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(r,"requiredNamespaces")}if(i&&!Ve(i)&&Ns(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),o&&!Ve(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ve(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(r||{}).concat(Object.keys(i||{}));if(!Object.keys(a).every(d=>l.includes(d.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),B(this,"validateNamespaces",(s,n)=>{const r=O1(s,"connect()",n);if(r)throw new Error(r.message)}),B(this,"isValidApprove",async s=>{if(!vt(s))throw new Error(K("MISSING_OR_INVALID",`approve() params: ${s}`).message);const{id:n,namespaces:r,relayProtocol:i,sessionProperties:o,scopedProperties:a}=s;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),l=Ra(r,"approve()");if(l)throw new Error(l.message);const d=gu(c.requiredNamespaces,r,"approve()");if(d)throw new Error(d.message);if(!Fe(i,!0)){const{message:u}=K("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(u)}if(o&&!Ve(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ve(a)){this.validateSessionProps(a,"scopedProperties");const u=new Set(Object.keys(r));if(!Object.keys(a).every(h=>u.has(h.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(u).join(", ")}`)}}),B(this,"isValidReject",async s=>{if(!vt(s)){const{message:i}=K("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(i)}const{id:n,reason:r}=s;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!R1(r)){const{message:i}=K("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw new Error(i)}}),B(this,"isValidSessionSettleRequest",s=>{if(!vt(s)){const{message:l}=K("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${s}`);throw new Error(l)}const{relay:n,controller:r,namespaces:i,expiry:o}=s;if(!Up(n)){const{message:l}=K("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=I1(r,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Ra(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(bs(o)){const{message:l}=K("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),B(this,"isValidUpdate",async s=>{if(!vt(s)){const{message:c}=K("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(c)}const{topic:n,namespaces:r}=s;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const i=this.client.session.get(n),o=Ra(r,"update()");if(o)throw new Error(o.message);const a=gu(i.requiredNamespaces,r,"update()");if(a)throw new Error(a.message)}),B(this,"isValidExtend",async s=>{if(!vt(s)){const{message:r}=K("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(r)}const{topic:n}=s;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),B(this,"isValidRequest",async s=>{if(!vt(s)){const{message:c}=K("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(c)}const{topic:n,request:r,chainId:i,expiry:o}=s;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!pu(a,i)){const{message:c}=K("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(c)}if(!U1(r)){const{message:c}=K("MISSING_OR_INVALID",`request() ${JSON.stringify(r)}`);throw new Error(c)}if(!B1(a,i,r.method)){const{message:c}=K("MISSING_OR_INVALID",`request() method: ${r.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),B(this,"isValidRespond",async s=>{var n;if(!vt(s)){const{message:a}=K("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(a)}const{topic:r,response:i}=s;try{await this.isValidSessionTopic(r)}catch(a){throw(n=s==null?void 0:s.response)!=null&&n.id&&this.cleanupAfterResponse(s),a}if(!$1(i)){const{message:a}=K("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(a)}const o=this.client.pendingRequest.get(i.id);if(o.topic!==r){const{message:a}=K("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${i.id}, expected topic: ${o.topic}, received topic: ${r}`);throw new Error(a)}}),B(this,"isValidPing",async s=>{if(!vt(s)){const{message:r}=K("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(r)}const{topic:n}=s;await this.isValidSessionOrPairingTopic(n)}),B(this,"isValidEmit",async s=>{if(!vt(s)){const{message:a}=K("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(a)}const{topic:n,event:r,chainId:i}=s;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!pu(o,i)){const{message:a}=K("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!D1(r)){const{message:a}=K("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(a)}if(!L1(o,i,r.name)){const{message:a}=K("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(a)}}),B(this,"isValidDisconnect",async s=>{if(!vt(s)){const{message:r}=K("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(r)}const{topic:n}=s;await this.isValidSessionOrPairingTopic(n)}),B(this,"isValidAuthenticate",s=>{const{chains:n,uri:r,domain:i,nonce:o}=s;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!Fe(r,!1))throw new Error("uri is required parameter");if(!Fe(i,!1))throw new Error("domain is required parameter");if(!Fe(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>Hs(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Hs(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),B(this,"getVerifyContext",async s=>{const{attestationId:n,hash:r,encryptedId:i,metadata:o,transportType:a}=s,c={verified:{verifyUrl:o.verifyUrl||ii,validation:"UNKNOWN",origin:o.url||""}};try{if(a===Pe.link_mode){const d=this.getAppLinkIfEnabled(o,a);return c.verified.validation=d&&new URL(d).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:n,hash:r,encryptedId:i,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),B(this,"validateSessionProps",(s,n)=>{Object.values(s).forEach((r,i)=>{if(r==null){const{message:o}=K("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${r} for key ${Object.keys(s)[i]}`);throw new Error(o)}})}),B(this,"getPendingAuthRequest",s=>{const n=this.client.auth.requests.get(s);return typeof n=="object"?n:void 0}),B(this,"addToRecentlyDeleted",(s,n)=>{if(this.recentlyDeletedMap.set(s,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let r=0;const i=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(r++>=i)break;this.recentlyDeletedMap.delete(o)}}}),B(this,"checkRecentlyDeleted",s=>{const n=this.recentlyDeletedMap.get(s);if(n){const{message:r}=K("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${s}`);throw new Error(r)}}),B(this,"isLinkModeEnabled",(s,n)=>{var r,i,o,a,c,l,d,u,h;return!s||n!==Pe.link_mode?!1:((i=(r=this.client.metadata)==null?void 0:r.redirect)==null?void 0:i.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((d=s==null?void 0:s.redirect)==null?void 0:d.universal)!==void 0&&((u=s==null?void 0:s.redirect)==null?void 0:u.universal)!==""&&((h=s==null?void 0:s.redirect)==null?void 0:h.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(s.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),B(this,"getAppLinkIfEnabled",(s,n)=>{var r;return this.isLinkModeEnabled(s,n)?(r=s==null?void 0:s.redirect)==null?void 0:r.universal:void 0}),B(this,"handleLinkModeMessage",({url:s})=>{if(!s||!s.includes("wc_ev")||!s.includes("topic"))return;const n=Sd(s,"topic")||"",r=decodeURIComponent(Sd(s,"wc_ev")||""),i=this.client.session.keys.includes(n);i&&this.client.session.update(n,{transportType:Pe.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:r,sessionExists:i})}),B(this,"registerLinkModeListeners",async()=>{var s;if(pl()||bn()&&(s=this.client.metadata.redirect)!=null&&s.linkMode){const n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const r=await n.getInitialURL();r&&setTimeout(()=>{this.handleLinkModeMessage({url:r})},50)}}}),B(this,"getTVFApproveParams",s=>{try{const n=kp(s.namespaces),r=u1(s.namespaces),i=h1(s.namespaces),o=s.sessionProperties,a=s.scopedProperties;return{approvedChains:n,approvedMethods:r,approvedEvents:i,sessionProperties:o,scopedProperties:a}}catch(n){return this.client.logger.warn(n,"Error getting TVF approve params"),{}}}),B(this,"getTVFParams",(s,n,r)=>{var i,o,a;if(!((i=n.request)!=null&&i.method))return{};const c={correlationId:s,rpcMethods:[n.request.method],chainId:n.chainId};try{const l=this.extractTxHashesFromResult(n.request,r);c.txHashes=l,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),B(this,"isValidContractData",s=>{var n;if(!s)return!1;try{const r=(s==null?void 0:s.data)||((n=s==null?void 0:s[0])==null?void 0:n.data);if(!r.startsWith("0x"))return!1;const i=r.slice(2);return/^[0-9a-fA-F]*$/.test(i)?i.length%2===0:!1}catch{}return!1}),B(this,"extractTxHashesFromResult",(s,n)=>{var r;try{if(!n)return[];const i=s.method,o=HS[i];if(i==="sui_signTransaction")return[ev(n.transactionBytes)];if(i==="near_signTransaction")return[Ud(n)];if(i==="near_signTransactions")return n.map(c=>Ud(c));if(i==="xrpl_signTransactionFor"||i==="xrpl_signTransaction")return[(r=n.tx_json)==null?void 0:r.hash];if(i==="polkadot_signTransaction")return[sA({transaction:s.params.transactionPayload,signature:n.signature})];if(i==="algo_signTxn")return Ks(n)?n.map(c=>$d(c)):[$d(n)];if(i==="cosmos_signDirect")return[sv(n)];if(i==="wallet_sendCalls")return nv(n);if(typeof n=="string")return[n];const a=n[o.key];if(Ks(a))return i==="solana_signAllTransactions"?a.map(c=>QE(c)):a;if(typeof a=="string")return[a]}catch(i){this.client.logger.warn(i,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,s=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,r]of Object.entries(s))for(const i of r)try{await this.onProviderMessageEvent({topic:n,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${i}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Me.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:s,message:n,attestation:r,transportType:i}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(fo)?this.client.auth.authKeys.get(fo):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(s,n,{receiverPublicKey:o,encoding:i===Pe.link_mode?ln:It});Qc(a)?(this.client.core.history.set(s,a),await this.onRelayEventRequest({topic:s,payload:a,attestation:r,transportType:i,encryptedId:Yt(n)})):el(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:s,payload:a,transportType:i}),this.client.core.history.delete(s,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:s,payload:a,transportType:i})),await this.client.core.relayer.messages.ack(s,n)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${n}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Vt.expired,async e=>{const{topic:s,id:n}=Rf(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,K("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,K("EXPIRED"),!0);s?this.client.session.keys.includes(s)&&(await this.deleteSession({topic:s,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:s})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(On.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(On.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Fe(e,!1)){const{message:s}=K("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(s)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:s}=K("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(s)}if(bs(this.client.core.pairing.pairings.get(e).expiry)){const{message:s}=K("EXPIRED",`pairing topic: ${e}`);throw new Error(s)}}async isValidSessionTopic(e){if(!Fe(e,!1)){const{message:s}=K("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(s)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:s}=K("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(s)}if(bs(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:s}=K("EXPIRED",`session topic: ${e}`);throw new Error(s)}if(!this.client.core.crypto.keychain.has(e)){const{message:s}=K("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(s)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Fe(e,!1)){const{message:s}=K("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(s)}else{const{message:s}=K("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(s)}}async isValidProposalId(e){if(!k1(e)){const{message:s}=K("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(s)}if(!this.client.proposal.keys.includes(e)){const{message:s}=K("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(s)}if(bs(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:s}=K("EXPIRED",`proposal id: ${e}`);throw new Error(s)}}validateRequestExpiry(e){if(e&&!j1(e,Ma)){const{message:s}=K("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${Ma.min} and ${Ma.max}`);throw new Error(s)}}}class r_ extends er{constructor(e,s){super(e,s,jS,Sl),this.core=e,this.logger=s}}let i_=class extends er{constructor(e,s){super(e,s,qS,Sl),this.core=e,this.logger=s}};class o_ extends er{constructor(e,s){super(e,s,zS,Sl,n=>n.id),this.core=e,this.logger=s}}class a_ extends er{constructor(e,s){super(e,s,YS,ea,()=>fo),this.core=e,this.logger=s}}class c_ extends er{constructor(e,s){super(e,s,JS,ea),this.core=e,this.logger=s}}class l_ extends er{constructor(e,s){super(e,s,XS,ea,n=>n.id),this.core=e,this.logger=s}}var d_=Object.defineProperty,u_=(t,e,s)=>e in t?d_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Fa=(t,e,s)=>u_(t,typeof e!="symbol"?e+"":e,s);class h_{constructor(e,s){this.core=e,this.logger=s,Fa(this,"authKeys"),Fa(this,"pairingTopics"),Fa(this,"requests"),this.authKeys=new a_(this.core,this.logger),this.pairingTopics=new c_(this.core,this.logger),this.requests=new l_(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var f_=Object.defineProperty,p_=(t,e,s)=>e in t?f_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,me=(t,e,s)=>p_(t,typeof e!="symbol"?e+"":e,s);class _l extends Qw{constructor(e){super(e),me(this,"protocol",Zp),me(this,"version",Qp),me(this,"name",La.name),me(this,"metadata"),me(this,"core"),me(this,"logger"),me(this,"events",new Yn.EventEmitter),me(this,"engine"),me(this,"session"),me(this,"proposal"),me(this,"pendingRequest"),me(this,"auth"),me(this,"signConfig"),me(this,"on",(n,r)=>this.events.on(n,r)),me(this,"once",(n,r)=>this.events.once(n,r)),me(this,"off",(n,r)=>this.events.off(n,r)),me(this,"removeListener",(n,r)=>this.events.removeListener(n,r)),me(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),me(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"update",async n=>{try{return await this.engine.update(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"request",async n=>{try{return await this.engine.request(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"find",n=>{try{return this.engine.find(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),me(this,"authenticate",async(n,r)=>{try{return await this.engine.authenticate(n,r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(r){throw this.logger.error(r.message),r}}),me(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(r){throw this.logger.error(r.message),r}}),this.name=(e==null?void 0:e.name)||La.name,this.metadata=Kb(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const s=Nl({logger:(e==null?void 0:e.logger)||La.logger,name:this.name});this.logger=s,this.core=(e==null?void 0:e.core)||new FS(e),this.session=new i_(this.core,this.logger),this.proposal=new r_(this.core,this.logger),this.pendingRequest=new o_(this.core,this.logger),this.engine=new n_(this),this.auth=new h_(this.core,this.logger)}static async init(e){const s=new _l(e);return await s.initialize(),s}get context(){return Mt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const g_=_l;function Tl(t){return t==null||typeof t!="object"&&typeof t!="function"}function tg(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function sg(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const m_="[object RegExp]",ng="[object String]",rg="[object Number]",ig="[object Boolean]",og="[object Arguments]",w_="[object Symbol]",y_="[object Date]",b_="[object Map]",E_="[object Set]",v_="[object Array]",C_="[object ArrayBuffer]",A_="[object Object]",I_="[object DataView]",N_="[object Uint8Array]",S_="[object Uint8ClampedArray]",__="[object Uint16Array]",T_="[object Uint32Array]",x_="[object Int8Array]",O_="[object Int16Array]",P_="[object Int32Array]",k_="[object Float32Array]",R_="[object Float64Array]";function xl(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function U_(t,e){return wr(t,void 0,t,new Map,e)}function wr(t,e,s,n=new Map,r=void 0){const i=r==null?void 0:r(t,e,s,n);if(i!=null)return i;if(Tl(t))return t;if(n.has(t))return n.get(t);if(Array.isArray(t)){const o=new Array(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=wr(t[a],a,s,n,r);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;n.set(t,o);for(const[a,c]of t)o.set(a,wr(c,a,s,n,r));return o}if(t instanceof Set){const o=new Set;n.set(t,o);for(const a of t)o.add(wr(a,void 0,s,n,r));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(xl(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=wr(t[a],a,s,n,r);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return n.set(t,o),Pn(o,t,s,n,r),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return n.set(t,o),Pn(o,t,s,n,r),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return n.set(t,o),Pn(o,t,s,n,r),o}if(t instanceof Error){const o=new t.constructor;return n.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,Pn(o,t,s,n,r),o}if(typeof t=="object"&&$_(t)){const o=Object.create(Object.getPrototypeOf(t));return n.set(t,o),Pn(o,t,s,n,r),o}return t}function Pn(t,e,s=t,n,r){const i=[...Object.keys(e),...tg(e)];for(let o=0;o<i.length;o++){const a=i[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=wr(e[a],a,s,n,r))}}function $_(t){switch(sg(t)){case og:case v_:case C_:case I_:case ig:case y_:case k_:case R_:case x_:case O_:case P_:case b_:case rg:case A_:case m_:case E_:case ng:case w_:case N_:case S_:case __:case T_:return!0;default:return!1}}function D_(t,e){return U_(t,(s,n,r,i)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case rg:case ng:case ig:{const o=new t.constructor(t==null?void 0:t.valueOf());return Pn(o,t),o}case og:{const o={};return Pn(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function zu(t){return D_(t)}function Ku(t){return t!==null&&typeof t=="object"&&sg(t)==="[object Arguments]"}function Vu(t){return typeof t=="object"&&t!==null}function B_(){}function L_(t){return xl(t)}function M_(t){var s;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const n=t[Symbol.toStringTag];return n==null||!((s=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&s.writable)?!1:t.toString()===`[object ${n}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function F_(t){if(Tl(t))return t;if(Array.isArray(t)||xl(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),s=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new s(t);if(t instanceof RegExp){const n=new s(t);return n.lastIndex=t.lastIndex,n}if(t instanceof DataView)return new s(t.buffer.slice(0));if(t instanceof Error){const n=new s(t.message);return n.stack=t.stack,n.name=t.name,n.cause=t.cause,n}if(typeof File<"u"&&t instanceof File)return new s([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const n=Object.create(e);return Object.assign(n,t)}return t}function j_(t,...e){const s=e.slice(0,-1),n=e[e.length-1];let r=t;for(let i=0;i<s.length;i++){const o=s[i];r=qc(r,o,n,new Map)}return r}function qc(t,e,s,n){if(Tl(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(n.has(e))return F_(n.get(e));if(n.set(e,t),Array.isArray(e)){e=e.slice();for(let i=0;i<e.length;i++)e[i]=e[i]??void 0}const r=[...Object.keys(e),...tg(e)];for(let i=0;i<r.length;i++){const o=r[i];let a=e[o],c=t[o];if(Ku(a)&&(a={...a}),Ku(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=zu(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const d=[],u=Reflect.ownKeys(c);for(let h=0;h<u.length;h++){const f=u[h];d[f]=c[f]}c=d}else c=[];const l=s(c,a,o,t,e,n);l!=null?t[o]=l:Array.isArray(a)||Vu(c)&&Vu(a)?t[o]=qc(c,a,s,n):c==null&&M_(a)?t[o]=qc({},a,s,n):c==null&&L_(a)?t[o]=zu(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function q_(t,...e){return j_(t,...e,B_)}const Gu="error",W_="wss://relay.walletconnect.org",H_="wc",ag="universal_provider",Xi=`${H_}@2:${ag}:`,cg="https://rpc.walletconnect.org/v1/",lg="generic",z_=`${cg}bundler`,vr="call_status",K_=86400,Ol={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var V_=Object.defineProperty,G_=Object.defineProperties,Y_=Object.getOwnPropertyDescriptors,Yu=Object.getOwnPropertySymbols,J_=Object.prototype.hasOwnProperty,X_=Object.prototype.propertyIsEnumerable,Ju=(t,e,s)=>e in t?V_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Zi=(t,e)=>{for(var s in e||(e={}))J_.call(e,s)&&Ju(t,s,e[s]);if(Yu)for(var s of Yu(e))X_.call(e,s)&&Ju(t,s,e[s]);return t},Z_=(t,e)=>G_(t,Y_(e));function dg(t,e,s){var n;const r=Hs(t);return((n=e.rpcMap)==null?void 0:n[r.reference])||`${cg}?chainId=${r.namespace}:${r.reference}&projectId=${s}`}function Q_(t){return t.includes(":")?t.split(":")[1]:t}function ug(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function eT(t,e){const s=Object.keys(e.namespaces).filter(r=>r.includes(t));if(!s.length)return[];const n=[];return s.forEach(r=>{const i=e.namespaces[r].accounts;n.push(...i)}),n}function Xu(t){return Object.fromEntries(Object.entries(t).filter(([e,s])=>{var n,r;return((n=s==null?void 0:s.chains)==null?void 0:n.length)&&((r=s==null?void 0:s.chains)==null?void 0:r.length)>0}))}function Qi(t={},e={}){const s=Xu(Zu(t)),n=Xu(Zu(e));return q_(s,n)}function Zu(t){var e,s,n,r,i;const o={};if(!Ns(t))return o;for(const[a,c]of Object.entries(t)){const l=Zo(a)?[a]:c.chains,d=c.methods||[],u=c.events||[],h=c.rpcMap||{},f=mr(a);o[f]=Z_(Zi(Zi({},o[f]),c),{chains:Is(l,(e=o[f])==null?void 0:e.chains),methods:Is(d,(s=o[f])==null?void 0:s.methods),events:Is(u,(n=o[f])==null?void 0:n.events)}),(Ns(h)||Ns(((r=o[f])==null?void 0:r.rpcMap)||{}))&&(o[f].rpcMap=Zi(Zi({},h),(i=o[f])==null?void 0:i.rpcMap))}return o}function Qu(t){return t.includes(":")?t.split(":")[2]:t}function eh(t){const e={};for(const[s,n]of Object.entries(t)){const r=n.methods||[],i=n.events||[],o=n.accounts||[],a=Zo(s)?[s]:n.chains?n.chains:ug(n.accounts);e[s]={chains:a,methods:r,events:i,accounts:o}}return e}function ja(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function tT(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const hg={},Cr=t=>hg[t],qa=(t,e)=>{hg[t]=e};var sT=Object.defineProperty,th=Object.getOwnPropertySymbols,nT=Object.prototype.hasOwnProperty,rT=Object.prototype.propertyIsEnumerable,sh=(t,e,s)=>e in t?sT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,nh=(t,e)=>{for(var s in e||(e={}))nT.call(e,s)&&sh(t,s,e[s]);if(th)for(var s of th(e))rT.call(e,s)&&sh(t,s,e[s]);return t};const rh="eip155",iT=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],oT=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,Wa=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,ih=t=>Object.keys(t).filter(e=>iT.includes(e)).reduce((e,s)=>(e[s]=aT(t[s]),e),{}),aT=t=>typeof t=="string"&&tT(t)?JSON.parse(t):t,cT=(t,e,s)=>{const{sessionProperties:n={},scopedProperties:r={}}=t,i={};if(!Ns(r)&&!Ns(n))return;const o=ih(n);for(const a of s){const c=oT(a);if(!c)continue;i[Wa(c)]=o;const l=r==null?void 0:r[`${rh}:${c}`];if(l){const d=l==null?void 0:l[`${rh}:${c}:${e}`];i[Wa(c)]=nh(nh({},i[Wa(c)]),ih(d||l))}}for(const[a,c]of Object.entries(i))Object.keys(c).length===0&&delete i[a];return Object.keys(i).length>0?i:void 0};var lT=Object.defineProperty,dT=(t,e,s)=>e in t?lT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,uT=(t,e,s)=>dT(t,e+"",s);let Ha;class Pl{constructor(e){uT(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,s){return await this.storage.setItem(e,s)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return Ha||(Ha=new Pl(e)),Ha}}var hT=Object.defineProperty,fT=Object.defineProperties,pT=Object.getOwnPropertyDescriptors,oh=Object.getOwnPropertySymbols,gT=Object.prototype.hasOwnProperty,mT=Object.prototype.propertyIsEnumerable,ah=(t,e,s)=>e in t?hT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,wT=(t,e)=>{for(var s in e||(e={}))gT.call(e,s)&&ah(t,s,e[s]);if(oh)for(var s of oh(e))mT.call(e,s)&&ah(t,s,e[s]);return t},yT=(t,e)=>fT(t,pT(e));async function bT(t,e){const s=Hs(t.result.capabilities.caip345.caip2),n=t.result.capabilities.caip345.transactionHashes,r=await Promise.allSettled(n.map(u=>ET(s.reference,u,e))),i=r.filter(u=>u.status==="fulfilled").map(u=>u.value).filter(u=>u);r.filter(u=>u.status==="rejected").forEach(u=>console.warn("Failed to fetch transaction receipt:",u.reason));const o=!i.length||i.some(u=>!u),a=i.every(u=>(u==null?void 0:u.status)==="0x1"),c=i.every(u=>(u==null?void 0:u.status)==="0x0"),l=i.some(u=>(u==null?void 0:u.status)==="0x0");let d;return o?d=100:a?d=200:c?d=500:l&&(d=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:i,status:d}}async function ET(t,e,s){return await s(parseInt(t)).request(ys("eth_getTransactionReceipt",[e]))}async function vT({sendCalls:t,storage:e}){const s=await e.getItem(vr);await e.setItem(vr,yT(wT({},s),{[t.result.id]:{request:t.request,result:t.result,expiry:Le(K_)}}))}async function CT({resultId:t,storage:e}){const s=await e.getItem(vr);if(s){delete s[t],await e.setItem(vr,s);for(const n in s)bs(s[n].expiry)&&delete s[n];await e.setItem(vr,s)}}async function AT({resultId:t,storage:e}){const s=await e.getItem(vr),n=s==null?void 0:s[t];if(n&&!bs(n.expiry))return n;await CT({resultId:t,storage:e})}var IT=Object.defineProperty,NT=Object.defineProperties,ST=Object.getOwnPropertyDescriptors,ch=Object.getOwnPropertySymbols,_T=Object.prototype.hasOwnProperty,TT=Object.prototype.propertyIsEnumerable,Wc=(t,e,s)=>e in t?IT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,za=(t,e)=>{for(var s in e||(e={}))_T.call(e,s)&&Wc(t,s,e[s]);if(ch)for(var s of ch(e))TT.call(e,s)&&Wc(t,s,e[s]);return t},Ka=(t,e)=>NT(t,ST(e)),Sn=(t,e,s)=>Wc(t,typeof e!="symbol"?e+"":e,s);class xT{constructor(e){Sn(this,"name","eip155"),Sn(this,"client"),Sn(this,"chainId"),Sn(this,"namespace"),Sn(this,"httpProviders"),Sn(this,"events"),Sn(this,"storage"),this.namespace=e.namespace,this.events=Cr("events"),this.client=Cr("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=Pl.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(parseInt(e),s);const n=this.chainId;this.chainId=parseInt(e),this.events.emit(Ol.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,s){const n=s||dg(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Zc(new xh(n,Cr("disableProviderPing")))}setHttpProvider(e,s){const n=this.createHttpProvider(e,s);n&&(this.httpProviders[e]=n)}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var n;const r=parseInt(Q_(s));e[r]=this.createHttpProvider(r,(n=this.namespace.rpcMap)==null?void 0:n[s])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}getHttpProvider(e){const s=e||this.chainId;return this.httpProviders[s]||(this.httpProviders=Ka(za({},this.httpProviders),{[s]:this.createHttpProvider(s)}),this.httpProviders[s])}async handleSwitchChain(e){var s,n;let r=e.request.params?(s=e.request.params[0])==null?void 0:s.chainId:"0x0";r=r.startsWith("0x")?r:`0x${r}`;const i=parseInt(r,16);if(this.isChainApproved(i))this.setDefaultChain(`${i}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:r}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${i}`);else throw new Error(`Failed to switch to chain 'eip155:${i}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var s,n,r,i,o;const a=(n=(s=e.request)==null?void 0:s.params)==null?void 0:n[0],c=((i=(r=e.request)==null?void 0:r.params)==null?void 0:i[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),d=((o=l==null?void 0:l.sessionProperties)==null?void 0:o.capabilities)||{},u=c.length>0?c.join(","):`0x${this.chainId.toString(16)}`,h=`${a}${u}`,f=d==null?void 0:d[h];if(f)return f;let g;try{g=cT(l,a,c)}catch(w){console.warn("Failed to extract capabilities from session",w)}if(g)return g;const p=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Ka(za({},l.sessionProperties||{}),{capabilities:Ka(za({},d||{}),{[h]:p})})})}catch(w){console.warn("Failed to update session with capabilities",w)}return p}async getCallStatus(e){var s,n,r;const i=this.client.session.get(e.topic),o=(s=i.sessionProperties)==null?void 0:s.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(d){console.warn("Failed to fetch call status from bundler",d,l)}}const a=(n=i.sessionProperties)==null?void 0:n.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await AT({resultId:(r=e.request.params)==null?void 0:r[0],storage:this.storage});if(c)try{return await bT(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,s){var n;const r=new URL(e),i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ys("eth_getUserOperationReceipt",[(n=s.request.params)==null?void 0:n[0]]))});if(!i.ok)throw new Error(`Failed to fetch user operation receipt - ${i.status}`);return await i.json()}getBundlerUrl(e,s){return`${z_}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${s}`}async sendCalls(e){var s,n,r;const i=await this.client.request(e),o=(s=e.request.params)==null?void 0:s[0],a=i==null?void 0:i.id,c=(i==null?void 0:i.capabilities)||{},l=(n=c==null?void 0:c.caip345)==null?void 0:n.caip2,d=(r=c==null?void 0:c.caip345)==null?void 0:r.transactionHashes;return!a||!l||!(d!=null&&d.length)||await vT({sendCalls:{request:o,result:i},storage:this.storage}),i}}var OT=Object.defineProperty,PT=(t,e,s)=>e in t?OT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ur=(t,e,s)=>PT(t,typeof e!="symbol"?e+"":e,s);class kT{constructor(e){ur(this,"name",lg),ur(this,"client"),ur(this,"httpProviders"),ur(this,"events"),ur(this,"namespace"),ur(this,"chainId"),this.namespace=e.namespace,this.events=Cr("events"),this.client=Cr("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s);const n=this.chainId;this.chainId=e,this.events.emit(Ol.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return Hs(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){var e,s;const n={};return(s=(e=this.namespace)==null?void 0:e.accounts)==null||s.forEach(r=>{var i,o;const a=Hs(r),c=(o=(i=this.namespace)==null?void 0:i.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];n[a.reference]=this.createHttpProvider(r,c)}),n}getHttpProvider(e){const s=Hs(e).reference,n=this.httpProviders[s];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return n}setHttpProvider(e,s){const n=this.createHttpProvider(e,s);n&&(this.httpProviders[e]=n)}createHttpProvider(e,s){const n=s||dg(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Zc(new xh(n,Cr("disableProviderPing")))}}var RT=Object.defineProperty,UT=Object.defineProperties,$T=Object.getOwnPropertyDescriptors,lh=Object.getOwnPropertySymbols,DT=Object.prototype.hasOwnProperty,BT=Object.prototype.propertyIsEnumerable,Hc=(t,e,s)=>e in t?RT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Gr=(t,e)=>{for(var s in e||(e={}))DT.call(e,s)&&Hc(t,s,e[s]);if(lh)for(var s of lh(e))BT.call(e,s)&&Hc(t,s,e[s]);return t},eo=(t,e)=>UT(t,$T(e)),Ot=(t,e,s)=>Hc(t,typeof e!="symbol"?e+"":e,s);let LT=class fg{constructor(e){Ot(this,"client"),Ot(this,"namespaces"),Ot(this,"optionalNamespaces"),Ot(this,"sessionProperties"),Ot(this,"scopedProperties"),Ot(this,"events",new Yc),Ot(this,"rpcProviders",{}),Ot(this,"session"),Ot(this,"providerOpts"),Ot(this,"logger"),Ot(this,"uri"),Ot(this,"disableProviderPing",!1),Ot(this,"connectParams");var s,n;this.providerOpts=e,this.logger=Nl({logger:(s=e.logger)!=null?s:Gu,name:(n=this.providerOpts.name)!=null?n:ag}),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const s=new fg(e);return await s.initialize(),s}async request(e,s,n){const[r,i]=this.validateChain(s);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(r).request({request:Gr({},e),chainId:`${r}:${i}`,topic:this.session.topic,expiry:n})}sendAsync(e,s,n,r){const i=new Date().getTime();this.request(e,n,r).then(o=>s(null,li(i,o))).catch(o=>s(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Ue("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.connectParams=e,this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,s){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:n,response:r}=await this.client.authenticate(e,s);n&&(this.uri=n,this.events.emit("display_uri",n));const i=await r();if(this.session=i.session,this.session){const o=eh(this.session.namespaces);this.namespaces=Qi(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return i}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}removeListener(e,s){this.events.removeListener(e,s)}off(e,s){this.events.off(e,s)}get isWalletConnect(){return!0}async pair(e){var s,n;const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:(s=this.connectParams)==null?void 0:s.authentication,walletPay:(n=this.connectParams)==null?void 0:n.walletPay});r&&(this.uri=r,this.events.emit("display_uri",r));const o=await i();this.session=o;const a=eh(o.namespaces);return this.namespaces=Qi(this.namespaces,a),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,s){try{if(!this.session)return;const[n,r]=this.validateChain(e);this.getProvider(n).setDefaultChain(r,s)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const s=this.client.pairing.getAll();if(!Ks(s))return;for(const n of s)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${s.length}`)}catch(s){this.logger.warn(s,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,s;if(this.client=this.providerOpts.client||await g_.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Gu,relayUrl:this.providerOpts.relayUrl||W_,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(n){throw this.logger.error(n,"Failed to get session"),new Error(`The provided session: ${(s=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:s.topic} doesn't exist in the Sign client`)}else{const n=this.client.session.getAll();this.session=n[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(s=>mr(s)))];qa("client",this.client),qa("events",this.events),qa("disableProviderPing",this.disableProviderPing),e.forEach(s=>{if(!this.session)return;const n=eT(s,this.session);if((n==null?void 0:n.length)===0)return;const r=ug(n),i=Qi(this.namespaces,this.optionalNamespaces),o=eo(Gr({},i[s]),{accounts:n,chains:r});switch(s){case"eip155":this.rpcProviders[s]=new xT({namespace:o});break;default:this.rpcProviders[s]=new kT({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var s;const{topic:n}=e;n===((s=this.session)==null?void 0:s.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var s;const{params:n,topic:r}=e;if(r!==((s=this.session)==null?void 0:s.topic))return;const{event:i}=n;if(i.name==="accountsChanged"){const o=i.data;o&&Ks(o)&&this.events.emit("accountsChanged",o.map(Qu))}else if(i.name==="chainChanged"){const o=n.chainId,a=n.event.data,c=mr(o),l=ja(o)!==ja(a)?`${c}:${ja(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:s})=>{var n,r;if(e!==((n=this.session)==null?void 0:n.topic))return;const{namespaces:i}=s,o=(r=this.client)==null?void 0:r.session.get(e);this.session=eo(Gr({},o),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:s})}),this.client.on("session_delete",async e=>{var s;e.topic===((s=this.session)==null?void 0:s.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",eo(Gr({},Ue("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Ol.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(eo(Gr({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[lg]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var s;this.getProvider(e).updateNamespace((s=this.session)==null?void 0:s.namespaces[e])})}setNamespaces(e){const{namespaces:s={},optionalNamespaces:n={},sessionProperties:r,scopedProperties:i}=e;this.optionalNamespaces=Qi(s,n),this.sessionProperties=r,this.scopedProperties=i}validateChain(e){const[s,n]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[s,n];if(s&&!Object.keys(this.namespaces||{}).map(o=>mr(o)).includes(s))throw new Error(`Namespace '${s}' is not configured. Please call connect() first with namespace config.`);if(s&&n)return[s,n];const r=mr(Object.keys(this.namespaces)[0]),i=this.rpcProviders[r].getDefaultChain();return[r,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:s,internal:n=!1}){if(!this.namespaces)return;const[r,i]=this.validateChain(e);i&&(this.updateNamespaceChain(r,i),n?(this.events.emit("chainChanged",i),this.emitAccountsChangedOnChainChange({namespace:r,currentCaipChainId:e,previousCaipChainId:s})):this.getProvider(r).setDefaultChain(i),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:s,previousCaipChainId:n}){var r,i;try{if(n===s)return;const o=(i=(r=this.session)==null?void 0:r.namespaces[e])==null?void 0:i.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${s}:`)).map(Qu);if(!Ks(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,s){if(!this.namespaces)return;const n=this.namespaces[e]?e:`${e}:${s}`,r={chains:[],methods:[],events:[],defaultChain:s};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=s):this.namespaces[n]=r}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,s){var n;const r=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.setItem(`${Xi}/${e}${r}`,s)}async getFromStore(e){var s;const n=((s=this.session)==null?void 0:s.topic)||"";return await this.client.core.storage.getItem(`${Xi}/${e}${n}`)}async deleteFromStore(e){var s;const n=((s=this.session)==null?void 0:s.topic)||"";await this.client.core.storage.removeItem(`${Xi}/${e}${n}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const s=await this.client.core.storage.getKeys();for(const n of s)n.startsWith(Xi)&&await this.client.core.storage.removeItem(n)}catch(s){this.logger.warn(s,"Failed to cleanup storage")}}};/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const po=globalThis,kl=po.ShadowRoot&&(po.ShadyCSS===void 0||po.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Rl=Symbol(),dh=new WeakMap;let pg=class{constructor(e,s,n){if(this._$cssResult$=!0,n!==Rl)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=s}get styleSheet(){let e=this.o;const s=this.t;if(kl&&e===void 0){const n=s!==void 0&&s.length===1;n&&(e=dh.get(s)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&dh.set(s,e))}return e}toString(){return this.cssText}};const os=t=>new pg(typeof t=="string"?t:t+"",void 0,Rl),dn=(t,...e)=>{const s=t.length===1?t[0]:e.reduce((n,r,i)=>n+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(r)+t[i+1],t[0]);return new pg(s,t,Rl)},MT=(t,e)=>{if(kl)t.adoptedStyleSheets=e.map(s=>s instanceof CSSStyleSheet?s:s.styleSheet);else for(const s of e){const n=document.createElement("style"),r=po.litNonce;r!==void 0&&n.setAttribute("nonce",r),n.textContent=s.cssText,t.appendChild(n)}},uh=kl?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let s="";for(const n of e.cssRules)s+=n.cssText;return os(s)})(t):t;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:FT,defineProperty:jT,getOwnPropertyDescriptor:qT,getOwnPropertyNames:WT,getOwnPropertySymbols:HT,getPrototypeOf:zT}=Object,gn=globalThis,hh=gn.trustedTypes,KT=hh?hh.emptyScript:"",Va=gn.reactiveElementPolyfillSupport,ai=(t,e)=>t,zc={toAttribute(t,e){switch(e){case Boolean:t=t?KT:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let s=t;switch(e){case Boolean:s=t!==null;break;case Number:s=t===null?null:Number(t);break;case Object:case Array:try{s=JSON.parse(t)}catch{s=null}}return s}},gg=(t,e)=>!FT(t,e),fh={attribute:!0,type:String,converter:zc,reflect:!1,useDefault:!1,hasChanged:gg};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),gn.litPropertyMetadata??(gn.litPropertyMetadata=new WeakMap);let hr=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,s=fh){if(s.state&&(s.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((s=Object.create(s)).wrapped=!0),this.elementProperties.set(e,s),!s.noAccessor){const n=Symbol(),r=this.getPropertyDescriptor(e,n,s);r!==void 0&&jT(this.prototype,e,r)}}static getPropertyDescriptor(e,s,n){const{get:r,set:i}=qT(this.prototype,e)??{get(){return this[s]},set(o){this[s]=o}};return{get:r,set(o){const a=r==null?void 0:r.call(this);i==null||i.call(this,o),this.requestUpdate(e,a,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??fh}static _$Ei(){if(this.hasOwnProperty(ai("elementProperties")))return;const e=zT(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(ai("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(ai("properties"))){const s=this.properties,n=[...WT(s),...HT(s)];for(const r of n)this.createProperty(r,s[r])}const e=this[Symbol.metadata];if(e!==null){const s=litPropertyMetadata.get(e);if(s!==void 0)for(const[n,r]of s)this.elementProperties.set(n,r)}this._$Eh=new Map;for(const[s,n]of this.elementProperties){const r=this._$Eu(s,n);r!==void 0&&this._$Eh.set(r,s)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const s=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const r of n)s.unshift(uh(r))}else e!==void 0&&s.push(uh(e));return s}static _$Eu(e,s){const n=s.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(s=>this.enableUpdating=s),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(s=>s(this))}addController(e){var s;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((s=e.hostConnected)==null||s.call(e))}removeController(e){var s;(s=this._$EO)==null||s.delete(e)}_$E_(){const e=new Map,s=this.constructor.elementProperties;for(const n of s.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return MT(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(s=>{var n;return(n=s.hostConnected)==null?void 0:n.call(s)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(s=>{var n;return(n=s.hostDisconnected)==null?void 0:n.call(s)})}attributeChangedCallback(e,s,n){this._$AK(e,n)}_$ET(e,s){var i;const n=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,n);if(r!==void 0&&n.reflect===!0){const o=(((i=n.converter)==null?void 0:i.toAttribute)!==void 0?n.converter:zc).toAttribute(s,n.type);this._$Em=e,o==null?this.removeAttribute(r):this.setAttribute(r,o),this._$Em=null}}_$AK(e,s){var i,o;const n=this.constructor,r=n._$Eh.get(e);if(r!==void 0&&this._$Em!==r){const a=n.getPropertyOptions(r),c=typeof a.converter=="function"?{fromAttribute:a.converter}:((i=a.converter)==null?void 0:i.fromAttribute)!==void 0?a.converter:zc;this._$Em=r;const l=c.fromAttribute(s,a.type);this[r]=l??((o=this._$Ej)==null?void 0:o.get(r))??l,this._$Em=null}}requestUpdate(e,s,n,r=!1,i){var o;if(e!==void 0){const a=this.constructor;if(r===!1&&(i=this[e]),n??(n=a.getPropertyOptions(e)),!((n.hasChanged??gg)(i,s)||n.useDefault&&n.reflect&&i===((o=this._$Ej)==null?void 0:o.get(e))&&!this.hasAttribute(a._$Eu(e,n))))return;this.C(e,s,n)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,s,{useDefault:n,reflect:r,wrapped:i},o){n&&!(this._$Ej??(this._$Ej=new Map)).has(e)&&(this._$Ej.set(e,o??s??this[e]),i!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||n||(s=void 0),this._$AL.set(e,s)),r===!0&&this._$Em!==e&&(this._$Eq??(this._$Eq=new Set)).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(s){Promise.reject(s)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var n;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[i,o]of this._$Ep)this[i]=o;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[i,o]of r){const{wrapped:a}=o,c=this[i];a!==!0||this._$AL.has(i)||c===void 0||this.C(i,void 0,o,c)}}let e=!1;const s=this._$AL;try{e=this.shouldUpdate(s),e?(this.willUpdate(s),(n=this._$EO)==null||n.forEach(r=>{var i;return(i=r.hostUpdate)==null?void 0:i.call(r)}),this.update(s)):this._$EM()}catch(r){throw e=!1,this._$EM(),r}e&&this._$AE(s)}willUpdate(e){}_$AE(e){var s;(s=this._$EO)==null||s.forEach(n=>{var r;return(r=n.hostUpdated)==null?void 0:r.call(n)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(s=>this._$ET(s,this[s]))),this._$EM()}updated(e){}firstUpdated(e){}};hr.elementStyles=[],hr.shadowRootOptions={mode:"open"},hr[ai("elementProperties")]=new Map,hr[ai("finalized")]=new Map,Va==null||Va({ReactiveElement:hr}),(gn.reactiveElementVersions??(gn.reactiveElementVersions=[])).push("2.1.2");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const ci=globalThis,ph=t=>t,$o=ci.trustedTypes,gh=$o?$o.createPolicy("lit-html",{createHTML:t=>t}):void 0,mg="$lit$",un=`lit$${Math.random().toFixed(9).slice(2)}$`,wg="?"+un,VT=`<${wg}>`,Gn=document,bi=()=>Gn.createComment(""),Ei=t=>t===null||typeof t!="object"&&typeof t!="function",Ul=Array.isArray,GT=t=>Ul(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",Ga=`[ 	
\f\r]`,Yr=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,mh=/-->/g,wh=/>/g,_n=RegExp(`>|${Ga}(?:([^\\s"'>=/]+)(${Ga}*=${Ga}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),yh=/'/g,bh=/"/g,yg=/^(?:script|style|textarea|title)$/i,bg=t=>(e,...s)=>({_$litType$:t,strings:e,values:s}),ex=bg(1),tx=bg(2),xr=Symbol.for("lit-noChange"),Ge=Symbol.for("lit-nothing"),Eh=new WeakMap,Mn=Gn.createTreeWalker(Gn,129);function Eg(t,e){if(!Ul(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return gh!==void 0?gh.createHTML(e):e}const YT=(t,e)=>{const s=t.length-1,n=[];let r,i=e===2?"<svg>":e===3?"<math>":"",o=Yr;for(let a=0;a<s;a++){const c=t[a];let l,d,u=-1,h=0;for(;h<c.length&&(o.lastIndex=h,d=o.exec(c),d!==null);)h=o.lastIndex,o===Yr?d[1]==="!--"?o=mh:d[1]!==void 0?o=wh:d[2]!==void 0?(yg.test(d[2])&&(r=RegExp("</"+d[2],"g")),o=_n):d[3]!==void 0&&(o=_n):o===_n?d[0]===">"?(o=r??Yr,u=-1):d[1]===void 0?u=-2:(u=o.lastIndex-d[2].length,l=d[1],o=d[3]===void 0?_n:d[3]==='"'?bh:yh):o===bh||o===yh?o=_n:o===mh||o===wh?o=Yr:(o=_n,r=void 0);const f=o===_n&&t[a+1].startsWith("/>")?" ":"";i+=o===Yr?c+VT:u>=0?(n.push(l),c.slice(0,u)+mg+c.slice(u)+un+f):c+un+(u===-2?a:f)}return[Eg(t,i+(t[s]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),n]};class vi{constructor({strings:e,_$litType$:s},n){let r;this.parts=[];let i=0,o=0;const a=e.length-1,c=this.parts,[l,d]=YT(e,s);if(this.el=vi.createElement(l,n),Mn.currentNode=this.el.content,s===2||s===3){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;(r=Mn.nextNode())!==null&&c.length<a;){if(r.nodeType===1){if(r.hasAttributes())for(const u of r.getAttributeNames())if(u.endsWith(mg)){const h=d[o++],f=r.getAttribute(u).split(un),g=/([.?@])?(.*)/.exec(h);c.push({type:1,index:i,name:g[2],strings:f,ctor:g[1]==="."?XT:g[1]==="?"?ZT:g[1]==="@"?QT:ta}),r.removeAttribute(u)}else u.startsWith(un)&&(c.push({type:6,index:i}),r.removeAttribute(u));if(yg.test(r.tagName)){const u=r.textContent.split(un),h=u.length-1;if(h>0){r.textContent=$o?$o.emptyScript:"";for(let f=0;f<h;f++)r.append(u[f],bi()),Mn.nextNode(),c.push({type:2,index:++i});r.append(u[h],bi())}}}else if(r.nodeType===8)if(r.data===wg)c.push({type:2,index:i});else{let u=-1;for(;(u=r.data.indexOf(un,u+1))!==-1;)c.push({type:7,index:i}),u+=un.length-1}i++}}static createElement(e,s){const n=Gn.createElement("template");return n.innerHTML=e,n}}function Or(t,e,s=t,n){var o,a;if(e===xr)return e;let r=n!==void 0?(o=s._$Co)==null?void 0:o[n]:s._$Cl;const i=Ei(e)?void 0:e._$litDirective$;return(r==null?void 0:r.constructor)!==i&&((a=r==null?void 0:r._$AO)==null||a.call(r,!1),i===void 0?r=void 0:(r=new i(t),r._$AT(t,s,n)),n!==void 0?(s._$Co??(s._$Co=[]))[n]=r:s._$Cl=r),r!==void 0&&(e=Or(t,r._$AS(t,e.values),r,n)),e}class JT{constructor(e,s){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=s}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:s},parts:n}=this._$AD,r=((e==null?void 0:e.creationScope)??Gn).importNode(s,!0);Mn.currentNode=r;let i=Mn.nextNode(),o=0,a=0,c=n[0];for(;c!==void 0;){if(o===c.index){let l;c.type===2?l=new Ri(i,i.nextSibling,this,e):c.type===1?l=new c.ctor(i,c.name,c.strings,this,e):c.type===6&&(l=new e2(i,this,e)),this._$AV.push(l),c=n[++a]}o!==(c==null?void 0:c.index)&&(i=Mn.nextNode(),o++)}return Mn.currentNode=Gn,r}p(e){let s=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,s),s+=n.strings.length-2):n._$AI(e[s])),s++}}class Ri{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this._$Cv}constructor(e,s,n,r){this.type=2,this._$AH=Ge,this._$AN=void 0,this._$AA=e,this._$AB=s,this._$AM=n,this.options=r,this._$Cv=(r==null?void 0:r.isConnected)??!0}get parentNode(){let e=this._$AA.parentNode;const s=this._$AM;return s!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=s.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,s=this){e=Or(this,e,s),Ei(e)?e===Ge||e==null||e===""?(this._$AH!==Ge&&this._$AR(),this._$AH=Ge):e!==this._$AH&&e!==xr&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):GT(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Ge&&Ei(this._$AH)?this._$AA.nextSibling.data=e:this.T(Gn.createTextNode(e)),this._$AH=e}$(e){var i;const{values:s,_$litType$:n}=e,r=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=vi.createElement(Eg(n.h,n.h[0]),this.options)),n);if(((i=this._$AH)==null?void 0:i._$AD)===r)this._$AH.p(s);else{const o=new JT(r,this),a=o.u(this.options);o.p(s),this.T(a),this._$AH=o}}_$AC(e){let s=Eh.get(e.strings);return s===void 0&&Eh.set(e.strings,s=new vi(e)),s}k(e){Ul(this._$AH)||(this._$AH=[],this._$AR());const s=this._$AH;let n,r=0;for(const i of e)r===s.length?s.push(n=new Ri(this.O(bi()),this.O(bi()),this,this.options)):n=s[r],n._$AI(i),r++;r<s.length&&(this._$AR(n&&n._$AB.nextSibling,r),s.length=r)}_$AR(e=this._$AA.nextSibling,s){var n;for((n=this._$AP)==null?void 0:n.call(this,!1,!0,s);e!==this._$AB;){const r=ph(e).nextSibling;ph(e).remove(),e=r}}setConnected(e){var s;this._$AM===void 0&&(this._$Cv=e,(s=this._$AP)==null||s.call(this,e))}}class ta{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,s,n,r,i){this.type=1,this._$AH=Ge,this._$AN=void 0,this.element=e,this.name=s,this._$AM=r,this.options=i,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Ge}_$AI(e,s=this,n,r){const i=this.strings;let o=!1;if(i===void 0)e=Or(this,e,s,0),o=!Ei(e)||e!==this._$AH&&e!==xr,o&&(this._$AH=e);else{const a=e;let c,l;for(e=i[0],c=0;c<i.length-1;c++)l=Or(this,a[n+c],s,c),l===xr&&(l=this._$AH[c]),o||(o=!Ei(l)||l!==this._$AH[c]),l===Ge?e=Ge:e!==Ge&&(e+=(l??"")+i[c+1]),this._$AH[c]=l}o&&!r&&this.j(e)}j(e){e===Ge?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class XT extends ta{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ge?void 0:e}}class ZT extends ta{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Ge)}}class QT extends ta{constructor(e,s,n,r,i){super(e,s,n,r,i),this.type=5}_$AI(e,s=this){if((e=Or(this,e,s,0)??Ge)===xr)return;const n=this._$AH,r=e===Ge&&n!==Ge||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,i=e!==Ge&&(n===Ge||r);r&&this.element.removeEventListener(this.name,this,n),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var s;typeof this._$AH=="function"?this._$AH.call(((s=this.options)==null?void 0:s.host)??this.element,e):this._$AH.handleEvent(e)}}class e2{constructor(e,s,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=s,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){Or(this,e)}}const Ya=ci.litHtmlPolyfillSupport;Ya==null||Ya(vi,Ri),(ci.litHtmlVersions??(ci.litHtmlVersions=[])).push("3.3.2");const t2=(t,e,s)=>{const n=(s==null?void 0:s.renderBefore)??e;let r=n._$litPart$;if(r===void 0){const i=(s==null?void 0:s.renderBefore)??null;n._$litPart$=r=new Ri(e.insertBefore(bi(),i),i,void 0,s??{})}return r._$AI(t),r};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const qn=globalThis;class go extends hr{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var s;const e=super.createRenderRoot();return(s=this.renderOptions).renderBefore??(s.renderBefore=e.firstChild),e}update(e){const s=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=t2(s,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return xr}}var Ih;go._$litElement$=!0,go.finalized=!0,(Ih=qn.litElementHydrateSupport)==null||Ih.call(qn,{LitElement:go});const Ja=qn.litElementPolyfillSupport;Ja==null||Ja({LitElement:go});(qn.litElementVersions??(qn.litElementVersions=[])).push("4.2.2");const s2={black:"#202020",white:"#FFFFFF",white010:"rgba(255, 255, 255, 0.1)",accent010:"rgba(9, 136, 240, 0.1)",accent020:"rgba(9, 136, 240, 0.2)",accent030:"rgba(9, 136, 240, 0.3)",accent040:"rgba(9, 136, 240, 0.4)",accent050:"rgba(9, 136, 240, 0.5)",accent060:"rgba(9, 136, 240, 0.6)",accent070:"rgba(9, 136, 240, 0.7)",accent080:"rgba(9, 136, 240, 0.8)",accent090:"rgba(9, 136, 240, 0.9)",accent100:"rgba(9, 136, 240, 1.0)",accentSecondary010:"rgba(199, 185, 148, 0.1)",accentSecondary020:"rgba(199, 185, 148, 0.2)",accentSecondary030:"rgba(199, 185, 148, 0.3)",accentSecondary040:"rgba(199, 185, 148, 0.4)",accentSecondary050:"rgba(199, 185, 148, 0.5)",accentSecondary060:"rgba(199, 185, 148, 0.6)",accentSecondary070:"rgba(199, 185, 148, 0.7)",accentSecondary080:"rgba(199, 185, 148, 0.8)",accentSecondary090:"rgba(199, 185, 148, 0.9)",accentSecondary100:"rgba(199, 185, 148, 1.0)",productWalletKit:"#FFB800",productAppKit:"#FF573B",productCloud:"#0988F0",productDocumentation:"#008847",neutrals050:"#F6F6F6",neutrals100:"#F3F3F3",neutrals200:"#E9E9E9",neutrals300:"#D0D0D0",neutrals400:"#BBB",neutrals500:"#9A9A9A",neutrals600:"#6C6C6C",neutrals700:"#4F4F4F",neutrals800:"#363636",neutrals900:"#2A2A2A",neutrals1000:"#252525",semanticSuccess010:"rgba(48, 164, 107, 0.1)",semanticSuccess020:"rgba(48, 164, 107, 0.2)",semanticSuccess030:"rgba(48, 164, 107, 0.3)",semanticSuccess040:"rgba(48, 164, 107, 0.4)",semanticSuccess050:"rgba(48, 164, 107, 0.5)",semanticSuccess060:"rgba(48, 164, 107, 0.6)",semanticSuccess070:"rgba(48, 164, 107, 0.7)",semanticSuccess080:"rgba(48, 164, 107, 0.8)",semanticSuccess090:"rgba(48, 164, 107, 0.9)",semanticSuccess100:"rgba(48, 164, 107, 1.0)",semanticError010:"rgba(223, 74, 52, 0.1)",semanticError020:"rgba(223, 74, 52, 0.2)",semanticError030:"rgba(223, 74, 52, 0.3)",semanticError040:"rgba(223, 74, 52, 0.4)",semanticError050:"rgba(223, 74, 52, 0.5)",semanticError060:"rgba(223, 74, 52, 0.6)",semanticError070:"rgba(223, 74, 52, 0.7)",semanticError080:"rgba(223, 74, 52, 0.8)",semanticError090:"rgba(223, 74, 52, 0.9)",semanticError100:"rgba(223, 74, 52, 1.0)",semanticWarning010:"rgba(243, 161, 63, 0.1)",semanticWarning020:"rgba(243, 161, 63, 0.2)",semanticWarning030:"rgba(243, 161, 63, 0.3)",semanticWarning040:"rgba(243, 161, 63, 0.4)",semanticWarning050:"rgba(243, 161, 63, 0.5)",semanticWarning060:"rgba(243, 161, 63, 0.6)",semanticWarning070:"rgba(243, 161, 63, 0.7)",semanticWarning080:"rgba(243, 161, 63, 0.8)",semanticWarning090:"rgba(243, 161, 63, 0.9)",semanticWarning100:"rgba(243, 161, 63, 1.0)"},Do={core:{backgroundAccentPrimary:"#0988F0",backgroundAccentCertified:"#C7B994",backgroundWalletKit:"#FFB800",backgroundAppKit:"#FF573B",backgroundCloud:"#0988F0",backgroundDocumentation:"#008847",backgroundSuccess:"rgba(48, 164, 107, 0.20)",backgroundError:"rgba(223, 74, 52, 0.20)",backgroundWarning:"rgba(243, 161, 63, 0.20)",textAccentPrimary:"#0988F0",textAccentCertified:"#C7B994",textWalletKit:"#FFB800",textAppKit:"#FF573B",textCloud:"#0988F0",textDocumentation:"#008847",textSuccess:"#30A46B",textError:"#DF4A34",textWarning:"#F3A13F",borderAccentPrimary:"#0988F0",borderSecondary:"#C7B994",borderSuccess:"#30A46B",borderError:"#DF4A34",borderWarning:"#F3A13F",foregroundAccent010:"rgba(9, 136, 240, 0.1)",foregroundAccent020:"rgba(9, 136, 240, 0.2)",foregroundAccent040:"rgba(9, 136, 240, 0.4)",foregroundAccent060:"rgba(9, 136, 240, 0.6)",foregroundSecondary020:"rgba(199, 185, 148, 0.2)",foregroundSecondary040:"rgba(199, 185, 148, 0.4)",foregroundSecondary060:"rgba(199, 185, 148, 0.6)",iconAccentPrimary:"#0988F0",iconAccentCertified:"#C7B994",iconSuccess:"#30A46B",iconError:"#DF4A34",iconWarning:"#F3A13F",glass010:"rgba(255, 255, 255, 0.1)",zIndex:"9999"},dark:{overlay:"rgba(0, 0, 0, 0.50)",backgroundPrimary:"#202020",backgroundInvert:"#FFFFFF",textPrimary:"#FFFFFF",textSecondary:"#9A9A9A",textTertiary:"#BBBBBB",textInvert:"#202020",borderPrimary:"#2A2A2A",borderPrimaryDark:"#363636",borderSecondary:"#4F4F4F",foregroundPrimary:"#252525",foregroundSecondary:"#2A2A2A",foregroundTertiary:"#363636",iconDefault:"#9A9A9A",iconInverse:"#FFFFFF"},light:{overlay:"rgba(230 , 230, 230, 0.5)",backgroundPrimary:"#FFFFFF",borderPrimaryDark:"#E9E9E9",backgroundInvert:"#202020",textPrimary:"#202020",textSecondary:"#9A9A9A",textTertiary:"#6C6C6C",textInvert:"#FFFFFF",borderPrimary:"#E9E9E9",borderSecondary:"#D0D0D0",foregroundPrimary:"#F3F3F3",foregroundSecondary:"#E9E9E9",foregroundTertiary:"#D0D0D0",iconDefault:"#9A9A9A",iconInverse:"#202020"}},n2={1:"4px",2:"8px",10:"10px",3:"12px",4:"16px",6:"24px",5:"20px",8:"32px",16:"64px",20:"80px",32:"128px",64:"256px",128:"512px",round:"9999px"},r2={0:"0px","01":"2px",1:"4px",2:"8px",3:"12px",4:"16px",5:"20px",6:"24px",7:"28px",8:"32px",9:"36px",10:"40px",12:"48px",14:"56px",16:"64px",20:"80px",32:"128px",64:"256px"},i2={regular:"KHTeka",mono:"KHTekaMono"},o2={regular:"400",medium:"500"},a2={h1:"50px",h2:"44px",h3:"38px",h4:"32px",h5:"26px",h6:"20px",large:"16px",medium:"14px",small:"12px"},c2={"h1-regular-mono":{lineHeight:"50px",letterSpacing:"-3px"},"h1-regular":{lineHeight:"50px",letterSpacing:"-1px"},"h1-medium":{lineHeight:"50px",letterSpacing:"-0.84px"},"h2-regular-mono":{lineHeight:"44px",letterSpacing:"-2.64px"},"h2-regular":{lineHeight:"44px",letterSpacing:"-0.88px"},"h2-medium":{lineHeight:"44px",letterSpacing:"-0.88px"},"h3-regular-mono":{lineHeight:"38px",letterSpacing:"-2.28px"},"h3-regular":{lineHeight:"38px",letterSpacing:"-0.76px"},"h3-medium":{lineHeight:"38px",letterSpacing:"-0.76px"},"h4-regular-mono":{lineHeight:"32px",letterSpacing:"-1.92px"},"h4-regular":{lineHeight:"32px",letterSpacing:"-0.32px"},"h4-medium":{lineHeight:"32px",letterSpacing:"-0.32px"},"h5-regular-mono":{lineHeight:"26px",letterSpacing:"-1.56px"},"h5-regular":{lineHeight:"26px",letterSpacing:"-0.26px"},"h5-medium":{lineHeight:"26px",letterSpacing:"-0.26px"},"h6-regular-mono":{lineHeight:"20px",letterSpacing:"-1.2px"},"h6-regular":{lineHeight:"20px",letterSpacing:"-0.6px"},"h6-medium":{lineHeight:"20px",letterSpacing:"-0.6px"},"lg-regular-mono":{lineHeight:"16px",letterSpacing:"-0.96px"},"lg-regular":{lineHeight:"18px",letterSpacing:"-0.16px"},"lg-medium":{lineHeight:"18px",letterSpacing:"-0.16px"},"md-regular-mono":{lineHeight:"14px",letterSpacing:"-0.84px"},"md-regular":{lineHeight:"16px",letterSpacing:"-0.14px"},"md-medium":{lineHeight:"16px",letterSpacing:"-0.14px"},"sm-regular-mono":{lineHeight:"12px",letterSpacing:"-0.72px"},"sm-regular":{lineHeight:"14px",letterSpacing:"-0.12px"},"sm-medium":{lineHeight:"14px",letterSpacing:"-0.12px"}},l2={"ease-out-power-2":"cubic-bezier(0.23, 0.09, 0.08, 1.13)","ease-out-power-1":"cubic-bezier(0.12, 0.04, 0.2, 1.06)","ease-in-power-2":"cubic-bezier(0.92, -0.13, 0.77, 0.91)","ease-in-power-1":"cubic-bezier(0.88, -0.06, 0.8, 0.96)","ease-inout-power-2":"cubic-bezier(0.77, 0.09, 0.23, 1.13)","ease-inout-power-1":"cubic-bezier(0.88, 0.04, 0.12, 1.06)"},d2={xl:"400ms",lg:"200ms",md:"125ms",sm:"75ms"},Kc={colors:s2,fontFamily:i2,fontWeight:o2,textSize:a2,typography:c2,tokens:{core:Do.core,theme:Do.dark},borderRadius:n2,spacing:r2,durations:d2,easings:l2},vh="--apkt";function to(t){if(!t)return{};const e={};return e["font-family"]=t["--apkt-font-family"]??t["--w3m-font-family"]??"KHTeka",e.accent=t["--apkt-accent"]??t["--w3m-accent"]??"#0988F0",e["color-mix"]=t["--apkt-color-mix"]??t["--w3m-color-mix"]??"#000",e["color-mix-strength"]=t["--apkt-color-mix-strength"]??t["--w3m-color-mix-strength"]??0,e["font-size-master"]=t["--apkt-font-size-master"]??t["--w3m-font-size-master"]??"10px",e["border-radius-master"]=t["--apkt-border-radius-master"]??t["--w3m-border-radius-master"]??"4px",t["--apkt-z-index"]!==void 0?e["z-index"]=t["--apkt-z-index"]:t["--w3m-z-index"]!==void 0&&(e["z-index"]=t["--w3m-z-index"]),e}const Bs={createCSSVariables(t){const e={},s={};function n(i,o,a=""){for(const[c,l]of Object.entries(i)){const d=a?`${a}-${c}`:c;l&&typeof l=="object"&&Object.keys(l).length?(o[c]={},n(l,o[c],d)):typeof l=="string"&&(o[c]=`${vh}-${d}`)}}function r(i,o){for(const[a,c]of Object.entries(i))c&&typeof c=="object"?(o[a]={},r(c,o[a])):typeof c=="string"&&(o[a]=`var(${c})`)}return n(t,e),r(e,s),{cssVariables:e,cssVariablesVarPrefix:s}},assignCSSVariables(t,e){const s={};function n(r,i,o){for(const[a,c]of Object.entries(r)){const l=o?`${o}-${a}`:a,d=i[a];c&&typeof c=="object"?n(c,d,l):typeof d=="string"&&(s[`${vh}-${l}`]=d)}}return n(t,e),s},createRootStyles(t,e){const s={...Kc,tokens:{...Kc.tokens,theme:t==="light"?Do.light:Do.dark}},{cssVariables:n}=Bs.createCSSVariables(s),r=Bs.assignCSSVariables(n,s),i=Bs.generateW3MVariables(e),o=Bs.generateW3MOverrides(e),a=Bs.generateScaledVariables(e),c=Bs.generateBaseVariables(r),l={...r,...c,...i,...o,...a},d=Bs.applyColorMixToVariables(e,l),u={...l,...d};return`:root {${Object.entries(u).map(([f,g])=>`${f}:${g.replace("/[:;{}</>]/g","")};`).join("")}}`},generateW3MVariables(t){if(!t)return{};const e=to(t),s={};return s["--w3m-font-family"]=e["font-family"],s["--w3m-accent"]=e.accent,s["--w3m-color-mix"]=e["color-mix"],s["--w3m-color-mix-strength"]=`${e["color-mix-strength"]}%`,s["--w3m-font-size-master"]=e["font-size-master"],s["--w3m-border-radius-master"]=e["border-radius-master"],s},generateW3MOverrides(t){if(!t)return{};const e=to(t),s={};if(t["--apkt-accent"]||t["--w3m-accent"]){const n=e.accent;s["--apkt-tokens-core-iconAccentPrimary"]=n,s["--apkt-tokens-core-borderAccentPrimary"]=n,s["--apkt-tokens-core-textAccentPrimary"]=n,s["--apkt-tokens-core-backgroundAccentPrimary"]=n}return(t["--apkt-font-family"]||t["--w3m-font-family"])&&(s["--apkt-fontFamily-regular"]=e["font-family"]),e["z-index"]!==void 0&&(s["--apkt-tokens-core-zIndex"]=`${e["z-index"]}`),s},generateScaledVariables(t){if(!t)return{};const e=to(t),s={};if(t["--apkt-font-size-master"]||t["--w3m-font-size-master"]){const n=parseFloat(e["font-size-master"].replace("px",""));s["--apkt-textSize-h1"]=`${Number(n)*5}px`,s["--apkt-textSize-h2"]=`${Number(n)*4.4}px`,s["--apkt-textSize-h3"]=`${Number(n)*3.8}px`,s["--apkt-textSize-h4"]=`${Number(n)*3.2}px`,s["--apkt-textSize-h5"]=`${Number(n)*2.6}px`,s["--apkt-textSize-h6"]=`${Number(n)*2}px`,s["--apkt-textSize-large"]=`${Number(n)*1.6}px`,s["--apkt-textSize-medium"]=`${Number(n)*1.4}px`,s["--apkt-textSize-small"]=`${Number(n)*1.2}px`}if(t["--apkt-border-radius-master"]||t["--w3m-border-radius-master"]){const n=parseFloat(e["border-radius-master"].replace("px",""));s["--apkt-borderRadius-1"]=`${Number(n)}px`,s["--apkt-borderRadius-2"]=`${Number(n)*2}px`,s["--apkt-borderRadius-3"]=`${Number(n)*3}px`,s["--apkt-borderRadius-4"]=`${Number(n)*4}px`,s["--apkt-borderRadius-5"]=`${Number(n)*5}px`,s["--apkt-borderRadius-6"]=`${Number(n)*6}px`,s["--apkt-borderRadius-8"]=`${Number(n)*8}px`,s["--apkt-borderRadius-16"]=`${Number(n)*16}px`,s["--apkt-borderRadius-20"]=`${Number(n)*20}px`,s["--apkt-borderRadius-32"]=`${Number(n)*32}px`,s["--apkt-borderRadius-64"]=`${Number(n)*64}px`,s["--apkt-borderRadius-128"]=`${Number(n)*128}px`}return s},generateColorMixCSS(t,e){if(!(t!=null&&t["--w3m-color-mix"])||!t["--w3m-color-mix-strength"])return"";const s=t["--w3m-color-mix"],n=t["--w3m-color-mix-strength"];if(!n||n===0)return"";const r=Object.keys(e||{}).filter(o=>{const a=o.includes("-tokens-core-background")||o.includes("-tokens-core-text")||o.includes("-tokens-core-border")||o.includes("-tokens-core-foreground")||o.includes("-tokens-core-icon")||o.includes("-tokens-theme-background")||o.includes("-tokens-theme-text")||o.includes("-tokens-theme-border")||o.includes("-tokens-theme-foreground")||o.includes("-tokens-theme-icon"),c=o.includes("-borderRadius-")||o.includes("-spacing-")||o.includes("-textSize-")||o.includes("-fontFamily-")||o.includes("-fontWeight-")||o.includes("-typography-")||o.includes("-duration-")||o.includes("-ease-")||o.includes("-path-")||o.includes("-width-")||o.includes("-height-")||o.includes("-visual-size-")||o.includes("-modal-width")||o.includes("-cover");return a&&!c});return r.length===0?"":` @supports (background: color-mix(in srgb, white 50%, black)) {
      :root {
        ${r.map(o=>{const a=(e==null?void 0:e[o])||"";return a.includes("color-mix")||a.startsWith("#")||a.startsWith("rgb")?`${o}: color-mix(in srgb, ${s} ${n}%, ${a});`:`${o}: color-mix(in srgb, ${s} ${n}%, var(${o}-base, ${a}));`}).join("")}
      }
    }`},generateBaseVariables(t){const e={},s=t["--apkt-tokens-theme-backgroundPrimary"];s&&(e["--apkt-tokens-theme-backgroundPrimary-base"]=s);const n=t["--apkt-tokens-core-backgroundAccentPrimary"];return n&&(e["--apkt-tokens-core-backgroundAccentPrimary-base"]=n),e},applyColorMixToVariables(t,e){const s={};e!=null&&e["--apkt-tokens-theme-backgroundPrimary"]&&(s["--apkt-tokens-theme-backgroundPrimary"]="var(--apkt-tokens-theme-backgroundPrimary-base)"),e!=null&&e["--apkt-tokens-core-backgroundAccentPrimary"]&&(s["--apkt-tokens-core-backgroundAccentPrimary"]="var(--apkt-tokens-core-backgroundAccentPrimary-base)");const n=to(t),r=n["color-mix"],i=n["color-mix-strength"];if(!i||i===0)return s;const o=Object.keys(e||{}).filter(a=>{const c=a.includes("-tokens-core-background")||a.includes("-tokens-core-text")||a.includes("-tokens-core-border")||a.includes("-tokens-core-foreground")||a.includes("-tokens-core-icon")||a.includes("-tokens-theme-background")||a.includes("-tokens-theme-text")||a.includes("-tokens-theme-border")||a.includes("-tokens-theme-foreground")||a.includes("-tokens-theme-icon")||a.includes("-tokens-theme-overlay"),l=a.includes("-borderRadius-")||a.includes("-spacing-")||a.includes("-textSize-")||a.includes("-fontFamily-")||a.includes("-fontWeight-")||a.includes("-typography-")||a.includes("-duration-")||a.includes("-ease-")||a.includes("-path-")||a.includes("-width-")||a.includes("-height-")||a.includes("-visual-size-")||a.includes("-modal-width")||a.includes("-cover");return c&&!l});return o.length===0||o.forEach(a=>{const c=(e==null?void 0:e[a])||"";a.endsWith("-base")||(a==="--apkt-tokens-theme-backgroundPrimary"||a==="--apkt-tokens-core-backgroundAccentPrimary"?s[a]=`color-mix(in srgb, ${r} ${i}%, var(${a}-base))`:c.includes("color-mix")||c.startsWith("#")||c.startsWith("rgb")?s[a]=`color-mix(in srgb, ${r} ${i}%, ${c})`:s[a]=`color-mix(in srgb, ${r} ${i}%, var(${a}-base, ${c}))`)}),s}},{cssVariablesVarPrefix:u2}=Bs.createCSSVariables(Kc);function sx(t,...e){return dn(t,...e.map(s=>os(typeof s=="function"?s(u2):s)))}let kn,Fn,Cs,Dt,Bo;const Us={"KHTeka-500-woff2":"https://fonts.reown.com/KHTeka-Medium.woff2","KHTeka-400-woff2":"https://fonts.reown.com/KHTeka-Regular.woff2","KHTeka-300-woff2":"https://fonts.reown.com/KHTeka-Light.woff2","KHTekaMono-400-woff2":"https://fonts.reown.com/KHTekaMono-Regular.woff2","KHTeka-500-woff":"https://fonts.reown.com/KHTeka-Light.woff","KHTeka-400-woff":"https://fonts.reown.com/KHTeka-Regular.woff","KHTeka-300-woff":"https://fonts.reown.com/KHTeka-Light.woff","KHTekaMono-400-woff":"https://fonts.reown.com/KHTekaMono-Regular.woff"};function Lo(t,e="dark"){kn&&document.head.removeChild(kn),kn=document.createElement("style"),kn.textContent=Bs.createRootStyles(e,t),document.head.appendChild(kn)}function nx(t,e="dark"){if(Bo=t,Fn=document.createElement("style"),Cs=document.createElement("style"),Dt=document.createElement("style"),Fn.textContent=Ar(t).core.cssText,Cs.textContent=Ar(t).dark.cssText,Dt.textContent=Ar(t).light.cssText,document.head.appendChild(Fn),document.head.appendChild(Cs),document.head.appendChild(Dt),Lo(t,e),Vc(e),!((t==null?void 0:t["--apkt-font-family"])||(t==null?void 0:t["--w3m-font-family"])))for(const[n,r]of Object.entries(Us)){const i=document.createElement("link");i.rel="preload",i.href=r,i.as="font",i.type=n.includes("woff2")?"font/woff2":"font/woff",i.crossOrigin="anonymous",document.head.appendChild(i)}Vc(e)}function Vc(t="dark"){Cs&&Dt&&kn&&(t==="light"?(Lo(Bo,t),Cs.removeAttribute("media"),Dt.media="enabled"):(Lo(Bo,t),Dt.removeAttribute("media"),Cs.media="enabled"))}function h2(t){var e,s,n;if(Bo=t,Fn&&Cs&&Dt){Fn.textContent=Ar(t).core.cssText,Cs.textContent=Ar(t).dark.cssText,Dt.textContent=Ar(t).light.cssText;const r=(t==null?void 0:t["--apkt-font-family"])||(t==null?void 0:t["--w3m-font-family"]);r&&(Fn.textContent=(e=Fn.textContent)==null?void 0:e.replace("font-family: KHTeka",`font-family: ${r}`),Cs.textContent=(s=Cs.textContent)==null?void 0:s.replace("font-family: KHTeka",`font-family: ${r}`),Dt.textContent=(n=Dt.textContent)==null?void 0:n.replace("font-family: KHTeka",`font-family: ${r}`))}if(kn){const r=(Dt==null?void 0:Dt.media)==="enabled"?"light":"dark";Lo(t,r)}}function Ar(t){const e=!!(t!=null&&t["--apkt-font-family"]||t!=null&&t["--w3m-font-family"]);return{core:dn`
      ${e?dn``:dn`
            @font-face {
              font-family: 'KHTeka';
              src:
                url(${os(Us["KHTeka-400-woff2"])}) format('woff2'),
                url(${os(Us["KHTeka-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
              font-display: swap;
            }

            @font-face {
              font-family: 'KHTeka';
              src:
                url(${os(Us["KHTeka-300-woff2"])}) format('woff2'),
                url(${os(Us["KHTeka-300-woff"])}) format('woff');
              font-weight: 300;
              font-style: normal;
            }

            @font-face {
              font-family: 'KHTekaMono';
              src:
                url(${os(Us["KHTekaMono-400-woff2"])}) format('woff2'),
                url(${os(Us["KHTekaMono-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
            }

            @font-face {
              font-family: 'KHTeka';
              src:
                url(${os(Us["KHTeka-400-woff2"])}) format('woff2'),
                url(${os(Us["KHTeka-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
            }
          `}

      @keyframes w3m-shake {
        0% {
          transform: scale(1) rotate(0deg);
        }
        20% {
          transform: scale(1) rotate(-1deg);
        }
        40% {
          transform: scale(1) rotate(1.5deg);
        }
        60% {
          transform: scale(1) rotate(-1.5deg);
        }
        80% {
          transform: scale(1) rotate(1deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes w3m-iframe-fade-out {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes w3m-iframe-zoom-in {
        0% {
          transform: translateY(50px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }
      @keyframes w3m-iframe-zoom-in-mobile {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      :root {
        --apkt-modal-width: 370px;

        --apkt-visual-size-inherit: inherit;
        --apkt-visual-size-sm: 40px;
        --apkt-visual-size-md: 55px;
        --apkt-visual-size-lg: 80px;

        --apkt-path-network-sm: path(
          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'
        );

        --apkt-path-network-md: path(
          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'
        );

        --apkt-path-network-lg: path(
          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'
        );

        --apkt-width-network-sm: 36px;
        --apkt-width-network-md: 48px;
        --apkt-width-network-lg: 86px;

        --apkt-duration-dynamic: 0ms;
        --apkt-height-network-sm: 40px;
        --apkt-height-network-md: 54px;
        --apkt-height-network-lg: 96px;
      }
    `,dark:dn`
      :root {
      }
    `,light:dn`
      :root {
      }
    `}}const rx=dn`
  div,
  span,
  iframe,
  a,
  img,
  form,
  button,
  label,
  *::after,
  *::before {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-style: normal;
    text-rendering: optimizeSpeed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    backface-visibility: hidden;
  }

  :host {
    font-family: var(--apkt-fontFamily-regular);
  }
`,ix=dn`
  button,
  a {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;

    will-change: background-color, color, border, box-shadow, width, height, transform, opacity;
    outline: none;
    border: none;
    text-decoration: none;
    transition:
      background-color var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      color var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      border var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      box-shadow var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      width var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      height var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      transform var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      opacity var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      scale var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      border-radius var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2);
    will-change:
      background-color, color, border, box-shadow, width, height, transform, opacity, scale,
      border-radius;
  }

  a:active:not([disabled]),
  button:active:not([disabled]) {
    scale: 0.975;
    transform-origin: center;
  }

  button:disabled {
    cursor: default;
  }

  input {
    border: none;
    outline: none;
    appearance: none;
  }
`,$s={EIP155:k.CHAIN.EVM,CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED",CONNECTOR_TYPE_AUTH:"AUTH"},f2={NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",11155111:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",1313161554:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900",2741:"fc2427d1-5af9-4a9c-8da5-6f94627cd900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200","00000008819873e925422c1ff0f99f7c":"b3406e4a-bbfc-44fb-e3a6-89673c78b700","-239":"20f673c0-095e-49b2-07cf-eb5049dcf600","-3":"20f673c0-095e-49b2-07cf-eb5049dcf600"}},Gc={getCaipTokens(t){if(!t)return;const e={};return Object.entries(t).forEach(([s,n])=>{e[`${$s.EIP155}:${s}`]=n}),e},isLowerCaseMatch(t,e){return(t==null?void 0:t.toLowerCase())===(e==null?void 0:e.toLowerCase())},getActiveNamespaceConnectedToAuth(){const t=m.state.activeChain;return k.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(e=>j.getConnectorId(e)===k.CONNECTOR_ID.AUTH&&e===t)},withRetry({conditionFn:t,intervalMs:e,maxRetries:s}){let n=0;return new Promise(r=>{async function i(){return n+=1,await t()?r(!0):n>=s?r(!1):(setTimeout(i,e),null)}i()})},userChainIdToChainNamespace(t){if(typeof t=="number")return k.CHAIN.EVM;const[e]=t.split(":");return e},getOtherAuthNamespaces(t){return t?k.AUTH_CONNECTOR_SUPPORTED_CHAINS.filter(n=>n!==t):[]},getConnectorStorageInfo(t,e){const n=L.getConnections()[e]??[];return{hasDisconnected:L.isConnectorDisconnected(t,e),hasConnected:n.some(r=>Gc.isLowerCaseMatch(r.connectorId,t))}}},p2=new AbortController,zt={EmbeddedWalletAbortController:p2,UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"ORIGIN_NOT_ALLOWED"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{code:"APKT001",displayMessage:"Network Not Found",debugMessage:"The specified network is not recognized. Please ensure it is included in the `networks` array of your `createAppKit` configuration."},ORIGIN_NOT_ALLOWED:{code:"APKT002",displayMessage:"Invalid App Configuration",debugMessage:()=>`The origin ${Jr()?window.origin:"unknown"} is not in your allow list. Please update your allowed domains at https://dashboard.reown.com. [PID: ${U.state.projectId}]`},IFRAME_LOAD_FAILED:{code:"APKT003",displayMessage:"Network Error: Wallet Load Failed",debugMessage:()=>"Failed to load the embedded wallet. This may be due to network issues or server downtime. Please check your network connection and try again shortly. Contact support if the issue persists."},IFRAME_REQUEST_TIMEOUT:{code:"APKT004",displayMessage:"Wallet Request Timeout",debugMessage:()=>"The request to the embedded wallet timed out. Please check your network connection and try again shortly. Contact support if the issue persists."},UNVERIFIED_DOMAIN:{code:"APKT005",displayMessage:"Unverified Domain",debugMessage:()=>"Embedded wallet load failed. Ensure your domain is verified in https://dashboard.reown.com."},JWT_TOKEN_NOT_VALID:{code:"APKT006",displayMessage:"Session Expired",debugMessage:"Your session is invalid or expired. Please check your systemâ€™s date and time settings, then reconnect."},INVALID_PROJECT_ID:{code:"APKT007",displayMessage:"Invalid Project ID",debugMessage:"The specified project ID is invalid. Please visit https://dashboard.reown.com to obtain a valid project ID."},PROJECT_ID_NOT_CONFIGURED:{code:"APKT008",displayMessage:"Project ID Missing",debugMessage:"No project ID is configured. You can create and configure a project ID at https://dashboard.reown.com."},SERVER_ERROR_APP_CONFIGURATION:{code:"APKT009",displayMessage:"Server Error",debugMessage:t=>`Unable to fetch App Configuration. ${t}. Please check your network connection and try again shortly. Contact support if the issue persists.`},RATE_LIMITED_APP_CONFIGURATION:{code:"APKT010",displayMessage:"Rate Limited",debugMessage:"You have been rate limited while retrieving App Configuration. Please wait a few minutes and try again. Contact support if the issue persists."}},ALERT_WARNINGS:{LOCAL_CONFIGURATION_IGNORED:{debugMessage:t=>`[Reown Config Notice] ${t}`},INACTIVE_NAMESPACE_NOT_CONNECTED:{code:"APKTW001",displayMessage:"Inactive Namespace Not Connected",debugMessage:(t,e)=>`An error occurred while connecting an inactive namespace ${t}: "${e}"`},INVALID_EMAIL:{code:"APKTW002",displayMessage:"Invalid Email Address",debugMessage:"Please enter a valid email address"}}},vg={TOKEN_ADDRESSES_BY_SYMBOL:{USDC:{8453:lw.asset,84532:dw.asset}},getTokenSymbolByAddress(t){if(!t)return;const[e]=Object.entries(vg.TOKEN_ADDRESSES_BY_SYMBOL).find(([s,n])=>Object.values(n).includes(t))??[];return e}},g2={createLogger(t,e="error"){const s=_h({level:e}),{logger:n}=Xc({opts:s});return n.error=(...r)=>{for(const i of r)if(i instanceof Error){t(i,...r);return}t(void 0,...r)},n}},m2="rpc.walletconnect.org";function Ch(t,e){const s=new URL("https://rpc.walletconnect.org/v1/");return s.searchParams.set("chainId",t),s.searchParams.set("projectId",e),s.toString()}const Xa=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","eip155:80094","eip155:80069","eip155:560048","eip155:31","eip155:2818","eip155:57054","eip155:911867","eip155:534351","eip155:1112","eip155:534352","eip155:1111","eip155:146","eip155:130","eip155:1284","eip155:30","eip155:2810","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],fr={extendRpcUrlWithProjectId(t,e){let s=!1;try{s=new URL(t).host===m2}catch{s=!1}if(s){const n=new URL(t);return n.searchParams.has("projectId")||n.searchParams.set("projectId",e),n.toString()}return t},isCaipNetwork(t){return"chainNamespace"in t&&"caipNetworkId"in t},getChainNamespace(t){return this.isCaipNetwork(t)?t.chainNamespace:k.CHAIN.EVM},getCaipNetworkId(t){return this.isCaipNetwork(t)?t.caipNetworkId:`${k.CHAIN.EVM}:${t.id}`},getDefaultRpcUrl(t,e,s){var r,i,o;const n=(o=(i=(r=t.rpcUrls)==null?void 0:r.default)==null?void 0:i.http)==null?void 0:o[0];return Xa.includes(e)?Ch(e,s):n||""},extendCaipNetwork(t,{customNetworkImageUrls:e,projectId:s,customRpcUrls:n}){var h,f,g,p,w,b,I;const r=this.getChainNamespace(t),i=this.getCaipNetworkId(t),o=(g=(f=(h=t.rpcUrls)==null?void 0:h.default)==null?void 0:f.http)==null?void 0:g[0],a=this.getDefaultRpcUrl(t,i,s),c=((b=(w=(p=t==null?void 0:t.rpcUrls)==null?void 0:p.chainDefault)==null?void 0:w.http)==null?void 0:b[0])||o,l=((I=n==null?void 0:n[i])==null?void 0:I.map(v=>v.url))||[],d=[...l,...a?[a]:[]],u=[...l];return c&&!u.includes(c)&&u.push(c),{...t,chainNamespace:r,caipNetworkId:i,assets:{imageId:f2.NetworkImageIds[t.id],imageUrl:e==null?void 0:e[t.id]},rpcUrls:{...t.rpcUrls,default:{http:d},chainDefault:{http:u}}}},extendCaipNetworks(t,{customNetworkImageUrls:e,projectId:s,customRpcUrls:n}){return t.map(r=>fr.extendCaipNetwork(r,{customNetworkImageUrls:e,customRpcUrls:n,projectId:s}))},getViemTransport(t,e,s){var r,i,o;const n=[];return s==null||s.forEach(a=>{n.push($i(a.url,a.config))}),Xa.includes(t.caipNetworkId)&&n.push($i(Ch(t.caipNetworkId,e),{fetchOptions:{headers:{"Content-Type":"text/plain"}}})),(o=(i=(r=t==null?void 0:t.rpcUrls)==null?void 0:r.default)==null?void 0:i.http)==null||o.forEach(a=>{n.push($i(a))}),Ll(n)},extendWagmiTransports(t,e,s){if(Xa.includes(t.caipNetworkId)){const n=this.getDefaultRpcUrl(t,t.caipNetworkId,e);return Ll([s,$i(n)])}return s},getUnsupportedNetwork(t){return{id:t.split(":")[1],caipNetworkId:t,name:k.UNSUPPORTED_NETWORK_NAME,chainNamespace:t.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}},getCaipNetworkFromStorage(t){var c;const e=L.getActiveCaipNetworkId(),s=m.getAllRequestedCaipNetworks(),n=Array.from(((c=m.state.chains)==null?void 0:c.keys())||[]),r=e==null?void 0:e.split(":")[0],i=r?n.includes(r):!1,o=s==null?void 0:s.find(l=>l.caipNetworkId===e);return i&&!o&&e?this.getUnsupportedNetwork(e):o||t||(s==null?void 0:s[0])}},so={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603};class w2 extends iw{async setUniversalProvider(e){if(!this.namespace)throw new Error("UniversalAdapter:setUniversalProvider - namespace is required");return this.addConnector(new ow({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace})),Promise.resolve()}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect(),this.emit("disconnect")}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}return{connections:[]}}syncConnections(){return Promise.resolve()}async writeSolanaTransaction(){return Promise.resolve({hash:""})}async getAccounts({namespace:e}){var r,i,o,a;const s=this.provider,n=((a=(o=(i=(r=s==null?void 0:s.session)==null?void 0:r.namespaces)==null?void 0:i[e])==null?void 0:o.accounts)==null?void 0:a.map(c=>{const[,,l]=c.split(":");return l}).filter((c,l,d)=>d.indexOf(c)===l))||[];return Promise.resolve({accounts:n.map(c=>Y.createAccount(e,c,e==="bip122"?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){var o,a,c,l,d;if(!(e.caipNetwork&&fe.BALANCE_SUPPORTED_CHAINS.includes((o=e.caipNetwork)==null?void 0:o.chainNamespace))||(a=e.caipNetwork)!=null&&a.testnet)return{balance:"0.00",symbol:((c=e.caipNetwork)==null?void 0:c.nativeCurrency.symbol)||""};const n=m.getAccountData();if(n!=null&&n.balanceLoading&&e.chainId===((l=m.state.activeCaipNetwork)==null?void 0:l.id))return{balance:(n==null?void 0:n.balance)||"0.00",symbol:(n==null?void 0:n.balanceSymbol)||""};const i=(await m.fetchTokenBalance()).find(u=>{var h,f;return u.chainId===`${(h=e.caipNetwork)==null?void 0:h.chainNamespace}:${e.chainId}`&&u.symbol===((f=e.caipNetwork)==null?void 0:f.nativeCurrency.symbol)});return{balance:(i==null?void 0:i.quantity.numeric)||"0.00",symbol:(i==null?void 0:i.symbol)||((d=e.caipNetwork)==null?void 0:d.nativeCurrency.symbol)||""}}async signMessage(e){var o,a,c;const{provider:s,message:n,address:r}=e;if(!s)throw new Error("UniversalAdapter:signMessage - provider is undefined");let i="";return((o=m.state.activeCaipNetwork)==null?void 0:o.chainNamespace)===k.CHAIN.SOLANA?i=(await s.request({method:"solana_signMessage",params:{message:Rr.encode(new TextEncoder().encode(n)),pubkey:r}},(a=m.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)).signature:i=await s.request({method:"personal_sign",params:[n,r]},(c=m.state.activeCaipNetwork)==null?void 0:c.caipNetworkId),{signature:i}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}emitFirstAvailableConnection(){}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){var r,i,o,a,c,l;const{caipNetwork:s}=e,n=this.getWalletConnectConnector();if(s.chainNamespace===k.CHAIN.EVM)try{await((r=n.provider)==null?void 0:r.request({method:"wallet_switchEthereumChain",params:[{chainId:$l(s.id)}]}))}catch(d){if(d.code===so.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||d.code===so.ERROR_INVALID_CHAIN_ID||d.code===so.ERROR_CODE_DEFAULT||((o=(i=d==null?void 0:d.data)==null?void 0:i.originalError)==null?void 0:o.code)===so.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await((l=n.provider)==null?void 0:l.request({method:"wallet_addEthereumChain",params:[{chainId:$l(s.id),rpcUrls:[(a=s==null?void 0:s.rpcUrls.chainDefault)==null?void 0:a.http],chainName:s.name,nativeCurrency:s.nativeCurrency,blockExplorerUrls:[(c=s.blockExplorers)==null?void 0:c.default.url]}]}))}catch{throw new Error("Chain is not supported")}}n.provider.setDefaultChain(s.caipNetworkId)}getWalletConnectProvider(){const e=this.connectors.find(n=>n.type==="WALLET_CONNECT");return e==null?void 0:e.provider}}const y2=["email","socials","swaps","onramp","activity","reownBranding","multiWallet","emailCapture","payWithExchange","payments","reownAuthentication","headless"],no={email:{apiFeatureName:"social_login",localFeatureName:"email",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return!!t.isEnabled&&e.includes("email")},processFallback:t=>t===void 0?fe.DEFAULT_REMOTE_FEATURES.email:!!t},socials:{apiFeatureName:"social_login",localFeatureName:"socials",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e.filter(s=>s!=="email"):!1},processFallback:t=>t===void 0?fe.DEFAULT_REMOTE_FEATURES.socials:typeof t=="boolean"?t?fe.DEFAULT_REMOTE_FEATURES.socials:!1:t},swaps:{apiFeatureName:"swap",localFeatureName:"swaps",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?fe.DEFAULT_REMOTE_FEATURES.swaps:typeof t=="boolean"?t?fe.DEFAULT_REMOTE_FEATURES.swaps:!1:t},onramp:{apiFeatureName:"onramp",localFeatureName:"onramp",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?fe.DEFAULT_REMOTE_FEATURES.onramp:typeof t=="boolean"?t?fe.DEFAULT_REMOTE_FEATURES.onramp:!1:t},activity:{apiFeatureName:"activity",localFeatureName:"history",returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?fe.DEFAULT_REMOTE_FEATURES.activity:!!t},reownBranding:{apiFeatureName:"reown_branding",localFeatureName:"reownBranding",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?fe.DEFAULT_REMOTE_FEATURES.reownBranding:!!t},emailCapture:{apiFeatureName:"email_capture",localFeatureName:"emailCapture",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>t.isEnabled&&(t.config??[]),processFallback:t=>!1},multiWallet:{apiFeatureName:"multi_wallet",localFeatureName:"multiWallet",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>fe.DEFAULT_REMOTE_FEATURES.multiWallet},payWithExchange:{apiFeatureName:"fund_from_exchange",localFeatureName:"payWithExchange",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>fe.DEFAULT_REMOTE_FEATURES.payWithExchange},payments:{apiFeatureName:"payments",localFeatureName:"payments",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>fe.DEFAULT_REMOTE_FEATURES.payments},reownAuthentication:{apiFeatureName:"reown_authentication",localFeatureName:"reownAuthentication",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>typeof t>"u"?fe.DEFAULT_REMOTE_FEATURES.reownAuthentication:!!t},headless:{apiFeatureName:"headless",localFeatureName:"headless",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>fe.DEFAULT_REMOTE_FEATURES.headless}},b2={localSettingsOverridden:new Set,getApiConfig(t,e){return e==null?void 0:e.find(s=>s.id===t)},addWarning(t,e){if(t!==void 0){const s=no[e],n=s.isLegacy?`"features.${s.localFeatureName}" (now "${e}")`:`"features.${e}"`;this.localSettingsOverridden.add(n)}},processFeature(t,e,s,n,r){const i=no[t],o=e[i.localFeatureName];if(r&&!i.isAvailableOnBasic)return!1;if(n){const a=this.getApiConfig(i.apiFeatureName,s);return(a==null?void 0:a.config)===null?this.processFallbackFeature(t,o):a!=null&&a.config?(o!==void 0&&this.addWarning(o,t),this.processApiFeature(t,a)):!1}return this.processFallbackFeature(t,o)},processApiFeature(t,e){return no[t].processApi(e)},processFallbackFeature(t,e){return no[t].processFallback(e)},async fetchRemoteFeatures(t){const e=t.basic??!1,s=t.features||{};this.localSettingsOverridden.clear();let n=null,r=!1;try{n=await X.fetchProjectConfig(),r=n!=null}catch(o){console.warn("[Reown Config] Failed to fetch remote project configuration. Using local/default values.",o)}const i=r&&!e?fe.DEFAULT_REMOTE_FEATURES:fe.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(const o of y2){const a=this.processFeature(o,s,n,r,e);Object.assign(i,{[o]:a})}}catch(o){return console.warn("[Reown Config] Failed to process the configuration from Cloud. Using default values.",o),fe.DEFAULT_REMOTE_FEATURES}if(r&&this.localSettingsOverridden.size>0){const o=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(", ")} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;Pt.open({debugMessage:zt.ALERT_WARNINGS.LOCAL_CONFIGURATION_IGNORED.debugMessage(o)},"warning")}return i}};class E2{constructor(e){this.chainNamespaces=[],this.features={},this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(s,n)=>{var r,i,o;if(s){const a=(r=m.getCaipNetworks(s))==null?void 0:r.find(d=>d.id===n);if(a)return a;const c=(i=m.getNetworkData(s))==null?void 0:i.caipNetwork;return c||((o=m.getRequestedCaipNetworks(s).filter(d=>d.chainNamespace===s))==null?void 0:o[0])}return m.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{const s=this.getCaipNetwork();if(s)return s.id},this.getCaipNetworks=s=>m.getCaipNetworks(s),this.getActiveChainNamespace=()=>m.state.activeChain,this.setRequestedCaipNetworks=(s,n)=>{m.setRequestedCaipNetworks(s,n)},this.getApprovedCaipNetworkIds=()=>m.getAllApprovedCaipNetworkIds(),this.getCaipAddress=s=>{var n,r;return m.state.activeChain===s||!s?m.state.activeCaipAddress:(r=(n=m.state.chains.get(s))==null?void 0:n.accountState)==null?void 0:r.caipAddress},this.setClientId=s=>{re.setClientId(s)},this.getProvider=s=>Oe.getProvider(s),this.getProviderType=s=>Oe.getProviderId(s),this.getPreferredAccountType=s=>Zt(s),this.setCaipAddress=(s,n,r=!1)=>{m.setAccountProp("caipAddress",s,n,r),m.setAccountProp("address",Y.getPlainAddress(s),n,r)},this.setBalance=(s,n,r)=>{m.setAccountProp("balance",s,r),m.setAccountProp("balanceSymbol",n,r)},this.setProfileName=(s,n)=>{m.setAccountProp("profileName",s,n)},this.setProfileImage=(s,n)=>{m.setAccountProp("profileImage",s,n)},this.setUser=(s,n)=>{m.setAccountProp("user",s,n)},this.resetAccount=s=>{m.resetAccount(s)},this.setCaipNetwork=s=>{m.setActiveCaipNetwork(s)},this.setCaipNetworkOfNamespace=(s,n)=>{m.setChainNetworkData(n,{caipNetwork:s})},this.setStatus=(s,n)=>{m.setAccountProp("status",s,n),j.isConnected()?L.setConnectionStatus("connected"):L.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=s=>{var n;return(n=m.getAccountData(s))==null?void 0:n.address},this.setConnectors=s=>{const n=[...j.state.allConnectors,...s];j.setConnectors(n)},this.setConnections=(s,n)=>{L.setConnections(s,n),H.setConnections(s,n)},this.fetchIdentity=s=>re.fetchIdentity(s),this.getReownName=s=>si.getNamesForAddress(s),this.getConnectors=()=>j.getConnectors(),this.getConnectorImage=s=>Eo.getConnectorImage(s),this.getConnections=s=>this.remoteFeatures.multiWallet?vo.getConnectionsData(s).connections:(Pt.open(k.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.getRecentConnections=s=>this.remoteFeatures.multiWallet?vo.getConnectionsData(s).recentConnections:(Pt.open(k.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.switchConnection=async s=>{if(!this.remoteFeatures.multiWallet){Pt.open(k.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}await H.switchConnection(s)},this.deleteConnection=s=>{if(!this.remoteFeatures.multiWallet){Pt.open(k.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}L.deleteAddressFromConnection(s),H.syncStorageConnections()},this.setConnectedWalletInfo=(s,n)=>{const r=Oe.getProviderId(n),i=s?{...s,type:r}:void 0;m.setAccountProp("connectedWalletInfo",i,n)},this.getIsConnectedState=()=>!!m.state.activeCaipAddress,this.addAddressLabel=(s,n,r)=>{var o;const i=((o=m.getAccountData(r))==null?void 0:o.addressLabels)||{};m.setAccountProp("addressLabels",{...i,[s]:n},r)},this.removeAddressLabel=(s,n)=>{var i;const r=((i=m.getAccountData(n))==null?void 0:i.addressLabels)||{};m.setAccountProp("addressLabels",{...r,[s]:void 0},n)},this.getAddress=s=>{var r;const n=s||m.state.activeChain;return(r=m.getAccountData(n))==null?void 0:r.address},this.resetNetwork=s=>{m.resetNetwork(s)},this.addConnector=s=>{j.addConnector(s)},this.resetWcConnection=()=>{H.resetWcConnection()},this.setAddressExplorerUrl=(s,n)=>{m.setAccountProp("addressExplorerUrl",s,n)},this.setSmartAccountDeployed=(s,n)=>{m.setAccountProp("smartAccountDeployed",s,n)},this.setPreferredAccountType=(s,n)=>{m.setAccountProp("preferredAccountType",s,n)},this.setEIP6963Enabled=s=>{U.setEIP6963Enabled(s)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.readyPromise=this.initialize(e)}getChainNamespacesSet(e,s){const n=e==null?void 0:e.map(i=>i.namespace).filter(i=>!!i);if(n!=null&&n.length)return[...new Set(n)];const r=s==null?void 0:s.map(i=>i.chainNamespace);return[...new Set(r)]}async initialize(e){var s,n,r,i,o,a;if(this.initializeProjectSettings(e),this.initControllers(e),await this.initChainAdapters(),this.sendInitializeEvent(e),(s=e.features)!=null&&s.headless&&!ht.hasInjectedConnectors()&&X.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1,fetchWalletRanks:!1,fetchRecommendedWallets:!0}),U.state.enableReconnect?(await this.syncExistingConnection(),await this.syncAdapterConnections()):await this.unSyncExistingConnection(),!e.basic&&!e.manualWCControl&&(this.remoteFeatures=await b2.fetchRemoteFeatures(e)),await X.fetchUsage(),U.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&ic.setOnrampProviders(this.remoteFeatures.onramp),((n=U.state.remoteFeatures)!=null&&n.email||Array.isArray((r=U.state.remoteFeatures)==null?void 0:r.socials)&&((i=U.state.remoteFeatures)==null?void 0:i.socials.length)>0)&&await this.checkAllowedOrigins(),(o=U.state.features)!=null&&o.reownAuthentication||(a=U.state.remoteFeatures)!=null&&a.reownAuthentication){const{ReownAuthentication:c}=await mo(async()=>{const{ReownAuthentication:d}=await import("./features-1a8VRkrL.js");return{ReownAuthentication:d}},__vite__mapDeps([8,2,3,5,6,7])),l=U.state.siwx;l instanceof c||(l&&console.warn("ReownAuthentication option is enabled, SIWX configuration will be overridden."),U.setSIWX(new c))}}async openSend(e){var i;const s=e.namespace||m.state.activeChain,n=this.getCaipAddress(s),r=(i=this.getCaipNetwork(s))==null?void 0:i.id;if(!n)throw new Error("openSend: caipAddress not found");if((r==null?void 0:r.toString())!==e.chainId.toString()){const o=m.getCaipNetworkById(e.chainId,s);if(!o)throw new Error(`openSend: caipNetwork with chainId ${e.chainId} not found`);await this.switchNetwork(o,{throwOnFailure:!0})}try{const o=vg.getTokenSymbolByAddress(e.assetAddress);o&&await X.fetchTokenImages([o])}catch{}return await pe.open({view:"WalletSend",data:{send:e}}),new Promise((o,a)=>{const c=ue.subscribeKey("hash",u=>{u&&(d(),o({hash:u}))}),l=pe.subscribe(u=>{u.open||(d(),a(new Error("Modal closed")))}),d=this.createCleanupHandler([c,l])})}toModalOptions(){function e(n){return(n==null?void 0:n.view)==="Swap"}function s(n){return(n==null?void 0:n.view)==="WalletSend"}return{isSwap:e,isSend:s}}async checkAllowedOrigins(){try{const e=await X.fetchAllowedOrigins();if(!Y.isClient())return;const s=window.location.origin;fn.isOriginAllowed(s,e,k.DEFAULT_ALLOWED_ANCESTORS)||Pt.open(zt.ALERT_ERRORS.ORIGIN_NOT_ALLOWED,"error")}catch(e){if(!(e instanceof Error))return;switch(e.message){case"RATE_LIMITED":Pt.open(zt.ALERT_ERRORS.RATE_LIMITED_APP_CONFIGURATION,"error");break;case"SERVER_ERROR":{const s=e.cause instanceof Error?e.cause:e;Pt.open({displayMessage:zt.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.displayMessage,debugMessage:zt.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.debugMessage(s.message)},"error");break}}}}createCleanupHandler(e){return()=>{e.forEach(s=>{try{s()}catch{}})}}sendInitializeEvent(e){var n;const{...s}=e;delete s.adapters,delete s.universalProvider,de.sendEvent({type:"track",event:"INITIALIZE",properties:{...s,networks:e.networks.map(r=>r.id),siweConfig:{options:((n=e.siweConfig)==null?void 0:n.options)||{}}}})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initAdapterController(){qh.initialize(this.chainAdapters)}initializeThemeController(e){e.themeMode&&Rt.setThemeMode(e.themeMode),e.themeVariables&&Rt.setThemeVariables(e.themeVariables)}initializeChainController(e){if(!this.connectionControllerClient)throw new Error("ConnectionControllerClient must be set");m.initialize(e.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient});const s=this.getDefaultNetwork();s&&m.setActiveCaipNetwork(s)}initializeConnectionController(e){H.initialize(e.adapters??[]),H.setWcBasic(e.basic??!1)}initializeConnectorController(){j.initialize(this.chainNamespaces)}initializeProjectSettings(e){U.setProjectId(e.projectId),U.setSdkVersion(e.sdkVersion)}initializeOptionsController(e){var r;U.setDebug(e.debug!==!1),U.setEnableWalletGuide(e.enableWalletGuide!==!1),U.setEnableWallets(e.enableWallets!==!1),U.setEIP6963Enabled(e.enableEIP6963!==!1),U.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),U.setEnableReconnect(e.enableReconnect!==!1),U.setEnableMobileFullScreen(e.enableMobileFullScreen===!0),U.setCoinbasePreference(e.coinbasePreference),U.setEnableAuthLogger(e.enableAuthLogger!==!1),U.setCustomRpcUrls(e.customRpcUrls),U.setEnableEmbedded(e.enableEmbedded),U.setAllWallets(e.allWallets),U.setIncludeWalletIds(e.includeWalletIds),U.setExcludeWalletIds(e.excludeWalletIds),U.setFeaturedWalletIds(e.featuredWalletIds),U.setTokens(e.tokens),U.setTermsConditionsUrl(e.termsConditionsUrl),U.setPrivacyPolicyUrl(e.privacyPolicyUrl),U.setCustomWallets(e.customWallets),U.setFeatures(e.features),U.setAllowUnsupportedChain(e.allowUnsupportedChain),U.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),U.setPreferUniversalLinks(e.experimental_preferUniversalLinks),U.setDefaultAccountTypes(e.defaultAccountTypes);const s=this.getDefaultMetaData();if(!e.metadata&&s&&(e.metadata=s),U.setMetadata(e.metadata),U.setDisableAppend(e.disableAppend),U.setEnableEmbedded(e.enableEmbedded),U.setSIWX(e.siwx),this.features=U.state.features??{},!e.projectId){Pt.open(zt.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if(((r=e.adapters)==null?void 0:r.find(i=>i.namespace===k.CHAIN.EVM))&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");U.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){var e,s,n,r;return Y.isClient()?{name:((s=(e=document.getElementsByTagName("title"))==null?void 0:e[0])==null?void 0:s.textContent)||"",description:((n=document.querySelector('meta[property="og:description"]'))==null?void 0:n.content)||"",url:window.location.origin,icons:[((r=document.querySelector('link[rel~="icon"]'))==null?void 0:r.href)||""]}:null}setUnsupportedNetwork(e){const s=this.getActiveChainNamespace();if(s){const n=fr.getUnsupportedNetwork(`${s}:${e}`);m.setActiveCaipNetwork(n)}}getDefaultNetwork(){return fr.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,s){return fr.extendCaipNetwork(e,{customNetworkImageUrls:s.chainImages,projectId:s.projectId})}extendCaipNetworks(e){return fr.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){const s=e.networks.find(r=>{var i;return r.id===((i=e.defaultNetwork)==null?void 0:i.id)});return s?fr.extendCaipNetwork(s,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}async disconnectConnector(e,s){var n,r;try{this.setLoading(!0,e);let i={connections:[]};const o=this.getAdapter(e);return(((r=(n=m.state.chains.get(e))==null?void 0:n.accountState)==null?void 0:r.caipAddress)||!U.state.enableReconnect)&&(o!=null&&o.disconnect)&&(i=await o.disconnect({id:s})),this.setLoading(!1,e),i}catch(i){throw this.setLoading(!1,e),new Error(`Failed to disconnect chains: ${i.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{var l;const e=m.state.activeChain,s=this.getAdapter(e),n=(l=this.getCaipNetwork(e))==null?void 0:l.id,r=H.getConnections(e),i=this.remoteFeatures.multiWallet,o=r.length>0;if(!s)throw new Error("Adapter not found");const a=await s.connectWalletConnect(n);(!o||!i)&&this.close(),this.setClientId((a==null?void 0:a.clientId)||null),L.setConnectedNamespaces([...m.state.chains.keys()]),await this.syncWalletConnectAccount(),await as.initializeIfEnabled()},connectExternal:async e=>{const s=await this.onConnectExternal(e);return await this.connectInactiveNamespaces(e,s),s?{address:s.address}:void 0},reconnectExternal:async({id:e,info:s,type:n,provider:r})=>{var a;const i=m.state.activeChain,o=this.getAdapter(i);if(!i)throw new Error("reconnectExternal: namespace not found");if(!o)throw new Error("reconnectExternal: adapter not found");o!=null&&o.reconnect&&(await(o==null?void 0:o.reconnect({id:e,info:s,type:n,provider:r,chainId:(a=this.getCaipNetwork())==null?void 0:a.id})),L.addConnectedNamespace(i),this.syncConnectedWalletInfo(i))},disconnectConnector:async e=>{await this.disconnectConnector(e.namespace,e.id)},disconnect:async e=>{var l;const{id:s,chainNamespace:n,initialDisconnect:r}=e||{},i=n||m.state.activeChain,o=j.getConnectorId(i),a=s===k.CONNECTOR_ID.AUTH||o===k.CONNECTOR_ID.AUTH,c=s===k.CONNECTOR_ID.WALLET_CONNECT||o===k.CONNECTOR_ID.WALLET_CONNECT;try{const d=Array.from(m.state.chains.keys());let u=n?[n]:d;(c||a)&&(u=d);const h=u.map(async p=>{const w=j.getConnectorId(p),b=s||w,I=await this.disconnectConnector(p,b);I&&(a&&L.deleteConnectedSocialProvider(),I.connections.forEach(v=>{L.addDisconnectedConnectorId(v.connectorId,p)})),r&&this.onDisconnectNamespace({chainNamespace:p,closeModal:!1})}),f=await Promise.allSettled(h);ue.resetSend(),H.resetWcConnection(),(l=as.getSIWX())!=null&&l.signOutOnDisconnect&&await as.clearSessions(),j.setFilterByNamespace(void 0),H.syncStorageConnections();const g=f.filter(p=>p.status==="rejected");if(g.length>0)throw new Error(g.map(p=>p.reason.message).join(", "));de.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:n||"all"}})}catch(d){throw new Error(`Failed to disconnect chains: ${d.message}`)}},checkInstalled:e=>e?e.some(s=>{var n;return!!((n=window.ethereum)!=null&&n[String(s)])}):!!window.ethereum,signMessage:async e=>{const s=m.state.activeChain,n=this.getAdapter(m.state.activeChain);if(!s)throw new Error("signMessage: namespace not found");if(!n)throw new Error("signMessage: adapter not found");const r=this.getAddress(s);if(!r)throw new Error("signMessage: address not found");const i=await(n==null?void 0:n.signMessage({message:e,address:r,provider:Oe.getProvider(s)}));return(i==null?void 0:i.signature)||""},sendTransaction:async e=>{const s=e.chainNamespace;if(!s)throw new Error("sendTransaction: namespace not found");if(fe.SEND_SUPPORTED_NAMESPACES.includes(s)){const n=this.getAdapter(s);if(!n)throw new Error("sendTransaction: adapter not found");const r=Oe.getProvider(s),i=await(n==null?void 0:n.sendTransaction({...e,caipNetwork:this.getCaipNetwork(),provider:r}));return(i==null?void 0:i.hash)||""}return""},estimateGas:async e=>{const s=e.chainNamespace;if(s===k.CHAIN.EVM){const n=this.getAdapter(s);if(!n)throw new Error("estimateGas: adapter is required but got undefined");const r=Oe.getProvider(s),i=this.getCaipNetwork();if(!i)throw new Error("estimateGas: caipNetwork is required but got undefined");const o=await(n==null?void 0:n.estimateGas({...e,provider:r,caipNetwork:i}));return(o==null?void 0:o.gas)||0n}return 0n},getEnsAvatar:async()=>{var r;const e=m.state.activeChain;if(!e)throw new Error("getEnsAvatar: namespace is required but got undefined");const s=this.getAddress(e);if(!s)throw new Error("getEnsAvatar: address not found");await this.syncIdentity({address:s,chainId:Number((r=this.getCaipNetwork())==null?void 0:r.id),chainNamespace:e});const n=m.getAccountData();return(n==null?void 0:n.profileImage)||!1},getEnsAddress:async e=>await fn.resolveReownName(e),writeContract:async e=>{const s=m.state.activeChain,n=this.getAdapter(s);if(!s)throw new Error("writeContract: namespace is required but got undefined");if(!n)throw new Error("writeContract: adapter is required but got undefined");const r=this.getCaipNetwork(),i=this.getCaipAddress(),o=Oe.getProvider(s);if(!r||!i)throw new Error("writeContract: caipNetwork or caipAddress is required but got undefined");const a=await(n==null?void 0:n.writeContract({...e,caipNetwork:r,provider:o,caipAddress:i}));return a==null?void 0:a.hash},writeSolanaTransaction:async e=>{const s=m.state.activeChain,n=this.getAdapter(s);if(!s)throw new Error("writeContract: namespace is required but got undefined");if(!n)throw new Error("writeContract: adapter is required but got undefined");const r=this.getCaipNetwork(),i=this.getCaipAddress(),o=Oe.getProvider(s);if(!r||!i)throw new Error("writeContract: caipNetwork or caipAddress is required but got undefined");const a=await(n==null?void 0:n.writeSolanaTransaction({...e,caipNetwork:r,provider:o,caipAddress:i}));return a==null?void 0:a.hash},parseUnits:(e,s)=>{const n=this.getAdapter(m.state.activeChain);if(!n)throw new Error("parseUnits: adapter is required but got undefined");return(n==null?void 0:n.parseUnits({value:e,decimals:s}))??0n},formatUnits:(e,s)=>{const n=this.getAdapter(m.state.activeChain);if(!n)throw new Error("formatUnits: adapter is required but got undefined");return(n==null?void 0:n.formatUnits({value:e,decimals:s}))??"0"},getCapabilities:async e=>{const s=this.getAdapter(m.state.activeChain);if(!s)throw new Error("getCapabilities: adapter is required but got undefined");return await(s==null?void 0:s.getCapabilities(e))},grantPermissions:async e=>{const s=this.getAdapter(m.state.activeChain);if(!s)throw new Error("grantPermissions: adapter is required but got undefined");return await(s==null?void 0:s.grantPermissions(e))},revokePermissions:async e=>{const s=this.getAdapter(m.state.activeChain);if(!s)throw new Error("revokePermissions: adapter is required but got undefined");return s!=null&&s.revokePermissions?await s.revokePermissions(e):"0x"},walletGetAssets:async e=>{const s=this.getAdapter(m.state.activeChain);if(!s)throw new Error("walletGetAssets: adapter is required but got undefined");return await(s==null?void 0:s.walletGetAssets(e))??{}},updateBalance:e=>{const s=this.getAddress(e),n=this.getCaipNetwork(e);!n||!s||this.updateNativeBalance(s,n==null?void 0:n.id,e)}},H.setClient(this.connectionControllerClient)}async onConnectExternal(e){var l,d,u,h,f,g,p,w;const s=m.state.activeChain,n=e.chain||s,r=this.getAdapter(n);let i=!0;if(e.type===$s.CONNECTOR_TYPE_AUTH&&k.AUTH_CONNECTOR_SUPPORTED_CHAINS.some(v=>j.getConnectorId(v)===k.CONNECTOR_ID.AUTH)&&e.chain!==s&&(i=!1),e.chain&&e.chain!==s&&!e.caipNetwork){const b=this.getCaipNetworks().find(I=>I.chainNamespace===e.chain);b&&i&&this.setCaipNetwork(b)}if(!n)throw new Error("connectExternal: namespace not found");if(!r)throw new Error("connectExternal: adapter not found");const o=this.getCaipNetwork(n),a=e.caipNetwork||o,c=await r.connect({id:e.id,address:e.address,info:e.info,type:e.type,provider:e.provider,socialUri:e.socialUri,chainId:((l=e.caipNetwork)==null?void 0:l.id)||(o==null?void 0:o.id),rpcUrl:((f=(h=(u=(d=e.caipNetwork)==null?void 0:d.rpcUrls)==null?void 0:u.default)==null?void 0:h.http)==null?void 0:f[0])||((w=(p=(g=o==null?void 0:o.rpcUrls)==null?void 0:g.default)==null?void 0:p.http)==null?void 0:w[0])});if(c)return L.addConnectedNamespace(n),this.syncProvider({...c,chainNamespace:n}),this.setStatus("connected",n),this.syncConnectedWalletInfo(n),L.removeDisconnectedConnectorId(e.id,n),{address:c.address,connectedCaipNetwork:a}}async connectInactiveNamespaces(e,s){var a;const n=e.type===$s.CONNECTOR_TYPE_AUTH,r=Gc.getOtherAuthNamespaces((a=s==null?void 0:s.connectedCaipNetwork)==null?void 0:a.chainNamespace),i=m.state.activeCaipNetwork,o=this.getAdapter(i==null?void 0:i.chainNamespace);n&&(await Promise.all(r.map(async c=>{var l,d,u;try{const h=Oe.getProvider(c),f=this.getCaipNetwork(c),g=this.getAdapter(c);await(g==null?void 0:g.connect({...e,provider:h,socialUri:void 0,chainId:f==null?void 0:f.id,rpcUrl:(u=(d=(l=f==null?void 0:f.rpcUrls)==null?void 0:l.default)==null?void 0:d.http)==null?void 0:u[0]}))&&(L.addConnectedNamespace(c),L.removeDisconnectedConnectorId(e.id,c),this.setStatus("connected",c),this.syncConnectedWalletInfo(c))}catch(h){Pt.warn(zt.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.displayMessage,zt.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.debugMessage(c,h instanceof Error?h.message:void 0),zt.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.code)}})),i&&await(o==null?void 0:o.switchNetwork({caipNetwork:i})))}getApprovedCaipNetworksData(){var s,n,r,i,o;if(Oe.getProviderId(m.state.activeChain)===$s.CONNECTOR_TYPE_WALLET_CONNECT){const a=(n=(s=this.universalProvider)==null?void 0:s.session)==null?void 0:n.namespaces;return{supportsAllNetworks:((o=(i=(r=this.universalProvider)==null?void 0:r.session)==null?void 0:i.peer)==null?void 0:o.metadata.name)==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(a)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){const s=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){const r=Oe.getProviderId(s);if(e.chainNamespace===m.state.activeChain){const i=this.getAdapter(s);await(i==null?void 0:i.switchNetwork({caipNetwork:e}))}else if(this.setCaipNetwork(e),r===$s.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{const i=this.getAddressByChainNamespace(s);i&&this.syncAccount({address:i,chainId:e.id,chainNamespace:s})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(s=>{const n=s.chains||[],r=s.accounts.map(i=>{const{chainId:o,chainNamespace:a}=Qe.parseCaipAddress(i);return`${a}:${o}`});return Array.from(new Set([...n,...r]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((s,n)=>{var i,o;const r=e==null?void 0:e.find(a=>a.namespace===n);return r?(r.construct({namespace:n,projectId:(i=this.options)==null?void 0:i.projectId,networks:(o=this.caipNetworks)==null?void 0:o.filter(({chainNamespace:a})=>a===n)}),s[n]=r):s[n]=new w2({namespace:n,networks:this.getCaipNetworks()}),s},{})}async initChainAdapter(e){this.onConnectors(e),this.listenAdapter(e);const s=this.getAdapter(e);if(!s)throw new Error("adapter not found");await s.syncConnectors(),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)})),this.initAdapterController()}onConnectors(e){const s=this.getAdapter(e);s==null||s.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){const s=this.getAdapter(e);if(!s)return;const n=L.getConnectionStatus();U.state.enableReconnect===!1?this.setStatus("disconnected",e):n==="connected"?this.setStatus("connecting",e):n==="disconnected"?(L.clearAddressCache(),this.setStatus(n,e)):this.setStatus(n,e),s.on("switchNetwork",({address:r,chainId:i})=>{var l,d;const o=this.getCaipNetworks().find(u=>u.id.toString()===i.toString()||u.caipNetworkId.toString()===i.toString()),a=m.state.activeChain===e,c=(d=(l=m.state.chains.get(e))==null?void 0:l.accountState)==null?void 0:d.address;if(o){const u=a&&r?r:c;u&&this.syncAccount({address:u,chainId:o.id,chainNamespace:e})}else this.setUnsupportedNetwork(i)}),s.on("disconnect",()=>{const r=this.remoteFeatures.multiWallet,i=Array.from(H.state.connections.values()).flat();this.onDisconnectNamespace({chainNamespace:e,closeModal:!r||i.length===0})}),s.on("connections",r=>{this.setConnections(r,e)}),s.on("pendingTransactions",()=>{const r=this.getAddress(e),i=m.state.activeCaipNetwork;!r||!(i!=null&&i.id)||this.updateNativeBalance(r,i.id,i.chainNamespace)}),s.on("accountChanged",({address:r,chainId:i,connector:o})=>{var d,u;this.handlePreviousConnectorConnection(o);const a=m.state.activeChain===e;o!=null&&o.provider&&(this.syncProvider({id:o.id,type:o.type,provider:o==null?void 0:o.provider,chainNamespace:e}),this.syncConnectedWalletInfo(e));const c=(u=(d=m.getNetworkData(e))==null?void 0:d.caipNetwork)==null?void 0:u.id,l=i||c;a&&l?this.syncAccount({address:r,chainId:l,chainNamespace:e}):!a&&l?(this.syncAccountInfo(r,l,e),this.syncBalance({address:r,chainId:l,chainNamespace:e})):this.syncAccountInfo(r,i,e),L.addConnectedNamespace(e)})}async handlePreviousConnectorConnection(e){var c;const s=e==null?void 0:e.chain,n=e==null?void 0:e.id,r=j.getConnectorId(s),i=(c=U.state.remoteFeatures)==null?void 0:c.multiWallet,a=s&&n&&r&&r!==n&&!i;try{a&&await H.disconnect({id:r,namespace:s})}catch(l){console.warn("Error disconnecting previous connector",l)}}async createUniversalProviderForAdapter(e){var s,n,r;await this.getUniversalProvider(),this.universalProvider&&await((r=(n=(s=this.chainAdapters)==null?void 0:s[e])==null?void 0:n.setUniversalProvider)==null?void 0:r.call(n,this.universalProvider))}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async unSyncExistingConnection(){try{await Promise.allSettled(this.chainNamespaces.map(e=>H.disconnect({namespace:e,initialDisconnect:!0})))}catch(e){console.error("Error disconnecting existing connections:",e)}}async reconnectWalletConnect(){await this.syncWalletConnectAccount();const e=this.getAddress();this.getCaipAddress()||L.deleteRecentWallet();const s=L.getRecentWallet();de.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:e,properties:{method:Y.isMobile()?"mobile":"qrcode",name:(s==null?void 0:s.name)||"Unknown",reconnect:!0,view:se.state.view,walletRank:s==null?void 0:s.order}})}async syncNamespaceConnection(e){try{e===k.CHAIN.EVM&&Y.isSafeApp()&&j.setConnectorId(k.CONNECTOR_ID.SAFE,e);const s=j.getConnectorId(e);switch(this.setStatus("connecting",e),s){case k.CONNECTOR_ID.WALLET_CONNECT:await this.reconnectWalletConnect();break;case k.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(s){console.warn("AppKit couldn't sync existing connection",s),this.setStatus("disconnected",e)}}onDisconnectNamespace(e){const{chainNamespace:s,closeModal:n}=e||{};m.resetAccount(s),m.resetNetwork(s),L.removeConnectedNamespace(s);const r=Array.from(m.state.chains.keys());(s?[s]:r).forEach(o=>L.addDisconnectedConnectorId(j.getConnectorId(o)||"",o)),j.removeConnectorId(s),Oe.resetChain(s),this.setUser(null,s),this.setStatus("disconnected",s),this.setConnectedWalletInfo(null,s),n!==!1&&pe.close()}async syncAdapterConnections(){await Promise.allSettled(this.chainNamespaces.map(e=>{const s=this.getAdapter(e),n=this.getCaipAddress(e),r=this.getCaipNetwork(e);return s==null?void 0:s.syncConnections({connectToFirstConnector:!n,caipNetwork:r})}))}async syncAdapterConnection(e){var a,c,l,d,u;const s=this.getAdapter(e),n=this.getCaipNetwork(e),r=j.getConnectorId(e),o=j.getConnectors(e).find(h=>h.id===r);try{if(!s||!o)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!(n!=null&&n.id))throw new Error("CaipNetwork not found");const h=await(s==null?void 0:s.syncConnection({namespace:e,id:o.id,chainId:n.id,rpcUrl:(l=(c=(a=n==null?void 0:n.rpcUrls)==null?void 0:a.default)==null?void 0:c.http)==null?void 0:l[0]}));h?(this.syncProvider({...h,chainNamespace:e}),await this.syncAccount({...h,chainNamespace:e}),this.setStatus("connected",e),de.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:h.address,properties:{method:"browser",name:((d=o.info)==null?void 0:d.name)||o.name||"Unknown",reconnect:!0,view:se.state.view,walletRank:(u=o==null?void 0:o.explorerWallet)==null?void 0:u.order}})):this.setStatus("disconnected",e)}catch{this.onDisconnectNamespace({chainNamespace:e,closeModal:!1})}}async syncWalletConnectAccount(){var n,r;const e=Object.keys(((r=(n=this.universalProvider)==null?void 0:n.session)==null?void 0:r.namespaces)||{}),s=this.chainNamespaces.map(async i=>{var u,h,f,g,p;const o=this.getAdapter(i);if(!o)return;const a=((g=(f=(h=(u=this.universalProvider)==null?void 0:u.session)==null?void 0:h.namespaces)==null?void 0:f[i])==null?void 0:g.accounts)||[],c=(p=m.state.activeCaipNetwork)==null?void 0:p.id,l=a.find(w=>{const{chainId:b}=Qe.parseCaipAddress(w);return b===(c==null?void 0:c.toString())})||a[0];if(l){const w=Qe.validateCaipAddress(l),{chainId:b,address:I}=Qe.parseCaipAddress(w);if(Oe.setProviderId(i,$s.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&m.state.activeCaipNetwork&&o.namespace!==k.CHAIN.EVM){const v=o.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:m.state.activeCaipNetwork});Oe.setProvider(i,v)}else Oe.setProvider(i,this.universalProvider);j.setConnectorId(k.CONNECTOR_ID.WALLET_CONNECT,i),L.addConnectedNamespace(i),await this.syncAccount({address:I,chainId:b,chainNamespace:i})}else e.includes(i)&&this.setStatus("disconnected",i);const d=this.getApprovedCaipNetworksData();this.syncConnectedWalletInfo(i),m.setApprovedCaipNetworksData(i,{approvedCaipNetworkIds:d.approvedCaipNetworkIds,supportsAllNetworks:d.supportsAllNetworks})});await Promise.all(s)}syncProvider({type:e,provider:s,id:n,chainNamespace:r}){Oe.setProviderId(r,e),Oe.setProvider(r,s),j.setConnectorId(n,r)}async syncAccount(e){var u,h;const s=e.chainNamespace===m.state.activeChain,n=m.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:r,chainId:i,chainNamespace:o}=e,{chainId:a}=L.getActiveNetworkProps(),c=(n==null?void 0:n.id)||a,l=((u=m.state.activeCaipNetwork)==null?void 0:u.name)===k.UNSUPPORTED_NETWORK_NAME,d=m.getNetworkProp("supportsAllNetworks",o);if(this.setStatus("connected",o),!(l&&!d)&&c){let f=this.getCaipNetworks().find(b=>b.id.toString()===c.toString()),g=this.getCaipNetworks().find(b=>b.chainNamespace===o);if(!d&&!f&&!g){const b=this.getApprovedCaipNetworkIds()||[],I=b.find(E=>{var _;return((_=Qe.parseCaipNetworkId(E))==null?void 0:_.chainId)===c.toString()}),v=b.find(E=>{var _;return((_=Qe.parseCaipNetworkId(E))==null?void 0:_.chainNamespace)===o});f=this.getCaipNetworks().find(E=>E.caipNetworkId===I),g=this.getCaipNetworks().find(E=>E.caipNetworkId===v||"deprecatedCaipNetworkId"in E&&E.deprecatedCaipNetworkId===v)}const p=f||g;(p==null?void 0:p.chainNamespace)===m.state.activeChain?U.state.enableNetworkSwitch&&!U.state.allowUnsupportedChain&&((h=m.state.activeCaipNetwork)==null?void 0:h.name)===k.UNSUPPORTED_NETWORK_NAME?m.showUnsupportedChainUI():this.setCaipNetwork(p):s||n&&this.setCaipNetworkOfNamespace(n,o),this.syncConnectedWalletInfo(o);const w=this.getAddress(o);Gc.isLowerCaseMatch(r,w)||this.syncAccountInfo(r,p==null?void 0:p.id,o),s?await this.syncBalance({address:r,chainId:p==null?void 0:p.id,chainNamespace:o}):await this.syncBalance({address:r,chainId:n==null?void 0:n.id,chainNamespace:o}),this.syncIdentity({address:r,chainId:i,chainNamespace:o})}}async syncAccountInfo(e,s,n){const r=this.getCaipAddress(n),i=s||(r==null?void 0:r.split(":")[1]);if(!i)return;const o=`${n}:${i}:${e}`;this.setCaipAddress(o,n,!0),await this.syncIdentity({address:e,chainId:i,chainNamespace:n})}async syncReownName(e,s){try{const n=await this.getReownName(e);if(n[0]){const r=n[0];this.setProfileName(r.name,s)}else this.setProfileName(null,s)}catch{this.setProfileName(null,s)}}syncConnectedWalletInfo(e){var r;const s=j.getConnectorId(e),n=Oe.getProviderId(e);if(n===$s.CONNECTOR_TYPE_ANNOUNCED||n===$s.CONNECTOR_TYPE_INJECTED){if(s){const o=this.getConnectors().find(a=>{var u,h;const c=a.id===s,l=((u=a.info)==null?void 0:u.rdns)===s,d=(h=a.connectors)==null?void 0:h.some(f=>{var g;return f.id===s||((g=f.info)==null?void 0:g.rdns)===s});return c||l||!!d});if(o){const{info:a,name:c,imageUrl:l}=o,d=l||this.getConnectorImage(o);this.setConnectedWalletInfo({name:c,icon:d,...a},e)}}}else if(n===$s.CONNECTOR_TYPE_WALLET_CONNECT){const i=Oe.getProvider(e);i!=null&&i.session&&this.setConnectedWalletInfo({...i.session.peer.metadata,name:i.session.peer.metadata.name,icon:(r=i.session.peer.metadata.icons)==null?void 0:r[0]},e)}else if(s&&(s===k.CONNECTOR_ID.COINBASE_SDK||s===k.CONNECTOR_ID.COINBASE)){const i=this.getConnectors().find(l=>l.id===s),o=(i==null?void 0:i.name)||"Coinbase Wallet",a=(i==null?void 0:i.imageUrl)||this.getConnectorImage(i),c=i==null?void 0:i.info;this.setConnectedWalletInfo({...c,name:o,icon:a},e)}}async syncBalance(e){!Ph.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(n=>{var r;return n.id.toString()===((r=e.chainId)==null?void 0:r.toString())})||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(e,s,n){const r=this.getAdapter(n),i=m.getCaipNetworkByNamespace(n,s);if(r){const o=await r.getBalance({address:e,chainId:s,caipNetwork:i,tokens:this.options.tokens});return this.setBalance(o.balance,o.symbol,n),o}}async initializeUniversalAdapter(){var r,i,o,a,c,l,d,u,h,f;const e=g2.createLogger((g,...p)=>{g&&this.handleAlertError(g),console.error(...p)}),s={projectId:(r=this.options)==null?void 0:r.projectId,metadata:{name:(i=this.options)!=null&&i.metadata?(o=this.options)==null?void 0:o.metadata.name:"",description:(a=this.options)!=null&&a.metadata?(c=this.options)==null?void 0:c.metadata.description:"",url:(l=this.options)!=null&&l.metadata?(d=this.options)==null?void 0:d.metadata.url:"",icons:(u=this.options)!=null&&u.metadata?(h=this.options)==null?void 0:h.metadata.icons:[""]},logger:e};U.setManualWCControl(!!((f=this.options)!=null&&f.manualWCControl)),this.universalProvider=this.options.universalProvider??await LT.init(s);const n=this.universalProvider.disconnect.bind(this.universalProvider);this.universalProvider.disconnect=async()=>{try{return await n()}catch(g){if(g instanceof Error&&g.message.includes("Missing or invalid. Record was recently deleted"))return;throw g}},U.state.enableReconnect===!1&&this.universalProvider.session&&await this.universalProvider.disconnect(),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&this.chainNamespaces.forEach(e=>{fn.listenWcProvider({universalProvider:this.universalProvider,namespace:e,onDisplayUri:s=>{H.setUri(s)},onConnect:s=>{const{address:n}=Y.getAccount(s[0]);for(const r of this.chainNamespaces)L.removeDisconnectedConnectorId(k.CONNECTOR_ID.WALLET_CONNECT,r);H.finalizeWcConnection(n)},onDisconnect:()=>{m.state.noAdapters&&this.resetAccount(e),H.resetWcConnection()},onChainChanged:s=>{const n=m.state.activeChain,r=n&&j.state.activeConnectorIds[n]===k.CONNECTOR_ID.WALLET_CONNECT;if(n===e&&(m.state.noAdapters||r)){const i=this.getCaipNetworks().find(a=>a.id.toString()===s.toString()||a.caipNetworkId.toString()===s.toString()),o=this.getCaipNetwork();if(!i){this.setUnsupportedNetwork(s);return}(o==null?void 0:o.id.toString())!==(i==null?void 0:i.id.toString())&&(o==null?void 0:o.chainNamespace)===(i==null?void 0:i.chainNamespace)&&this.setCaipNetwork(i)}},onAccountsChanged:s=>{const n=m.state.activeChain,r=n&&j.state.activeConnectorIds[n]===k.CONNECTOR_ID.WALLET_CONNECT;if(n===e&&(m.state.noAdapters||r)){const i=s==null?void 0:s[0];i&&this.syncAccount({address:i.address,chainId:i.chainId,chainNamespace:i.chainNamespace})}}})})}createUniversalProvider(){var e;return!this.universalProviderInitPromise&&Y.isClient()&&((e=this.options)!=null&&e.projectId)&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){de.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}getDisabledCaipNetworks(){const e=m.getAllApprovedCaipNetworkIds(),s=m.getAllRequestedCaipNetworks();return Y.sortRequestedNetworks(e,s).filter(r=>m.isCaipNetworkDisabled(r))}handleAlertError(e){const s=Object.entries(zt.UniversalProviderErrors).find(([,{message:a}])=>e.message.includes(a)),[n,r]=s??[],{message:i,alertErrorKey:o}=r??{};if(n&&i&&!this.reportedAlertErrors[n]){const a=zt.ALERT_ERRORS[o];a&&(Pt.open(a,"error"),this.reportedAlertErrors[n]=!0)}}getAdapter(e){var s;if(e)return(s=this.chainAdapters)==null?void 0:s[e]}createAdapter(e){var r,i;if(!e)return;const s=e.namespace;if(!s)return;this.createClients();const n=e;n.namespace=s,n.construct({namespace:s,projectId:(r=this.options)==null?void 0:r.projectId,networks:(i=this.caipNetworks)==null?void 0:i.filter(({chainNamespace:o})=>o===s)}),this.chainNamespaces.includes(s)||this.chainNamespaces.push(s),this.chainAdapters&&(this.chainAdapters[s]=n)}async open(e){await this.injectModalUi(),e!=null&&e.uri&&H.setUri(e.uri);const{isSwap:s,isSend:n}=this.toModalOptions();return s(e)?pe.open({...e,data:{swap:e.arguments}}):n(e)&&e.arguments?this.openSend(e.arguments):pe.open(e)}async close(){await this.injectModalUi(),pe.close()}setLoading(e,s){pe.setLoading(e,s)}async disconnect(e){await H.disconnect({namespace:e})}getSIWX(){return U.state.siwx}getError(){return""}getChainId(){var e;return(e=m.state.activeCaipNetwork)==null?void 0:e.id}async switchNetwork(e,{throwOnFailure:s=!1}={}){const n=this.getCaipNetworks().find(r=>r.id===e.id);if(!n){Pt.open(zt.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}await m.switchActiveNetwork(n,{throwOnFailure:s})}getWalletProvider(){return m.state.activeChain?Oe.state.providers[m.state.activeChain]:null}getWalletProviderType(){return Oe.getProviderId(m.state.activeChain)}subscribeProviders(e){return Oe.subscribeProviders(e)}getThemeMode(){return Rt.state.themeMode}getThemeVariables(){return Rt.state.themeVariables}setThemeMode(e){Rt.setThemeMode(e),Vc(Rt.state.themeMode)}setTermsConditionsUrl(e){U.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){U.setPrivacyPolicyUrl(e)}setThemeVariables(e){Rt.setThemeVariables(e),h2(Rt.state.themeVariables)}subscribeTheme(e){return Rt.subscribe(e)}subscribeConnections(e){return this.remoteFeatures.multiWallet?H.subscribe(e):(Pt.open(k.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),()=>{})}getWalletInfo(e){var n,r;if(e)return(r=(n=m.state.chains.get(e))==null?void 0:n.accountState)==null?void 0:r.connectedWalletInfo;const s=m.getAccountData();return s==null?void 0:s.connectedWalletInfo}getAccount(e){const s=e||m.state.activeChain,n=j.getAuthConnector(s),r=m.getAccountData(s),i=L.getConnectedConnectorId(m.state.activeChain),o=H.getConnections(s);if(!s)throw new Error("AppKit:getAccount - namespace is required");const a=o.flatMap(c=>c.accounts.map(({address:l,type:d,publicKey:u})=>Y.createAccount(s,l,d||"eoa",u)));if(r)return{allAccounts:a,caipAddress:r.caipAddress,address:Y.getPlainAddress(r.caipAddress),isConnected:!!r.caipAddress,status:r.status,embeddedWalletInfo:n&&i===k.CONNECTOR_ID.AUTH?{user:r.user?{...r.user,username:L.getConnectedSocialUsername()}:void 0,authProvider:r.socialProvider||"email",accountType:Zt(s),isSmartAccountDeployed:!!r.smartAccountDeployed}:void 0}}subscribeAccount(e,s){const n=[],r=()=>{const o=this.getAccount(s);o&&e(o)};if(s){const o=m.subscribeChainProp("accountState",r,s);n.push(o)}else{const o=m.subscribe(r);n.push(o)}const i=j.subscribe(r);return n.push(i),()=>{n.forEach(o=>o())}}subscribeNetwork(e){return m.subscribe(({activeCaipNetwork:s})=>{e({caipNetwork:s,chainId:s==null?void 0:s.id,caipNetworkId:s==null?void 0:s.caipNetworkId})})}subscribeWalletInfo(e,s){return s?m.subscribeChainProp("accountState",n=>e(n==null?void 0:n.connectedWalletInfo),s):m.subscribeChainProp("accountState",n=>e(n==null?void 0:n.connectedWalletInfo))}subscribeShouldUpdateToAddress(e){return m.subscribeChainProp("accountState",s=>e(s==null?void 0:s.shouldUpdateToAddress))}subscribeCaipNetworkChange(e){return m.subscribeKey("activeCaipNetwork",e)}getState(){return cs.state}getRemoteFeatures(){return U.state.remoteFeatures}subscribeState(e){return cs.subscribe(e)}subscribeRemoteFeatures(e){return U.subscribeKey("remoteFeatures",e)}showErrorMessage(e){Es.showError(e)}showSuccessMessage(e){Es.showSuccess(e)}getEvent(){return{...de.state}}subscribeEvents(e){return de.subscribe(e)}replace(e){se.replace(e)}redirect(e){se.push(e)}popTransactionStack(e){se.popTransactionStack(e)}isOpen(){return pe.state.open}isTransactionStackEmpty(){return se.state.transactionStack.length===0}static getInstance(){return this.instance}updateFeatures(e){U.setFeatures(e)}updateRemoteFeatures(e){U.setRemoteFeatures(e)}updateOptions(e){const n={...U.state||{},...e};U.setOptions(n)}setConnectMethodsOrder(e){U.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){U.setWalletFeaturesOrder(e)}setCollapseWallets(e){U.setCollapseWallets(e)}setSocialsOrder(e){U.setSocialsOrder(e)}getConnectMethodsOrder(){return hn.getConnectOrderMethod(U.state.features,j.getConnectors())}addNetwork(e,s){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);const n=this.extendCaipNetwork(s,this.options);this.getCaipNetworks().find(r=>r.id===n.id)||m.addNetwork(n)}removeNetwork(e,s){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(r=>r.id===s)&&m.removeNetwork(e,s)}}let Ah=!1;class Cg extends E2{async open(e){j.isConnected()||await super.open(e)}async close(){var e;if(await super.close(),this.options.manualWCControl){const s=(e=m.getAccountData(this.activeChainNamespace))==null?void 0:e.address;H.finalizeWcConnection(s)}}async syncIdentity(e){return Promise.resolve()}async syncBalance(e){return Promise.resolve()}async injectModalUi(){if(!Ah&&Y.isClient()){if(await mo(()=>import("./basic-B89gVQ4F.js"),__vite__mapDeps([9,10,2,3,5,6,7])),await mo(()=>import("./w3m-modal-DFS-P5Ca.js"),__vite__mapDeps([11,10,2,3,5,6,7])),!document.querySelector("w3m-modal")){const s=document.createElement("w3m-modal");!U.state.disableAppend&&!U.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",s)}Ah=!0}}}const v2="1.8.17-wc-circular-dependencies-fix.0";function C2(t){return new Cg({...t,basic:!0,sdkVersion:`html-core-${v2}`})}const ox=Object.freeze(Object.defineProperty({__proto__:null,AppKit:Cg,createAppKit:C2},Symbol.toStringTag,{value:"Module"}));export{qh as $,X as A,re as B,m as C,fe as D,xr as E,jh as F,j as G,tt as H,et as I,ke as J,as as K,nm as L,pe as M,Ph as N,Qe as O,Oe as P,Ii as Q,se as R,ee as S,Gc as T,U,_2 as V,js as W,Eo as X,Jt as Y,Rt as Z,nx as _,k as a,ht as a0,Hn as a1,Fs as a2,vo as a3,fr as a4,L as a5,hn as a6,ox as a7,Z as b,gg as c,go as d,ex as e,Ll as f,Li as g,Ge as h,dn as i,sx as j,ix as k,$h as l,es as m,Es as n,H as o,de as p,Zt as q,rx as r,Hg as s,Y as t,zc as u,u2 as v,tx as w,Wm as x,Pt as y,sl as z};
