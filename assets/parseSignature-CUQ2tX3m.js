import{g as j,bi as w,c8 as I,a4 as z,cj as L,cD as D,b7 as O,cZ as K,ci as u,c_ as U,x as W,c$ as q,a_ as Y,a7 as $,ce as A,S as N,aM as J,B,d0 as Q,cy as Z,c6 as M,cz as X,d1 as ee,d2 as te,d3 as se,am as ne,bY as re,cL as P,ba as ie,b4 as oe,bf as ae,b5 as ce,cF as ue,ad as le,cN as F,cJ as H,d4 as fe,bx as de,c5 as he,d5 as xe,c3 as _,cB as V,cE as ge,d6 as me,d7 as be,d8 as pe,cQ as ye,d9 as we,bj as Pe,cs as Ie,da as ze}from"./index-DAFyR3CE.js";function je(t,e){if(t.length!==e.length)throw new j({expectedLength:t.length,givenLength:e.length});const n=[];for(let s=0;s<t.length;s++){const r=t[s],i=e[s];n.push(R(r,i))}return w(n)}function R(t,e,n=!1){if(t==="address"){const a=e;if(!I(a))throw new z({address:a});return L(a.toLowerCase(),{size:n?32:null})}if(t==="string")return D(e);if(t==="bytes")return e;if(t==="bool")return L(O(e),{size:n?32:1});const s=t.match(K);if(s){const[a,o,l="256"]=s,f=Number.parseInt(l,10)/8;return u(e,{size:n?32:f,signed:o==="int"})}const r=t.match(U);if(r){const[a,o]=r;if(Number.parseInt(o,10)!==(e.length-2)/2)throw new W({expectedSize:Number.parseInt(o,10),givenSize:(e.length-2)/2});return L(e,{dir:"right",size:n?32:null})}const i=t.match(q);if(i&&Array.isArray(e)){const[a,o]=i,l=[];for(let f=0;f<e.length;f++)l.push(R(o,e[f],!0));return l.length===0?"0x":w(l)}throw new Y(t)}function Te(t){const{authorizationList:e}=t;if(e)for(const n of e){const{chainId:s}=n,r=n.address;if(!I(r))throw new z({address:r});if(s<0)throw new $({chainId:s})}k(t)}function ve(t){const{blobVersionedHashes:e}=t;if(e){if(e.length===0)throw new Q;for(const n of e){const s=Z(n),r=M(X(n,0,1));if(s!==32)throw new ee({hash:n,size:s});if(r!==te)throw new se({hash:n,version:r})}}k(t)}function k(t){const{chainId:e,maxPriorityFeePerGas:n,maxFeePerGas:s,to:r}=t;if(e<=0)throw new $({chainId:e});if(r&&!I(r))throw new z({address:r});if(s&&s>A)throw new N({maxFeePerGas:s});if(n&&s&&n>s)throw new J({maxFeePerGas:s,maxPriorityFeePerGas:n})}function Ee(t){const{chainId:e,maxPriorityFeePerGas:n,gasPrice:s,maxFeePerGas:r,to:i}=t;if(e<=0)throw new $({chainId:e});if(i&&!I(i))throw new z({address:i});if(n||r)throw new B("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid EIP-2930 Transaction attribute.");if(s&&s>A)throw new N({maxFeePerGas:s})}function Fe(t){const{chainId:e,maxPriorityFeePerGas:n,gasPrice:s,maxFeePerGas:r,to:i}=t;if(i&&!I(i))throw new z({address:i});if(typeof e<"u"&&e<=0)throw new $({chainId:e});if(n||r)throw new B("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid Legacy Transaction attribute.");if(s&&s>A)throw new N({maxFeePerGas:s})}function G(t){if(!t||t.length===0)return[];const e=[];for(let n=0;n<t.length;n++){const{address:s,storageKeys:r}=t[n];for(let i=0;i<r.length;i++)if(r[i].length-2!==64)throw new ne({storageKey:r[i]});if(!I(s,{strict:!1}))throw new z({address:s});e.push([s,r])}return e}function De(t,e){const n=re(t);return n==="eip1559"?Se(t,e):n==="eip2930"?$e(t,e):n==="eip4844"?Ce(t,e):n==="eip7702"?Be(t,e):Ge(t,e)}function Be(t,e){const{authorizationList:n,chainId:s,gas:r,nonce:i,to:a,value:o,maxFeePerGas:l,maxPriorityFeePerGas:f,accessList:c,data:x}=t;Te(t);const h=G(c),d=Le(n);return w(["0x04",P([u(s),i?u(i):"0x",f?u(f):"0x",l?u(l):"0x",r?u(r):"0x",a??"0x",o?u(o):"0x",x??"0x",h,d,...C(t,e)])])}function Ce(t,e){const{chainId:n,gas:s,nonce:r,to:i,value:a,maxFeePerBlobGas:o,maxFeePerGas:l,maxPriorityFeePerGas:f,accessList:c,data:x}=t;ve(t);let h=t.blobVersionedHashes,d=t.sidecars;if(t.blobs&&(typeof h>"u"||typeof d>"u")){const b=typeof t.blobs[0]=="string"?t.blobs:t.blobs.map(E=>ie(E)),S=t.kzg,v=oe({blobs:b,kzg:S});if(typeof h>"u"&&(h=ae({commitments:v})),typeof d>"u"){const E=ce({blobs:b,commitments:v,kzg:S});d=ue({blobs:b,commitments:v,proofs:E})}}const p=G(c),m=[u(n),r?u(r):"0x",f?u(f):"0x",l?u(l):"0x",s?u(s):"0x",i??"0x",a?u(a):"0x",x??"0x",p,o?u(o):"0x",h??[],...C(t,e)],g=[],T=[],y=[];if(d)for(let b=0;b<d.length;b++){const{blob:S,commitment:v,proof:E}=d[b];g.push(S),T.push(v),y.push(E)}return w(["0x03",d?P([m,g,T,y]):P(m)])}function Se(t,e){const{chainId:n,gas:s,nonce:r,to:i,value:a,maxFeePerGas:o,maxPriorityFeePerGas:l,accessList:f,data:c}=t;k(t);const x=G(f),h=[u(n),r?u(r):"0x",l?u(l):"0x",o?u(o):"0x",s?u(s):"0x",i??"0x",a?u(a):"0x",c??"0x",x,...C(t,e)];return w(["0x02",P(h)])}function $e(t,e){const{chainId:n,gas:s,data:r,nonce:i,to:a,value:o,accessList:l,gasPrice:f}=t;Ee(t);const c=G(l),x=[u(n),i?u(i):"0x",f?u(f):"0x",s?u(s):"0x",a??"0x",o?u(o):"0x",r??"0x",c,...C(t,e)];return w(["0x01",P(x)])}function Ge(t,e){const{chainId:n=0,gas:s,data:r,nonce:i,to:a,value:o,gasPrice:l}=t;Fe(t);let f=[i?u(i):"0x",l?u(l):"0x",s?u(s):"0x",a??"0x",o?u(o):"0x",r??"0x"];if(e){const c=(()=>{if(e.v>=35n)return(e.v-35n)/2n>0?e.v:27n+(e.v===35n?0n:1n);if(n>0)return BigInt(n*2)+BigInt(35n+e.v-27n);const d=27n+(e.v===27n?0n:1n);if(e.v!==d)throw new le({v:e.v});return d})(),x=F(e.r),h=F(e.s);f=[...f,u(c),x==="0x00"?"0x":x,h==="0x00"?"0x":h]}else n>0&&(f=[...f,u(n),"0x","0x"]);return P(f)}function C(t,e){const n=e??t,{v:s,yParity:r}=n;if(typeof n.r>"u")return[];if(typeof n.s>"u")return[];if(typeof s>"u"&&typeof r>"u")return[];const i=F(n.r),a=F(n.s);return[typeof r=="number"?r?u(1):"0x":s===0n?"0x":s===1n?u(1):s===27n?"0x":u(1),i==="0x00"?"0x":i,a==="0x00"?"0x":a]}function Le(t){if(!t||t.length===0)return[];const e=[];for(const n of t){const{chainId:s,nonce:r,...i}=n,a=n.address;e.push([s?H(s):"0x",a,r?H(r):"0x",...C({},i)])}return e}function Oe(t){const{source:e}=t,n=new Map,s=new fe(8192),r=new Map,i=({address:a,chainId:o})=>`${a}.${o}`;return{async consume({address:a,chainId:o,client:l}){const f=i({address:a,chainId:o}),c=this.get({address:a,chainId:o,client:l});this.increment({address:a,chainId:o});const x=await c;return await e.set({address:a,chainId:o},x),s.set(f,x),x},async increment({address:a,chainId:o}){const l=i({address:a,chainId:o}),f=n.get(l)??0;n.set(l,f+1)},async get({address:a,chainId:o,client:l}){const f=i({address:a,chainId:o});let c=r.get(f);return c||(c=(async()=>{try{const h=await e.get({address:a,chainId:o,client:l}),d=s.get(f)??0;return d>0&&h<=d?d+1:(s.delete(f),h)}finally{this.reset({address:a,chainId:o})}})(),r.set(f,c)),(n.get(f)??0)+await c},reset({address:a,chainId:o}){const l=i({address:a,chainId:o});n.delete(l),r.delete(l)}}}const Me="0x6492649264926492649264926492649264926492649264926492649264926492";function Ke(t){const{address:e,data:n,signature:s,to:r="hex"}=t,i=w([de([{type:"address"},{type:"bytes"},{type:"bytes"}],[e,n,s]),Me]);return r==="hex"?i:he(i)}class Ae extends B{constructor({value:e}){super(`Number \`${e}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function Ue(t,e){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(t))throw new Ae({value:t});let[n,s="0"]=t.split(".");const r=n.startsWith("-");if(r&&(n=n.slice(1)),s=s.replace(/(0+)$/,""),e===0)Math.round(+`.${s}`)===1&&(n=`${BigInt(n)+1n}`),s="";else if(s.length>e){const[i,a,o]=[s.slice(0,e-1),s.slice(e-1,e),s.slice(e)],l=Math.round(+`${a}.${o}`);l>9?s=`${BigInt(i)+BigInt(1)}0`.padStart(i.length+1,"0"):s=`${i}${l}`,s.length>e&&(s=s.slice(1),n=`${BigInt(n)+1n}`),s=s.slice(0,e)}else s=s.padEnd(e,"0");return BigInt(`${r?"-":""}${n}${s}`)}const Ne="0x5792579257925792579257925792579257925792579257925792579257925792",ke=u(0,{size:32});async function He(t,e){async function n(c){if(c.endsWith(Ne.slice(2))){const h=F(V(c,-64,-32)),d=V(c,0,-64).slice(2).match(/.{1,64}/g),p=await Promise.all(d.map(g=>ke.slice(2)!==g?t.request({method:"eth_getTransactionReceipt",params:[`0x${g}`]},{dedupe:!0}):void 0)),m=p.some(g=>g===null)?100:p.every(g=>(g==null?void 0:g.status)==="0x1")?200:p.every(g=>(g==null?void 0:g.status)==="0x0")?500:600;return{atomic:!1,chainId:M(h),receipts:p.filter(Boolean),status:m,version:"2.0.0"}}return t.request({method:"wallet_getCallsStatus",params:[c]})}const{atomic:s=!1,chainId:r,receipts:i,version:a="2.0.0",...o}=await n(e.id),[l,f]=(()=>{const c=o.status;return c>=100&&c<200?["pending",c]:c>=200&&c<300?["success",c]:c>=300&&c<700?["failure",c]:c==="CONFIRMED"?["success",200]:c==="PENDING"?["pending",100]:[void 0,c]})();return{...o,atomic:s,chainId:r?M(r):void 0,receipts:(i==null?void 0:i.map(c=>({...c,blockNumber:_(c.blockNumber),gasUsed:_(c.gasUsed),status:xe[c.status]})))??[],statusCode:f,status:l,version:a}}class _e extends B{constructor(e){super(`Call bundle failed with status: ${e.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=e}}async function We(t,e){const{id:n,pollingInterval:s=t.pollingInterval,status:r=({statusCode:m})=>m===200||m>=300,retryCount:i=4,retryDelay:a=({count:m})=>~~(1<<m)*200,timeout:o=6e4,throwOnFailure:l=!1}=e,f=ge(["waitForCallsStatus",t.uid,n]),{promise:c,resolve:x,reject:h}=me();let d;const p=be(f,{resolve:x,reject:h},m=>{const g=pe(async()=>{const T=y=>{clearTimeout(d),g(),y(),p()};try{const y=await ye(async()=>{const b=await we(t,He,"getCallsStatus")({id:n});if(l&&b.status==="failure")throw new _e(b);return b},{retryCount:i,delay:a});if(!r(y))return;T(()=>m.resolve(y))}catch(y){T(()=>m.reject(y))}},{interval:s,emitOnBegin:!0});return g});return d=o?setTimeout(()=>{p(),clearTimeout(d),h(new Ve({id:n}))},o):void 0,await c}class Ve extends B{constructor({id:e}){super(`Timed out while waiting for call bundle with id "${e}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}}function qe(t){const{key:e="public",name:n="Public Client"}=t;return Pe({...t,key:e,name:n,type:"publicClient"}).extend(Ie)}function Ye(t){const{r:e,s:n}=ze.Signature.fromCompact(t.slice(2,130)),s=+`0x${t.slice(130)}`,[r,i]=(()=>{if(s===0||s===1)return[void 0,s];if(s===27)return[BigInt(s),0];if(s===28)return[BigInt(s),1];throw new Error("Invalid yParityOrV value")})();return typeof r<"u"?{r:u(e,{size:32}),s:u(n,{size:32}),v:r,yParity:i}:{r:u(e,{size:32}),s:u(n,{size:32}),yParity:i}}export{_e as B,Ae as I,Ve as W,k as a,Ee as b,qe as c,Fe as d,Oe as e,je as f,Ue as g,Ke as h,De as i,Ye as p,G as s,C as t,We as w};
